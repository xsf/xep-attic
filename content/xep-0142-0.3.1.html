<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>XEP-0142: Workgroup Queues</title><link rel="stylesheet" type="text/css" href="xmpp.css" /><link href="prettify.css" type="text/css" rel="stylesheet" /><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" /><script type="text/javascript" src="prettify.js"></script><meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=2.0" /><meta name="DC.Title" content="Workgroup Queues" /><meta name="DC.Creator" content="Matt Tucker" /><meta name="DC.Description" content="This document defines an XMPP protocol extension that enables a user to communicate with a representative of an organization, department, or workgroup." /><meta name="DC.Publisher" content="XMPP Standards Foundation" /><meta name="DC.Contributor" content="XMPP Extensions Editor" /><meta name="DC.Date" content="2018-11-03" /><meta name="DC.Type" content="XMPP Extension Protocol" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="XEP-0142" /><meta name="DC.Language" content="en" /><meta name="DC.Rights" content="This XMPP Extension Protocol is copyright &#xA9; 1999 &#x2013; 2018 by the XMPP Standards Foundation (XSF)." /></head><body onload="prettyPrint()"><h1>XEP-0142: Workgroup Queues</h1><table><tr valign="top"><td><strong>Abstract:</strong></td><td>This document defines an XMPP protocol extension that enables a user to communicate with a representative of an organization, department, or workgroup.</td></tr><tr valign="top"><td><strong>Author:</strong></td><td>Matt Tucker</td></tr><tr valign="top"><td><strong>Copyright:</strong></td><td>© 1999 – 2018 XMPP Standards Foundation. <a href="#appendix-legal">SEE LEGAL NOTICES</a>.</td></tr><tr valign="top"><td><strong>Status:</strong></td><td>Deferred</td></tr><tr valign="top"><td><strong>Type:</strong></td><td>Standards Track</td></tr><tr valign="top"><td><strong>Version:</strong></td><td>0.3.1</td></tr><tr valign="top"><td><strong>Last Updated:</strong></td><td>2018-11-03</td></tr></table><hr /><p style="color:red">WARNING: This document has been automatically Deferred after 12 months of inactivity in its previous Experimental state. Implementation of the protocol described herein is not recommended for production systems. However, exploratory implementations are encouraged to resume the standards process.</p><hr /><h2>Table of Contents</h2><div class="indent"><p><br />1.  <a href="#intro">Introduction</a><br />   
      1.1.  <a href="#intro-over">Overview</a><br />   
      1.2.  <a href="#intro-motive">Motivation</a><br />   
      1.3.  <a href="#intro-concepts">Concepts</a><br />   
      1.4.  <a href="#intro-prereq">Prerequisites</a><br />2.  <a href="#roleresp">Roles and Responsibilities</a><br />   
      2.1.  <a href="#roles">Roles</a><br />   
      2.2.  <a href="#responsibilities">Responsibilities</a><br />3.  <a href="#user">User Protocol</a><br />   
      3.1.  <a href="#proto-states">User States</a><br />   
      3.2.  <a href="#proto-user">User Packet Exchanges</a><br />      
      3.2.1.  <a href="#proto-user-join">User Join Protocol</a><br />        
      3.2.1.1.  <a href="#proto-user-join-errors">Error Conditions</a><br />        
      3.2.1.2.  <a href="#proto-user-join-example">Example</a><br />      
      3.2.2.  <a href="#proto-user-depart">User Depart Protocol</a><br />        
      3.2.2.1.  <a href="#proto-user-depart-errors">Error Conditions</a><br />        
      3.2.2.2.  <a href="#proto-user-depart-example">Example</a><br />      
      3.2.3.  <a href="#proto-user-status">User Status Update Protocol</a><br />        
      3.2.3.1.  <a href="#proto-user-status-updates">User Status Updates</a><br />        
      3.2.3.2.  <a href="#proto-user-status-errors">Error Conditions</a><br />      
      3.2.4.  <a href="#proto-user-invite">User Invite Protocol</a><br />        
      3.2.4.1.  <a href="#proto-user-invite-errors">Error Conditions</a><br />        
      3.2.4.2.  <a href="#proto-user-invite-example">Example</a><br />4.  <a href="#agent">Agent Protocol</a><br />   
      4.1.  <a href="#proto-agent-states">Agent States</a><br />   
      4.2.  <a href="#proto-agent">Agent Packet Exchanges</a><br />      
      4.2.1.  <a href="#proto-agent-presence">Agent Presence Protocol</a><br />        
      4.2.1.1.  <a href="#proto-agent-presence-errors">Error Conditions</a><br />        
      4.2.1.2.  <a href="#proto-agent-presence-example">Example</a><br />      
      4.2.2.  <a href="#proto-workgroup-status">Workgroup Status Update Protocol</a><br />        
      4.2.2.1.  <a href="#proto-workgroup-status-errors">Error Conditions</a><br />        
      4.2.2.2.  <a href="#proto-workgroup-status-example">Example</a><br />      
      4.2.3.  <a href="#proto-queue-status">Queue Status Update Protocol</a><br />        
      4.2.3.1.  <a href="#proto-queue-status-errors">Error Conditions</a><br />        
      4.2.3.2.  <a href="#proto-queue-status-example">Example</a><br />      
      4.2.4.  <a href="#proto-agent-status">Agent Status Update Protocol</a><br />        
      4.2.4.1.  <a href="#proto-agent-status-errors">Error Conditions</a><br />      
      4.2.5.  <a href="#proto-agent-offer">Agent Offer Protocol</a><br />        
      4.2.5.1.  <a href="#proto-agent-offer-errors">Error Conditions</a><br />        
      4.2.5.2.  <a href="#proto-agent-offer-example">Example</a><br />      
      4.2.6.  <a href="#proto-agent-acceptreject">Agent Offer Accept/Reject Protocol</a><br />        
      4.2.6.1.  <a href="#proto-agent-acceptreject-errors">Error Conditions</a><br />        
      4.2.6.2.  <a href="#proto-agent-acceptreject-example">Example</a><br />      
      4.2.7.  <a href="#proto-agent-revoke">Agent Offer Revoke Protocol</a><br />        
      4.2.7.1.  <a href="#proto-agent-revoke-errors">Error Conditions</a><br />        
      4.2.7.2.  <a href="#proto-agent-revoke-example">Example</a><br />      
      4.2.8.  <a href="#proto-agent-invite">Agent Invite Protocol</a><br />        
      4.2.8.1.  <a href="#proto-agent-invite-errors">Error Conditions</a><br />        
      4.2.8.2.  <a href="#proto-agent-invite-example">Example</a><br />5.  <a href="#disco">Service Discovery</a><br />6.  <a href="#impl">Implementation Notes</a><br />7.  <a href="#security">Security Considerations</a><br />8.  <a href="#iana">IANA Considerations</a><br />9.  <a href="#registrar">XMPP Registrar Considerations</a><br />   
      9.1.  <a href="#registrar-ns">Protocol Namespaces</a><br />   
      9.2.  <a href="#registrar-discotype">Service Discovery Category/Type</a><br />10.  <a href="#schema">XML Schema</a><br />11.  <a href="#acknowledgements">Acknowledgements</a></p><p><a href="#appendices">Appendices</a><br />    <a href="#appendix-docinfo">A: Document Information</a><br />    <a href="#appendix-authorinfo">B: Author Information</a><br />    <a href="#appendix-legal">C: Legal Notices</a><br />    <a href="#appendix-xmpp">D: Relation to XMPP</a><br />    <a href="#appendix-discuss">E: Discussion Venue</a><br />    <a href="#appendix-conformance">F: Requirements Conformance</a><br />    <a href="#appendix-notes">G: Notes</a><br />    <a href="#appendix-revs">H: Revision History</a></p></div><hr /><h2>1.
       <a name="intro" id="intro">Introduction</a></h2>
        <div class="indent"><h3>1.1 <a name="intro-over" id="intro-over">Overview</a></h3>
            <p class="" style="">The protocol defined herein enables users to contact a representative of an organization or workgroup without knowing the address of a particular member of that organization or workgroup. This functionality is similar to an 'email alias' with the addition of queuing pending communication requests and quality of service negotiation to accommodate the real-time nature of IM/chat. Although this protocol is generic enough to handle many use cases, specific features have been added that make it particularly suitable for customer support environments.</p>
        </div>
        <div class="indent"><h3>1.2 <a name="intro-motive" id="intro-motive">Motivation</a></h3>
            <p class="" style="">This protocol addresses the need of starting a private XMPP conversation with a qualified member of a workgroup. In a standard XMPP exchange of messages, users either connect directly to another user for a one on one conversation, or connect to a chat room for a conversation between many people. The current protocols do not allow users to initiate a private conversation with any person playing a particular role in an organization or workgroup.</p>
            <p class="" style="">For example, a customer has a question and needs to talk to a support representative.  The conversation is private and therefore cannot be conducted in a well-known chat room.  Using the workgroup protocol, the user requests a chat with support@workgroup.example.com.  The chat request is put into a queue and the server routes the chat request to individual support representatives in the support@workgroup.example.com workgroup. The support representative can accept or reject the chat request. Once the request is accepted, the conversation takes place through standard XMPP messaging protocols.</p>
        </div>
        <div class="indent"><h3>1.3 <a name="intro-concepts" id="intro-concepts">Concepts</a></h3>
            <p class="" style="">The namespace governing this protocol is "http://jabber.org/protocol/workgroup". This namespace relies on the &lt;iq/&gt; element for execution, and uses the &lt;presence/&gt; element for announcing status updates.</p>
            <p class="" style="">This protocol depends on <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0030.html">Service Discovery (XEP-0030)</a></span>  [<a href="#nt-idm63">1</a>] for reporting and announcing available workgroup services. However, support for service discovery is entirely optional and workgroup services may be made known through other means (e.g. web pages or word of mouth .</p>
            <p class="" style="">The end result of a workgroup interaction is to negotiate and route a user and workgroup member (a.k.a. agent) to an appropriate chat room for a chat conversation using the multi-user chat (MUC) protocol. However, multi-user chat essentially 'takes over' when the workgroup protocol successfully completes so there is no overlap between the two protocols. It is RECOMMENDED that groupchat implementations support basic groupchat (a.k.a. Groupchat 1.0) for maximum client compatibility.</p>
        </div>
        <div class="indent"><h3>1.4 <a name="intro-prereq" id="intro-prereq">Prerequisites</a></h3>
            <p class="" style="">There are no requirements for supporting the workgroup protocol beyond <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc6120">XMPP Core</a></span>  [<a href="#nt-idm70">2</a>] and <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0045.html">Multi-User Chat (XEP-0045)</a></span>  [<a href="#nt-idm74">3</a>]. Support for <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0004.html">Data Forms (XEP-0004)</a></span>  [<a href="#nt-idm78">4</a>] is optional if users need to submit additional data before joining (see User Join section of this document).</p>
        </div>
    <h2>2.
       <a name="roleresp" id="roleresp">Roles and Responsibilities</a></h2>
        <p class="" style="">This protocol has clearly defined roles and responsibilities for its participants.</p>
        <div class="indent"><h3>2.1 <a name="roles" id="roles">Roles</a></h3>
            <p class="" style="">The workgroup protocol involves three distinct participants that fill the following roles:</p>
            <ul class="" style="">
                <li class="" style=""><span class="strong">User</span> - The user requests a private conversation with a member of a workgroup.</li>
                <li class="" style=""><span class="strong">Service</span> - The workgroup service receives and sends messages using the workgroup address. The workgroup address represents a general contact address which allows users to find workgroup members to talk to without the need to know any particular workgroup member's individual address. The workgroup service manages the interactions between users and agents.</li>
                <li class="" style=""><span class="strong">Agent</span> - The agent is a member of the workgroup and can carry out conversations with users on behalf of their workgroup organization or company.</li>
            </ul>
            <p class="" style="">In the examples shown throughout this document, the user address &lt;user@example.net/home&gt;, the service address is &lt;support@workgroup.example.com&gt;, and the agent addresses are &lt;alice@example.com/work&gt; and &lt;bob@example.com/work&gt;.</p>
            <p class="" style="">Note: A service MAY contain several queues to help organize, route and handle incoming user chat requests. Implementations supporting multiple queues in a workgroup will respond differently to requests, and send different status information for each queue. Workgroup queues are identified by a unique resource name: e.g.  support@workgroup.example.com/platinum-plan or support@workgroup.example.com/xmpp-products.  Implementations should gracefully handle services with only one queue (using support@workgroup.example.com) or multiple queues. Users should only be aware of one workgroup (users should never see workgroup queue resource names).</p>
        </div>
        <div class="indent"><h3>2.2 <a name="responsibilities" id="responsibilities">Responsibilities</a></h3>
            <p class="" style="">Each participant is responsible for certain behaviors in the workgroup protocol.</p>
            <p class="" style="">Users should:</p>
            <ul class="" style="">
                <li class="" style="">Know the status of the workgroup queue before requesting a conversation.  This information allows users to see if the workgroup is available, and how long a wait they may have before a chat is initiated.</li>
                <li class="" style="">Know the status of their request while in the request queue.</li>
                <li class="" style="">Be able to cancel a chat request at any time.</li>
            </ul>
            <p class="" style="">Workgroup agents should:</p>
            <ul class="" style="">
                <li class="" style="">Know the status of the workgroup queue(s).</li>
                <li class="" style="">Be able to accept or reject chat requests.</li>
                <li class="" style="">Indicate their availability for handling workgroup chats.</li>
            </ul>
            <p class="" style="">The workgroup service:</p>
            <ul class="" style="">
                <li class="" style="">Controls the workgroup request queue(s).</li>
                <li class="" style="">Manages the updating of queue status information.</li>
                <li class="" style="">Determines how users are queued and how queue requests are routed to workgroup
                members. The queue routing algorithm is beyond the scope of this document and left to
                implementers (simple round-robin, priority based, rules based, etc).</li>
                <li class="" style="">Maintains its presence, indicating the availability of the workgroup service.</li>
            </ul>
        </div>
    <h2>3.
       <a name="user" id="user">User Protocol</a></h2>
        <p class="" style="">The workgroup protocol consists of several XMPP packet exchanges that occur during the
        lifetime of the protocol. These packet exchanges change the state of the relationship
        between user, agent and service.</p>

        <div class="indent"><h3>3.1 <a name="proto-states" id="proto-states">User States</a></h3>
            <p class="" style="">Users join the workgroup queue to wait for a chat with an agent. Once they have joined the queue, they may receive zero or more status updates from the workgroup service informing them of their status in the queue. Users have the option to cancel their chat request at any time.</p>
            <p class="" style="">When an agent is ready to chat with the user, the user MUST be sent a standard XMPP groupchat invitation to a chat room. Receipt of the invitation indicates that the user is no longer in the queue and that they should join the chat room using the standard XMPP groupchat protocol in order to converse with an agent. Groupchat is used because it offers several advantages in workgroup conversations including:</p>
            <ul class="" style="">
                <li class="" style="">Allowing more than one agent to join the conversation (useful for bringing in experts to join the conversation).</li>
                <li class="" style="">Allowing managers to monitor conversations for quality of service.</li>
                <li class="" style="">Creating a simple way of determining what is in a 'conversation' for logging and gathering other statistical information about the conversation.</li>
                <li class="" style="">Allowing a convenient mechanism for bringing 'chatbot' services into the conversation (e.g. answering FAQs).</li>
            </ul>
            <p class="" style="">The user's states and packet exchanges that cause state transitions are shown below:</p>
            <p class="caption"></p><div class="indent"><pre class="prettyprint">
              +-------+
              | Start |&lt;------+
              +-------+       |
                  |           |
                  | Join      |
                  v           |
             +---------+      |
      +-----&gt;| Queued  |      |
      |      +---------+      |
      | Status |  |  | Depart |
      +--------+  |  +--------+
                  |
                  | Invite
                  v
            +-----------+
            | Chat room |
            +-----------+
</pre></div>
        </div>
        <div class="indent"><h3>3.2 <a name="proto-user" id="proto-user">User Packet Exchanges</a></h3>
            <p class="" style="">Packets are exchanged between the user and service to trigger state changes in the user. These packet exchanges are described next.</p>
            <div class="indent"><h3>3.2.1 <a name="proto-user-join" id="proto-user-join">User Join Protocol</a></h3>
                <p class="" style="">This section describes the packet exchange allowing users to join a workgroup service queue. This protocol MUST be supported by compliant implementations.</p>
                <p class="caption"><a name="example-1" id="example-1"></a>Example 1. Transactions</p><div class="indent"><pre class="prettyprint">
User                          Service
  |        Join Request          |
  |-----------------------------&gt;|
  |                              |
  |        Join Response         |
  |&lt;-----------------------------|
  |                              |
</pre></div>
                <p class="" style="">The user sends a join request to the workgroup service in order to join the workgroup queue.
                The workgroup service may either accept or reject the request. A user session (e.g. user@example.net/home)
                may have only one active join request. Subsequent, simultaneous joins MUST result in an error.</p>

                <p class="" style="">Some workgroups require that the user submit certain information before the user is allowed to join.
                In these cases, the workgroup MUST reject the initial join request with a &lt;not-acceptable/&gt; error. The user should then
                use the Data Forms protocol within iq-join-queue to obtain a form, and submit it to join
                the queue.</p>
                <p class="caption"><a name="example-2" id="example-2"></a>Example 2. Request Element</p><div class="indent"><pre class="prettyprint">
U: &lt;iq to='support@workgroup.example.com' from='user@example.net/home' id='id1' type='set'&gt;
U:   &lt;join-queue xmlns='http://jabber.org/protocol/workgroup'&gt;
U:     &lt;queue-notifications/&gt;
U:   &lt;/join-queue&gt;
U: &lt;/iq&gt;
</pre></div>
                <p class="" style="">The request may contain application-specific metadata to help the service determine queuing of the user or Data Forms data when submitting form information (definition of such data is out of scope for this document). In addition, the &lt;join-queue&gt; element MAY contain a standard &lt;queue-notifications/&gt; element, which indicates that the user would like to receive user status updates about their state in the queue.</p>
                <p class="" style="">A successful join results in a success response:</p>
                <p class="caption"><a name="example-3" id="example-3"></a>Example 3. Response Element</p><div class="indent"><pre class="prettyprint">
S: &lt;iq to='user@example.net/home' from='support@workgroup.example.com' id='id1' type='result'/&gt;
</pre></div>
                <p class="" style="">If the user indicated interest in their queue status information, the supported status updates MUST be sent by the server. Compliant implementations do not have to support any status update types. Status updates requested by the user and supported by the server MUST be pushed to the user by the service until the user departs or is invited to a chat room.</p>
                <div class="indent"><h3>3.2.1.1 <a name="proto-user-join-errors" id="proto-user-join-errors">Error Conditions</a></h3>
                    <div class="indent"><p class="caption"><a name="table-1" id="table-1"></a>Table 1: Join-Queue Error Conditions</p><table border="1" cellpadding="3" cellspacing="0">
                        <tr class="body">
                            <th colspan="" rowspan="">Condition</th>
                            <th colspan="" rowspan="">Description</th>
                        </tr>
                        <tr class="body">
                            <td align="" colspan="" rowspan="">&lt;not-authorized/&gt;</td>
                            <td align="" colspan="" rowspan="">The user is not authorized to join the queue. A determination of who has permission to join a queue is left to implementations.</td>
                        </tr>
                        <tr class="body">
                            <td align="" colspan="" rowspan="">&lt;item-not-found/&gt;</td>
                            <td align="" colspan="" rowspan="">The address the user requests a chat with does not exist or is not a workgroup.  Compliant workgroup service implementations MUST NOT return this error if the requested address is a valid workgroup.</td>
                        </tr>
                        <tr class="body">
                            <td align="" colspan="" rowspan="">&lt;not-acceptable/&gt;</td>
                            <td align="" colspan="" rowspan="">The user must submit valid form data before joining the queue. Note that this error is sent when the user tries to join, or if the user submits form data that is not filled out correctly.</td>
                        </tr>
                        <tr class="body">
                            <td align="" colspan="" rowspan="">&lt;conflict/&gt;</td>
                            <td align="" colspan="" rowspan="">The user has already joined the queue.</td>
                        </tr>
                        <tr class="body">
                            <td align="" colspan="" rowspan="">&lt;service-unavailable/&gt;</td>
                            <td align="" colspan="" rowspan="">The workgroup is valid but not accepting new join-queue requests.</td>
                        </tr>
                    </table></div>
                </div>
                <div class="indent"><h3>3.2.1.2 <a name="proto-user-join-example" id="proto-user-join-example">Example</a></h3>
                    <p class="" style="">The following protocol flows show an example of a user successfully joining a workgroup queue for support@workgroup.example.com.</p>
                    <p class="caption"><a name="example-4" id="example-4"></a>Example 4. Successful Join</p><div class="indent"><pre class="prettyprint">
U: &lt;iq type='set'
U:     from='user@example.net/home'
U:       to='support@workgroup.example.com'
U:       id='id1'&gt;
U:   &lt;join-queue xmlns='http://jabber.org/protocol/workgroup'&gt;
U:     &lt;queue-notifications/&gt;
U:   &lt;/join-queue&gt;
U: &lt;/iq&gt;
S: &lt;iq type='result'
S:     from='support@workgroup.example.com'
S:     to='user@example.net/home'
S:     id='id1'/&gt;
</pre></div>
                    <p class="" style="">The following XML is another example where metadata is sent by the user to assist the workgroup server in queuing and routing (naturally, the custom namespace that qualifies the &lt;crm/&gt; element in this example would be defined outside the context of this specification).</p>
                    <p class="caption"><a name="example-5" id="example-5"></a>Example 5. Join With Meta-Data</p><div class="indent"><pre class="prettyprint">
U: &lt;iq type='set'
U:     from='user@example.net/home'
U:       to='support@workgroup.example.com'
U:       id='id2'&gt;
U:   &lt;join-queue xmlns='http://jabber.org/protocol/workgroup'&gt;
U:     &lt;crm xmlns='http://www.example.com/xmpp/workgroup'&gt;
U:       &lt;customer-id&gt;the24th498onth&lt;/customer-id&gt;
U:       &lt;referrer&gt;
U:         http://www.example.com/portal/
U:       &lt;/referrer&gt;
U:       &lt;product&gt;Widget 1.0&lt;/product&gt;
U:     &lt;/crm&gt;
U:     &lt;queue-notifications/&gt;
U:   &lt;/join-queue&gt;
U: &lt;/iq&gt;
S: &lt;iq type='result'
S:     from='support@workgroup.example.com'
S:       to='user@example.net/home'
S:       id='id2'/&gt;
</pre></div>
                    <p class="" style="">Finally an example of a required form submission before a user is allowed to the workgroup queue for support@workgroup.example.com. The data form in this example is trivial; please see <span class="ref">XEP-0004</span> for a complete data form example. The example begins as normal, but the workgroup returns a &lt;not-acceptable/&gt; error.</p>
                    <p class="caption"><a name="example-6" id="example-6"></a>Example 6. Join With Form</p><div class="indent"><pre class="prettyprint">
U: &lt;iq type='set'
U:     from='user@example.net/home'
U:       to='support@workgroup.example.com'
U:       id='id1'&gt;
U:   &lt;join-queue xmlns='http://jabber.org/protocol/workgroup'&gt;
U:     &lt;queue-notifications/&gt;
U:   &lt;/join-queue&gt;
U: &lt;/iq&gt;
S: &lt;iq type='error'
S:     from='support@workgroup.example.com'
S:       to='user@example.net/home'
S:       id='id1'&gt;
S:   &lt;error code='406' type='modify'&gt;
S:     &lt;not-acceptable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
S:   &lt;/error&gt;
S: &lt;/iq&gt;
</pre></div>
                    <p class="" style="">The &lt;not-acceptable/&gt; error indicates that a data form is required. The user requests the required data form from the workgroup.</p>
                    <p class="caption"><a name="example-7" id="example-7"></a>Example 7. Join With Form (2)</p><div class="indent"><pre class="prettyprint">
U: &lt;iq type='get'
U:     from='user@example.net/home'
U:       to='support@workgroup.example.com'
U:       id='id2'&gt;
U:   &lt;join-queue xmlns='http://jabber.org/protocol/workgroup'/&gt;
U: &lt;/iq&gt;
S: &lt;iq type='result'
S:     from='support@workgroup.example.com'
S:       to='user@example.net/home'
S:       id='id2'&gt;
S:   &lt;join-queue xmlns='http://jabber.org/protocol/workgroup'&gt;
S:     &lt;x xmlns='jabber:iq:data' type='form'&gt;
S:       &lt;title&gt;Support.com Chat Customer Information&lt;/title&gt;
S:       &lt;instructions&gt;Welcome to example.com! Please provide us with
S:         some information about yourself so we can serve you better.
S:       &lt;/instructions&gt;
S:       &lt;field type='text-single' label='First Name' var='first' /&gt;
S:       &lt;field type='text-single' label='Last Name' var='last' /&gt;
S:       &lt;field type='list-single' label='Contract Type'
var='contract_type'&gt;
S:         &lt;value&gt;0&lt;/value&gt;
S:         &lt;option label='None'&gt;&lt;value&gt;0&lt;/value&gt;&lt;/option&gt;
S:         &lt;option label='Bronze'&gt;&lt;value&gt;1&lt;/value&gt;&lt;/option&gt;
S:         &lt;option label='Silver'&gt;&lt;value&gt;2&lt;/value&gt;&lt;/option&gt;
S:         &lt;option label='Gold'&gt;&lt;value&gt;3&lt;/value&gt;&lt;/option&gt;
S:       &lt;/field&gt;
S:     &lt;/x&gt;
S:   &lt;/join-queue&gt;
S: &lt;/iq&gt;
</pre></div>
                    <p class="" style="">After presenting the form to the user and gathering the form data, the user submits the form data to the workgroup and the workgroup accepts it. The user is now in the queue.</p>
                    <p class="caption"><a name="example-8" id="example-8"></a>Example 8. Join With Form (3)</p><div class="indent"><pre class="prettyprint">
U: &lt;iq type='set'
U:     from='user@example.net/home'
U:       to='support@workgroup.example.com'
U:       id='id3'&gt;
U:   &lt;join-queue xmlns='http://jabber.org/protocol/workgroup'&gt;
U:     &lt;queue-notifications/&gt;
U:     &lt;x xmlns='jabber:iq:data' type='submit'&gt;
U:       &lt;field var='first'&gt;&lt;value&gt;John&lt;/value&gt;&lt;/field&gt;
U:       &lt;field var='last'&gt;&lt;value&gt;Doe&lt;/value&gt;&lt;/field&gt;
U:       &lt;field var='contract_type'&gt;&lt;value&gt;2&lt;/value&gt;&lt;/field&gt;
U:     &lt;/x&gt;
U:   &lt;/join-queue&gt;
U: &lt;/iq&gt;
S: &lt;iq type='result'
S:     from='support@workgroup.example.com'
S:       to='user@example.net/home'
S:       id='id3' /&gt;
</pre></div>
                </div>
            </div>
            <div class="indent"><h3>3.2.2 <a name="proto-user-depart" id="proto-user-depart">User Depart Protocol</a></h3>
                <p class="" style="">This section describes the packet exchange allowing users to depart a workgroup service queue, or for a workgroup service to remove a user from the workgroup queue. This protocol MUST be supported by compliant implementations.</p>
                <p class="" style="">The user no longer wishes to be in the queue and issues a depart queue command.</p>
                <p class="caption"><a name="example-9" id="example-9"></a>Example 9. Transactions</p><div class="indent"><pre class="prettyprint">
Requester                     Service
  |        Depart Request        |
  |-----------------------------&gt;|
  |        Depart Response       |
  |&lt;-----------------------------|
  |                              |
</pre></div>
                <p class="" style="">The service notifies the user that they have been removed from the workgroup queue.</p>
                <p class="caption"><a name="example-10" id="example-10"></a>Example 10. Transactions (2)</p><div class="indent"><pre class="prettyprint">
User                          Service
  |        Depart Message        |
  |&lt;-----------------------------|
  |                              |
</pre></div>
                <p class="caption"><a name="example-11" id="example-11"></a>Example 11. Depart Request</p><div class="indent"><pre class="prettyprint">
U: &lt;iq from='user@example.net/home' to='support@workgroup.example.com' id='id1' type='set'&gt;
U:   &lt;depart-queue xmlns='http://jabber.org/protocol/workgroup'/&gt;
U: &lt;/iq&gt;
</pre></div>
                <p class="" style="">In the typical case, the sender is the user departing the queue. However, it is possible for other users (system administrators for example) to request that another user be removed from the queue. In this case, the jid of the user who is departing is included in the depart request:</p>
                <p class="caption"><a name="example-12" id="example-12"></a>Example 12. Depart Request With JID</p><div class="indent"><pre class="prettyprint">
U: &lt;iq from='admin-jid' to='support@workgroup.example.com' id='id1' type='set'&gt;
U:   &lt;depart-queue xmlns='http://jabber.org/protocol/workgroup'&gt;
U:     &lt;jid&gt;user@example.net/home&lt;/jid&gt;
U:   &lt;/depart-queue&gt;
U: &lt;/iq&gt;
</pre></div>
                <p class="" style="">It is expected that implementations will determine who is allowed to remove other users from the queue based on an implementation specific permissions model.  These administrator depart requests may result in &lt;not-authorized/&gt; errors (see error section). A user removing their own queue entry MUST NOT receive unauthorized errors (the workgroup service MUST NOT prevent a user from departing the queue).</p>
                <p class="" style="">The sender of the depart request receives a successful result packet:</p>
                <p class="caption"><a name="example-13" id="example-13"></a>Example 13. Depart Request</p><div class="indent"><pre class="prettyprint">
S: &lt;iq from='support@workgroup.example.com' to=user@example.net/home' id='id1' type='result'/&gt;
</pre></div>
                <p class="" style="">And the user who is departing receives a depart message (the user may not have been the sender of the request):</p>
                <p class="caption"><a name="example-14" id="example-14"></a>Example 14. Depart Message</p><div class="indent"><pre class="prettyprint">
S: &lt;message from='support@workgroup.example.com' to='user@example.net/home'&gt;
S:    &lt;depart-queue xmlns='http://jabber.org/protocol/workgroup'/&gt;
S: &lt;/message&gt;
</pre></div>
                <p class="" style="">The user will not be in the queue after a response is received unless the error response code is &lt;not-authorized/&gt;.</p>
                <div class="indent"><h3>3.2.2.1 <a name="proto-user-depart-errors" id="proto-user-depart-errors">Error Conditions</a></h3>
                    <div class="indent"><p class="caption"><a name="table-2" id="table-2"></a>Table 2: Depart-Queue Error Conditions</p><table border="1" cellpadding="3" cellspacing="0">
                        <tr class="body">
                            <th colspan="" rowspan="">Condition</th>
                            <th colspan="" rowspan="">Description</th>
                        </tr>
                        <tr class="body">
                            <td align="" colspan="" rowspan="">&lt;not-authorized/&gt;</td>
                            <td align="" colspan="" rowspan="">The sender did not have permission to remove the user from the queue.  This error code MUST NOT be used when a user is removing their queue entry.</td>
                        </tr>
                        <tr class="body">
                            <td align="" colspan="" rowspan="">&lt;item-not-found/&gt;</td>
                            <td align="" colspan="" rowspan="">The user was not in the queue.</td>
                        </tr>
                    </table></div>
                </div>
                <div class="indent"><h3>3.2.2.2 <a name="proto-user-depart-example" id="proto-user-depart-example">Example</a></h3>
                    <p class="" style="">A user leaves the workgroup queue support@workgroup.example.com.</p>
                    <p class="caption"><a name="example-15" id="example-15"></a>Example 15. User Departs</p><div class="indent"><pre class="prettyprint">
U: &lt;iq from='user@example.net/home'
U:       to='support@workgroup.example.com'
U:       id='id1'
U:     type='set'&gt;
U:   &lt;depart-queue xmlns='http://jabber.org/protocol/workgroup'/&gt;
U: &lt;/iq&gt;
S: &lt;iq from='support@workgoup.example.com'
S:     to='user@example.net/home'
S:     id='id1'
S:     type='result'/&gt;
S: &lt;message from='support@workgroup.example.com' to='user@example.net/home'&gt;
S:    &lt;depart-queue xmlns='http://jabber.org/protocol/workgroup'/&gt;
S: &lt;/message&gt;
</pre></div>
                    <p class="" style="">An administrator removes a user from the workgroup queue support@workgroup.example.com.
                    Notice that the depart-queue message is sent to the user that has left the queue.</p>
                    <p class="caption"><a name="example-16" id="example-16"></a>Example 16. Administrator Removes User</p><div class="indent"><pre class="prettyprint">
U: &lt;iq from='admin@example.com/work'
U:       to='support@workgroup.example.com'
U:       id='id1'
U:     type='set'&gt;
U:   &lt;depart-queue xmlns='http://jabber.org/protocol/workgroup'&gt;
U:     &lt;jid&gt;user@example.net/home&lt;/jid&gt;
U:   &lt;/depart-queue&gt;
U: &lt;/iq&gt;
S: &lt;iq from='support@workgroup.example.com'
S:     to='admin@example.com/work'
S:     id='id1'
S:     type='result'/&gt;
S: &lt;message from='support@workgroupexample.com' to='user@example.net/home'&gt;
S:    &lt;depart-queue xmlns='http://jabber.org/protocol/workgroup'/&gt;
S: &lt;/message&gt;
</pre></div>
                </div>
            </div>
            <div class="indent"><h3>3.2.3 <a name="proto-user-status" id="proto-user-status">User Status Update Protocol</a></h3>
                <p class="" style="">This section describes the packet exchange for updating users on their queue status.  This protocol MAY
                be supported by compliant implementations.</p>
                <p class="caption"><a name="example-17" id="example-17"></a>Example 17. Transactions</p><div class="indent"><pre class="prettyprint">
User                          Service
  |      User Status Push        |
  |&lt;-----------------------------|
  |                              |
  |     User Status Request      |
  |-----------------------------&gt;|
  |     User Status Response     |
  |&lt;-----------------------------|
  |                              |
</pre></div>
                <p class="" style="">The workgroup service pushes updates to the user as their queue status changes. Furthermore, the user may request their queue status at any time.</p>
                <div class="indent"><h3>3.2.3.1 <a name="proto-user-status-updates" id="proto-user-status-updates">User Status Updates</a></h3>
                    <p class="" style="">User status updates are contained in a &lt;queue-status/&gt; element that updates the user on their queue position and estimated time. The position contained in a &lt;position&gt; sub-element is a non-negative integer indicating the number of queue entries that must be routed to an agent before the user is routed to an agent. A position of 0 (zero) indicates the user is currently being routed. Clients may use this information to display the current queue position to the user.</p>
                    <p class="" style="">The queue time status is contained in a &lt;time/&gt; sub-element that updates the user with the estimated time until they will be routed to an agent. The time is a non-negative integer indicating the estimated number of seconds remaining before being routed. Services should send this update at regular intervals. We recommend every 15 seconds, but the best solution will depend on application dependent factors and the service may decide to send updates at any interval or never (relying on the client to request the information). User clients should assume the estimated time counts down at a rate of one per second between status updates. Clients may use this information to display the running estimated time to the user.</p>
                    <p class="" style="">A server 'push' occurs asynchronously to client:</p>
                    <p class="caption"><a name="example-18" id="example-18"></a>Example 18. User Status Push</p><div class="indent"><pre class="prettyprint">
S: &lt;message to='user@example.net/home' from='support@workgroup.example.com'&gt;
S:   &lt;queue-status xmlns='http://jabber.org/protocol/workgroup'&gt;
S:     &lt;position&gt;4&lt;/position&gt;
S:     &lt;time&gt;60&lt;/time&gt;
S:   &lt;/queue-status&gt;
S: &lt;/message&gt;
</pre></div>
                    <p class="" style="">Alternately the client may poll their position:</p>
                    <p class="caption"><a name="example-19" id="example-19"></a>Example 19. User Status Poll</p><div class="indent"><pre class="prettyprint">
U: &lt;iq to='support@workgroup.example.com' from='user@example.net/home' id='id1' type='get'&gt;
U:   &lt;queue-status xmlns='http://jabber.org/protocol/workgroup'/&gt;
U: &lt;/iq&gt;
S: &lt;iq to='user@example.net/home' from='support@workgroup.example.com' id='id1' type='result'&gt;
S:   &lt;queue-status xmlns='http://jabber.org/protocol/workgroup'&gt;
S:     &lt;position&gt;4&lt;/position&gt;
S:     &lt;time&gt;60&lt;/time&gt;
S:   &lt;/queue-status&gt;
S: &lt;/iq&gt;
</pre></div>
                </div>
                <div class="indent"><h3>3.2.3.2 <a name="proto-user-status-errors" id="proto-user-status-errors">Error Conditions</a></h3>
                    <div class="indent"><p class="caption"><a name="table-3" id="table-3"></a>Table 3: Queue-Status Error Conditions</p><table border="1" cellpadding="3" cellspacing="0">
                        <tr class="body">
                            <th colspan="" rowspan="">Condition</th>
                            <th colspan="" rowspan="">Description</th>
                        </tr>
                        <tr class="body">
                            <td align="" colspan="" rowspan="">&lt;not-authorized/&gt;</td>
                            <td align="" colspan="" rowspan="">Sent by the server to the user in response to a status query only if
                            the user is not a member of the queue.</td>
                        </tr>
                        <tr class="body">
                            <td align="" colspan="" rowspan="">&lt;feature-not-implemented/&gt;</td>
                            <td align="" colspan="" rowspan="">Sent only if status updates are not implemented in either the client or server.</td>
                        </tr>
                    </table></div>
                </div>
            </div>
            <div class="indent"><h3>3.2.4 <a name="proto-user-invite" id="proto-user-invite">User Invite Protocol</a></h3>
                <p class="" style="">This section describes the packet exchange for inviting a queued user to a chat room for conversation with an agent. This protocol MUST be supported by compliant implementations.</p>
                <p class="caption"><a name="example-20" id="example-20"></a>Example 20. Transactions</p><div class="indent"><pre class="prettyprint">
User                          Service
  |          User Invite         |
  |&lt;-----------------------------|
  |                              |
</pre></div>
                <p class="" style="">The server sends an invitation to the user to begin their conversation with an agent, structured according to the format defined in <span class="ref">XEP-0045</span>. The 'from' attribute of the &lt;invite/&gt; element MUST be set to the JID of the workgroup. The invitation indicates that the user is no longer in the workgroup queue. The user MUST NOT receive any more user queue status updates once they receive an invitation.</p>
                <div class="indent"><h3>3.2.4.1 <a name="proto-user-invite-errors" id="proto-user-invite-errors">Error Conditions</a></h3>
                    <p class="" style="">There are no defined error conditions for user invitations.</p>
                </div>
                <div class="indent"><h3>3.2.4.2 <a name="proto-user-invite-example" id="proto-user-invite-example">Example</a></h3>
                    <p class="" style="">An invitation from the server on behalf of the support@example.net workgroup:</p>
                    <p class="caption"><a name="example-21" id="example-21"></a>Example 21. An Invitation</p><div class="indent"><pre class="prettyprint">
S: &lt;message
S:     from='roomname@chatserver.example.com'
S:     to='user@example.net/home'&gt;
S:   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
S:     &lt;invite from='support@workgroup.example.com'&gt;
S:       &lt;reason&gt;
S:        You have been invited to chat with a support@workgroup.example.com
          agent.
S:       &lt;/reason&gt;
S:     &lt;/invite&gt;
S:   &lt;/x&gt;
S: &lt;/message&gt;
</pre></div>
                </div>
            </div>
        </div>
    <h2>4.
       <a name="agent" id="agent">Agent Protocol</a></h2>
        <div class="indent"><h3>4.1 <a name="proto-agent-states" id="proto-agent-states">Agent States</a></h3>
            <p class="" style="">Agents join a workgroup to indicate they are capable of handling conversations with users.  Agent membership in the workgroup is expected to be a long term, persistent relationship similar to roster membership. For example, a customer support agent may join the support@workgroup.example.com workgroup when they begin working at example.com and will only depart when they leave that position.  The wide variety of relationships, processes and permissions associated with joining and leaving workgroups lies outside the scope of this document.</p>
            <p class="" style="">Once an agent has joined a workgroup they will receive workgroup status updates to inform them of the status of other members of the workgroup.  Agents are responsible for updating the workgroup service with their presence so the service can intelligently route chat requests to the 'best' agent.  Workgroup agent presence uses standard XMPP presence packets with optional metadata to help routing of chat requests to agents. Some metadata will be standard and defined later in this document. It is expected that other deployment specific metadata will also be needed to make routing decisions.</p>
            <p class="" style="">The general agent workgroup state diagram is shown below:</p>
            <p class="caption"></p><div class="indent"><pre class="prettyprint">
            +-----------+
      +----&gt;| Workgroup |&lt;-----+
      |     +-----------+      |
      |        |     |Agent    |
      | Status |     |Presence |
      +--------+     +---------+
</pre></div>
            <p class="" style="">Once an agent has joined a workgroup and is available, the agent will receive offers to chat with users by the workgroup service. Chat offers will be made to the agent and the agent has the opportunity to accept or reject each offer. The workgroup service may also revoke an offer. For example, a service may revoke chat offers if the offer is not responded to within a certain period of time to ensure fast responses to user chat requests.</p>
            <p class="" style="">Once an offer has been accepted, the agent must wait for a standard groupchat invitation from the workgroup service. The workgroup service may revoke the offer at this stage of the protocol as well. This enables workgroup services to send offers to several agents in parallel, and choose the 'best' agent that accepts. A diagram showing the agent workgroup sub-states and transitions is shown below:</p>
            <p class="caption"></p><div class="indent"><pre class="prettyprint">
              +-------+
              | Start |&lt;---------+
              +-------+          |
                  |              |
                  | Offer        |
                  v              |
            +---------------+    |
            | Offer Pending |    |
            +---------------+    |
                 |  |  | Revoke  |
                 |  |  +--------&gt;|
                 |  | Reject     |
          Accept |  +-----------&gt;|
                 v               |
            +--------------+     |
            | Chat Pending |     |
            +--------------+     |
                 |   | Revoke    |
          Invite |   +-----------+
                 V
              +-----------+
              | Chat room |
              +-----------+
</pre></div>
        </div>
        <div class="indent"><h3>4.2 <a name="proto-agent" id="proto-agent">Agent Packet Exchanges</a></h3>
            <p class="" style="">Packets are exchanged between the agent and service to trigger state changes in the agent client.  These packet exchanges are described next.</p>
            <div class="indent"><h3>4.2.1 <a name="proto-agent-presence" id="proto-agent-presence">Agent Presence Protocol</a></h3>
                <p class="" style="">This section describes the packet exchange allowing agents to update a workgroup with their current presence. This protocol MUST be supported by compliant implementations.</p>
                <p class="caption"><a name="example-22" id="example-22"></a>Example 22. Transactions</p><div class="indent"><pre class="prettyprint">
Agent                         Service
  |       Presence Update        |
  |-----------------------------&gt;|
  |                              |
</pre></div>
                <p class="" style="">The agent must inform the workgroup of its presence by sending it a directed (not broadcast) presence update packet.  Agent presence updates use standard XMPP presence with optional metadata. However, there must always be an agent-status workgroup sub-element in the presence packet to indicate that the presence update relates to agent workgroup presence. Agent workgroup presence is designed to allow a separation between the agent's normal XMPP presence (server-managed via rosters) and their presence with the workgroup.</p>
                <p class="caption"><a name="example-23" id="example-23"></a>Example 23. Presence Update</p><div class="indent"><pre class="prettyprint">
U: &lt;presence from='alice@example.com/work' to='support@workgroup.example.com'&gt;
U:   &lt;agent-status xmlns='http://jabber.org/protocol/workgroup'&gt;
U:     &lt;max-chats&gt;count&lt;/max-chats&gt;
U:   &lt;/agent-status&gt;
U: &lt;/presence&gt;
</pre></div>
                <p class="" style="">Agent presence updates use standard XMPP presence packets and should contain the normal sub elements as needed (e.g. &lt;show/&gt;, &lt;status/&gt;, etc) and can be of type='unavailable' to indicate the agent is not available for workgroup routing or for receiving workgroup agent updates. The standard XMPP show states have specific meaning within the context of the workgroup protocol:</p>
                <ul class="" style="">
                    <li class="" style="">chat - Indicates the agent is available to chat (is idle and ready to handle more conversations).</li>
                    <li class="" style="">away - The agent is busy (possibly with other chats). The agent may still be able to handle other chats but an offer rejection is likely.</li>
                    <li class="" style="">xa - The agent is physically away from their terminal and should not have a chat routed to them.</li>
                    <li class="" style="">dnd - The agent is busy and should not be disturbed. However, special case, or extreme urgency chats may still be offered to the agent although offer rejection or offer timeouts are highly likely.</li>
                </ul>
                <p class="" style="">Agents MAY also embed metadata to help the workgroup service route chat requests, using the &lt;max-chats&gt; element, which specifies the maximum number of chats the agent can handle. If a presence is sent to the workgroup that does not contain the max-chats value, the "default setting" will be assumed.  The value of the default setting for an agent is up to an implementation.   [<a href="#nt-idm253">5</a>]</p>
                <div class="indent"><h3>4.2.1.1 <a name="proto-agent-presence-errors" id="proto-agent-presence-errors">Error Conditions</a></h3>
                    <p class="" style="">There are no defined error conditions for presence updates.</p>
                </div>
                <div class="indent"><h3>4.2.1.2 <a name="proto-agent-presence-example" id="proto-agent-presence-example">Example</a></h3>
                    <p class="" style="">An agent (alice) becomes available to the workgroup support@workgroup.example.com.</p>
                    <p class="caption"><a name="example-24" id="example-24"></a>Example 24. Agent Becomes Available</p><div class="indent"><pre class="prettyprint">
U: &lt;presence from='alice@example.com/work'
U:             to='support@workgroup.example.com'&gt;
U:   &lt;show&gt;chat&lt;/show&gt;
U:   &lt;agent-status xmlns='http://jabber.org/protocol/workgroup'&gt;
U:     &lt;max-chats&gt;3&lt;/max-chats&gt;
U:   &lt;/agent-status&gt;
U: &lt;/presence&gt;
</pre></div>
                </div>
            </div>
            <div class="indent"><h3>4.2.2 <a name="proto-workgroup-status" id="proto-workgroup-status">Workgroup Status Update Protocol</a></h3>
                <p class="" style="">This section describes the packet exchange used to update agents on the status of the workgroup. This protocol MAY be supported by compliant implementations.</p>
                <p class="" style="">After an agent announces their presence to the workgroup, they will begin receiving presence updates from the workgroup. All fields are optional:</p>
                <p class="caption"><a name="example-25" id="example-25"></a>Example 25. Notify-Agent Status Type</p><div class="indent"><pre class="prettyprint">
S: &lt;presence to='alice@example.com/work' from='support@workgroup.example.com'&gt;
S:   &lt;notify-agents xmlns='http://jabber.org/protocol/workgroup'&gt;
S:     &lt;available&gt;count&lt;/available&gt;
S:     &lt;current-chats&gt;count&lt;/current-chats&gt;
S:     &lt;max-chats&gt;count&lt;/max-chats&gt;
S:   &lt;/notify-agents&gt;
S: &lt;/presence&gt;
</pre></div>

                <p class="" style="">The defined sub-elements of &lt;notify-agents&gt; are:</p>
                <ul class="" style="">
                    <li class="" style="">&lt;available&gt; - The total number of agents available in the workgroup.</li>
                    <li class="" style="">&lt;current-chats&gt; - The current total number of chats being handled by agents in the workgroup.</li>
                    <li class="" style="">&lt;max-chats&gt; - The maximum number of simultaneous conversations that can be handled by agents in the workgroup.</li>
                </ul>
                <div class="indent"><h3>4.2.2.1 <a name="proto-workgroup-status-errors" id="proto-workgroup-status-errors">Error Conditions</a></h3>
                    <p class="" style="">There are no defined error conditions for notify workgroup updates.</p>
                </div>
                <div class="indent"><h3>4.2.2.2 <a name="proto-workgroup-status-example" id="proto-workgroup-status-example">Example</a></h3>
                    <p class="" style="">An agent (alice) receives an update from workgroup support@workgroup.example.com.</p>
                    <p class="caption"><a name="example-26" id="example-26"></a>Example 26. Agent Recives Update</p><div class="indent"><pre class="prettyprint">
S: &lt;presence to='alice@example.com/work' from='support@wokgroup.example.com'&gt;
S:   &lt;notify-agents xmlns='http://jabber.org/protocol/workgroup'&gt;
S:     &lt;available&gt;2&lt;/available&gt;
S:     &lt;current-chats&gt;2&lt;/current-chats&gt;
S:     &lt;max-chats&gt;7&lt;/max-chats&gt;
S:   &lt;/notify-agents&gt;
S: &lt;/presence&gt;
</pre></div>
                </div>
            </div>
            <div class="indent"><h3>4.2.3 <a name="proto-queue-status" id="proto-queue-status">Queue Status Update Protocol</a></h3>
                <p class="" style="">This section describes the packet exchange used to update agents on the status of the workgroup queue. This protocol MAY be supported by compliant implementations.</p>
                <p class="" style="">After an agent announces their presence to the workgroup, they will begin receiving presence updates from the workgroup with an overview and details on the queue status.</p>
                <p class="" style="">The &lt;notify-queue/&gt; element updates the agent with a summary of the status of the workgroup queue. All fields are optional:</p>
                <p class="caption"><a name="example-27" id="example-27"></a>Example 27. Notify-Queue Status Type</p><div class="indent"><pre class="prettyprint">
S: &lt;presence to='alice@example.com/work' from='support@workgroup.example.com'&gt;
S:   &lt;notify-queue xmlns='http://jabber.org/protocol/workgroup'&gt;
S:     &lt;count&gt;count&lt;/count&gt;
S:     &lt;oldest&gt;YYYY-MM-DDTHH:mm:ss&lt;/oldest&gt;
S:     &lt;time&gt;average-time-to-chat&lt;/time&gt;
S:     &lt;status&gt;open&lt;/status&gt;
S:   &lt;/notify-queue&gt;
S: &lt;/presence&gt;
</pre></div>
                <p class="" style="">The defined sub-elements of &lt;notify-queue&gt; are:</p>
                <ul class="" style="">
                    <li class="" style="">&lt;count&gt; - The total number of users in the workgroup queue.</li>
                    <li class="" style="">&lt;oldest&gt; - The date and time when the oldest member of the queue joined (MUST conform to the DateTime profile defined in <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0082.html">XMPP Date and Time Profiles (XEP-0082)</a></span>  [<a href="#nt-idm284">6</a>]).</li>
                    <li class="" style="">&lt;time&gt; - The average time in seconds that a user is in the queue before they are routed to an agent for handling.</li>
                    <li class="" style="">&lt;status&gt; - The status of the queue. Queues may be active (requests are being routed and handled by agents) but not accepting new requests for handling. Typical reasons for this state include the queue is shutting down but finishing processing users in the queue, or because the queue has too many requests and should not accept more request until the existing requests are handled. The status field MUST contain one of the following values:
                        <ul class="" style="">
                            <li class="" style="">open - the queue is active and accepting new chat requests</li>
                            <li class="" style="">active - the queue is active but NOT accepting new chat requests</li>
                            <li class="" style="">closed - the queue is NOT active and NOT accepting new chat requests</li>
                        </ul>
                    </li>
                </ul>

                <p class="" style="">The &lt;notify-queue-details/&gt; element updates the agent with details of the workgroup queue. All fields are optional:</p>
                <p class="caption"><a name="example-28" id="example-28"></a>Example 28. Notify-Queue-Details Status Type</p><div class="indent"><pre class="prettyprint">
S: &lt;presence to='alice@example.com/work' from='support@workgroup.example.com'&gt;
S:   &lt;notify-queue-details xmlns='http://jabber.org/protocol/workgroup'&gt;
S:     &lt;user jid='user@example.net/home'&gt;
S:       &lt;position&gt;pos&lt;/position&gt;
S:       &lt;time&gt;estimated-time&lt;/time&gt;
S:       &lt;join-time&gt;YYYY-MM-DDTHH:mm:SS&lt;/join-time&gt;
S:     &lt;/user&gt;
S:   &lt;/notify-queue-details&gt;
S: &lt;/presence&gt;
</pre></div>
                <p class="" style="">An update may contain one or more &lt;user&gt; entries (one per user in the queue).  The defined sub-elements of &lt;user&gt; are:</p>
                <ul class="" style="">
                    <li class="" style="">&lt;position&gt; - The user's zero-based position in the queue.</li>
                    <li class="" style="">&lt;time&gt; - Estimated time in seconds remaining before the user is routed to an agent.</li>
                    <li class="" style="">&lt;join-time&gt; - The datetime when the user joined the queue (MUST conform to the DateTime profile defined in <span class="ref">XEP-0082</span>).</li>
                </ul>
                <div class="indent"><h3>4.2.3.1 <a name="proto-queue-status-errors" id="proto-queue-status-errors">Error Conditions</a></h3>
                    <p class="" style="">There are no defined error conditions for workgroup queue status updates.</p>
                </div>
                <div class="indent"><h3>4.2.3.2 <a name="proto-queue-status-example" id="proto-queue-status-example">Example</a></h3>
                    <p class="" style="">An agent receives an update from workgroup support@workgroup.example.com.</p>
                    <p class="caption"><a name="example-29" id="example-29"></a>Example 29. Agent Receives Updates</p><div class="indent"><pre class="prettyprint">
S: &lt;presence to='alice@example.com/work' from='support@workgroup.example.com'&gt;
S:   &lt;notify-queue xmlns='http://jabber.org/protocol/workgroup'&gt;
S:     &lt;count&gt;1&lt;/count&gt;
S:     &lt;oldest&gt;20050208T10:00:00&lt;/oldest&gt;
S:     &lt;time&gt;30&lt;/time&gt;
S:     &lt;status&gt;open&lt;/status&gt;
S:   &lt;/notify-queue&gt;
S: &lt;/presence&gt;
S: &lt;presence to='alice@example.com/work' from='support@workgroup.example.com'&gt;
S:   &lt;notify-queue-details xmlns='http://jabber.org/protocol/workgroup'&gt;
S:     &lt;user jid='user@example.net/home'&gt;
S:       &lt;position&gt;1&lt;/position&gt;
S:       &lt;time&gt;5&lt;/time&gt;
S:       &lt;join-time&gt;20050208T10:00:00&lt;/join-time&gt;
S:     &lt;/user&gt;
S:   &lt;/notify-queue-details&gt;
S: &lt;/presence&gt;
</pre></div>
                </div>
            </div>
            <div class="indent"><h3>4.2.4 <a name="proto-agent-status" id="proto-agent-status">Agent Status Update Protocol</a></h3>
                <p class="" style="">This section describes the packet exchange used to update agents on the status of other agents in the workgroup. This protocol MAY be supported by compliant implementations.</p>
                <p class="caption"><a name="example-30" id="example-30"></a>Example 30. Transactions</p><div class="indent"><pre class="prettyprint">
Agent                         Service
  |    Request Agent Status      |
  |-----------------------------&gt;|
  |         Agent List           |
  |&lt;-----------------------------|
  |                              |
  |     Agent Presence Pushes    |
  |&lt;-----------------------------|
</pre></div>
                <p class="" style="">The workgroup service pushes presence updates to the agent as the presence of other agents changes. This will only occur after an agent has requested to receive other agents' information. The server will continue to send presence updates until the agent sends an unavailable presence to the server. This protocol is similar to the standard XMPP roster workflow.</p>
                <p class="" style="">To receive presence updates for other agents in the workgroup, the agent sends an agent info request to the workgroup:</p>
                <p class="caption"><a name="example-31" id="example-31"></a>Example 31. Request Element</p><div class="indent"><pre class="prettyprint">
U: &lt;iq to='support@workgroup.example.com' from='alice@example.com/work'
U:     id='id1' type='get'&gt;
U:   &lt;agent-status-request xmlns='http://jabber.org/protocol/workgroup'/&gt;
U: &lt;/iq&gt;
</pre></div>
                <p class="" style="">The workgroup will then reply with a list of all agents in the workgroup (excluding the agent making the request):</p>
                <p class="caption"><a name="example-32" id="example-32"></a>Example 32. Response Element</p><div class="indent"><pre class="prettyprint">
S: &lt;iq to='alice@example.com/work' from='support@workgroup.example.com'
S:     id='id1' type='result'&gt;
S:   &lt;agent-status-request xmlns='http://jabber.org/protocol/workgroup'&gt;
S:     &lt;agent jid='bob@example.com' /&gt;
S:   &lt;/agent-status-request&gt;
S: &lt;/iq&gt;
</pre></div>
                <p class="" style="">The server will then push presence packets for other agents as their presence changes. All fields in the &lt;agent-status&gt; child stanza are optional, but an &lt;agent-status&gt; child stanza must be present:</p>
                <p class="caption"><a name="example-33" id="example-33"></a>Example 33. Agent Status Update</p><div class="indent"><pre class="prettyprint">
S: &lt;presence to='alice@example.com/work' from='bob@example.com/work'&gt;
S:   &lt;agent-status xmlns='http://jabber.org/protocol/workgroup'&gt;
S:       &lt;current-chats&gt;2&lt;/current-chats&gt;
S:       &lt;max-chats&gt;4&lt;/max-chats&gt;
S:   &lt;/agent-status&gt;
S: &lt;/presence&gt;
</pre></div>
                <p class="" style="">The defined sub-elements of &lt;agent-status&gt; are:</p>
                <ul class="" style="">
                    <li class="" style="">&lt;current-chats&gt; - The number of conversations currently being handled by the agent.</li>
                    <li class="" style="">&lt;max-chats&gt; - The maximum number of simultaneous conversations the agent can handle.</li>
                </ul>
                <div class="indent"><h3>4.2.4.1 <a name="proto-agent-status-errors" id="proto-agent-status-errors">Error Conditions</a></h3>
                    <p class="" style="">There are no defined error conditions for agent status updates.</p>
                </div>
            </div>
            <div class="indent"><h3>4.2.5 <a name="proto-agent-offer" id="proto-agent-offer">Agent Offer Protocol</a></h3>
                <p class="" style="">This section describes the packet exchange involved in a service offering a chat to an agent. This protocol MUST be supported by compliant implementations.</p>
                <p class="caption"><a name="example-34" id="example-34"></a>Example 34. Transactions</p><div class="indent"><pre class="prettyprint">
Agent                         Service
  |         Offer Request        |
  |&lt;-----------------------------|
  |         Offer Response       |
  |-----------------------------&gt;|
  |                              |
</pre></div>
                <p class="" style="">The agent is offered a chat with a user. A successful offer results in the agent owning the offer, but does not mean it has accepted the chat.  Accepting an offer is handled by the Agent Accept protocol. The separation between offer and acceptance is made so that agents may receive offers while engaged in other activities (busy with other chats) and accept them at a later time.</p>
                <p class="caption"><a name="example-35" id="example-35"></a>Example 35. Offer Request</p><div class="indent"><pre class="prettyprint">
S: &lt;iq from='support@workgroup.example.com' to='alice@example.com/work' id='id1' type='set'&gt;
S:   &lt;offer xmlns='http://jabber.org/protocol/workgroup' jid='user@example.net/home'&gt;
S:     &lt;timeout&gt;seconds&lt;/timeout&gt;
S:   &lt;/offer&gt;
S: &lt;/iq&gt;
</pre></div>
                <p class="" style="">Application specific metadata will normally be added as a sub-element of &lt;offer&gt; to help agents decide whether to accept or not (formats for which are out of scope for this document). An optional &lt;timeout&gt; sub-element may be included indicating the amount of time the offer stands before the service will revoke it.</p>
                <p class="caption"><a name="example-36" id="example-36"></a>Example 36. Offer Response</p><div class="indent"><pre class="prettyprint">
A: &lt;iq from='alice@example.com/work' to='support@workgroup.example.com' id='id1' type='result'/&gt;
</pre></div>
                <p class="" style="">The agent may respond only with a successful result.</p>
                <div class="indent"><h3>4.2.5.1 <a name="proto-agent-offer-errors" id="proto-agent-offer-errors">Error Conditions</a></h3>
                    <p class="" style="">There are no defined error conditions for an offer response.</p>
                </div>
                <div class="indent"><h3>4.2.5.2 <a name="proto-agent-offer-example" id="proto-agent-offer-example">Example</a></h3>
                    <p class="" style="">An agent is offered a chat with a user. The offer will be revoked in 30 seconds.</p> <p class="caption"><a name="example-37" id="example-37"></a>Example 37. Agent is Offered a Chat</p><div class="indent"><pre class="prettyprint">
S: &lt;iq to='alice@example.com/work'
S:     from='support@workgroup.example.com'
S:     id='id1'
S:     type='set'&gt;
S:   &lt;offer xmlns='http://jabber.org/protocol/workgroup' jid='user@example.net/home'&gt;
S:     &lt;timeout&gt;30&lt;/timeout&gt;
S:   &lt;/offer&gt;
S: &lt;/iq&gt;
A: &lt;iq to='support@workgroup.example.com'
A:     from='alice@example.com/work'
A:     id='id1'
A:     type='result'/&gt;
</pre></div>
                    <p class="" style="">The following is a more typical offer containing metadata about the user.  The offer will be revoked in 30 seconds.</p>
                    <p class="caption"><a name="example-38" id="example-38"></a>Example 38. Offer Including Meta-Data</p><div class="indent"><pre class="prettyprint">
S: &lt;iq to='alice@example.com/work'
S:     from='support@workgroup.example.com'
S:     id='id2'
S:     type='set'&gt;
S:   &lt;offer xmlns='http://jabber.org/protocol/workgroup' jid='user@example.net/home'&gt;
S:     &lt;timeout&gt;30&lt;/timeout&gt;
S:     &lt;crm xmlns='http://www.example.com/xmpp/workgroup'&gt;
S:       &lt;user-id&gt;423498ae84f&lt;/user-id&gt;
S:       &lt;product&gt;Widget 1.0&lt;/product&gt;
S:     &lt;/crm&gt;
S:   &lt;/offer&gt;
S: &lt;/iq&gt;
A: &lt;iq to='support@workgroup.example.com'
A:     from='alice@example.com/work'
A:     id='id2'
A:     type='result'/&gt;
</pre></div>
                </div>
            </div>
            <div class="indent"><h3>4.2.6 <a name="proto-agent-acceptreject" id="proto-agent-acceptreject">Agent Offer Accept/Reject Protocol</a></h3>
                <p class="" style="">This section describes the packet exchange involved in an agent rejecting an offering a chat to a user. This protocol MUST be supported by compliant implementations.</p>
                <p class="caption"><a name="example-39" id="example-39"></a>Example 39. Transactions</p><div class="indent"><pre class="prettyprint">
Agent                         Service
  |  Offer Accept/Reject Request |
  |-----------------------------&gt;|
  | Offer Accept/Reject Response |
  |&lt;-----------------------------|
  |                              |
</pre></div>
                <p class="" style="">The agent accepts or rejects an offer to chat with a user.</p>
                <p class="caption"><a name="example-40" id="example-40"></a>Example 40. Offer Accept Request</p><div class="indent"><pre class="prettyprint">
A: &lt;iq to='support@workgroup.example.com' from='alice@example.com/work' id='id1' type='set'&gt;
A:   &lt;offer-accept jid='user@example.net/home' xmlns='http://jabber.org/protocol/workgroup' /&gt;
A: &lt;/iq&gt;
</pre></div>
                <p class="caption"><a name="example-41" id="example-41"></a>Example 41. Offer Reject Request</p><div class="indent"><pre class="prettyprint">
A: &lt;iq to='support@workgroup.example.com' from='alice@example.com/work' id='id1' type='set'&gt;
A:   &lt;offer-reject jid='user@example.net/home' xmlns='http://jabber.org/protocol/workgroup'/&gt;
A: &lt;/iq&gt;
</pre></div>
                <p class="caption"><a name="example-42" id="example-42"></a>Example 42. Offer Response</p><div class="indent"><pre class="prettyprint">
S: &lt;iq to='alice@example.com/work' from='support@workgroup.example.com' id='id1' type='result'/&gt;
</pre></div>
                <p class="" style="">The service may respond only with a successful result.</p>
                <div class="indent"><h3>4.2.6.1 <a name="proto-agent-acceptreject-errors" id="proto-agent-acceptreject-errors">Error Conditions</a></h3>
                    <p class="" style="">There are no defined error conditions for an accept/reject offer response.</p>
                </div>
                <div class="indent"><h3>4.2.6.2 <a name="proto-agent-acceptreject-example" id="proto-agent-acceptreject-example">Example</a></h3>
                    <p class="caption"><a name="example-43" id="example-43"></a>Example 43. Agent Accepts Chat</p><div class="indent"><pre class="prettyprint">
A: &lt;iq from='alice@example.com/work'
A:       to='support@workgroup.example.com'
A:       id='id3'
A:     type='set'&gt;
A:   &lt;offer-accept jid='user@example.net/home' xmlns='http://jabber.org/protocol/workgroup'/&gt;
A: &lt;/iq&gt;
S: &lt;iq from='support@workgroup.example.com'
S:     to='alice@example.com/work'
S:     id='id3'
S:     type='result'/&gt;
</pre></div>
                </div>
            </div>
            <div class="indent"><h3>4.2.7 <a name="proto-agent-revoke" id="proto-agent-revoke">Agent Offer Revoke Protocol</a></h3>
                <p class="" style="">This section describes the packet exchange involved in a service revoking an offer to an agent to chat to a user. This protocol MUST be supported by compliant implementations.</p>
                <p class="caption"><a name="example-44" id="example-44"></a>Example 44. Transactions</p><div class="indent"><pre class="prettyprint">
Agent                         Service
  |     Offer Revoke Request     |
  |&lt;-----------------------------|
  |    Offer Revoke Response     |
  |-----------------------------&gt;|
  |                              |
</pre></div>
                <p class="" style="">The service revokes an earlier offer to chat to a user. Offer revocations typically occur when the original offer times out, or a better agent was found to handle the chat. Note that offer revocations may occur anytime after an offer has been made, and before an invitation is sent (see agent state diagram). In other words, even though an agent has accepted an offer to chat, the agent may still receive an offer revocation (e.g. a better agent was found to handle the chat).</p>
                <p class="caption"><a name="example-45" id="example-45"></a>Example 45. Offer Revoke Request</p><div class="indent"><pre class="prettyprint">
S: &lt;iq from='support@workgroup.example.com' to='alice@example.com/work' id='id1' type='set'&gt;
S:   &lt;offer-revoke jid='user@example.net/home' xmlns='http://jabber.org/protocol/workgroup'&gt;
S:     &lt;reason&gt;
S:       [natural-language text]
S:     &lt;/reason&gt;
S:   &lt;/offer-revoke&gt;
S: &lt;/iq&gt;
</pre></div>
                <p class="" style="">The reason element may optionally contain free form text explaining the reason the offer was revoked.</p>
                <p class="caption"><a name="example-46" id="example-46"></a>Example 46. Offer Response</p><div class="indent"><pre class="prettyprint">
A: &lt;iq from='alice@example.com/work' to='support@workgroup.example.com' id='id1' type='result'/&gt;
</pre></div>
                <p class="" style="">The agent may respond only with a successful result.</p>
                <div class="indent"><h3>4.2.7.1 <a name="proto-agent-revoke-errors" id="proto-agent-revoke-errors">Error Conditions</a></h3>
                    <p class="" style="">There are no defined error conditions for an offer response.</p>
                </div>
                <div class="indent"><h3>4.2.7.2 <a name="proto-agent-revoke-example" id="proto-agent-revoke-example">Example</a></h3>
                    <p class="caption"><a name="example-47" id="example-47"></a>Example 47. Offer Revoked Due to Timeout</p><div class="indent"><pre class="prettyprint">
S: &lt;iq to='alice@example.com/work'
S:     from='support@workgroup.example.com'
S:     id='id4'
S:     type='set'&gt;
S:   &lt;offer-revoke xmlns='http://jabber.org/protocol/workgroup' jid='user@example.net/home'&gt;
S:       &lt;reason&gt;
S:         Offer timed out
S:       &lt;/reason&gt;
S:   &lt;/offer-revoke&gt;
S: &lt;/iq&gt;
A: &lt;iq to='support@workgroup.example.com'
A:     from='alice@example.com/work'
A:       id='id4'
A:     type='result'/&gt;
</pre></div>
                </div>
            </div>
            <div class="indent"><h3>4.2.8 <a name="proto-agent-invite" id="proto-agent-invite">Agent Invite Protocol</a></h3>
                <p class="" style="">This section describes the packet exchange inviting an agent to a chat room for conversation with a user. This protocol MUST be supported by compliant implementations.</p>
                <p class="caption"><a name="example-48" id="example-48"></a>Example 48. Transactions</p><div class="indent"><pre class="prettyprint">
Agent                         Service
  |         Agent Invite         |
  |&lt;-----------------------------|
  |                              |
</pre></div>
                <p class="" style="">The server sends an invitation to the agent to begin their conversation with the user, structured according to the format defined in <span class="ref">XEP-0045</span>. The 'from' attribute of the &lt;invite/&gt; element MUST be set to the JID of the workgroup.</p>
                <p class="" style="">In order to match invitations to offers, all invitations SHOULD include metadata in the &lt;offer/&gt; element, with the JID of the user specified via the 'jid' attribute. The typical metadata fragment would appear as:</p>
                <p class="caption"><a name="example-49" id="example-49"></a>Example 49. Invitation Meta-Data</p><div class="indent"><pre class="prettyprint">
&lt;offer xmlns='http://jabber.org/protocol/workgroup' jid='user@example.net/home'&gt;
</pre></div>
                <div class="indent"><h3>4.2.8.1 <a name="proto-agent-invite-errors" id="proto-agent-invite-errors">Error Conditions</a></h3>
                    <p class="" style="">There are no defined error conditions for agent invitations.</p>
                </div>
                <div class="indent"><h3>4.2.8.2 <a name="proto-agent-invite-example" id="proto-agent-invite-example">Example</a></h3>
                    <p class="" style="">An invitation from the server on behalf of the support@example.net workgroup:</p>
                    <p class="caption"><a name="example-50" id="example-50"></a>Example 50. An Invitation</p><div class="indent"><pre class="prettyprint">
S: &lt;message
S:     from='roomname@chatserver.example.com'
S:     to='alice@example.com/work'&gt;
S:   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
S:     &lt;invite from='support@workgroup.example.com'&gt;
S:       &lt;reason&gt;
S:       Please join the chat room to start your chat with user@example.net.
S:       &lt;/reason&gt;
S:     &lt;/invite&gt;
S:   &lt;/x&gt;
S:   &lt;offer xmlns='http://jabber.org/protocol/workgroup' jid='user@example.net/home'/&gt;
S: &lt;/message&gt;
</pre></div>
                </div>
            </div>
        </div>
    <h2>5.
       <a name="disco" id="disco">Service Discovery</a></h2>
        <p class="" style="">Service Discovery support is optional for Workgroup compliant implementations.  Workgroup services that do support Service Discovery MUST:</p>
        <ul class="" style="">
            <li class="" style="">Use the &lt;identity&gt; category='collaboration'.</li>
            <li class="" style="">Use the &lt;identity&gt; type='workgroup'.</li>
            <li class="" style="">Use the &lt;feature&gt; var='http://jabber.org/protocol/workgroup'.</li>
        </ul>
        <p class="" style="">An example of discovery browsing is included. Notice how probing starts at the server (example.com) revealing the workgroup service by its JID (workgroup.example.com) and a simple, human friendly name ("Example.com Live Assistant").  It is only during the discovery probing of the service that it is identified as a workgroup using the &lt;identity&gt; and &lt;feature&gt; tags. Finally individual workgroups (support and sales) can be discovered on the Workgroup service. When individual workgroups are probed, the &lt;identity&gt; and &lt;feature&gt; tags are again presented to identify them as workgroups along with (optional) associated metadata.</p>
        <p class="caption"><a name="example-51" id="example-51"></a>Example 51. Workgroup Service Discovery</p><div class="indent"><pre class="prettyprint">
U: &lt;iq to='example.com' from='user@example.net/home' id='id1' type='get'&gt;
U:     &lt;query xmlns='http://jabber.org/protocol/disco#items'/&gt;
U: &lt;/iq&gt;
S: &lt;iq from='example.com' to='user@example.net/home' id='id1' type='result'&gt;
S:    &lt;query xmlns='http://jabber.org/protocol/disco#items'&gt;
S:        &lt;item jid='workgroup.example.com' name='Example.com Live Assistant'/&gt;
S:    &lt;/query&gt;
S: &lt;/iq&gt;

U: &lt;iq to='workgroup.example.com' from='user@example.net/home' id='id2' type='get'&gt;
U:    &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
U: &lt;/iq&gt;
S: &lt;iq from='workgroup.example.com' to='user@example.net/home' id='i2' type='result'&gt;
S:    &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
S:        &lt;identity category='collaboration' name='Live Assistant' type='workgroup'/&gt;
S:        &lt;feature var='http://jabber.org/protocol/workgroup'/&gt;
S:        &lt;feature var='http://jabber.org/protocol/disco#info'/&gt;
S:    &lt;/query&gt;
S: &lt;/iq&gt;

U: &lt;iq to='workgroup.example.com' from='user@example.net/home' id='id3' type='get'&gt;
U:     &lt;query xmlns='http://jabber.org/protocol/disco#items'/&gt;
U: &lt;/iq&gt;
S: &lt;iq from='workgroup.example.com' to='user@example.net/home' id='id3' type='result'&gt;
S:     &lt;query xmlns='http://jabber.org/protocol/disco#items'&gt;
S:         &lt;item jid='support@workgroup.example.com' name='Example.com Support Live Assistant'/&gt;
S:         &lt;item jid='sales@workgroup.example.com' name='Example.com Sales Live Assistant'/&gt;
S:     &lt;/query&gt;
S: &lt;/iq&gt;

U: &lt;iq to='support@workgroup.example.com' from='user@example.net/home' id='id4' type="get'&gt;
U:     &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
U: &lt;/iq&gt;
S: &lt;iq from='support@workgroup.example.com' to='user@example.net/home' id='id4' type='result'&gt;
S:     &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
S:         &lt;identity category='collaboration' name='demo' type='workgroup'/&gt;
S:         &lt;feature var='http://jabber.org/protocol/disco#info'/&gt;
S:         &lt;x xmlns='jabber:x:data' type='result'&gt;
S:             &lt;field var='FORM_TYPE' type='hidden'&gt;
S:                 &lt;value&gt;http://jabber.org/protocol/workgroup#workgroupinfo&lt;/value&gt;
S:             &lt;/field&gt;
S:             &lt;field var='workgroup#description' label='Description'&gt;
S:                 &lt;value&gt;Example.com Support Workgroup&lt;/value&gt;
S:             &lt;/field&gt;
S:             &lt;field var='workgroup#online' label='Status'&gt;
S:                 &lt;value&gt;ready&lt;/value&gt;
S:             &lt;/field&gt;
S:         &lt;/x&gt;
S:     &lt;/query&gt;
S: &lt;/iq&gt;
</pre></div>
    <h2>6.
       <a name="impl" id="impl">Implementation Notes</a></h2>
        <ul class="" style="">
            <li class="" style="">A workgroup is a normal XMPP messaging node and MUST maintain its own presence.  It is recommended that a workgroup be able to respond to arbitrary chat messages sent to it (preferably by responding with instructions on how to join the queue).  Other users may subscribe to the workgroup service's presence using standard XMPP presence-subscribe and presence-unsubscribe protocols. The workgroup service's presence can be used to determine the workgroup's status without joining the workgroup as a user or agent. For example, a website server-side component can subscribe to the workgroup presence and indicate on web pages whether a workgroup is available to offer live chat to website visitors.</li>
            <li class="" style="">If workgroup goes offline, all queued users SHOULD be notified using the appropriate workgroup presence, status, and depart protocols.</li>
            <li class="" style="">An implementation MAY support anonymous login by users, which makes it easier to deploy such a system on a website.</li>
            <li class="" style="">Generally, client authors only need to implement the "user" portion of this document so that clients can contact workgroups. Implementing the "agent" portion of the document is generally left to specialized clients for agents.</li>
            <li class="" style="">Coordination of groupchat and workgroup services is beyond the scope of this document.  It is RECOMMENDED that implementations use or create standard mechanisms to allow workgroups and groupchat services to interact.</li>
        </ul>
    <h2>7.
       <a name="security" id="security">Security Considerations</a></h2>
        <p class="" style="">Implementations may wish to restrict who is allowed to join workgroups as users and agents. Details concerning the implementation of this feature is outside the scope of this document.</p>
    <h2>8.
       <a name="iana" id="iana">IANA Considerations</a></h2>
        <p class="" style="">This document requires no interaction with the <span class="ref" style=""><a href="http://www.iana.org/">Internet Assigned Numbers Authority (IANA)</a></span>  [<a href="#nt-idm393">7</a>].</p>
    <h2>9.
       <a name="registrar" id="registrar">XMPP Registrar Considerations</a></h2>
        <div class="indent"><h3>9.1 <a name="registrar-ns" id="registrar-ns">Protocol Namespaces</a></h3>
        <p class="" style="">The <span class="ref" style=""><a href="https://xmpp.org/registrar/">XMPP Registrar</a></span>  [<a href="#nt-idm400">8</a>] shall include 'http://jabber.org/protocol/workgroup' in its registry of protocol namespaces.</p>
        </div>
        <div class="indent"><h3>9.2 <a name="registrar-discotype" id="registrar-discotype">Service Discovery Category/Type</a></h3>
            <p class="" style="">The XMPP Registrar shall add a Service Discovvery type of "workgroup" to the existing "collaboration" category. The registry submission is as follows:</p>
            <p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;category&gt;
  &lt;name&gt;collaboriation&lt;/name&gt;
  &lt;type&gt;
    &lt;name&gt;workgroup&lt;/name&gt;
    &lt;desc&gt;A workgroup component.&lt;/desc&gt;
    &lt;doc&gt;XEP-0142&lt;/doc&gt;
  &lt;/type&gt;
&lt;/category&gt;
</pre></div>
        </div>
    <h2>10.
       <a name="schema" id="schema">XML Schema</a></h2>
      <p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='http://jabber.org/protocol/workgroup'
    xmlns='http://jabber.org/protocol/workgroup'
    elementFormDefault='qualified'&gt;

  &lt;xs:annotation&gt;
    &lt;xs:documentation&gt;
      The allowable root elements for the namespace defined
      herein are:
        - agent-status
        - agent-status-request
        - depart-queue
        - join-queue
        - notify-agents
        - notify-queue
        - notify-queue-details
        - offer
        - offer-accept
        - offer-reject
        - offer-revoke
        - queue-status
    &lt;/xs:documentation&gt;
  &lt;/xs:annotation&gt;

  &lt;xs:import
      namespace='jabber:x:data'
      schemaLocation='http://www.xmpp.org/schemas/x-data.xsd'/&gt;

  &lt;xs:element name='agent-status'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice minOccurs='0' maxOccurs='unbounded'&gt;
        &lt;xs:element name='current-chats' type='xs:positiveInteger'/&gt;
        &lt;xs:element name='max-chats' type='xs:positiveInteger'/&gt;
      &lt;/xs:choice&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='agent-status-request'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence minOccurs='0' maxOccurs='unbounded'&gt;
        &lt;xs:element ref='agent'/&gt;
      &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='depart-queue'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice minOccurs='0' maxOccurs='unbounded'&gt;
        &lt;xs:element name='jid' type='xs:string'/&gt;
        &lt;xs:any namespace='##other' processContents='lax'/&gt;
      &lt;/xs:choice&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='join-queue'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice xmlns:xdata='jabber:x:data' minOccurs='0' maxOccurs='unbounded'&gt;
        &lt;xs:element name='queue-notifications' type='empty'/&gt;
        &lt;xs:element ref='xdata:x'/&gt;
        &lt;xs:any namespace='##other' processContents='lax'/&gt;
      &lt;/xs:choice&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='notify-agents'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice minOccurs='0' maxOccurs='unbounded'&gt;
        &lt;xs:element name='available' type='xs:positiveInteger'/&gt;
        &lt;xs:element name='current-chats' type='xs:positiveInteger'/&gt;
        &lt;xs:element name='max-chats' type='xs:positiveInteger'/&gt;
      &lt;/xs:choice&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='notify-queue'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice minOccurs='0' maxOccurs='unbounded'&gt;
        &lt;xs:element name='count' type='xs:positiveInteger'/&gt;
        &lt;xs:element name='oldest' type='xs:dateTime'/&gt;
        &lt;xs:element name='time' type='xs:positiveInteger'/&gt;
        &lt;xs:element name='status'&gt;
          &lt;xs:simpleType&gt;
            &lt;xs:restriction base='xs:NCName'&gt;
              &lt;xs:enumeration value='moderator'/&gt;
              &lt;xs:enumeration value='none'/&gt;
              &lt;xs:enumeration value='participant'/&gt;
              &lt;xs:enumeration value='visitor'/&gt;
            &lt;/xs:restriction&gt;
          &lt;/xs:simpleType&gt;
        &lt;/xs:element&gt;
      &lt;/xs:choice&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='notify-queue-details'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence minOccurs='0' maxOccurs='unbounded'&gt;
        &lt;xs:element ref='user'/&gt;
      &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='offer'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice minOccurs='0' maxOccurs='unbounded'&gt;
        &lt;xs:element name='timeout' type='xs:positiveInteger'/&gt;
        &lt;xs:any namespace='##other' processContents='lax'/&gt;
      &lt;/xs:choice&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='offer-accept'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='jid' use='required' type='xs:string'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='offer-reject'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='jid' use='required' type='xs:string'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='offer-revoke'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence minOccurs='0'&gt;
        &lt;xs:element name='reason' type='xs:string'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='jid' type='xs:string' use='required'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='queue-status'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice minOccurs='0' maxOccurs='unbounded'&gt;
        &lt;xs:element name='position' type='xs:positiveInteger'/&gt;
        &lt;xs:element name='time' type='xs:positiveInteger'/&gt;
        &lt;xs:any namespace='##other' processContents='lax'/&gt;
      &lt;/xs:choice&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='user'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element name='position' type='xs:positiveInteger'/&gt;
        &lt;xs:element name='time' type='xs:positiveInteger'/&gt;
        &lt;xs:element name='join-time' type='xs:dateTime'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='jid' type='xs:string' use='required'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='agent'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='jid' use='required' type='xs:string'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
</pre></div>
    <h2>11.
       <a name="acknowledgements" id="acknowledgements">Acknowledgements</a></h2>
      <p class="" style="">The author would like to thank Iain Shigeoka for his work on the first version of this document, and Derek DeMoro and Gaston Dombiak for their comments.</p>
    <hr /><a name="appendices" id="appendices"></a><h2>Appendices</h2><hr /><a name="appendix-docinfo" id="appendix-docinfo"></a><h3>Appendix A: Document Information</h3><p class="indent">
            Series: <a href="http://xmpp.org/extensions/">XEP</a><br />
            Number: 0142<br />
            Publisher: <a href="/xsf/">XMPP Standards Foundation</a><br />
            Status:
            <a href="http://xmpp.org/extensions/xep-0001.html#states-Deferred">Deferred</a><br />
            Type:
            <a href="http://xmpp.org/extensions/xep-0001.html#types-Standards Track">Standards Track</a><br />
            Version: 0.3.1<br />
            Last Updated: 2018-11-03<br />
                Approving Body: <a href="http://xmpp.org/council/">XMPP Council</a><br />Dependencies: XMPP Core, XEP-0030, XEP-0045<br />
                Supersedes: None<br />
                Superseded By: None<br />
            Short Name: Not yet assigned<br />
              Source Control:
                <a class="standardsButton" href="https://github.com/xsf/xeps/blob/master/xep-0142.xml">HTML</a><br />
            This document in other formats:
                <a class="standardsButton" href="http://xmpp.org/extensions/xep-0142.xml">XML</a> 
                <a class="standardsButton" href="http://xmpp.org/extensions/xep-0142.pdf">PDF</a></p><hr /><a name="appendix-authorinfo" id="appendix-authorinfo"></a><h3>Appendix B: Author Information</h3><div class="indent"><h3>Matt Tucker</h3><p class="indent">
        Email:
        <a href="mailto:matt@jivesoftware.com">matt@jivesoftware.com</a><br />
        JabberID:
        <a href="xmpp:jivematt@jabber.org">jivematt@jabber.org</a><br /></p></div><hr /><a name="appendix-legal" id="appendix-legal"></a><h3>Appendix C: Legal Notices</h3><div class="indent"><h4>Copyright</h4>This XMPP Extension Protocol is copyright © 1999 – 2018 by the <a href="https://xmpp.org/">XMPP Standards Foundation</a> (XSF).<h4>Permissions</h4>Permission is hereby granted, free of charge, to any person obtaining a copy of this specification (the "Specification"), to make use of the Specification without restriction, including without limitation the rights to implement the Specification in a software program, deploy the Specification in a network service, and copy, modify, merge, publish, translate, distribute, sublicense, or sell copies of the Specification, and to permit persons to whom the Specification is furnished to do so, subject to the condition that the foregoing copyright notice and this permission notice shall be included in all copies or substantial portions of the Specification. Unless separate permission is granted, modified works that are redistributed shall not contain misleading information regarding the authors, title, number, or publisher of the Specification, and shall not claim endorsement of the modified works by the authors, any organization or project to which the authors belong, or the XMPP Standards Foundation.<h4>Disclaimer of Warranty</h4><span style="font-weight: bold">## NOTE WELL: This Specification is provided on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE. ##</span><h4>Limitation of Liability</h4>In no event and under no legal theory, whether in tort (including negligence), contract, or otherwise, unless required by applicable law (such as deliberate and grossly negligent acts) or agreed to in writing, shall the XMPP Standards Foundation or any author of this Specification be liable for damages, including any direct, indirect, special, incidental, or consequential damages of any character arising from, out of, or in connection with the Specification or the implementation, deployment, or other use of the Specification (including but not limited to damages for loss of goodwill, work stoppage, computer failure or malfunction, or any and all other commercial damages or losses), even if the XMPP Standards Foundation or such author has been advised of the possibility of such damages.<h4>IPR Conformance</h4>This XMPP Extension Protocol has been contributed in full conformance with the XSF's Intellectual Property Rights Policy (a copy of which can be found at &lt;<a href="https://xmpp.org/about/xsf/ipr-policy">https://xmpp.org/about/xsf/ipr-policy</a>&gt; or obtained by writing to XMPP Standards Foundation, P.O. Box 787, Parker, CO 80134 USA).</div><hr /><a name="appendix-xmpp" id="appendix-xmpp"></a><h3>Appendix D: Relation to XMPP</h3><p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 6120) and XMPP IM (RFC 6121) specifications contributed by the XMPP Standards Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this document has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p><hr /><a name="appendix-discuss" id="appendix-discuss"></a><h3>Appendix E: Discussion Venue</h3><p class="indent">The primary venue for discussion of XMPP Extension Protocols is the &lt;<a href="http://mail.jabber.org/mailman/listinfo/standards">standards@xmpp.org</a>&gt; discussion list.</p><p class="indent">Discussion on other xmpp.org discussion lists might also be appropriate; see &lt;<a href="http://xmpp.org/about/discuss.shtml">http://xmpp.org/about/discuss.shtml</a>&gt; for a complete list.</p><p class="indent">Errata can be sent to &lt;<a href="mailto:editor@xmpp.org">editor@xmpp.org</a>&gt;.</p><hr /><a name="appendix-conformance" id="appendix-conformance"></a><h3>Appendix F: Requirements Conformance</h3><p class="indent">The following requirements keywords as used in this document are to be interpreted as described in <a href="http://www.ietf.org/rfc/rfc2119.txt">RFC 2119</a>: "MUST", "SHALL", "REQUIRED"; "MUST NOT", "SHALL NOT"; "SHOULD", "RECOMMENDED"; "SHOULD NOT", "NOT RECOMMENDED"; "MAY", "OPTIONAL".</p><hr /><a name="appendix-notes" id="appendix-notes"></a><h3>Appendix G: Notes</h3><div class="indent"><p><a name="nt-idm63" id="nt-idm63">1</a>. XEP-0030: Service Discovery &lt;<a href="https://xmpp.org/extensions/xep-0030.html">https://xmpp.org/extensions/xep-0030.html</a>&gt;.</p><p><a name="nt-idm70" id="nt-idm70">2</a>. RFC 6120: Extensible Messaging and Presence Protocol (XMPP): Core &lt;<a href="http://tools.ietf.org/html/rfc6120">http://tools.ietf.org/html/rfc6120</a>&gt;.</p><p><a name="nt-idm74" id="nt-idm74">3</a>. XEP-0045: Multi-User Chat &lt;<a href="https://xmpp.org/extensions/xep-0045.html">https://xmpp.org/extensions/xep-0045.html</a>&gt;.</p><p><a name="nt-idm78" id="nt-idm78">4</a>. XEP-0004: Data Forms &lt;<a href="https://xmpp.org/extensions/xep-0004.html">https://xmpp.org/extensions/xep-0004.html</a>&gt;.</p><p><a name="nt-idm253" id="nt-idm253">5</a>. The max-chats value sent from agent to workgroup service is a 'hint' or recommended value.  The workgroup service is not obliged to accept this value. The actual max-chats value for the agent will be sent to the agent via the next Agent Status Update. This allows administrators to constrain agent behavior in order to enforce company policy, quality assurance, etc.</p><p><a name="nt-idm284" id="nt-idm284">6</a>. XEP-0082: XMPP Date and Time Profiles &lt;<a href="https://xmpp.org/extensions/xep-0082.html">https://xmpp.org/extensions/xep-0082.html</a>&gt;.</p><p><a name="nt-idm393" id="nt-idm393">7</a>. The Internet Assigned Numbers Authority (IANA) is the central coordinator for the assignment of unique parameter values for Internet protocols, such as port numbers and URI schemes. For further information, see &lt;<a href="http://www.iana.org/">http://www.iana.org/</a>&gt;.</p><p><a name="nt-idm400" id="nt-idm400">8</a>. The XMPP Registrar maintains a list of reserved protocol namespaces as well as registries of parameters used in the context of XMPP extension protocols approved by the XMPP Standards Foundation. For further information, see &lt;<a href="https://xmpp.org/registrar/">https://xmpp.org/registrar/</a>&gt;.</p></div><hr /><a name="appendix-revs" id="appendix-revs"></a><h3>Appendix H: Revision History</h3><p>Note: Older versions of this specification might be available at <a href="http://xmpp.org/extensions/attic/">http://xmpp.org/extensions/attic/</a></p><div class="indent"><h4>Version 0.3.1 (2018-11-03)</h4><div class="indent">Fix a bunch of typos, batch-style. (pep)
    </div><h4>Version 0.3 (2005-05-09)</h4><div class="indent"><p class="" style="">Editorial revision; defined XML schema.</p> (psa)
    </div><h4>Version 0.2 (2005-02-28)</h4><div class="indent"><p class="" style="">General re-organization, refined agent status protocol, removed queue-notification element from join request replies, user status pushes now use a message instead of IQ.</p> (mt/is)
    </div><h4>Version 0.1 (2004-08-10)</h4><div class="indent"><p class="" style="">Initial version.</p> (mt/is)
    </div></div><hr /><p>END</p></body></html>
