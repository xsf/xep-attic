<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>JEP-0130: Waiting Lists</title>
<link rel="stylesheet" type="text/css" href="jep.css">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
<meta name="DC.Title" content="Waiting Lists">
<meta name="DC.Creator" content="Peter Saint-Andre">
<meta name="DC.Creator" content="Yehezkel Dallal">
<meta name="DC.Creator" content="Alexandre Nolle">
<meta name="DC.Creator" content="Jean-Louis Seguineau">
<meta name="DC.Creator" content="Mark Troyer">
<meta name="DC.Description" content="This JEP defines an XMPP protocol extension that enables a user to add a non-IM user to a waiting list and be informed when the contact creates an IM account.">
<meta name="DC.Publisher" content="Jabber Software Foundation">
<meta name="DC.Contributor" content="JEP Editor">
<meta name="DC.Date" content="2005-11-30">
<meta name="DC.Type" content="Jabber Enhancement Proposal">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="JEP-0130">
<meta name="DC.Language" content="en">
<meta name="DC.Rights" content="This Jabber Enhancement Proposal is copyright 1999 - 2005 by the Jabber Software Foundation (JSF) and is in full conformance with the JSF's Intellectual Property Rights Policy &lt;http://www.jabber.org/jsf/ipr-policy.shtml&gt;. This material may be distributed only subject to the terms and conditions set forth in the Creative Commons Attribution License (&lt;http://creativecommons.org/licenses/by/2.5/&gt;).">
</head>
<body>
<h1>JEP-0130: Waiting Lists</h1>
<p>This JEP defines an XMPP protocol extension that enables a user to add a non-IM user to a waiting list and be informed when the contact creates an IM account.</p>
<p><hr></p>
<p style="color:green">NOTICE: This Historical JEP provides canonical documentation of a protocol that is in use within the Jabber/XMPP community. This JEP is not a standards-track specification within the Jabber Software Foundation's standards process; however, it may be converted to standards-track in the future or may be obsoleted by a more modern protocol.</p>
<p><hr></p>
<h2>JEP Information</h2>
<p class="indent">
            Status: Active<br>
            Type: Historical<br>
            Number: 0130<br>
            Version: 1.1<br>
            Last Updated: 2005-11-30<br>
            JIG: Standards JIG<br>
                Approving Body: Jabber Council<br>Dependencies: XMPP Core, XMPP IM, JEP-0094, JEP-0030<br>
                Supersedes: None<br>
                Superseded By: None<br>
            Short Name: waitinglist<br>
        Schema: &lt;<a href="http://jabber.org/protocol/waitinglist/waitinglist.xsd">http://jabber.org/protocol/waitinglist/waitinglist.xsd</a>&gt;<br>
              Wiki Page: &lt;<a href="http://wiki.jabber.org/index.php/Waiting%20Lists%20(JEP-0130)">http://wiki.jabber.org/index.php/Waiting Lists (JEP-0130)</a>&gt;
            </p>
<h2>Author Information</h2>
<div class="indent">
<h3>Peter Saint-Andre</h3>
<p class="indent">
        Email: stpeter@jabber.org<br>
        JID: stpeter@jabber.org</p>
<h3>Yehezkel Dallal</h3>
<p class="indent">
        Email: yehezkeld@followap.com<br></p>
<h3>Alexandre Nolle</h3>
<p class="indent">
        Email: anolle@francetelecom.com<br></p>
<h3>Jean-Louis Seguineau</h3>
<p class="indent">
        Email: jean-louis.seguineau@antepo.com<br>
        JID: jlseguineau@im.antepo.com</p>
<h3>Mark Troyer</h3>
<p class="indent">
        Email: mtroyer@jabber.com<br>
        JID: mtroyer@corp.jabber.com</p>
</div>
<h2>Legal Notice</h2>
<p class="indent">This Jabber Enhancement Proposal is copyright 1999 - 2005 by the <a href="http://www.jabber.org/jsf/">Jabber Software Foundation</a> (JSF) and is in full conformance with the JSF's Intellectual Property Rights Policy &lt;<a href="http://www.jabber.org/jsf/ipr-policy.shtml">http://www.jabber.org/jsf/ipr-policy.shtml</a>&gt;. This material may be distributed only subject to the terms and conditions set forth in the Creative Commons Attribution License (&lt;<a href="http://creativecommons.org/licenses/by/2.5/">http://creativecommons.org/licenses/by/2.5/</a>&gt;).</p>
<h2>Discussion Venue</h2>
<p class="indent">The preferred venue for discussion of this document is the Standards-JIG discussion list: &lt;<a href="http://mail.jabber.org/mailman/listinfo/standards-jig">http://mail.jabber.org/mailman/listinfo/standards-jig</a>&gt;.</p>
<h2>Relation to XMPP</h2>
<p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 3920) and XMPP IM (RFC 3921) specifications contributed by the Jabber Software Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this JEP has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p>
<h2>Conformance Terms</h2>
<p class="indent">The keywords "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119.</p>
<p><hr></p>
<h2>Table of Contents</h2>
<div class="indent"><dl>
<dt>1.  <a href="#intro">Introduction</a>
</dt>
<dt>2.  <a href="#glossary">Glossary</a>
</dt>
<dt>3.  <a href="#reqs">Requirements</a>
</dt>
<dt>4.  <a href="#usecases">Use Cases</a>
</dt>
<dl>
<dt>4.1.  <a href="#imuser-retrieve">IM User Retrieves Current WaitingList</a>
</dt>
<dl>
<dt>4.1.1.  <a href="#imuser-retrieve-primary">Primary Flow</a>
</dt>
<dt>4.1.2.  <a href="#imuser-retrieve-alt">Alternate Flows</a>
</dt>
</dl>
<dt>4.2.  <a href="#imuser-add">IM User Adds Contact to WaitingList</a>
</dt>
<dl>
<dt>4.2.1.  <a href="#imuser-add-primary">Primary Flow</a>
</dt>
<dt>4.2.2.  <a href="#imuser-add-alt">Alternate Flows</a>
</dt>
</dl>
<dt>4.3.  <a href="#imuser-remove">IM User Removes Contact from WaitingList</a>
</dt>
<dl>
<dt>4.3.1.  <a href="#imuser-remove-primary">Primary Flow</a>
</dt>
<dt>4.3.2.  <a href="#imuser-remove-alt">Alternate Flows</a>
</dt>
</dl>
</dl>
<dt>5.  <a href="#protocol">Protocol</a>
</dt>
<dl>
<dt>5.1.  <a href="#protocol-imuser">IM User Interaction With WaitingListService</a>
</dt>
<dl>
<dt>5.1.1.  <a href="#protocol-imuser-retrieve">IM User Retrieves Current WaitingList</a>
</dt>
<dt>5.1.2.  <a href="#protocol-imuser-add">IM User Adds Contact to WaitingList</a>
</dt>
<dt>5.1.3.  <a href="#protocol-imuser-remove">IM User Removes Contact from WaitingList</a>
</dt>
</dl>
<dt>5.2.  <a href="#protocol-service">WaitingListService Interaction With InteropPartners</a>
</dt>
<dl>
<dt>5.2.1.  <a href="#protocol-service-retrieve">ServiceProvider's WaitingListService Retrieves Current WaitingList</a>
</dt>
<dt>5.2.2.  <a href="#protocol-service-add">ServiceProvider's WaitingListService Adds Contact to WaitingList</a>
</dt>
<dt>5.2.3.  <a href="#protocol-service-remove">ServiceProvider's WaitingListService Removes Contact from WaitingList</a>
</dt>
</dl>
</dl>
<dt>6.  <a href="#impl">Implementation Notes</a>
</dt>
<dt>7.  <a href="#security">Security Considerations</a>
</dt>
<dt>8.  <a href="#iana">IANA Considerations</a>
</dt>
<dt>9.  <a href="#registrar">Jabber Registrar Considerations</a>
</dt>
<dl>
<dt>9.1.  <a href="#registrar-ns">Protocol Namespaces</a>
</dt>
<dt>9.2.  <a href="#registrar-identities">Service Discovery Identities</a>
</dt>
<dt>9.3.  <a href="#registrar-features">Service Discovery Features</a>
</dt>
</dl>
<dt>10.  <a href="#schema">XML Schema</a>
</dt>
<dt><a href="#notes">Notes</a></dt>
<dt><a href="#revs">Revision History</a></dt>
</dl></div>
<p><hr></p>
<h2>1.
       <a name="intro">Introduction</a>
</h2>
    <p class="" style="">An IM user may want to be informed when a contact creates an IM account. If the user knows some information about the contact (e.g., a phone number or email address), the user's service can use that information to place the contact on a "waiting list", then inform the user when the contact creates an IM account. This document defines an extension to <span class="ref" style="">RFC 3920</span>  [<a href="#nt-id2250973">1</a>] and <span class="ref" style="">RFC 3921</span>  [<a href="#nt-id2256305">2</a>] that enables such "waiting list" functionality, including the ability to add contacts on other domains if service providers agree to interoperate (e.g., to add a contact who uses a different mobile telephony service provider).</p>
    <p class="" style=""><span style="font-style: italic">Note: The protocol defined herein is currently in use at several large service providers in Europe. Others are welcome to use the protocol.</span></p>
  <h2>2.
       <a name="glossary">Glossary</a>
</h2>
    <p class="caption">Table 1: Terms Used</p>
<table border="1" cellpadding="3" cellspacing="0">
      <tr class="body">
        <th colspan="" rowspan="">Term</th>
        <th colspan="" rowspan="">Definition</th>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">Contact</td>
        <td align="" colspan="" rowspan="">A person with whom an IM User seeks to communicate, identified by a URI such as &lt;tel:PhoneNumber&gt; (see <span class="ref" style="">RFC 3966</span>  [<a href="#nt-id2256390">3</a>]) or &lt;mailto:EmailAddress&gt; (see <span class="ref" style="">RFC 2368</span>  [<a href="#nt-id2256412">4</a>]).</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">Customer</td>
        <td align="" colspan="" rowspan="">A person who is contracted for services with a ServiceProvider.</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">IM User</td>
        <td align="" colspan="" rowspan="">Any Customer who has registered for instant messaging services.</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">InteropPartner</td>
        <td align="" colspan="" rowspan="">Any company that agrees to interoperate using the protocol defined herein.</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">JID</td>
        <td align="" colspan="" rowspan="">The unique identifier of an IM User in the XMPP protocol. Outside the context of an IM session, a JID is of the form &lt;user@domain&gt; ("bare JID"); within the context of an IM session, a JID is of the form &lt;user@domain/resource&gt; ("full JID").</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">ServiceProvider</td>
        <td align="" colspan="" rowspan="">A company that provides telephony or email services to a Customer.</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">URI</td>
        <td align="" colspan="" rowspan="">A Uniform Resource Identifier as defined in <span class="ref" style="">RFC 3986</span>  [<a href="#nt-id2256562">5</a>]. Specific URI schemes that may be useful in this specification include 'tel:', 'mailto:', and 'sip:', but any URI scheme may be used.</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">Waiting List</td>
        <td align="" colspan="" rowspan="">A list of Contacts whom an entity (IM User or InteropPartner) is waiting to hear about regarding their status as instant messaging users.</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">WaitingListService</td>
        <td align="" colspan="" rowspan="">An XMPP service that maintains Waiting lists for IM Users and/or InteropPartners.</td>
      </tr>
    </table>
  <h2>3.
       <a name="reqs">Requirements</a>
</h2>
    <p class="" style="">This protocol is designed so that an IM User can:</p>
    <ol start="1" type="1">
      <li>Request the user's current Waiting List</li>
      <li>Add a Contact to a local WaitingList (based on some URI associated with the Contact)</li>
      <li>Receive notification from a local WaitingListService if the Contact has (or subsequently creates) an IM account</li>
      <li>Remove a Contact from the Waiting List</li>
    </ol>
    <p class="" style="">In addition, this protocol is designed so that a ServiceProvider can:</p>
    <ol start="1" type="1">
      <li>Request the service's current WaitingList</li>
      <li>Add a Contact to a WaitingList at an InteroPartner (based on some URI associated with the Contact)</li>
      <li>Receive notification from the InteropPartner if the Contact has (or subsequently creates) an IM account</li>
      <li>Remove a Contact from the Waiting List</li>
    </ol>
  <h2>4.
       <a name="usecases">Use Cases</a>
</h2>
    <div class="indent">
<h3>4.1 <a name="imuser-retrieve">IM User Retrieves Current WaitingList</a>
</h3>
      <p class="" style="">Before adding or removing Contacts from its WaitingList, an IM User SHOULD retrieve its current WaitingList. The activity flow is as follows:</p>
      <div class="indent">
<h3>4.1.1 <a name="imuser-retrieve-primary">Primary Flow</a>
</h3>
        <ol start="1" type="1">
          <li>IM User discovers WaitingListService hosted by ServiceProvider [A1]; it is RECOMMENDED to do this immediately after logging in.</li>
          <li>IM User requests current WaitingList from WaitingListService.</li>
          <li>WaitingListService returns WaitingList to IM User, including any items for which JIDs have been discovered [A2].</li>
        </ol>
      </div>
      <div class="indent">
<h3>4.1.2 <a name="imuser-retrieve-alt">Alternate Flows</a>
</h3>
        <ol start="1" type="1">
          <li>ServiceProvider does not host a WaitingListService:
          <ol start="1" type="1">
              <li>Use Case Ends unsuccessfully.</li>
            </ol>
          </li>
          <li>IM User does not have a Waiting List:
          <ol start="1" type="1">
              <li>WaitingListService returns &lt;item-not-found/&gt; error to IM User.</li>
              <li>Use Case Ends unsuccessfully.</li>
            </ol>
          </li>
        </ol>
      </div>
    </div>
    <div class="indent">
<h3>4.2 <a name="imuser-add">IM User Adds Contact to WaitingList</a>
</h3>
      <p class="" style="">An IM User may know a URI for a Contact (e.g., a phone number or email address) but not the Contact's JID. In order to subscribe to the Contact's presence or otherwise communicate with the Contact over an instant messaging system, the IM User first needs to discover the Contact's JID based on a URI for the Contact. However, the Contact may not yet have an IM account. Because the IM User may therefore need to wait until the Contact creates an account, the IM User needs to add the Contact to a WaitingList. The activity flow is as follows:</p>
      <div class="indent">
<h3>4.2.1 <a name="imuser-add-primary">Primary Flow</a>
</h3>
        <ol start="1" type="1">
          <li>IM User SHOULD first complete use case for "IM User Retrieves Current WaitingList".</li>
          <li>IM User requests addition of Contact to WaitingList based on Contact's URI.</li>
          <li>WaitingListService determines that the URI scheme is supported [A1].</li>
          <li>WaitingListService determines that the information provided is a valid URI for that URI scheme [A2].</li>
          <li>WaitingListService acknowledges addition of Contact to IM User's WaitingList.</li>
          <li>WaitingListService determines that Contact's URI does not belong to a person served by ServiceProvider [A3].</li>
          <li>WaitingListService discovers WaitingListServices hosted by one or more InteropPartners.</li>
          <li>WaitingListService queries one or more InteropPartner's WaitingListServices for JID associated with URI.</li>
          <li>InteropPartner's WaitingListService determines that Contact's URI belongs to a person served by that partner [A4].</li>
          <li>InteropPartner's WaitingListService determines that Contact is an IM User [A5].</li>
          <li>OPTIONALLY, WaitingListService requires that Contact approves request.</li>
          <li>InteropPartner's WaitingListService informs ServiceProvider's WaitingListService of JID associated with Contact's URI. [A6]</li>
          <li>ServiceProvider's WaitingListService informs IM User of Contact's JID. [A8]</li>
          <li>Use Case Ends.</li>
        </ol>
      </div>
      <div class="indent">
<h3>4.2.2 <a name="imuser-add-alt">Alternate Flows</a>
</h3>
        <ol start="1" type="1">
          <li>The URI scheme is not supported:
            <ol start="1" type="1">
              <li>WaitingListService sends &lt;bad-request/&gt; error to IM User and does not add contact to WaitingList.</li>
              <li>Use Case Ends unsuccessfully.</li>
            </ol>
          </li>
          <li>The information provided is not a valid URI:
            <ol start="1" type="1">
              <li>WaitingListService sends &lt;not-acceptable/&gt; error to IM User and does not add contact to WaitingList.</li>
              <li>Use Case Ends unsuccessfully.</li>
            </ol>
          </li>
          <li>URI belongs to person served by ServiceProvider:
            <ol start="1" type="1">
              <li>WaitingListService determines that Contact is an IM User registered with ServiceProvider [A7].</li>
              <li>OPTIONALLY, WaitingListService requires that Contact approves request.</li>
              <li>WaitingListService informs IM User of Contact's JID.</li>
              <li>Use Case Ends.</li>
            </ol>
          </li>
          <li>URI does not belong to a person served by InteropPartner:
            <ol start="1" type="1">
              <li>InteropPartner sends &lt;item-not-found/&gt; error to WaitingListService.</li>
              <li>If all InteropPartners queried return &lt;item-not-found/&gt; error, WaitingListService sends &lt;item-not-found/&gt; error (or local equivalent) to IM User and IM User removes item from WaitingList.</li>
              <li>Use Case Ends unsuccessfully.</li>
            </ol>
          </li>
          <li>Contact is not an IM User registered with InteropPartner:
            <ol start="1" type="1">
              <li>InteropPartner records WaitingListService's request for JID associated with URI.</li>
              <li>OPTIONALLY, InteropPartner invites Contact to register as an IM User.</li>
              <li>Contact registers.</li>
              <li>InteropPartner informs Service Provider's WaitingListService of JID associated with Contact's URI.</li>
              <li>ServiceProvider's WaitingListService informs all IM Users who requested JID associated with Contact's URI.</li>
              <li>Use Case Ends.</li>
            </ol>
          </li>
          <li>Contact denies request:
            <ol start="1" type="1">
              <li>InteropPartner's WaitingListService sends &lt;not-authorized/&gt; error to ServiceProvider's WaitingListService.</li>
              <li>ServiceProvider's WaitingListService sends &lt;not-authorized/&gt; error (or local equivalent) to IM User.</li>
              <li>IM User removes item from WaitingList.</li>
              <li>Use Case Ends unsuccessfully.</li>
            </ol>
          </li>
          <li>Contact is not an IM User registered with ServiceProvider:
            <ol start="1" type="1">
              <li>WaitingListService records IM User's request for JID associated with URI.</li>
              <li>OPTIONALLY, WaitingListService invites Contact to register as an IM User.</li>
              <li>Contact registers.</li>
              <li>WaitingListService informs all IM Users who requested JID associated with Contact's URI.</li>
              <li>Use Case Ends.</li>
            </ol>
          </li>
          <li>Contact's URI is not handled by any ServiceProvider:
            <ol start="1" type="1">
              <li>WaitingListService informs all IM Users who requested JID associated with Contact's URI that no InteropPartner services Contact's URI.</li>
              <li>IM User removes item from WaitingList.</li>
              <li>Use Case Ends unsuccessfully.</li>
            </ol>
          </li>
          <li>Connection to ServiceProvider times out:
            <ol start="1" type="1">
              <li>WaitingListService sends &lt;remote-server-timeout/&gt; error (or local equivalent) to IM User.</li>
              <li>IM User removes item from WaitingList.</li>
              <li>Use Case Ends unsuccessfully.</li>
            </ol>
          </li>
        </ol>
      </div>
    </div>
    <div class="indent">
<h3>4.3 <a name="imuser-remove">IM User Removes Contact from WaitingList</a>
</h3>
      <p class="" style="">An IM User may want to remove an item from its WaitingList (or removing the item may be recommended as part of an unsuccessful flow in the previous use case).</p>
      <div class="indent">
<h3>4.3.1 <a name="imuser-remove-primary">Primary Flow</a>
</h3>
        <ol start="1" type="1">
          <li>IM User sends removal request to WaitingListService.</li>
          <li>WaitingListService removes IM User's request for JID associated with URI.</li>
          <li>WaitingListService informs IM User of successful removal [A1].</li>
          <li>WaitingListService sends removal request to appropriate InteropPartner's WaitingListService [A2].</li>
          <li>InteropPartner's WaitingListService determines that URI belongs to a person served by that partner.</li>
          <li>InteropPartner's WaitingListService removes ServiceProvider's WaitingListService's request for JID.</li>
          <li>InteropPartner's WaitingListService informs ServiceProvider's WaitingListService of successful removal.</li>
          <li>Use Case Ends.</li>
        </ol>
      </div>
      <div class="indent">
<h3>4.3.2 <a name="imuser-remove-alt">Alternate Flows</a>
</h3>
        <ol start="1" type="1">
          <li>IM User never requested JID associated with URI:
            <ol start="1" type="1">
              <li>WaitingListService sends &lt;item-not-found/&gt; error to IM User.</li>
              <li>Use Case Ends.</li>
            </ol>
          </li>
          <li>Contact URI is served by WaitingListService or IM User was not the only person who requested the JID:
            <ol start="1" type="1">
              <li>Use Case Ends.</li>
            </ol>
          </li>
        </ol>
      </div>
    </div>
  <h2>5.
       <a name="protocol">Protocol</a>
</h2>
    <div class="indent">
<h3>5.1 <a name="protocol-imuser">IM User Interaction With WaitingListService</a>
</h3>
      <p class="" style="">
        <span style="font-style: italic">This section of the document is provided for the sake of domains that implement XMPP as their local protocol; domains that implement another protocol will use their service-specific protocol to complete the user-to-domain interaction. Support for the protocol defined in this section is NOT REQUIRED for services that do not implement XMPP as their local protocol.</span>
      </p>
      <div class="indent">
<h3>5.1.1 <a name="protocol-imuser-retrieve">IM User Retrieves Current WaitingList</a>
</h3>
        <p class="" style="">It is RECOMMENDED for an IM User's client to retrieve the WaitingList immediately after logging in. However, first it must discover its local WaitingListService. An IM User MAY use either <span class="ref" style="">Service Discovery</span>  [<a href="#nt-id2257488">6</a>] or the deprecated <span class="ref" style="">Agent Information</span>  [<a href="#nt-id2257512">7</a>] protocol.</p>
        <p class="caption">Example 1. IM User Discovers WaitingListService by Sending Agent Information Request to its Server</p>
<div class="indent"><pre>
&lt;iq type='get' id='agent1'&gt;
  &lt;query xmlns='jabber:iq:agents'/&gt;
&lt;/iq&gt;
        </pre></div>
        <p class="caption">Example 2. Server Returns Address of its WaitingListService</p>
<div class="indent"><pre>
&lt;iq type='result' id='agent1'&gt;
  &lt;query xmlns='jabber:iq:agents'&gt;
    ...
    &lt;agent jid='waitlist.service-provider.com'&gt;
      &lt;name&gt;Waiting List Service&lt;/name&gt;
      &lt;service&gt;waitinglist&lt;/service&gt;
    &lt;/agent&gt;
    ...
  &lt;/query&gt;
&lt;/iq&gt;
        </pre></div>
        <p class="caption">Example 3. IM User Discovers WaitingListService by Sending Service Discovery Request to its Server</p>
<div class="indent"><pre>
&lt;iq type='get' id='disco1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'/&gt;
&lt;/iq&gt;
        </pre></div>
        <p class="caption">Example 4. Server Returns Address of its WaitingListService</p>
<div class="indent"><pre>
&lt;iq type='result' id='disco1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'&gt;
    ...
    &lt;item jid='waitlist.service-provider.com'
          name='Waiting List Service'/&gt;
    ...
  &lt;/query&gt;
&lt;/iq&gt;
        </pre></div>
        <p class="caption">Example 5. IM User Queries WaitingListService for Detailed Information</p>
<div class="indent"><pre>
&lt;iq type='get'
    from='user@service-provider.com/resource'
    to='waitlist.service-provider.com'
    id='disco2'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;
        </pre></div>
        <p class="" style="">The WaitingListService SHOULD return detailed information about the service it provides, including the URI schemes it supports (see also the <a href="#registrar-features">Service Discovery Features</a> section of this document).</p>
        <p class="caption">Example 6. WaitingListService Returns Detailed Information</p>
<div class="indent"><pre>
&lt;iq type='result'
    from='waitlist.service-provider.com'
    to='user@service-provider.com/resource'
    id='disco2'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;identity category='directory' type='waitinglist'/&gt;
    &lt;feature var='http://jabber.org/protocol/waitinglist'/&gt;
    &lt;feature var='http://jabber.org/protocol/waitinglist/schemes/mailto'/&gt;
    &lt;feature var='http://jabber.org/protocol/waitinglist/schemes/tel'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
        </pre></div>
        <p class="" style="">Once an IM User has discovered the WaitingListService, the user's client SHOULD request its current Waiting List. This is done by sending an IQ-get to the WaitingListService containing an empty &lt;query/&gt; element qualified by the 'http://jabber.org/protocol/waitinglist' namespace:</p>
        <p class="caption">Example 7. IM User Requests its Current WaitingList</p>
<div class="indent"><pre>
&lt;iq type='get'
    from='user@service-provider.com/resource'
    to='waitlist.service-provider.com'
    id='request1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/waitinglist'/&gt;
&lt;/iq&gt;
        </pre></div>
        <p class="" style="">Upon request, the WaitingListService MUST return the current WaitingList to the IM User:</p>
        <p class="caption">Example 8. WaitingListService Returns WaitingList to IM User</p>
<div class="indent"><pre>
&lt;iq type='result'
    from='waitlist.service-provider.com'
    to='user@service-provider.com/resource'
    id='request1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/waitinglist'&gt;
    &lt;item id='12345'&gt;
      &lt;uri scheme='tel'&gt;3033083282&lt;/uri&gt;
      &lt;name&gt;PSA&lt;/name&gt;
    &lt;/item&gt;
    &lt;item id='23456'&gt;
      &lt;uri scheme='mailto'&gt;editor@jabber.org&lt;/uri&gt;
      &lt;name&gt;JEP Editor&lt;/name&gt;
    &lt;/item&gt;
  &lt;/query&gt;
&lt;/iq&gt;
        </pre></div>
        <p class="" style="">Each ItemID MUST be unique within the scope of the client's WaitingList items. The value of the ItemID is an opaque string; an implementation MAY assign semantic meaning to the ItemID (e.g., id="John Smith (mobile)" rather than id="12345"), but such meaning is implementation-specific and outside the scope of the protocol defined herein. The user MAY include a &lt;name/&gt; element containing a natural-language name for the Contact.</p>
        <p class="" style="">The WaitingList MAY contain an item for which a JID has been discovered.</p>
        <p class="caption">Example 9. IM User Asks for its WaitingList including Newly Discovered JID</p>
<div class="indent"><pre>
&lt;iq type='get'
    from='user@service-provider.com/resource'
    to='waitlist.service-provider.com'
    id='jidask1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/waitinglist'/&gt;
&lt;/iq&gt;

&lt;iq type='result'
    from='waitlist.service-provider.com'
    to='user@service-provider.com/resource'
    id='jidask1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/waitinglist'&gt;
    &lt;item id='12345' jid='stpeter@jabber.org'&gt;
      &lt;uri scheme='tel'&gt;3033083282&lt;/uri&gt;
      &lt;name&gt;PSA&lt;/name&gt;
    &lt;/item&gt;
    &lt;item id='23456'&gt;
      &lt;uri scheme='mailto'&gt;editor@jabber.org&lt;/uri&gt;
      &lt;name&gt;JEP Editor&lt;/name&gt;
    &lt;/item&gt;
  &lt;/query&gt;
&lt;/iq&gt;
        </pre></div>
      </div>
      <div class="indent">
<h3>5.1.2 <a name="protocol-imuser-add">IM User Adds Contact to WaitingList</a>
</h3>
        <p class="" style="">Once an IM User's client has discovered the WaitingListService and requested the user's WaitingList, the user can add Contacts to the WaitingList based on the Contact's URI. (Note: This JEP uses the example of phone numbers via the 'tel' URI scheme, but the same rules apply to WaitingList items based on email addresses or other URI schemes.)</p>
        <p class="caption">Example 10. IM User Requests Addition of Contact to WaitingList</p>
<div class="indent"><pre>
&lt;iq type='set'
    to='waitlist.service-provider.com'
    id='waitinglist1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/waitinglist'&gt;
    &lt;item&gt;
      &lt;uri scheme='tel'&gt;contact-number&lt;/uri&gt;
      &lt;name&gt;contact-name&lt;/name&gt;
    &lt;/item&gt;
  &lt;/query&gt;
&lt;/iq&gt;
        </pre></div>
        <p class="" style="">As described below, various error conditions may occur. (For information about error syntax, refer to <span class="ref" style="">Error Condition Mappings</span>  [<a href="#nt-id2257742">8</a>].)</p>
        <p class="" style="">If the IM User provided a URI whose scheme is not supported, WaitingListService MUST return a &lt;bad-request/&gt; error to the IM User and MUST NOT add the Contact to the WaitingList.</p>
        <p class="caption">Example 11. WaitingListService Returns &lt;bad-request/&gt; Error to IM User</p>
<div class="indent"><pre>
&lt;iq type='error'
    from='waitlist.service-provider.com'
    to='user@service-provider.com/resource'
    id='waitinglist1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/waitinglist'&gt;
    &lt;item&gt;
      &lt;uri scheme='tag'&gt;shakespeare.lit,2005-08:waitlist1&lt;/uri&gt;
      &lt;name&gt;contact-name&lt;/name&gt;
    &lt;/item&gt;
  &lt;/query&gt;
  &lt;error code='400' type='modify'&gt;
    &lt;bad-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
        </pre></div>
        <p class="" style="">If the IM User included a JID in the request, WaitingListService MUST return a &lt;bad-request/&gt; error to IM User and MUST NOT add the Contact to the WaitingList. (Note: A WaitingListService MUST NOT return a non-XMPP URI to an IM User based on the Contact's JID; see the <a href="#security">Security Considerations</a> section of this document.)</p>
        <p class="caption">Example 12. WaitingListService Returns &lt;bad-request/&gt; Error to IM User</p>
<div class="indent"><pre>
&lt;iq type='error'
    from='waitlist.service-provider.com'
    to='user@service-provider.com/resource'
    id='waitinglist1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/waitinglist'&gt;
    &lt;item jid='some-jid'&gt;
      &lt;uri scheme='tel'&gt;contact-number&lt;/uri&gt;
      &lt;name&gt;contact-name&lt;/name&gt;
    &lt;/item&gt;
  &lt;/query&gt;
  &lt;error code='400' type='modify'&gt;
    &lt;bad-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
        </pre></div>
        <p class="" style="">If the IM User provided an invalid URI (e.g., a phone number with too many digits or an email address with no '@' character), WaitingListService MUST return a &lt;not-acceptable/&gt; error to the IM User and MUST NOT add the Contact to the WaitingList.</p>
        <p class="caption">Example 13. WaitingListService Returns &lt;not-acceptable/&gt; Error to IM User</p>
<div class="indent"><pre>
&lt;iq type='error'
    from='waitlist.service-provider.com'
    to='user@service-provider.com/resource'
    id='waitinglist1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/waitinglist'&gt;
    &lt;item&gt;
      &lt;uri scheme='tel'&gt;+1234563033083283&lt;/uri&gt;
      &lt;name&gt;contact-name&lt;/name&gt;
    &lt;/item&gt;
  &lt;/query&gt;
  &lt;error code='406' type='modify'&gt;
    &lt;not-acceptable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
        </pre></div>
        <p class="" style="">If all of the InteropPartners return an &lt;item-not-found/&gt; error to WaitingListService, WaitingListService MUST return an &lt;item-not-found/&gt; error (or local equivalent) to the IM User (and IM User SHOULD then remove the item from the WaitingList as described in the next use case).</p>
        <p class="caption">Example 14. WaitingListService Returns &lt;item-not-found/&gt; Error to IM User</p>
<div class="indent"><pre>
&lt;iq type='error'
    from='waitlist.service-provider.com'
    to='user@service-provider.com/resource'
    id='waitinglist1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/waitinglist'&gt;
    &lt;item&gt;
      &lt;uri scheme='tel'&gt;+1234563033083283&lt;/uri&gt;
      &lt;name&gt;contact-name&lt;/name&gt;
    &lt;/item&gt;
  &lt;/query&gt;
  &lt;error code='404' type='cancel'&gt;
    &lt;item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
        </pre></div>
        <p class="" style="">If Contact denies request, InteropPartner MUST return a &lt;not-authorized/&gt; error to WaitingListService, which MUST return a &lt;not-authorized/&gt; error (or local equivalent) to the IM User (and IM User SHOULD then remove the item from the WaitingList as described in the next use case).</p>
        <p class="caption">Example 15. WaitingListService Returns &lt;not-authorized/&gt; Error to IM User</p>
<div class="indent"><pre>
&lt;iq type='error'
    from='waitlist.service-provider.com'
    to='user@service-provider.com/resource'
    id='waitinglist1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/waitinglist'&gt;
    &lt;item&gt;
      &lt;uri scheme='tel'&gt;+1234563033083283&lt;/uri&gt;
      &lt;name&gt;contact-name&lt;/name&gt;
    &lt;/item&gt;
  &lt;/query&gt;
  &lt;error code='401' type='auth'&gt;
    &lt;not-authorized xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
        </pre></div>
        <p class="" style="">If the IM User provided a URI that is not served by an InteropPartner (e.g., a phone number associated with a telephony provider that is not in the WaitingListService's whitelist of InteropPartners), WaitingListService SHOULD return a &lt;remote-server-not-found/&gt; error to IM User (and the IM User SHOULD then remove the item from the WaitingList as described in the next use case).</p>
        <p class="caption">Example 16. WaitingListService Returns &lt;remote-server-not-found/&gt; Error to IM User</p>
<div class="indent"><pre>
&lt;iq type='error' id='waitinglist1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/waitinglist'&gt;
    &lt;item&gt;
      &lt;uri scheme='tel'&gt;contact-number&lt;/uri&gt;
      &lt;name&gt;contact-name&lt;/name&gt;
    &lt;/item&gt;
  &lt;/query&gt;
  &lt;error code='404' type='cancel'&gt;
    &lt;remote-server-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
        </pre></div>
        <p class="" style="">If WaitingListService does not receive a reply from InteropPartner within a certain amount of time or the connection to InteropPartner times out, WaitingListService SHOULD send a &lt;remote-server-timeout/&gt; error to IM User (and the IM User SHOULD then remove the item from the WaitingList as described in the next use case).</p>
        <p class="caption">Example 17. WaitingListService Returns &lt;remote-server-timeout/&gt; Error to IM User</p>
<div class="indent"><pre>
&lt;iq type='error' id='waitinglist1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/waitinglist'&gt;
    &lt;item&gt;
      &lt;uri scheme='tel'&gt;contact-number&lt;/uri&gt;
      &lt;name&gt;contact-name&lt;/name&gt;
    &lt;/item&gt;
  &lt;/query&gt;
  &lt;error code='504' type='cancel'&gt;
    &lt;remote-server-timeout xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
        </pre></div>
        <p class="" style="">If no error was generated but the WaitingListService does not immediately know the Contact JID, WaitingListService MUST inform the IM User that the request was successfully received, including a unique ID number for the new WaitingList item.</p>
        <p class="caption">Example 18. WaitingListService Informs IM User that Request was Received</p>
<div class="indent"><pre>
&lt;iq type='result'
    from='waitlist.service-provider.com'
    to='user@service-provider.com/resource'
    id='waitinglist1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/waitinglist'&gt;
    &lt;item id='34567'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
        </pre></div>
        <p class="" style="">If WaitingListService knows Contact JID when the IQ result is returned to the user, it MAY include the WaitingList item in the IQ result:</p>
        <p class="caption">Example 19. WaitingListService Returns IQ Result to IM User (With Contact JID)</p>
<div class="indent"><pre>
&lt;iq type='result'
    from='waitlist.service-provider.com'
    to='user@service-provider.com/resource'
    id='waitinglist1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/waitinglist'&gt;
    &lt;item id='34567' jid='contact@service-provider.com'&gt;
      &lt;uri scheme='tel'&gt;contact-number&lt;/uri&gt;
      &lt;name&gt;contact-name&lt;/name&gt;
    &lt;/item&gt;
  &lt;/query&gt;
&lt;/iq&gt;
        </pre></div>
        <p class="" style="">If WaitingListService knows Contact JID (or learns Contact JID from InteropPartner), it MUST inform IM User through a "JID push" message, which consists of a message stanza that contains a &lt;waitlist/&gt; element qualified by the 'http://jabber.org/protocol/waitinglist' namespace:
           [<a href="#nt-id2257996">9</a>]
        </p>
        <p class="caption">Example 20. WaitingListService Pushes Contact's JID to IM User</p>
<div class="indent"><pre>
&lt;message
    from='waitlist.service-provider.com'
    to='user@service-provider.com'&gt;
  &lt;body&gt;This message contains a WaitingList item.&lt;/body&gt;
  &lt;waitlist xmlns='http://jabber.org/protocol/waitinglist'&gt;
    &lt;item id='34567' jid='contact@service-provider.com'&gt;
      &lt;uri scheme='tel'&gt;contact-number&lt;/uri&gt;
      &lt;name&gt;contact-name&lt;/name&gt;
    &lt;/item&gt;
  &lt;/waitlist&gt;
&lt;/message&gt;
        </pre></div>
        <p class="" style="">Note: The JID push uses &lt;message/&gt; because the WaitingListService has no knowledge of the user's presence and therefore cannot assume that an &lt;iq/&gt; stanza will be received by the user at a specific resource.</p>
        <p class="" style="">If WaitingListService learns that Contact's URI is not handled by any InteropPartner, it SHOULD inform IM User through a "JID push" message:</p>
        <p class="caption">Example 21. WaitingListService Informs IM User that No InteropPartner Handles Contact's URI</p>
<div class="indent"><pre>
&lt;message
    from='waitlist.service-provider.com'
    to='user@service-provider.com'&gt;
  &lt;body&gt;Sorry, we cannot find this contact.&lt;/body&gt;
  &lt;waitlist xmlns='http://jabber.org/protocol/waitinglist'&gt;
    &lt;item id='34567' 
          jid='contact@service-provider.com'
          type='error'&gt;
      &lt;uri scheme='tel'&gt;contact-number&lt;/uri&gt;
      &lt;name&gt;contact-name&lt;/name&gt;
      &lt;error code='404' 
             type='cancel'
             xmlns='jabber:client'&gt;
        &lt;item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
      &lt;/error&gt;
    &lt;/item&gt;
  &lt;/waitlist&gt;
&lt;/message&gt;
        </pre></div>
      </div>
      <div class="indent">
<h3>5.1.3 <a name="protocol-imuser-remove">IM User Removes Contact from WaitingList</a>
</h3>
        <p class="" style="">In order to remove the item from the WaitingList, the IM User MUST complete the "Remove Contact from WaitingList" use case.</p>
        <p class="caption">Example 22. IM User Sends Removal Request to WaitingListService</p>
<div class="indent"><pre>
&lt;iq type='set'
    from='user@service-provider.com/resource'
    to='waitlist.service-provider.com'
    id='remove1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/waitinglist'&gt;
    &lt;item id='34567'&gt;
      &lt;remove/&gt;
    &lt;/item&gt;
  &lt;/query&gt;
&lt;/iq&gt;
        </pre></div>
        <p class="" style="">If WaitingListService previously recorded request, WaitingListService removes request from list and returns result to IM User.</p>
        <p class="caption">Example 23. WaitingListService Returns Result to IM User</p>
<div class="indent"><pre>
&lt;iq type='result'
    from='waitlist.service-provider.com'
    to='user@service-provider.com/resource'
    id='remove1'/&gt;
        </pre></div>
        <p class="" style="">If WaitingListService did not previously record this request, WaitingListService MUST return an &lt;item-not-found/&gt; error to the IM User.</p>
        <p class="caption">Example 24. WaitingListService Returns &lt;item-not-found/&gt; Error to IM User</p>
<div class="indent"><pre>
&lt;iq type='error' id='remove1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/waitinglist'&gt;
    &lt;item id='34567'&gt;
      &lt;remove/&gt;
    &lt;/item&gt;
  &lt;/query&gt;
  &lt;error code='404' type='cancel'&gt;
    &lt;item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
        </pre></div>
      </div>
    </div>
    <div class="indent">
<h3>5.2 <a name="protocol-service">WaitingListService Interaction With InteropPartners</a>
</h3>
      <p class="" style="">
        <span style="font-style: italic">This section of the document describes the inter-domain protocol for communication between WaitingListServices. The protocol defined in this section MUST be implemented by ServiceProviders.</span>
      </p>
      <p class="" style="">A ServiceProvider's WaitingListService MUST be configured with a "whitelist" of InteropPartner's WaitingListServices with which it communicates. Therefore service discovery SHOULD NOT be necessary. However, if necessary it MAY use either the <span style="font-weight: bold">Agent Information</span> protocol or the <span style="font-weight: bold">Service Discovery</span> protocol as described in the following examples.</p>
      <p class="" style="">Note: The InteropPartner's WaitingListService is NOT REQUIRED to be hosted by InteropPartner, and could be hosted by a third party (e.g., a neutral phone number translation service). In this case, InteropPartner would simply advertise 'waitlist.third-party.com' as its WaitingListService.</p>
      <div class="indent">
<h3>5.2.1 <a name="protocol-service-retrieve">ServiceProvider's WaitingListService Retrieves Current WaitingList</a>
</h3>
        <p class="caption">Example 25. ServiceProvider Discovers InteropPartner's WaitingListService by Sending Agent Information Request to InteropPartner</p>
<div class="indent"><pre>
&lt;iq type='get'
    from='waitlist.service-provider.com'
    to='interop-partner.com'
    id='agent2'&gt;
  &lt;query xmlns='jabber:iq:agents'/&gt;
&lt;/iq&gt;
        </pre></div>
        <p class="caption">Example 26. InteropPartner Returns Address of its WaitingListService</p>
<div class="indent"><pre>
&lt;iq type='result'
    from='interop-partner.com'
    to='waitlist.service-provider.com'
    id='agent2'&gt;
  &lt;query xmlns='jabber:iq:agents'&gt;
    ...
    &lt;agent jid='waitlist.interop-partner.com'&gt;
      &lt;name&gt;Waiting List Service&lt;/name&gt;
      &lt;service&gt;waitinglist&lt;/service&gt;
    &lt;/agent&gt;
    ...
  &lt;/query&gt;
&lt;/iq&gt;
        </pre></div>
        <p class="caption">Example 27. ServiceProvider Discovers InteropPartner's WaitingListService by Sending Service Discovery Request to InteropPartner</p>
<div class="indent"><pre>
&lt;iq type='get'
    from='waitlist.service-provider.com'
    to='interop-partner.com'
    id='disco3'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'/&gt;
&lt;/iq&gt;
        </pre></div>
        <p class="caption">Example 28. InteropPartner Returns Address of its WaitingListService</p>
<div class="indent"><pre>
&lt;iq type='result' id='disco3'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'&gt;
    ...
    &lt;item jid='waitlist.service-provider.com'
          name='Waiting List Service'/&gt;
    ...
  &lt;/query&gt;
&lt;/iq&gt;
        </pre></div>
        <p class="caption">Example 29. Service Provider Queries InteropPartner's WaitingListService for Detailed Information</p>
<div class="indent"><pre>
&lt;iq type='get'
    from='waitlist.service-provider.com'
    to='waitlist.interop-partner.com'
    id='disco4'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;
        </pre></div>
        <p class="caption">Example 30. InteropPartner's WaitingListService Returns Detailed Information</p>
<div class="indent"><pre>
&lt;iq type='result'
    from='waitlist.interop-partner.com'
    to='waitlist.service-provider.com'
    id='disco4'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;identity category='directory'
              type='waitinglist'/&gt;
    &lt;feature var='http://jabber.org/protocol/waitinglist'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
        </pre></div>
      </div>
      <div class="indent">
<h3>5.2.2 <a name="protocol-service-add">ServiceProvider's WaitingListService Adds Contact to WaitingList</a>
</h3>
        <p class="" style="">Once a ServiceProvider's WaitingListService has discovered the InteropPartner's WaitingListService and requested its WaitingList, the ServiceProvider's WaitingListService can add items to its WaitingList based on URI.</p>
        <p class="caption">Example 31. ServiceProvider's WaitingListService Adds New Item to WaitingList</p>
<div class="indent"><pre>
&lt;iq type='set'
    from='waitlist.service-provider.com'
    to='waitlist.interop-partner.com'
    id='waitinglist2'&gt;
  &lt;query xmlns='http://jabber.org/protocol/waitinglist'&gt;
    &lt;item&gt;
      &lt;uri scheme='tel'&gt;contact-number&lt;/uri&gt;
    &lt;/item&gt;
  &lt;/query&gt;
&lt;/iq&gt;
        </pre></div>
        <p class="" style="">If Contact's URI is not associated with a person served by this InteropPartner, the InteropPartner MUST return an &lt;item-not-found/&gt; error to the ServiceProvider.</p>
        <p class="caption">Example 32. InteropPartner Returns &lt;item-not-found/&gt; Error to ServiceProvider</p>
<div class="indent"><pre>
&lt;iq type='error'
    from='waitlist.interop-partner.com'
    to='waitlist.service-provider.com'
    id='waitinglist2'&gt;
  &lt;query xmlns='http://jabber.org/protocol/waitinglist'&gt;
    &lt;item&gt;
      &lt;uri scheme='tel'&gt;contact-number&lt;/uri&gt;
    &lt;/item&gt;
  &lt;/query&gt;
  &lt;error code='404' type='cancel'&gt;
    &lt;item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
        </pre></div>
        <p class="" style="">If Contact's URI is associated with a person served by this InteropPartner, InteropPartner MUST return acknowledgement of the WaitingList addition to the ServiceProvider's WaitingListService.</p>
        <p class="caption">Example 33. InteropPartner's WaitingListService Acknowledges Receipt</p>
<div class="indent"><pre>
&lt;iq type='result'
    from='waitlist.interop-partner.com'
    to='waitlist.service-provider.com'
    id='waitinglist2'&gt;
  &lt;query xmlns='http://jabber.org/protocol/waitinglist'&gt;
    &lt;item id='34567'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
        </pre></div>
        <p class="" style="">If Contact is an IM User served by InteropPartner, InteropPartner's WaitingListService pushes Contact's JID to ServiceProvider's WaitingListService.</p>
        <p class="caption">Example 34. InteropPartner's WaitingListService Pushes Contact's JID to ServiceProvider's WaitingListService</p>
<div class="indent"><pre>
&lt;iq type='set'
    from='waitlist.interop-partner.com'
    to='waitlist.service-provider.com'
    id='jidpush1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/waitinglist'&gt;
    &lt;item id='34567' jid='user@domain'&gt;
      &lt;uri scheme='tel'&gt;contact-number&lt;/uri&gt;
    &lt;/item&gt;
  &lt;/query&gt;
&lt;/iq&gt;
        </pre></div>
        <p class="caption">Example 35. ServiceProvider's WaitingListService Acknowledges Receipt of JID Push</p>
<div class="indent"><pre>
&lt;iq type='result'
    from='waitlist.service-provider.com'
    to='waitlist.interop-partner.com'
    id='jidpush1'/&gt;
        </pre></div>
        <p class="" style="">After receiving acknowledgement (but not before), InteropPartner's WaitingListService MUST remove that item from the WaitingList for the ServiceProvider's WaitingListService.</p>
      </div>
      <div class="indent">
<h3>5.2.3 <a name="protocol-service-remove">ServiceProvider's WaitingListService Removes Contact from WaitingList</a>
</h3>
        <p class="caption">Example 36. ServiceProvider Requests Removal of Item from WaitingList</p>
<div class="indent"><pre>
&lt;iq type='set'
    from='waitlist.service-provider.com'
    to='waitlist.interop-partner.com'
    id='remove2'&gt;
  &lt;query xmlns='http://jabber.org/protocol/waitinglist'&gt;
    &lt;item id='34567'&gt;
      &lt;remove/&gt;
    &lt;/item&gt;
  &lt;/query&gt;
&lt;/iq&gt;
        </pre></div>
        <p class="" style="">If item exists on WaitingList, InteropPartner's WaitingListService removes item from list and returns result to ServiceProvider's WaitingListService.</p>
        <p class="caption">Example 37. InteropPartner Returns Result to ServiceProvider</p>
<div class="indent"><pre>
&lt;iq type='result'
    from='waitlist.interop-partner.com'
    to='waitlist.service-provider.com'
    id='remove2'/&gt;
        </pre></div>
        <p class="" style="">If item does not exist on WaitingList, InteropPartner's WaitingListService MUST return an &lt;item-not-found/&gt; error to the ServiceProvider's WaitingListService.</p>
        <p class="caption">Example 38. InteropPartner Returns &lt;item-not-found/&gt; Error to ServiceProvider</p>
<div class="indent"><pre>
&lt;iq type='error'
    from='waitlist.interop-partner.com'
    to='waitlist.service-provider.com'
    id='remove2'&gt;
  &lt;query xmlns='http://jabber.org/protocol/waitinglist'&gt;
    &lt;item id='34567'&gt;
      &lt;remove/&gt;
    &lt;/item&gt;
  &lt;/query&gt;
  &lt;error code='404' type='cancel'&gt;
    &lt;item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
        </pre></div>
      </div>
    </div>
  <h2>6.
       <a name="impl">Implementation Notes</a>
</h2>
    <ol start="1" type="1">
      <li>Protocols and mechanisms for inviting a Contact to register as an IM User are out of scope for this proposal and shall be determined by each InteropPartner individually.</li>
      <li>A ServiceProvider's WaitingListService MUST record which of its IM Users have requested the JID associated with Contact's URI, and an InteropPartner's WaitingListService MUST record that Service Provider's WaitingListService (not User) has requested JID associated with Contact's URI. Therefore when Contact registers, InteropPartner's WaitingListService informs its local users as well as ServiceProvider's WaitingListService, and ServiceProvider's WaitingListService informs its local users.</li>
      <li>The InteropPartner's WaitingListService is NOT REQUIRED to be hosted by InteropPartner, and could be hosted by a third party (e.g., a neutral phone number translation service). In this case, InteropPartner would simply advertise 'waitlist.third-party.com' as its WaitingListService.</li>
      <li>Once an IM User learns a Contact's JID, the IM User MAY send a normal subscription request to the Contact, setting the "to" address to Contact's JID. This interaction is defined in the base XMPP specifications and is out of scope for this document.</li>
      <li>For historical reasons, implementations MUST support the older <span style="font-weight: bold">Agent Information</span> protocol (JEP-0094) and SHOULD support <span style="font-weight: bold">Service Discovery</span> (JEP-0030). Note well that the <span style="font-weight: bold">Agent Information</span> protocol will eventually be deprecated in favor of <span style="font-weight: bold">Service Discovery</span>.</li>
      <li>An IM User's client receives WaitingList information either through a "JID push" message (received from WaitingListService at any time) or in the IQ result received after requesting the WaitingList (since one or more of the WaitingList items may contain a JID). (The same rule applies to a ServiceProvider's WaitingListService that receives an IQ set from an InteropPartner's WaitingListService.)</li>
      <li>When an IM User logs in, the user's client SHOULD request the current WaitingList.</li>
      <li>Although the examples in this JEP show the hostname of the WaitingListService as 'waitlist.third-party.com' (etc.), this is for convenience only; the hostname MAY be any valid DNS hostname.</li>
      <li>When sending JID pushes, an implementation MAY specify a message type of 'headline', which in some deployments will prevent such messages from being stored offline for later delivery.</li>
    </ol>
  <h2>7.
       <a name="security">Security Considerations</a>
</h2>
    <p class="" style="">A ServiceProvider's WaitingListService MUST be configured with a "whitelist" of InteropPartners with which it communicates. The WaitingListService SHOULD NOT communicate with any InteropPartners that are not on the whitelist.</p>
    <p class="" style="">Requesting JIDs via WaitingLists is not bidirectional; i.e., a service MUST NOT allow an IM User to discover a Contact's non-XMPP URI based on the Contact's JID.</p>
    <p class="" style="">A service MAY require a Contact to approve the disclosure of the Contact's JID, either as a global preference or for each request; however, this is a local policy matter.</p>
  <h2>8.
       <a name="iana">IANA Considerations</a>
</h2>
    <p class="" style="">This JEP requires no interaction with the <span class="ref" style="">Internet Assigned Numbers Authority (IANA)</span>  [<a href="#nt-id2258620">10</a>].</p>
  <h2>9.
       <a name="registrar">Jabber Registrar Considerations</a>
</h2>
    <div class="indent">
<h3>9.1 <a name="registrar-ns">Protocol Namespaces</a>
</h3>
      <p class="" style="">The <span class="ref" style="">Jabber Registrar</span>  [<a href="#nt-id2258668">11</a>] includes 'http://jabber.org/protocol/waitinglist' in its registry of protocol namespaces.</p>
    </div>
    <div class="indent">
<h3>9.2 <a name="registrar-identities">Service Discovery Identities</a>
</h3>
      <p class="" style="">The Jabber Registar includes a type of "waitinglist" in the "directory" category in its registry of service discovery identities.</p>
    </div>
    <div class="indent">
<h3>9.3 <a name="registrar-features">Service Discovery Features</a>
</h3>
      <p class="" style="">The Jabber Registrar includes supported URI schemes in its registry of service discovery features. These features shall be of the form 'http://jabber.org/protocol/waitlist/schemes/SCHEME-NAME'.</p>
      <p class="" style="">This JEP registers the following two namespace names for URI schemes, but others MAY be registered in the future using standard registration procedures:</p>
      <ul>
        <li>http://jabber.org/protocol/waitlist/schemes/mailto</li>
        <li>http://jabber.org/protocol/waitlist/schemes/tel</li>
      </ul>
    </div>
  <h2>10.
       <a name="schema">XML Schema</a>
</h2>
    <p class="caption"></p>
<div class="indent"><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='http://jabber.org/protocol/waitinglist'
    xmlns='http://jabber.org/protocol/waitinglist'
    elementFormDefault='qualified'&gt;

  &lt;xs:annotation&gt;
    &lt;xs:documentation&gt;
      The protocol documented by this schema is defined in
      JEP-0130: http://www.jabber.org/jeps/jep-0130.html
    &lt;/xs:documentation&gt;
  &lt;/xs:annotation&gt;

  &lt;xs:import namespace='jabber:client'/&gt;

  &lt;xs:annotation&gt;
    &lt;xs:documentation&gt;
      Note: there are two allowable root elements for the
      'http://jabber.org/protocol/waitinglist' namespace,
      query and waitlist. The query element is used within
      IQ stanzas and the waitlist element is used within
      message stanzas. See JEP-0130 for details.
    &lt;/xs:documentation&gt;
  &lt;/xs:annotation&gt;

  &lt;xs:element name='waitlist'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='item'
                    minOccurs='0'
                    maxOccurs='unbounded'/&gt;
      &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='query'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='item'
                    minOccurs='0'
                    maxOccurs='unbounded'/&gt;
      &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='item'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice minOccurs='0' maxOccurs='1'&gt;&gt;
        &lt;xs:all xmlns:xmpp='jabber:client'&gt;
          &lt;xs:element ref='uri'/&gt;
          &lt;xs:element ref='name' minOccurs='0'/&gt;
          &lt;xs:element ref='xmpp:error' minOccurs='0'/&gt;
        &lt;/xs:all&gt;
        &lt;xs:element ref='remove'/&gt;
      &lt;/xs:choice&gt;
      &lt;xs:attribute name='id'
                    type='xs:string'
                    use='optional'/&gt;
      &lt;xs:attribute name='jid'
                    type='xs:string'
                    use='optional'/&gt;
      &lt;xs:attribute name='type'
                    use='optional'&gt;
        &lt;xs:simpleType&gt;
          &lt;xs:restriction base='xs:NCName'&gt;
            &lt;xs:enumeration value='error'/&gt;
          &lt;/xs:restriction&gt;
        &lt;/xs:simpleType&gt;
      &lt;/xs:attribute&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='uri' type='xs:string'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:attribute name='scheme'
                    type='xs:NCNAME'
                    use='required'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='name' type='string1023'/&gt;

  &lt;xs:element name='remove' type='empty'/&gt;

  &lt;xs:simpleType name='string1023'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:maxLength value='1023'/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
    </pre></div>
  <p><hr></p>
<a name="notes"></a><h2>Notes</h2>
<div class="indent">
<p><a name="nt-id2250973">1</a>. RFC 3920: Extensible Messaging and Presence Protocol (XMPP): Core &lt;<a href="http://www.ietf.org/rfc/rfc3920.txt">http://www.ietf.org/rfc/rfc3920.txt</a>&gt;.</p>
<p><a name="nt-id2256305">2</a>. RFC 3921: Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence &lt;<a href="http://www.ietf.org/rfc/rfc3921.txt">http://www.ietf.org/rfc/rfc3921.txt</a>&gt;.</p>
<p><a name="nt-id2256390">3</a>. RFC 3966: The tel URI for Telephone Numbers &lt;<a href="http://www.ietf.org/rfc/rfc3966.txt">http://www.ietf.org/rfc/rfc3966.txt</a>&gt;.</p>
<p><a name="nt-id2256412">4</a>. RFC 2368: The mailto URL scheme &lt;<a href="http://www.ietf.org/rfc/rfc2368.txt">http://www.ietf.org/rfc/rfc2368.txt</a>&gt;.</p>
<p><a name="nt-id2256562">5</a>. RFC 3986: Uniform Resource Identifiers (URI): Generic Syntax &lt;<a href="http://www.ietf.org/rfc/rfc3986.txt">http://www.ietf.org/rfc/rfc3986.txt</a>&gt;.</p>
<p><a name="nt-id2257488">6</a>. JEP-0030: Service Discovery &lt;<a href="http://www.jabber.org/jeps/jep-0030.html">http://www.jabber.org/jeps/jep-0030.html</a>&gt;.</p>
<p><a name="nt-id2257512">7</a>. JEP-0094: Agent Information &lt;<a href="http://www.jabber.org/jeps/jep-0094.html">http://www.jabber.org/jeps/jep-0094.html</a>&gt;.</p>
<p><a name="nt-id2257742">8</a>. JEP-0086: Error Condition Mappings &lt;<a href="http://www.jabber.org/jeps/jep-0086.html">http://www.jabber.org/jeps/jep-0086.html</a>&gt;.</p>
<p><a name="nt-id2257996">9</a>. When waiting list information is included in a message stanza, the root element for the 'http://jabber.org/protocol/waitinglist' namespace is &lt;waitlist/&gt; rather than &lt;query/&gt; (as used within IQ stanzas). This disparity is historical and tracks the protocol syntax that was most widely implemented, as defined in version 0.4 of this specification. In the interest of interoperability, the IQ usage was changed back to &lt;query/&gt; in version 1.1 of this specification. If this JEP were not historical, the root element usage would be harmonized to use only the &lt;waitlist/&gt; element.</p>
<p><a name="nt-id2258620">10</a>. The Internet Assigned Numbers Authority (IANA) is the central coordinator for the assignment of unique parameter values for Internet protocols, such as port numbers and URI schemes. For further information, see &lt;<a href="http://www.iana.org/">http://www.iana.org/</a>&gt;.</p>
<p><a name="nt-id2258668">11</a>. The Jabber Registrar maintains a list of reserved Jabber protocol namespaces as well as registries of parameters used in the context of protocols approved by the Jabber Software Foundation. For further information, see &lt;<a href="http://www.jabber.org/registrar/">http://www.jabber.org/registrar/</a>&gt;.</p>
</div>
<p><hr></p>
<a name="revs"></a><h2>Revision History</h2>
<div class="indent">
<h4>Version 1.1 (2005-11-30)</h4>
<div class="indent">Harmonized root element specification with implemented usage, reversing change made in version 0.5. (psa)
    </div>
<h4>Version 1.0 (2005-08-26)</h4>
<div class="indent">Per a vote of the Jabber Council, advanced status to Active. (psa)
    </div>
<h4>Version 0.6 (2005-08-16)</h4>
<div class="indent">Added error case for remote server timeout; specified client and service responsibilities regarding removal of waiting list items in error cases. (psa)
    </div>
<h4>Version 0.5 (2005-05-16)</h4>
<div class="indent">Corrected schema and IQ examples by changing root element for namespace from &lt;query/&gt; to &lt;waitlist/&gt; (this had been used for message examples but not IQ examples). (psa)
    </div>
<h4>Version 0.4 (2005-04-01)</h4>
<div class="indent">Changed JEP type to Informational; corrected Remote Server Error example to use &lt;remote-server-not-found/&gt; rather than &lt;service-unavailable/&gt;; added service discovery identity to Jabber Registrar Considerations; corrected text regarding registration of service discovery features; corrected some small errors in the text, examples, and schema. (psa)
    </div>
<h4>Version 0.3 (2004-09-27)</h4>
<div class="indent">Corrected error syntax used when Contact URI is not handled by any InteropPartner. (psa)
    </div>
<h4>Version 0.2 (2004-09-03)</h4>
<div class="indent">Added alternate flow for situation in which Contact URI is not handled by any InteropPartner; changed headline message type for JID pushes from SHOULD to MAY; clarified semantics of item ID; added name child of item; corrected and updated the XML schema; updated examples to use XMPP error conditions. (psa)
    </div>
<h4>Version 0.1 (2004-03-18)</h4>
<div class="indent">Initial JEP version. (psa)
    </div>
<h4>Version 0.0.10 (2003-09-03)</h4>
<div class="indent">Fixed several small errors in the examples. (psa)
    </div>
<h4>Version 0.0.9 (2003-08-22)</h4>
<div class="indent">Specified optional use of message type 'headline'; fixed one small error in the examples. (psa)
    </div>
<h4>Version 0.0.8 (2003-07-23)</h4>
<div class="indent">Changed client-server push mechanism to use &lt;message/&gt; rather than &lt;iq/&gt;, since client may not be online; allowed IQ result to include waitlist information if known; added more detailed disco#info lookup to support discovery of URI types supported. (psa)
    </div>
<h4>Version 0.0.7 (2003-07-02)</h4>
<div class="indent">Modified to use a generic &lt;uri scheme=''/&gt; element. (psa)
    </div>
<h4>Version 0.0.6 (2003-06-26)</h4>
<div class="indent">Refactored protocol to use IQ sets that are "pushed" to the component or client (similar to XMPP rosters); added service discovery and agents support; made text more generic; simplified error handling; change name to "Waiting Lists". (psa)
    </div>
<h4>Version 0.0.5 (2003-06-24)</h4>
<div class="indent">Added remove use case and protocol; added XML schema. (psa)
    </div>
<h4>Version 0.0.4 (2003-06-19)</h4>
<div class="indent">Specified protocol. (psa)
    </div>
<h4>Version 0.0.3 (2003-06-18)</h4>
<div class="indent">Simplified requirements; defined main use case. (psa)
    </div>
<h4>Version 0.0.2 (2003-06-16)</h4>
<div class="indent">Converted to JEP XML format; formalized use case definitions; minor editorial changes. (psa)
    </div>
<h4>Version 0.0.1 (2003-06-10)</h4>
<div class="indent">First draft. (an)
    </div>
</div>
<p><hr></p>
<p>END</p>
</body>
</html>
