<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>JEP-0045: Multi-User Chat</title>
<link rel="stylesheet" type="text/css" href="jep.css">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
<meta name="DC.Title" content="Multi-User Chat">
<meta name="DC.Creator" content="Peter Saint-Andre">
<meta name="DC.Description" content="This JEP defines a robust protocol for XMPP-based text conferencing.">
<meta name="DC.Publisher" content="Jabber Software Foundation">
<meta name="DC.Contributor" content="JEP Editor">
<meta name="DC.Date" content="2005-04-21">
<meta name="DC.Type" content="Jabber Enhancement Proposal">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="JEP-0045">
<meta name="DC.Language" content="en">
<meta name="DC.Rights" content="This Jabber Enhancement Proposal is copyright 1999 - 2005 by the Jabber Software Foundation (JSF) and is in full conformance with the JSF's Intellectual Property Rights Policy &lt;http://www.jabber.org/jsf/ipr-policy.shtml&gt;. This material may be distributed only subject to the terms and conditions set forth in the Open Publication License, v1.0 or later (the latest version is presently available at &lt;http://www.opencontent.org/openpub/&gt;).">
</head>
<body>
<h1>JEP-0045: Multi-User Chat</h1>
<p>This JEP defines a robust protocol for XMPP-based text conferencing.</p>
<p><hr></p>
<p style="color:green">NOTICE: The protocol defined herein is a Draft Standard of the Jabber Software Foundation. Implementations are encouraged and the protocol is appropriate for deployment in production systems, but some changes to the protocol are possible before it becomes a Final Standard.</p>
<p><hr></p>
<h2>JEP Information</h2>
<p class="indent">
            Status: Draft<br>
            Type: Standards Track<br>
            Number: 0045<br>
            Version: 1.19<br>
            Last Updated: 2005-04-21<br>
            JIG: Standards JIG<br>
                Approving Body: Jabber Council<br>Dependencies: XMPP Core, XMPP IM, JEP-0004, JEP-0030, JEP-0068, JEP-0082<br>
                Supersedes: None<br>
                Superseded By: None<br>
            Short Name: muc<br>
        Schema for muc: &lt;<a href="http://jabber.org/protocol/muc/muc.xsd">http://jabber.org/protocol/muc/muc.xsd</a>&gt;<br>
        Schema for muc#admin: &lt;<a href="http://jabber.org/protocol/muc/admin.xsd">http://jabber.org/protocol/muc/admin.xsd</a>&gt;<br>
        Schema for muc#owner: &lt;<a href="http://jabber.org/protocol/muc/owner.xsd">http://jabber.org/protocol/muc/owner.xsd</a>&gt;<br>
        Schema for muc#user: &lt;<a href="http://jabber.org/protocol/muc/user.xsd">http://jabber.org/protocol/muc/user.xsd</a>&gt;<br>
              Registry: 
              
              &lt;<a href="http://www.jabber.org/registrar/muc.html">http://www.jabber.org/registrar/muc.html</a>&gt;
              <br></p>
<h2>Author Information</h2>
<div class="indent">
<h3>Peter Saint-Andre</h3>
<p class="indent">
        Email: stpeter@jabber.org<br>
        JID: stpeter@jabber.org</p>
</div>
<h2>Legal Notice</h2>
<p class="indent">This Jabber Enhancement Proposal is copyright 1999 - 2005 by the <a href="http://www.jabber.org/jsf/">Jabber Software Foundation</a> (JSF) and is in full conformance with the JSF's Intellectual Property Rights Policy &lt;<a href="http://www.jabber.org/jsf/ipr-policy.shtml">http://www.jabber.org/jsf/ipr-policy.shtml</a>&gt;. This material may be distributed only subject to the terms and conditions set forth in the Open Publication License, v1.0 or later (the latest version is presently available at &lt;<a href="http://www.opencontent.org/openpub/">http://www.opencontent.org/openpub/</a>&gt;).</p>
<h2>Discussion Venue</h2>
<p class="indent">The preferred venue for discussion of this document is the Standards-JIG discussion list: &lt;<a href="http://mail.jabber.org/mailman/listinfo/standards-jig">http://mail.jabber.org/mailman/listinfo/standards-jig</a>&gt;.</p>
<h2>Relation to XMPP</h2>
<p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 3920) and XMPP IM (RFC 3921) specifications contributed by the Jabber Software Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this JEP has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p>
<h2>Conformance Terms</h2>
<p class="indent">The keywords "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119.</p>
<p><hr></p>
<h2>Table of Contents</h2>
<div class="indent"><dl>
<dt>1.  <a href="#intro">Introduction</a>
</dt>
<dt>2.  <a href="#scope">Scope</a>
</dt>
<dt>3.  <a href="#reqs">Requirements</a>
</dt>
<dt>4.  <a href="#terms">Terminology</a>
</dt>
<dl>
<dt>4.1.  <a href="#terms-general">General Terms</a>
</dt>
<dt>4.2.  <a href="#terms-rooms">Room Types</a>
</dt>
</dl>
<dt>5.  <a href="#connections">Roles and Affiliations</a>
</dt>
<dl>
<dt>5.1.  <a href="#roles">Roles</a>
</dt>
<dl>
<dt>5.1.1.  <a href="#roles-priv">Privileges</a>
</dt>
<dt>5.1.2.  <a href="#roles-change">Changing Roles</a>
</dt>
</dl>
<dt>5.2.  <a href="#affil">Affiliations</a>
</dt>
<dl>
<dt>5.2.1.  <a href="#affil-priv">Privileges</a>
</dt>
<dt>5.2.2.  <a href="#affil-change">Changing Affiliations</a>
</dt>
</dl>
</dl>
<dt>6.  <a href="#user">Occupant Use Cases</a>
</dt>
<dl>
<dt>6.1.  <a href="#discovery">Discovering Component Support for MUC</a>
</dt>
<dt>6.2.  <a href="#discovery-client">Discovering Client Support for MUC</a>
</dt>
<dt>6.3.  <a href="#enter">Entering a Room</a>
</dt>
<dl>
<dt>6.3.1.  <a href="#enter-gc">Groupchat 1.0 Protocol</a>
</dt>
<dt>6.3.2.  <a href="#enter-muc">Basic MUC Protocol</a>
</dt>
<dt>6.3.3.  <a href="#enter-pres">Presence Broadcast</a>
</dt>
<dt>6.3.4.  <a href="#enter-roles">Default Roles</a>
</dt>
<dt>6.3.5.  <a href="#enter-nonanon">Non-Anonymous Rooms</a>
</dt>
<dt>6.3.6.  <a href="#enter-semianon">Semi-Anonymous Rooms</a>
</dt>
<dt>6.3.7.  <a href="#enter-pw">Password-Protected Rooms</a>
</dt>
<dt>6.3.8.  <a href="#enter-members">Members-Only Rooms</a>
</dt>
<dt>6.3.9.  <a href="#enter-banned">Banned Users</a>
</dt>
<dt>6.3.10.  <a href="#enter-conflict">Nickname Conflict</a>
</dt>
<dt>6.3.11.  <a href="#enter-maxusers">Max Users</a>
</dt>
<dt>6.3.12.  <a href="#enter-history">Discussion History</a>
</dt>
<dt>6.3.13.  <a href="#enter-managehistory">Managing Discussion History</a>
</dt>
<dt>6.3.14.  <a href="#enter-locked">Locked Room</a>
</dt>
<dt>6.3.15.  <a href="#enter-nonexistent">Nonexistent Room</a>
</dt>
</dl>
<dt>6.4.  <a href="#exit">Exiting a Room</a>
</dt>
<dt>6.5.  <a href="#changenick">Changing Nickname</a>
</dt>
<dt>6.6.  <a href="#changepres">Changing Availability Status</a>
</dt>
<dt>6.7.  <a href="#invite">Inviting Another User to a Room</a>
</dt>
<dt>6.8.  <a href="#continue">Converting a One-to-One Chat Into a Conference</a>
</dt>
<dt>6.9.  <a href="#subject-occupant">Occupant Modification of the Room Subject</a>
</dt>
<dt>6.10.  <a href="#privatemessage">Sending a Private Message</a>
</dt>
<dt>6.11.  <a href="#message">Sending a Message to All Occupants</a>
</dt>
<dt>6.12.  <a href="#register">Registering with a Room</a>
</dt>
<dt>6.13.  <a href="#reservednick">Discovering Reserved Room Nickname</a>
</dt>
</dl>
<dt>7.  <a href="#moderator">Moderator Use Cases</a>
</dt>
<dl>
<dt>7.1.  <a href="#subject-mod">Modifying the Room Subject</a>
</dt>
<dt>7.2.  <a href="#kick">Kicking a Visitor or Participant from a Room</a>
</dt>
<dt>7.3.  <a href="#grantvoice">Granting Voice to a Visitor</a>
</dt>
<dt>7.4.  <a href="#revokevoice">Revoking Voice from a Participant</a>
</dt>
<dt>7.5.  <a href="#modifyvoice">Modifying the Voice List</a>
</dt>
</dl>
<dt>8.  <a href="#admin">Admin Use Cases</a>
</dt>
<dl>
<dt>8.1.  <a href="#ban">Banning a User</a>
</dt>
<dt>8.2.  <a href="#modifyban">Modifying the Ban List</a>
</dt>
<dt>8.3.  <a href="#grantmember">Granting Membership</a>
</dt>
<dt>8.4.  <a href="#revokemember">Revoking Membership</a>
</dt>
<dt>8.5.  <a href="#modifymember">Modifying the Member List</a>
</dt>
<dt>8.6.  <a href="#grantmod">Granting Moderator Privileges</a>
</dt>
<dt>8.7.  <a href="#revokemod">Revoking Moderator Privileges</a>
</dt>
<dt>8.8.  <a href="#modifymod">Modifying the Moderator List</a>
</dt>
<dt>8.9.  <a href="#regapprove">Approving Registration Requests</a>
</dt>
</dl>
<dt>9.  <a href="#owner">Owner Use Cases</a>
</dt>
<dl>
<dt>9.1.  <a href="#createroom">Creating a Room</a>
</dt>
<dl>
<dt>9.1.1.  <a href="#createroom-general">General Considerations</a>
</dt>
<dt>9.1.2.  <a href="#createroom-instant">Creating an Instant Room</a>
</dt>
<dt>9.1.3.  <a href="#createroom-reserved">Creating a Reserved Room</a>
</dt>
</dl>
<dt>9.2.  <a href="#roomconfig">Subsequent Room Configuration</a>
</dt>
<dt>9.3.  <a href="#grantowner">Granting Ownership Privileges</a>
</dt>
<dt>9.4.  <a href="#revokeowner">Revoking Ownership Privileges</a>
</dt>
<dt>9.5.  <a href="#modifyowner">Modifying the Owner List</a>
</dt>
<dt>9.6.  <a href="#grantadmin">Granting Administrative Privileges</a>
</dt>
<dt>9.7.  <a href="#revokeadmin">Revoking Administrative Privileges</a>
</dt>
<dt>9.8.  <a href="#modifyadmin">Modifying the Admin List</a>
</dt>
<dt>9.9.  <a href="#destroyroom">Destroying a Room</a>
</dt>
</dl>
<dt>10.  <a href="#errorstatus">Error and Status Codes</a>
</dt>
<dl>
<dt>10.1.  <a href="#errorcodes">Error Codes</a>
</dt>
<dt>10.2.  <a href="#statuscodes">Status Codes</a>
</dt>
</dl>
<dt>11.  <a href="#i18n">Internationalization Considerations</a>
</dt>
<dt>12.  <a href="#security">Security Considerations</a>
</dt>
<dt>13.  <a href="#iana">IANA Considerations</a>
</dt>
<dt>14.  <a href="#registrar">Jabber Registrar Considerations</a>
</dt>
<dl>
<dt>14.1.  <a href="#registrar-protocol">Protocol Namespaces</a>
</dt>
<dt>14.2.  <a href="#registrar-discocat">Service Discovery Category/Type</a>
</dt>
<dt>14.3.  <a href="#registrar-features">Service Discovery Features</a>
</dt>
<dt>14.4.  <a href="#registrar-nodes">Well-Known Service Discovery Nodes</a>
</dt>
<dt>14.5.  <a href="#registrar-formtype">Field Standardization</a>
</dt>
<dl>
<dt>14.5.1.  <a href="#registrar-formtype-register">muc#register FORM_TYPE</a>
</dt>
<dt>14.5.2.  <a href="#registrar-formtype-owner">muc#roomconfig FORM_TYPE</a>
</dt>
<dt>14.5.3.  <a href="#registrar-formtype-roominfo">muc#roominfo FORM_TYPE</a>
</dt>
</dl>
<dt>14.6.  <a href="#registrar-statuscodes">Status Codes Registry</a>
</dt>
<dl>
<dt>14.6.1.  <a href="#registrar-statuscodes-process">Process</a>
</dt>
<dt>14.6.2.  <a href="#registrar-statuscodes-init">Initial Submission</a>
</dt>
</dl>
</dl>
<dt>15.  <a href="#bizrules">Business Rules</a>
</dt>
<dl>
<dt>15.1.  <a href="#bizrules-jids">Addresses</a>
</dt>
<dt>15.2.  <a href="#bizrules-message">Message</a>
</dt>
<dt>15.3.  <a href="#bizrules-presence">Presence</a>
</dt>
<dt>15.4.  <a href="#bizrules-iq">IQ</a>
</dt>
</dl>
<dt>16.  <a href="#impl">Implementation Notes</a>
</dt>
<dl>
<dt>16.1.  <a href="#impl-service">Services</a>
</dt>
<dl><dt>16.1.1.  <a href="#impl-service-traffic">Allowable Traffic</a>
</dt></dl>
<dt>16.2.  <a href="#impl-client">Clients</a>
</dt>
<dl><dt>16.2.1.  <a href="#impl-client-irc">IRC Command Mapping</a>
</dt></dl>
</dl>
<dt>17.  <a href="#schemas">XML Schemas</a>
</dt>
<dl>
<dt>17.1.  <a href="#schemas-muc">http://jabber.org/protocol/muc</a>
</dt>
<dt>17.2.  <a href="#schemas-user">http://jabber.org/protocol/muc#user</a>
</dt>
<dt>17.3.  <a href="#schemas-admin">http://jabber.org/protocol/muc#admin</a>
</dt>
<dt>17.4.  <a href="#schemas-owner">http://jabber.org/protocol/muc#owner</a>
</dt>
</dl>
<dt>18.  <a href="#ack">Acknowledgements</a>
</dt>
<dt><a href="#notes">Notes</a></dt>
<dt><a href="#revs">Revision History</a></dt>
</dl></div>
<p><hr></p>
<h2>1.
       <a name="intro">Introduction</a>
</h2>
  <p class="" style="">Traditionally, instant messaging is thought to consist of one-to-one chat rather than many-to-many chat, which is called variously "groupchat" or "text conferencing". Groupchat functionality is familiar from systems such as Internet Relay Chat (IRC) and the chatroom functionality offered by popular consumer IM services. The Jabber community developed and implemented a basic groupchat protocol as long ago as 1999. This "groupchat 1.0" protocol provided a minimal feature set for chat rooms but was rather limited in scope. This JEP builds on the older "groupchat 1.0" protocol in a backwards-compatible manner but provides advanced features such as invitations, room moderation and administration, and specialized room types. These extensions are implemented using protocol elements qualified by the 'http://jabber.org/protocol/muc' namespace (and the #owner, #admin, and #user fragments on the main namespace URI).</p>
<h2>2.
       <a name="scope">Scope</a>
</h2>
  <p class="" style="">This JEP addresses common requirements related to configuration of, participation in, and administration of individual text-based conference rooms. All of the requirements addressed herein apply at the level of the individual room and are "common" in the sense that they have been widely discussed within the Jabber community or are familiar from existing text-based conference environments outside of Jabber (e.g., Internet Relay Chat as defined in <span class="ref" style="">RFC 1459</span>  [<a href="#nt-id2250245">1</a>] and its successors).</p>
  <p class="" style="">This JEP explicitly does <span style="font-style: italic">not</span> address the following:</p>
  <ul>
    <li>Relationships between rooms (e.g., hierarchies of rooms)</li>
    <li>Management of multi-user chat services (e.g., managing permissions across an entire service or registering a global room nickname)</li>
    <li>Moderation of individual messages</li>
    <li>Security and encryption at the level of a room or service</li>
    <li>Advanced features such as attaching files to a room, integrating whiteboards, and interfacing with audio chat services</li>
    <li>Interaction between MUC deployments and foreign chat systems (e.g., gateways to IRC or to legacy IM systems)</li>
  </ul>
  <p class="" style="">This limited scope is not meant to disparage such topics, which are of inherent interest; however, it is meant to focus the discussion in this JEP and to present a comprehensible proposal that can be implemented by Jabber client and component developers alike. Future JEPs may of course address the topics mentioned above.</p>
<h2>3.
       <a name="reqs">Requirements</a>
</h2>
  <p class="" style="">This JEP addresses the minimal functionality provided by existing multi-user chat services in Jabber. For the sake of backwards-compatibility, this JEP uses the original "groupchat 1.0" protocol for this baseline functionality, with the result that:</p>
  <ul>
    <li>Each room is identified as &lt;room@service&gt; (e.g., &lt;jdev@conference.jabber.org&gt;), where "room" is the name of the room and "service" is the hostname at which the multi-user chat service is running.</li>
    <li>Each occupant in a room is identified as &lt;room@service/nick&gt;, where "nick" is the room nickname of the occupant as specified on entering the room or subsequently changed during the occupant's visit.</li>
    <li>A user enters a room (i.e., becomes an occupant) by sending presence to &lt;room@service/nick&gt;.</li>
    <li>Messages sent within multi-user chat rooms are of a special type "groupchat" and are addressed to the room itself (room@service), then reflected to all occupants.</li>
    <li>An occupant can change his or her room nickname and availability status within the room by sending presence information to &lt;room@service/newnick&gt;.</li>
    <li>An occupant exits a room by sending presence of type "unavailable" to its current &lt;room@service/nick&gt;.</li>
  </ul>
  <p class="" style="">The additional features and functionality addressed in this JEP include the following:</p>
  <ol start="1" type="">
    <li>native conversation logging (no in-room bot required)</li>
    <li>enabling users to request membership in a room</li>
    <li>enabling occupants to view an occupant's full JID in a non-anonymous room</li>
    <li>enabling moderators to view an occupant's full JID in a semi-anonymous room</li>
    <li>allowing only moderators to change the room subject</li>
    <li>enabling moderators to kick participants and visitors from the room</li>
    <li>enabling moderators to grant and revoke voice (i.e., the privilege to speak) in a moderated room, and to manage the voice list</li>
    <li>enabling admins to grant and revoke moderator privileges, and to manage the moderator list</li>
    <li>enabling admins to ban users from the room, and to manage the ban list</li>
    <li>enabling admins to grant and revoke membership privileges, and to manage the member list for a members-only room</li>
    <li>enabling owners to limit the number of occupants</li>
    <li>enabling owners to specify other owners</li>
    <li>enabling owners to grant and revoke administrative privileges, and to manage the admin list</li>
    <li>enabling owners to destroy the room</li>
  </ol>
  <p class="" style="">In addition, this JEP provides protocol elements for supporting the following room types:</p>
  <ol start="1" type="">
    <li>public or hidden</li>
    <li>persistent or temporary</li>
    <li>password-protected or unsecured</li>
    <li>members-only or open</li>
    <li>moderated or unmoderated</li>
    <li>non-anonymous or semi-anonymous</li>
  </ol>
<h2>4.
       <a name="terms">Terminology</a>
</h2>
  <div class="indent">
<h3>4.1 <a name="terms-general">General Terms</a>
</h3>
    <p class="" style="">Affiliation -- a long-lived association or connection with a room; the possible affiliations are "owner", "admin", "member", and "outcast" (naturally it is also possible to have no affiliation); affiliation is distinct from role. An affiliation lasts across a user's visits to a room.</p>
    <p class="" style="">Ban -- to remove a user from a room such that the user is not allowed to re-enter the room (until and unless the ban has been removed). A banned user has an affiliation of "outcast".</p>
    <p class="" style="">Bare JID -- the &lt;user@host&gt; by which a user is identified outside the context of any existing session or resource; contrast with Full JID and Room JID.</p>
    <p class="" style="">Full JID -- the &lt;user@host/resource&gt; by which an online user is identified outside the context of a room; contrast with Bare JID and Room JID.</p>
    <p class="" style="">GC -- the minimal "groupchat 1.0" protocol  [<a href="#nt-id2256104">2</a>] developed within the Jabber community in 1999; MUC is backwards-compatible with GC.</p>
    <p class="" style="">History -- a limited number of message stanzas sent to a new occupant to provide the context of current discussion.</p>
    <p class="" style="">Invitation -- a special message sent from one user to another asking the recipient to join a room.</p>
    <p class="" style="">IRC -- Internet Relay Chat.</p>
    <p class="" style="">Kick -- to temporarily remove a participant or visitor from a room; the user is allowed to re-enter the room at any time. A kicked user has a role of "none".</p>
    <p class="" style="">Logging -- storage of discussions that occur within a room for future retrieval inside or outside the context of the room.</p>
    <p class="" style="">Member -- a user who is on the "whitelist" for a members-only room or who is registered with an open room. A member has an affiliation of "member".</p>
    <p class="" style="">Moderator -- a room role that is usually associated with room admins but that may be granted to non-admins; is allowed to kick users, grant and revoke voice, etc. A moderator has an affiliation of "moderator".</p>
    <p class="" style="">MUC -- the multi-user chat protocol for text-based conferencing specified in this JEP.</p>
    <p class="" style="">Occupant -- any Jabber user who is in a room (this is an "abstract class" and does not correspond to any specific role).</p>
    <p class="" style="">Outcast -- a user who has been banned from a room. An outcast has an affiliation of "outcast".</p>
    <p class="" style="">Participant -- an occupant who does not have administrative privileges; in a moderated room, a participant is further defined as having voice (in contrast to a visitor). A participant has a role of "participant".</p>
    <p class="" style="">Private Message -- a message sent from one occupant directly to another's room JID (not to the room itself for broadcasting to all occupants).</p>
    <p class="" style="">Role -- a temporary position or privilege level within a room, distinct from a user's long-lived affiliation with the room; the possible roles are "moderator", "participant", and "visitor" (it is also possible to have no defined role). A role lasts only for the duration of an occupant's visit to a room.</p>
    <p class="" style="">Room -- a virtual space that Jabber users figuratively enter in order to participate in real-time, text-based conferencing with other users.</p>
    <p class="" style="">Room Administrator -- a user empowered by the room owner to perform administrative functions such as banning users; however, is not allowed to change defining room features. An admin has an affiliation of "admin".</p>
    <p class="" style="">Room ID -- the node identifier portion of a Room JID, which may be opaque and thus lack meaning for human users (see Business Rules for syntax); contrast with Room Name.</p>
    <p class="" style="">Room JID -- the &lt;&lt;room@service/nick&gt;&gt; by which an occupant is identified within the context of a room; contrast with Bare JID and Full JID.</p>
    <p class="" style="">Room Name -- a user-friendly, natural-language name for a room, configured by the room owner and presented in Service Discovery queries; contrast with Room ID.</p>
    <p class="" style="">Room Nickname -- the resource identifier portion of a Room JID (see Business Rules for syntax); this is the "friendly name" by which an occupant is known in the room.</p>
    <p class="" style="">Room Owner -- the Jabber user who created the room or a Jabber user who has been designated by the room creator or owner as someone with owner privileges (if allowed); is allowed to change defining room features as well as perform all administrative functions. An owner has an affiliation of "owner".</p>
    <p class="" style="">Room Roster -- a Jabber client's representation of the occupants in a room.</p>
    <p class="" style="">Server -- a Jabber server that may or may not have associated with it a text-based conferencing service.</p>
    <p class="" style="">Service -- a host that offers text-based conferencing capabilities; often but not necessarily a sub-domain of a Jabber server (e.g., conference.jabber.org).</p>
    <p class="" style="">Subject -- a temporary discussion topic within a room.</p>
    <p class="" style="">Visit -- a user's "session" in a room, beginning when the user enters the room (i.e., becomes an occupant) and ending when the user exits the room.</p>
    <p class="" style="">Visitor -- in a moderated room, an occupant who does not have voice (in contrast to a participant). A visitor has a role of "visitor".</p>
    <p class="" style="">Voice -- in a moderated room, the privilege to send messages to all occupants.</p>
  </div>
  <div class="indent">
<h3>4.2 <a name="terms-rooms">Room Types</a>
</h3>
    <p class="" style="">Fully-Anonymous Room -- a room in which the full JIDs or bare JIDs of occupants cannot be discovered by anyone, including room admins and room owners; such rooms are NOT RECOMMENDED or explicitly supported by MUC, but are possible using this protocol if a service implementation offers the appropriate configuration options; contrast with Non-Anonymous Room and Semi-Anonymous Room.</p>
    <p class="" style="">Hidden Room -- a room that cannot be found by any user through normal means such as searching and service discovery; antonym: Public Room.</p>
    <p class="" style="">Members-Only Room -- a room that a user cannot enter without being on the member list; antonym: Open Room.</p>
    <p class="" style="">Moderated Room -- a room in which only those with "voice" may send messages to all occupants; antonym: Unmoderated Room.</p>
    <p class="" style="">Non-Anonymous Room -- a room in which an occupant's full JID is exposed to all other occupants, although the occupant may choose any desired room nickname; contrast with Semi-Anonymous Room and Fully-Anonymous Room.</p>
    <p class="" style="">Open Room -- a room that anyone may enter without being on the member list; antonym: Members-Only Room.</p>
    <p class="" style="">Password-Protected Room -- a room that a user cannot enter without first providing the correct password; antonym: Unsecured Room.</p>
    <p class="" style="">Persistent Room -- a room that is not destroyed if the last occupant exits; antonym: Temporary Room.</p>
    <p class="" style="">Public Room -- a room that can be found by any user through normal means such as searching and service discovery; antonym: Hidden Room.</p>
    <p class="" style="">Semi-Anonymous Room -- a room in which an occupant's full JID can be discovered by room admins only; contrast with Fully-Anonymous Room and Non-Anonymous Room.</p>
    <p class="" style="">Temporary Room -- a room that is destroyed if the last occupant exits; antonym: Persistent Room.</p>
    <p class="" style="">Unmoderated Room -- a room in which any occupant is allowed to send messages to all occupants; antonym: Moderated Room.</p>
    <p class="" style="">Unsecured Room -- a room that anyone is allowed to enter without first providing the correct password; antonym: Password-Protected Room.</p>
  </div>
<h2>5.
       <a name="connections">Roles and Affiliations</a>
</h2>
  <p class="" style="">There are two dimensions along which we can measure a user's connection with or position in a room. One is the user's long-lived affiliation with a room -- e.g., a user's status as an owner or an outcast. The other is a user's role while an occupant of a room -- e.g., an occupant's position as a moderator with the ability to kick visitors and participants. These two dimensions are distinct from each other, since an affiliation lasts across visits, while a role lasts only for the duration of a visit. In addition, there is no one-to-one correspondence between roles and affiliations; for example, someone who is not affiliated with a room may be a (temporary) moderator, and a member may be a participant or a visitor in a moderated room. These concepts are explained more fully below.</p>
  <div class="indent">
<h3>5.1 <a name="roles">Roles</a>
</h3>
    <p class="" style="">There are four defined roles that an occupant may have:</p>
    <ol start="1" type="">
      <li>Moderator</li>
      <li>Participant</li>
      <li>Visitor</li>
      <li>None (the absence of a role)</li>
    </ol>
    <p class="" style="">These roles are temporary in that they do not persist across a user's visits to the room and MAY change during the course of an occupant's visit to the room. In addition, there is no one-to-one mapping between these roles and a user's affiliation with the room (e.g., a member could be a participant or a visitor).</p>
    <p class="" style="">A moderator is the most powerful occupant within the context of the room, and can to some extent manage other occupants' roles in the room. A participant has fewer privileges than a moderator, although he or she always has the right to speak. A visitor is a more restricted role within the context of a moderated room, since visitors are not allowed to send messages to all occupants.</p>
    <p class="" style="">Roles are granted, revoked, and maintained based on the occupant's room nickname or full JID rather than bare JID. The privileges associated with these roles, as well as the actions that trigger changes in roles, are defined below.</p>
    <p class="" style="">Information about roles MUST be sent in all presence stanzas generated or reflected by the room and thus sent to occupants.</p>
    <div class="indent">
<h3>5.1.1 <a name="roles-priv">Privileges</a>
</h3>
      <p class="" style="">For the most part, roles exist in a hierarchy. For instance, a participant can do anything a visitor can do, and a moderator can do anything a participant can do. Each role has privileges not possessed by the next-lowest role; these privileges are specified in the following table as defaults (an implementation MAY provide configuration options that override these defaults).</p>
      <p class="caption">Table 1: Privileges Associated With Roles</p>
<table border="1" cellpadding="3" cellspacing="0">
        <tr class="body">
          <th colspan="" rowspan="">Privilege</th>
          <th colspan="" rowspan="">None</th>
          <th colspan="" rowspan="">Visitor</th>
          <th colspan="" rowspan="">Participant</th>
          <th colspan="" rowspan="">Moderator</th>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">Present in Room</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">Yes</td>
          <td align="" colspan="" rowspan="">Yes</td>
          <td align="" colspan="" rowspan="">Yes</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">Receive Messages</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">Yes</td>
          <td align="" colspan="" rowspan="">Yes</td>
          <td align="" colspan="" rowspan="">Yes</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">Change Availability Status</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">Yes</td>
          <td align="" colspan="" rowspan="">Yes</td>
          <td align="" colspan="" rowspan="">Yes</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">Change Room Nickname</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">Yes*</td>
          <td align="" colspan="" rowspan="">Yes</td>
          <td align="" colspan="" rowspan="">Yes</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">Send Private Messages</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">Yes*</td>
          <td align="" colspan="" rowspan="">Yes</td>
          <td align="" colspan="" rowspan="">Yes</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">Invite Other Users</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">Yes*</td>
          <td align="" colspan="" rowspan="">Yes*</td>
          <td align="" colspan="" rowspan="">Yes</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">Send Messages to All</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">No**</td>
          <td align="" colspan="" rowspan="">Yes</td>
          <td align="" colspan="" rowspan="">Yes</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">Modify Subject</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">No*</td>
          <td align="" colspan="" rowspan="">Yes*</td>
          <td align="" colspan="" rowspan="">Yes</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">Kick Participants and Visitors</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">Yes</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">Grant Voice</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">Yes</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">Revoke Voice</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">Yes***</td>
        </tr>
      </table>
      <p class="" style="">* Default; configuration settings MAY modify this privilege.</p>
      <p class="" style="">** An implementation MAY grant voice by default to visitors in unmoderated rooms.</p>
      <p class="" style="">*** A moderator MUST NOT be able to revoke voice privileges from an admin or owner.</p>
    </div>
    <div class="indent">
<h3>5.1.2 <a name="roles-change">Changing Roles</a>
</h3>
      <p class="" style="">The ways in which an occupant's role changes are well-defined. Sometimes the change results from the occupant's own action (e.g., entering or exiting the room), whereas sometimes the change results from an action taken by a moderator, admin, or owner. If an occupant's role changes, a MUC service implementation MUST change the occupant's role to reflect the change and communicate the change to all occupants. Role changes and their triggering actions are specified in the following table.</p>
      <p class="caption">Table 2: Role State Chart</p>
<table border="1" cellpadding="3" cellspacing="0">
        <tr class="body">
          <th colspan="" rowspan="">&gt;</th>
          <th colspan="" rowspan="">None</th>
          <th colspan="" rowspan="">Visitor</th>
          <th colspan="" rowspan="">Participant</th>
          <th colspan="" rowspan="">Moderator</th>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">None</td>
          <td align="" colspan="" rowspan="">--</td>
          <td align="" colspan="" rowspan="">Enter moderated room</td>
          <td align="" colspan="" rowspan="">Enter unmoderated room</td>
          <td align="" colspan="" rowspan="">Admin or owner enters room</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">Visitor</td>
          <td align="" colspan="" rowspan="">Exit room or be kicked by a moderator</td>
          <td align="" colspan="" rowspan="">--</td>
          <td align="" colspan="" rowspan="">Moderator grants voice</td>
          <td align="" colspan="" rowspan="">Admin or owner grants moderator privileges</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">Participant</td>
          <td align="" colspan="" rowspan="">Exit room or be kicked by a moderator</td>
          <td align="" colspan="" rowspan="">Moderator revokes voice</td>
          <td align="" colspan="" rowspan="">--</td>
          <td align="" colspan="" rowspan="">Admin or owner grants moderator privileges</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">Moderator</td>
          <td align="" colspan="" rowspan="">Exit room</td>
          <td align="" colspan="" rowspan="">Admin or owner changes role to visitor *</td>
          <td align="" colspan="" rowspan="">Admin or owner changes role to participant or revokes moderator privileges *</td>
          <td align="" colspan="" rowspan="">--</td>
        </tr>
      </table>
      <p class="" style="">* A moderator MUST NOT be able to revoke moderator privileges from an occupant who is equal to or above the moderator in the hierarchy of affiliations.</p>
    </div>
  </div>
  <div class="indent">
<h3>5.2 <a name="affil">Affiliations</a>
</h3>
    <p class="" style="">There are five defined affiliations that a user may have in relation to a room:</p>
    <ol start="1" type="">
      <li>Owner</li>
      <li>Admin</li>
      <li>Member</li>
      <li>Outcast</li>
      <li>None (the absence of an affiliation)</li>
    </ol>
    <p class="" style="">These affiliations are long-lived in that they persist across a user's visits to the room and are not affected by happenings in the room. In addition, there is no one-to-one mapping between these affiliations and an occupant's role within the room. Affiliations are granted, revoked, and maintained based on the user's bare JID.</p>
    <p class="" style="">If a user without a defined affiliation enters a room, the user's affiliation is defined as "none"; however, this affiliation does not persist across visits (i.e., a service does not maintain a "none list" across visits).</p>
    <p class="" style="">The member affiliation provides a way for a room owner or admin to specify a "whitelist" of users who are allowed to enter a members-only room. When a member enters a members-only room, his or her affiliation does not change, no matter what his or her role is. The member affiliation also provides a way for users to effectively register with an open room and thus be lastingly associated with that room in some way (one result may be that the user's nickname is reserved in the room).</p>
    <p class="" style="">An outcast is a user who has been banned from a room and who is not allowed to enter the room.</p>
    <p class="" style="">Information about affiliations MUST be sent in all presence stanzas generated or reflected by the room and sent to occupants.</p>
    <div class="indent">
<h3>5.2.1 <a name="affil-priv">Privileges</a>
</h3>
      <p class="" style="">For the most part, affiliations exist in a hierarchy. For instance, an owner can do anything an admin can do, and an admin can do anything a member can do. Each affiliation has privileges not possessed by the next-lowest affiliation; these privileges are specified in the following table.</p>
      <p class="caption">Table 3: Privileges Associated With Affiliations</p>
<table border="1" cellpadding="3" cellspacing="0">
        <tr class="body">
          <th colspan="" rowspan="">Privilege</th>
          <th colspan="" rowspan="">Outcast</th>
          <th colspan="" rowspan="">None</th>
          <th colspan="" rowspan="">Member</th>
          <th colspan="" rowspan="">Admin</th>
          <th colspan="" rowspan="">Owner</th>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">Enter Open Room</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">Yes*</td>
          <td align="" colspan="" rowspan="">Yes</td>
          <td align="" colspan="" rowspan="">Yes</td>
          <td align="" colspan="" rowspan="">Yes</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">Register with an Open Room</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">Yes</td>
          <td align="" colspan="" rowspan="">N/A</td>
          <td align="" colspan="" rowspan="">N/A</td>
          <td align="" colspan="" rowspan="">N/A</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">Enter Members-Only Room</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">Yes*</td>
          <td align="" colspan="" rowspan="">Yes</td>
          <td align="" colspan="" rowspan="">Yes</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">Ban Members and Unaffiliated Users</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">Yes</td>
          <td align="" colspan="" rowspan="">Yes</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">Edit Member List</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">Yes</td>
          <td align="" colspan="" rowspan="">Yes</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">Edit Moderator List</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">Yes**</td>
          <td align="" colspan="" rowspan="">Yes**</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">Edit Admin List</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">Yes</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">Edit Owner List</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">Yes</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">Change Room Definition</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">Yes</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">Destroy Room</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">No</td>
          <td align="" colspan="" rowspan="">Yes</td>
        </tr>
      </table>
      <p class="" style="">* As a default, an unaffiliated user enters a moderated room as a visitor, and enters an open room as a participant. A member enters a room as a participant. An admin or owner enters a room as a moderator.</p>
      <p class="" style="">** An admin or owner MUST NOT be able to revoke moderation privileges from another admin or owner.</p>
    </div>
    <div class="indent">
<h3>5.2.2 <a name="affil-change">Changing Affiliations</a>
</h3>
      <p class="" style="">The ways in which a user's affiliation changes are well-defined. Sometimes the change results from the user's own action (e.g., registering as a member of the room), whereas sometimes the change results from an action taken by an admin or owner. If a user's affiliation changes, a MUC service implementation MUST change the user's affiliation to reflect the change and communicate that to all occupants. Affiliation changes and their triggering actions are specified in the following table.</p>
      <p class="caption">Table 4: Affiliation State Chart</p>
<table border="1" cellpadding="3" cellspacing="0">
        <tr class="body">
          <th colspan="" rowspan="">&gt;</th>
          <th colspan="" rowspan="">Outcast</th>
          <th colspan="" rowspan="">None</th>
          <th colspan="" rowspan="">Member</th>
          <th colspan="" rowspan="">Admin</th>
          <th colspan="" rowspan="">Owner</th>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">Outcast</td>
          <td align="" colspan="" rowspan="">--</td>
          <td align="" colspan="" rowspan="">Admin or owner removes ban</td>
          <td align="" colspan="" rowspan="">Admin or owner adds user to member list</td>
          <td align="" colspan="" rowspan="">Owner adds user to admin list</td>
          <td align="" colspan="" rowspan="">Owner adds user to owner list</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">None</td>
          <td align="" colspan="" rowspan="">Admin or owner applies ban</td>
          <td align="" colspan="" rowspan="">--</td>
          <td align="" colspan="" rowspan="">Admin or owner adds user to member list, or user registers as member (if allowed)</td>
          <td align="" colspan="" rowspan="">Owner adds user to admin list</td>
          <td align="" colspan="" rowspan="">Owner adds user to owner list</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">Member</td>
          <td align="" colspan="" rowspan="">Admin or owner applies ban</td>
          <td align="" colspan="" rowspan="">Admin or owner changes affiliation to "none"</td>
          <td align="" colspan="" rowspan="">--</td>
          <td align="" colspan="" rowspan="">Owner adds user to admin list</td>
          <td align="" colspan="" rowspan="">Owner adds user to owner list</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">Admin</td>
          <td align="" colspan="" rowspan="">Owner applies ban</td>
          <td align="" colspan="" rowspan="">Owner changes affiliation to "none"</td>
          <td align="" colspan="" rowspan="">Owner changes affiliation to "member"</td>
          <td align="" colspan="" rowspan="">--</td>
          <td align="" colspan="" rowspan="">Owner adds user to owner list</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">Owner</td>
          <td align="" colspan="" rowspan="">Owner applies ban</td>
          <td align="" colspan="" rowspan="">Owner changes affiliation to "none"</td>
          <td align="" colspan="" rowspan="">Owner changes affiliation to "member"</td>
          <td align="" colspan="" rowspan="">Owner changes affiliation to "admin"</td>
          <td align="" colspan="" rowspan="">--</td>
        </tr>
      </table>
    </div>
  </div>
<h2>6.
       <a name="user">Occupant Use Cases</a>
</h2>
  <p class="" style="">The main actor in a multi-user chat environment is the occupant, who can be said to be located "in" a multi-user chat room and to participate in the discussions held in that room (for the purposes of this JEP, participants and visitors are considered to be "mere" occupants, since they possess no administrative privileges). As will become clear, the protocol elements proposed in this JEP to fulfill the occupant use cases fall into three categories:</p>
  <ol start="1" type="">
    <li><p class="" style="">existing "groupchat 1.0" protocol for minimal functionality</p></li>
    <li><p class="" style="">straightforward applications of the "groupchat 1.0" protocol, for example to handle some of the errors related to new room types</p></li>
    <li><p class="" style="">additional protocol elements to handle functionality not covered by "groupchat 1.0" (room invites, room passwords, extended presence related to room roles and affiliations); these are qualified by the 'http://jabber.org/protocol/muc#user' namespace</p></li>
  </ol>
  <p class="" style="">Note: All client-generated examples herein are presented from the perspective of the service, with the result that all stanzas received by a service contain a 'from' attribute corresponding to the sender's full JID as added by a normal Jabber router or session manager. In addition, normal IQ result stanzas sent upon successful completion of a request (as required by <span class="ref" style="">RFC 3920</span>  [<a href="#nt-id2259172">3</a>]) are not shown. Most of the examples in this document use the scenario of the witches' meeting held in a dark cave at the beginning of Act IV, Scene I of Shakespeare's <span style="font-style: italic">Macbeth</span>, represented here as the "darkcave@macbeth.shakespeare.lit" chatroom. The characters are as follows:</p>
  <p class="caption">Table 5: Dramatis Personae</p>
<table border="1" cellpadding="3" cellspacing="0">
    <tr class="body">
      <th colspan="" rowspan="">Room Nickname</th>
      <th colspan="" rowspan="">Full JID</th>
      <th colspan="" rowspan="">Affiliation</th>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">firstwitch</td>
      <td align="" colspan="" rowspan="">crone1@shakespeare.lit/desktop</td>
      <td align="" colspan="" rowspan="">Owner</td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">secondwitch</td>
      <td align="" colspan="" rowspan="">wiccarocks@shakespeare.lit/laptop</td>
      <td align="" colspan="" rowspan="">Admin</td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">thirdwitch</td>
      <td align="" colspan="" rowspan="">hag66@shakespeare.lit/pda</td>
      <td align="" colspan="" rowspan="">None</td>
    </tr>
  </table>
  <div class="indent">
<h3>6.1 <a name="discovery">Discovering Component Support for MUC</a>
</h3>
    <p class="" style="">Before entering a room, a Jabber user may want to discover if the room implements the Multi-User Chat protocol.</p>
    <p class="" style="">A MUC implementation MUST support <span class="ref" style="">Service Discovery</span>  [<a href="#nt-id2259349">4</a>].</p>
    <p class="caption">Example 1. User Queries Chat Service for MUC Support via Disco</p>
<div class="indent"><pre>
&lt;iq from='hag66@shakespeare.lit/pda'
    id='disco1'
    to='macbeth.shakespeare.lit'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The service MUST return its identity and the features it supports:</p>
    <p class="caption">Example 2. Service Returns Disco Info Results</p>
<div class="indent"><pre>
&lt;iq from='macbeth.shakespeare.lit'
    id='disco1'
    to='hag66@shakespeare.lit/pda'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;identity
        category='conference'
        name='Macbeth Chat Service'
        type='text'/&gt;
    &lt;feature var='http://jabber.org/protocol/muc'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">Note: Because MUC is a superset of the old "groupchat 1.0" protocol, a MUC service SHOULD NOT return a &lt;feature var='gc-1.0'/&gt; entry in a disco#info result.</p>
    <p class="" style="">The disco protocol also enables a user to query a service for a list of associated items, which in the case of a chat service would mainly consist of the specific chat rooms hosted by the service.</p>
    <p class="caption">Example 3. User Queries Chat Service for Associated Items</p>
<div class="indent"><pre>
&lt;iq from='hag66@shakespeare.lit/pda'
    id='disco2'
    to='macbeth.shakespeare.lit'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'/&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="caption">Example 4. Service Returns Disco Item Results</p>
<div class="indent"><pre>
&lt;iq from='macbeth.shakespeare.lit'
    id='disco2'
    to='hag66@shakespeare.lit/pda'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'&gt;
    &lt;item jid='heath@macbeth.shakespeare.lit'
          name='A Lonely Heath'/&gt;
    &lt;item jid='darkcave@macbeth.shakespeare.lit'
          name='A Dark Cave'/&gt;
    &lt;item jid='forres@macbeth.shakespeare.lit'
          name='The Palace'/&gt;
    &lt;item jid='inverness@macbeth.shakespeare.lit'
          name='Macbeth&amp;apos;s Castle'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">Using disco, a user may also query a specific chat room for more detailed information about the room:</p>
    <p class="caption">Example 5. User Queries for Information about a Specific Chat Room</p>
<div class="indent"><pre>
&lt;iq from='hag66@shakespeare.lit/pda'
    id='disco3'
    to='darkcave@macbeth.shakespeare.lit'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The room MUST return its identity and SHOULD return the features it supports:</p>
    <p class="caption">Example 6. Room Returns Disco Info Results</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='disco3'
    to='hag66@shakespeare.lit/pda'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;identity
        category='conference'
        name='A Dark Cave'
        type='text'/&gt;
    &lt;feature var='http://jabber.org/protocol/muc'/&gt;
    &lt;feature var='muc_passwordprotected'/&gt;
    &lt;feature var='muc_hidden'/&gt;
    &lt;feature var='muc_temporary'/&gt;
    &lt;feature var='muc_open'/&gt;
    &lt;feature var='muc_unmoderated'/&gt;
    &lt;feature var='muc_nonanonymous'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">Note: Because MUC is a superset of the old "groupchat 1.0" protocol, a MUC room SHOULD NOT return a &lt;feature var='gc-1.0'/&gt; entry in a disco#info result. The room SHOULD return the materially-relevant features it supports, such as password protection and room moderation (these are listed fully in the feature registry maintained by the Jabber Registrar; see also the <a href="#registrar">Jabber Registrar</a> section of this document).</p>
    <p class="" style="">A chatroom MAY return more detailed information in its disco#info response using <span class="ref" style="">Service Discovery Extensions</span>  [<a href="#nt-id2259520">5</a>], identified by inclusion of a hidden FORM_TYPE field whose value is "http://jabber.org/protocol/muc#roominfo". Such information might include a more verbose description of the room, the current room subject, and the current number of occupants in the room:</p>
    <p class="caption">Example 7. Room Returns Extended Disco Info Results</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='disco3a'
    to='hag66@shakespeare.lit/pda'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;identity
        category='conference'
        name='A Dark Cave'
        type='text'/&gt;
    &lt;feature var='http://jabber.org/protocol/muc'/&gt;
    &lt;feature var='muc_passwordprotected'/&gt;
    &lt;feature var='muc_hidden'/&gt;
    &lt;feature var='muc_temporary'/&gt;
    &lt;feature var='muc_open'/&gt;
    &lt;feature var='muc_unmoderated'/&gt;
    &lt;feature var='muc_nonanonymous'/&gt;
    &lt;x xmlns='jabber:x:data' type='result'&gt;
      &lt;field var='FORM_TYPE' type='hidden'&gt;
        &lt;value&gt;http://jabber.org/protocol/muc#roominfo&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roominfo_description' label='Description'&gt;
        &lt;value&gt;The place for all good witches!&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roominfo_subject' label='Subject'&gt;
        &lt;value&gt;Spells&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roominfo_occupants' label='Number of occupants'&gt;
        &lt;value&gt;3&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roominfo_lang' label='Language of discussion'&gt;
        &lt;value&gt;en&lt;/value&gt;
      &lt;/field&gt;
    &lt;/x&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">Note: The foregoing extended service discovery fields for the 'http://jabber.org/protocol/muc#roominfo' FORM_TYPE may be supplemented in the future via the mechanisms described in the <a href="#registrar-formtype">Field Standardization</a> section of this document.</p>
    <p class="" style="">Finally, a user MAY also query a specific chat room for its associated items:</p>
    <p class="caption">Example 8. User Queries for Items Associated with a Specific Chat Room</p>
<div class="indent"><pre>
&lt;iq from='hag66@shakespeare.lit/pda'
    id='disco4'
    to='darkcave@macbeth.shakespeare.lit'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'/&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">An implementation MAY return a list of existing occupants if that information is publicly available, or return no list at all if this information is kept private.</p>
    <p class="caption">Example 9. Room Returns Disco Item Results (Items are Public)</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='disco4'
    to='hag66@shakespeare.lit/pda'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'&gt;
    &lt;item jid='darkcave@macbeth.shakespeare.lit/firstwitch'/&gt;
    &lt;item jid='darkcave@macbeth.shakespeare.lit/secondwitch'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">Note: These &lt;item/&gt; elements are qualified by the disco#items namespace, not the muc namespace; this means that they cannot possess 'affiliation' or 'role' attributes, for example.</p>
    <p class="caption">Example 10. Room Returns Empty Disco Item Results (Items are Private)</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='disco4'
    to='hag66@shakespeare.lit/pda'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'/&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">If a non-occupant attempts to send a disco request to an address of the form &lt;&lt;room@service/nick&gt;&gt;, a MUC service SHOULD return the request to the entity and specify a &lt;bad-request/&gt; error condition. If an occupant sends such a request, the service MAY pass it through the intended recipient; see the <a href="#impl">Implementation Guidelines</a> section of this document for details.</p>
  </div>
  <div class="indent">
<h3>6.2 <a name="discovery-client">Discovering Client Support for MUC</a>
</h3>
    <p class="" style="">A Jabber user may want to discover if one of the user's contacts supports the Multi-User Chat protocol. This is done using Service Discovery.</p>
    <p class="caption">Example 11. User Queries Contact Regarding MUC Support</p>
<div class="indent"><pre>
&lt;iq from='hag66@shakespeare.lit/pda'
    id='disco5'
    to='wiccarocks@shakespeare.lit/laptop'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The client SHOULD return its identity and the features it supports:</p>
    <p class="caption">Example 12. Contact Returns Disco Info Results</p>
<div class="indent"><pre>
&lt;iq from='wiccarocks@shakespeare.lit/laptop'
    id='disco5'
    to='hag66@shakespeare.lit/pda'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;identity
        category='client'
        type='pc'/&gt;
    ...
    &lt;feature var='http://jabber.org/protocol/muc'/&gt;
    ...
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">A user may also query a contact regarding which rooms the contact is in. This is done by querying the contact's full JID (&lt;user@host/resource&gt;) while specifying the well-known Service Discovery node 'http://jabber.org/protocol/muc#rooms':</p>
    <p class="caption">Example 13. User Queries Contact for Current Rooms</p>
<div class="indent"><pre>
&lt;iq from='hag66@shakespeare.lit/pda'
    id='rooms1'
    to='wiccarocks@shakespeare.lit/laptop'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'
         node='http://jabber.org/protocol/muc#rooms'/&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="caption">Example 14. Contact Returns Room Query Results</p>
<div class="indent"><pre>
&lt;iq from='wiccarocks@shakespeare.lit/laptop'
    id='rooms1'
    to='hag66@shakespeare.lit/pda'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'
         node='http://jabber.org/protocol/muc#rooms'/&gt;
    &lt;item jid='darkcave@macbeth.shakespeare.lit'/&gt;
    &lt;item jid='characters@conference.shakespeare.lit'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">Optionally, the contact MAY include its roomnick as the value of the 'name' attribute:</p>
    <p class="caption"></p>
<div class="indent"><pre>
    ...
    &lt;item jid='darkcave@macbeth.shakespeare.lit'
          name='secondwitch'/&gt;
    ...
    </pre></div>
  </div>
  <div class="indent">
<h3>6.3 <a name="enter">Entering a Room</a>
</h3>
    <div class="indent">
<h3>6.3.1 <a name="enter-gc">Groupchat 1.0 Protocol</a>
</h3>
      <p class="" style="">In order to participate in the discussions held in a multi-user chat room, a Jabber user MUST first become an occupant by entering the room. In the old "groupchat 1.0" protocol, this was done by sending presence to &lt;room@service/nick&gt;, where "room" is the room ID, "service" is the hostname of the chat service, and "nick" is the user's desired nickname within the room:</p>
      <p class="caption">Example 15. Jabber User Seeks to Enter a Room (Groupchat 1.0)</p>
<div class="indent"><pre>
&lt;presence
    from='hag66@shakespeare.lit/pda'
    to='darkcave@macbeth.shakespeare.lit/thirdwitch'/&gt;
      </pre></div>
      <p class="" style="">In this example, a user with a full JID of "hag66@shakespeare.lit/pda" has requested to enter the room "darkcave" on the "macbeth.shakespeare.lit" chat service with a room nickname of "thirdwitch".</p>
      <p class="" style="">If the user does not specify a room nickname, the service SHOULD return a &lt;jid-malformed/&gt; error:</p>
      <p class="caption">Example 16. Jabber User Seeks to Enter a Room (Groupchat 1.0)</p>
<div class="indent"><pre>
&lt;presence
    from='darkcave@macbeth.shakespeare.lit'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;error code='400' type='modify'&gt;
    &lt;jid-malformed xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/presence&gt;
      </pre></div>
    </div>
    <div class="indent">
<h3>6.3.2 <a name="enter-muc">Basic MUC Protocol</a>
</h3>
      <p class="" style="">Compliant multi-user chat services MUST accept the foregoing as a request to enter a room from any Jabber client that knows either the "groupchat 1.0" (GC) protocol or the multi-user chat (MUC) protocol; however, MUC clients SHOULD signal their ability to speak the MUC protocol by including in the initial presence stanza an empty &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc' namespace (note the absence of the '#user' fragment):</p>
      <p class="caption">Example 17. Jabber User Seeks to Enter a Room (Multi-User Chat)</p>
<div class="indent"><pre>
&lt;presence
    from='hag66@shakespeare.lit/pda'
    to='darkcave@macbeth.shakespeare.lit/thirdwitch'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;
&lt;/presence&gt;
      </pre></div>
    </div>
    <div class="indent">
<h3>6.3.3 <a name="enter-pres">Presence Broadcast</a>
</h3>
      <p class="" style="">If the service is able to add the user to the room, it MUST send presence from all the existing occupants' room JIDs to the new occupant's full JID, including extended presence information about roles in an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'role' attribute set to a value of "moderator", "participant", "visitor", or "none" and with the 'affiliation' attribute set to a value of "owner", "admin", "member", or "none" as appropriate:</p>
      <p class="caption">Example 18. Service Sends Presence from Existing Occupants to New Occupant</p>
<div class="indent"><pre>
&lt;presence
    from='darkcave@macbeth.shakespeare.lit/firstwitch'
    to='hag66@shakespeare.lit/pda'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='owner' role='moderator'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
&lt;presence
    from='darkcave@macbeth.shakespeare.lit/secondwitch'
    to='hag66@shakespeare.lit/pda'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='admin' role='moderator'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
      </pre></div>
      <p class="" style="">In this example, the user from the previous example has entered the room, by which time two other people had already entered the room: a user with a room nickname of "firstwitch" (who is a room owner) and a user with a room nickname of "secondwitch" (who is a room admin).</p>
      <p class="" style="">The service MUST also send presence from the new occupant's room JID to the full JIDs of all the occupants (including the new occupant):</p>
      <p class="caption">Example 19. Service Sends New Occupant's Presence to All Occupants</p>
<div class="indent"><pre>
&lt;presence
    from='darkcave@macbeth.shakespeare.lit/thirdwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member' role='participant'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
&lt;presence
    from='darkcave@macbeth.shakespeare.lit/thirdwitch'
    to='wiccarocks@shakespeare.lit/laptop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member' role='participant'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
&lt;presence
    from='darkcave@macbeth.shakespeare.lit/thirdwitch'
    to='hag66@shakespeare.lit/pda'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member' role='participant'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
      </pre></div>
      <p class="" style="">In this example, initial room presence is being sent from the new occupant (thirdwitch) to all occupants, including the new occupant.</p>
      <p class="" style="">The order of the presence stanzas sent to the new occupant is important. The service MUST first send the complete list of the existing occupants to the new occupant and only then send the new occupant's own presence to the new occupant. This helps the client know when it has received the complete "room roster".</p>
    </div>
    <div class="indent">
<h3>6.3.4 <a name="enter-roles">Default Roles</a>
</h3>
      <p class="" style="">The following table summarizes the initial default roles that a service should set based on the user's affiliation (there is no role associated with the "outcast" affiliation, since such users are not allowed to enter the room).</p>
      <p class="caption">Table 6: Initial Role Based on Affiliation</p>
<table border="1" cellpadding="3" cellspacing="0">
        <tr class="body">
          <th colspan="" rowspan="">Room Type</th>
          <th colspan="" rowspan="">None</th>
          <th colspan="" rowspan="">Member</th>
          <th colspan="" rowspan="">Admin</th>
          <th colspan="" rowspan="">Owner</th>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">Moderated</td>
          <td align="" colspan="" rowspan="">Visitor</td>
          <td align="" colspan="" rowspan="">Participant</td>
          <td align="" colspan="" rowspan="">Moderator</td>
          <td align="" colspan="" rowspan="">Moderator</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">Unmoderated</td>
          <td align="" colspan="" rowspan="">Participant</td>
          <td align="" colspan="" rowspan="">Participant</td>
          <td align="" colspan="" rowspan="">Moderator</td>
          <td align="" colspan="" rowspan="">Moderator</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">Members-Only</td>
          <td align="" colspan="" rowspan="">N/A *</td>
          <td align="" colspan="" rowspan="">Participant</td>
          <td align="" colspan="" rowspan="">Moderator</td>
          <td align="" colspan="" rowspan="">Moderator</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">Open</td>
          <td align="" colspan="" rowspan="">Participant</td>
          <td align="" colspan="" rowspan="">Participant</td>
          <td align="" colspan="" rowspan="">Moderator</td>
          <td align="" colspan="" rowspan="">Moderator</td>
        </tr>
      </table>
      <p class="" style="">* Entry is not permitted.</p>
    </div>
    <div class="indent">
<h3>6.3.5 <a name="enter-nonanon">Non-Anonymous Rooms</a>
</h3>
      <p class="" style="">If the room is non-anonymous, the service MUST send the new occupant's full JID to all occupants using extended presence information in an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with a 'jid' attribute specifying the occupant's full JID:</p>
      <p class="caption">Example 20. Service Sends Full JID to All Occupants</p>
<div class="indent"><pre>
&lt;presence
    from='darkcave@macbeth.shakespeare.lit/thirdwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='none'
          jid='hag66@shakespeare.lit/pda'
          role='participant'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
.
.
.
      </pre></div>
      <p class="" style="">If the user is entering a room that is non-anonymous (i.e., which informs all occupants of each occupant's full JID as shown above), the service SHOULD allow the user to enter the room but MAY warn the user that the room is not anonymous; this is done by sending a message of type "groupchat" to the new occupant containing an &lt;x/&gt; child with a &lt;status/&gt; element that has the 'code' attribute set to a value of "100":</p>
      <p class="caption">Example 21. Service Warns New Occupant About Lack of Anonymity</p>
<div class="indent"><pre>
&lt;message
    from='darkcave@macbeth.shakespeare.lit'
    to='hag66@shakespeare.lit/pda'
    type='groupchat'&gt;
  &lt;body&gt;This room is not anonymous.&lt;/body&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;status code='100'/&gt;
  &lt;/x&gt;
&lt;/message&gt;
      </pre></div>
      <p class="" style="">The inclusion of the status code assists clients in presenting their own notification messages (e.g., information appropriate to the user's locality).</p>
    </div>
    <div class="indent">
<h3>6.3.6 <a name="enter-semianon">Semi-Anonymous Rooms</a>
</h3>
      <p class="" style="">If the room is semi-anonymous, the service MUST send the new occupant's full JID in the format shown above only to those occupants with a role of "moderator".</p>
      <p class="" style="">(Note: All subsequent examples include the 'jid' attribute for each &lt;item/&gt; element, even though this information is not sent to non-moderators in semi-anonymous rooms.)</p>
    </div>
    <div class="indent">
<h3>6.3.7 <a name="enter-pw">Password-Protected Rooms</a>
</h3>
      <p class="" style="">If the room requires a password and the user did not supply one (or the password provided is incorrect), the service MUST deny access to the room and inform the user that they are unauthorized; this is done by returning a presence stanza of type "error" specifying a &lt;not-authorized/&gt; error:</p>
      <p class="caption">Example 22. Service Denies Access Because No Password Provided</p>
<div class="indent"><pre>
&lt;presence
    from='darkcave@macbeth.shakespeare.lit'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;error code='401' type='auth'&gt;
    &lt;not-authorized xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/presence&gt;
      </pre></div>
      <p class="" style="">Passwords SHOULD be supplied with the presence stanza sent when entering the room, contained within an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc' namespace and containing a &lt;password/&gt; child. Passwords are to be sent as cleartext; no other authentication methods are supported at this time, and any such authentication or authorization methods shall be defined in a separate specification (see the <a href="#security">Security Considerations</a> section of this document).</p>
      <p class="caption">Example 23. User Provides Password On Entering a Room</p>
<div class="indent"><pre>
&lt;presence
    from='hag66@shakespeare.lit/pda'
    to='darkcave@macbeth.shakespeare.lit/thirdwitch'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc'&gt;
    &lt;password&gt;cauldron&lt;/password&gt;
  &lt;/x&gt;
&lt;/presence&gt;
      </pre></div>
    </div>
    <div class="indent">
<h3>6.3.8 <a name="enter-members">Members-Only Rooms</a>
</h3>
      <p class="" style="">If the room is members-only but the user is not on the member list, the service MUST deny access to the room and inform the user that they are not allowed to enter the room; this is done by returning a presence stanza of type "error" specifying a &lt;registration-required/&gt; error condition:</p>
      <p class="caption">Example 24. Service Denies Access Because User Is Not on Member List</p>
<div class="indent"><pre>
&lt;presence
    from='darkcave@macbeth.shakespeare.lit'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;error code='407' type='auth'&gt;
    &lt;registration-required xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/presence&gt;
      </pre></div>
    </div>
    <div class="indent">
<h3>6.3.9 <a name="enter-banned">Banned Users</a>
</h3>
      <p class="" style="">If the user has been banned from the room (i.e., has an affiliation of "outcast"), the service MUST deny access to the room and inform the user of the fact that he or she is banned; this is done by returning a presence stanza of type "error" specifying a &lt;forbidden/&gt; error condition:</p>
      <p class="caption">Example 25. Service Denies Access Because User is Banned</p>
<div class="indent"><pre>
&lt;presence
    from='darkcave@macbeth.shakespeare.lit'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;error code='403' type='auth'&gt;
    &lt;forbidden xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/presence&gt;
      </pre></div>
    </div>
    <div class="indent">
<h3>6.3.10 <a name="enter-conflict">Nickname Conflict</a>
</h3>
      <p class="" style="">If the room already contains an occupant with the nickname desired by the user seeking to enter the room (or if the nickname is reserved by a user on the member list), the service MUST deny access to the room and inform the user of the conflict; this is done by returning a presence stanza of type "error" specifying a &lt;conflict/&gt; error condition:</p>
      <p class="caption">Example 26. Service Denies Access Because of Nick Conflict</p>
<div class="indent"><pre>
&lt;presence
    from='darkcave@macbeth.shakespeare.lit'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;error code='409' type='cancel'&gt;
    &lt;conflict xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/presence&gt;
      </pre></div>
    </div>
    <div class="indent">
<h3>6.3.11 <a name="enter-maxusers">Max Users</a>
</h3>
      <p class="" style="">If the room has reached its maximum number of uses, the service SHOULD deny access to the room and inform the user of the restriction; this is done by returning a presence stanza of type "error" specifying a &lt;service-unavailable/&gt; error condition:</p>
      <p class="caption">Example 27. Service Informs User that Room Occupant Limit Has Been Reached</p>
<div class="indent"><pre>
&lt;presence
    from='darkcave@macbeth.shakespeare.lit'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;error code='503' type='wait'&gt;
    &lt;service-unavailable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/presence&gt;
      </pre></div>
      <p class="" style="">Alternatively, the room could kick an "idle user" in order to free up space. Also, a room MUST always allow entry by a room admin or owner.</p>
    </div>
    <div class="indent">
<h3>6.3.12 <a name="enter-history">Discussion History</a>
</h3>
      <p class="" style="">After sending initial presence as shown above, a room MAY send discussion history to the new occupant. Whether such history is sent, and how many messages comprise the history, shall be determined by the chat service implementation or specific deployment.</p>
      <p class="caption">Example 28. Delivery of Discussion History</p>
<div class="indent"><pre>
&lt;message
    from='darkcave@macbeth.shakespeare.lit/firstwitch'
    to='hecate@shakespeare.lit/broom'
    type='groupchat'&gt;
  &lt;body&gt;Thrice the brinded cat hath mew'd.&lt;/body&gt;
  &lt;x xmlns='jabber:x:delay'
     from='crone1@shakespeare.lit/desktop'
     stamp='20021013T23:58:37'/&gt;
&lt;/message&gt;

&lt;message
    from='darkcave@macbeth.shakespeare.lit/secondwitch'
    to='hecate@shakespeare.lit/broom'
    type='groupchat'&gt;
  &lt;body&gt;Thrice and once the hedge-pig whined.&lt;/body&gt;
  &lt;x xmlns='jabber:x:delay'
     from='wiccarocks@shakespeare.lit/laptop'
     stamp='20021013T23:58:43'/&gt;
&lt;/message&gt;

&lt;message
    from='darkcave@macbeth.shakespeare.lit/thirdwitch'
    to='hecate@shakespeare.lit/broom'
    type='groupchat'&gt;
  &lt;body&gt;Harpier cries 'Tis time, 'tis time.&lt;/body&gt;
  &lt;x xmlns='jabber:x:delay'
     from='hag66@shakespeare.lit/pda'
     stamp='20021013T23:58:49'/&gt;
&lt;/message&gt;
      </pre></div>
      <p class="" style="">Discussion history messages SHOULD be stamped with extended information qualified by the 'jabber:x:delay' namespace (see <span class="ref" style="">Delayed Delivery</span>  [<a href="#nt-id2260620">6</a>]) to indicate that they are sent with delayed delivery. The 'from' attribute SHOULD be the full JID of the original sender in non-anonymous rooms, but MUST NOT be in semi-anonymous rooms (the 'from' attribute SHOULD be set to the room JID in semi-anonymous rooms). The service SHOULD send all discussion history messages before delivering any "live" messages sent after the user enters the room.</p>
    </div>
    <div class="indent">
<h3>6.3.13 <a name="enter-managehistory">Managing Discussion History</a>
</h3>
      <p class="" style="">A user MAY want to manage the amount of discussion history provided on entering a room (perhaps because the user is on a low-bandwidth connection or is using a small-footprint client). This MUST be accomplished by including a &lt;history/&gt; child in the initial presence stanza sent when joining the room. There are four allowable attributes for this element:</p>
      <p class="caption">Table 7: History Management Attributes</p>
<table border="1" cellpadding="3" cellspacing="0">
        <tr class="body">
          <th colspan="" rowspan="">Attribute</th>
          <th colspan="" rowspan="">Datatype</th>
          <th colspan="" rowspan="">Meaning</th>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">maxchars</td>
          <td align="" colspan="" rowspan="">int</td>
          <td align="" colspan="" rowspan="">Limit the total number of characters in the history to "X" (where the character count is the characters of the complete XML stanzas, not only their XML character data).</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">maxstanzas</td>
          <td align="" colspan="" rowspan="">int</td>
          <td align="" colspan="" rowspan="">Limit the total number of messages in the history to "X".</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">seconds</td>
          <td align="" colspan="" rowspan="">int</td>
          <td align="" colspan="" rowspan="">Send only the messages received in the last "X" seconds.</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">since</td>
          <td align="" colspan="" rowspan="">dateTime</td>
          <td align="" colspan="" rowspan="">Send only the messages received since the datetime specified (which MUST conform to the DateTime profile specified in <span class="ref" style="">Jabber Date and Time Profiles</span>  [<a href="#nt-id2260811">7</a>]).</td>
        </tr>
      </table>
      <p class="" style="">The service MUST send the smallest amount of traffic that meets any combination of the above criteria, taking into account service-level and room-level defaults. The service MUST send complete message stanzas only (i.e., it MUST not literally truncate the history at a certain number of characters, but MUST send the largest number of complete stanzas that results in a number of characters less than or equal to the 'maxchars' value specified). If the client wishes to receive no history, it MUST set the 'maxchars' attribute to a value of "0" (zero).</p>
      <p class="" style="">The following examples illustrate the use of this protocol.</p>
      <p class="caption">Example 29. User Requests Limit on Number of Messages in History</p>
<div class="indent"><pre>
&lt;presence
    from='hag66@shakespeare.lit/pda'
    to='darkcave@macbeth.shakespeare.lit/thirdwitch'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc'&gt;
    &lt;history maxstanzas='20'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
      </pre></div>
      <p class="caption">Example 30. User Requests History in Last 3 Minutes</p>
<div class="indent"><pre>
&lt;presence
    from='hag66@shakespeare.lit/pda'
    to='darkcave@macbeth.shakespeare.lit/thirdwitch'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc'&gt;
    &lt;history seconds='180'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
      </pre></div>
      <p class="caption">Example 31. User Requests All History Since the Beginning of the Unix Era</p>
<div class="indent"><pre>
&lt;presence
    from='hag66@shakespeare.lit/pda'
    to='darkcave@macbeth.shakespeare.lit/thirdwitch'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc'&gt;
    &lt;history since='1970-01-01T00:00Z'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
      </pre></div>
      <p class="" style="">Obviously the service SHOULD NOT return all messages sent in the room since the beginning of the Unix era, and SHOULD appropriately limit the amount of history sent to the user based on service or room defaults.</p>
      <p class="caption">Example 32. User Requests No History</p>
<div class="indent"><pre>
&lt;presence
    from='hag66@shakespeare.lit/pda'
    to='darkcave@macbeth.shakespeare.lit/thirdwitch'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc'&gt;
    &lt;history maxchars='0'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
      </pre></div>
    </div>
    <div class="indent">
<h3>6.3.14 <a name="enter-locked">Locked Room</a>
</h3>
      <p class="" style="">If a user attempts to enter a room while it is "locked" (i.e., before the room creator provides an initial configuration and therefore before the room officially exists), the service MUST refuse entry and return an &lt;item-not-found/&gt; error to the user:</p>
      <p class="caption">Example 33. Service Denies Access Because Room Does Not Exist</p>
<div class="indent"><pre>
&lt;presence
    from='darkcave@macbeth.shakespeare.lit'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;error code='404' type='cancel'&gt;
    &lt;item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/presence&gt;
      </pre></div>
    </div>
    <div class="indent">
<h3>6.3.15 <a name="enter-nonexistent">Nonexistent Room</a>
</h3>
      <p class="" style="">If the room does not already exist when the user seeks to enter it, the service SHOULD create it; however, this is not required, since an implementation or deployment MAY choose to restrict the privilege of creating rooms. For details, see the <a href="#createroom">Creating a Room</a> section of this document.</p>
    </div>
  </div>
  <div class="indent">
<h3>6.4 <a name="exit">Exiting a Room</a>
</h3>
    <p class="" style="">In order to exit a multi-user chat room, an occupant sends a presence stanza of type "unavailable" to the &lt;room@service/nick&gt; it is currently using in the room.</p>
    <p class="caption">Example 34. Occupant Exits a Room</p>
<div class="indent"><pre>
&lt;presence
    from='hag66@shakespeare.lit/pda'
    to='darkcave@macbeth.shakespeare.lit/thirdwitch'
    type='unavailable'/&gt;
    </pre></div>
    <p class="" style="">The service MUST then send presence stanzas of type "unavailable" from the departing occupant's room JID to the full JIDs of the departing occupant and of the remaining occupants:</p>
    <p class="caption">Example 35. Service Sends Presence Related to Departure of Occupant</p>
<div class="indent"><pre>
&lt;presence
    from='darkcave@macbeth.shakespeare.lit/thirdwitch'
    to='hag66@shakespeare.lit/pda'
    type='unavailable'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member' role='none'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
&lt;presence
    from='darkcave@macbeth.shakespeare.lit/thirdwitch'
    to='crone1@shakespeare.lit/desktop'
    type='unavailable'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member' role='none'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
&lt;presence
    from='darkcave@macbeth.shakespeare.lit/thirdwitch'
    to='wiccarocks@shakespeare.lit/laptop'
    type='unavailable'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member' role='none'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
    </pre></div>
    <p class="" style="">Presence stanzas of type "unavailable" reflected by the room MUST contain extended presence information about roles and affiliations, and MAY also contain normal &lt;show/&gt; and &lt;status/&gt; information (this last enables occupants to provide custom exit messages if desired).</p>
    <p class="caption">Example 36. Custom Exit Message</p>
<div class="indent"><pre>
&lt;presence
    from='wiccarocks@shakespeare.lit/laptop'
    to='darkcave@macbeth.shakespeare.lit/oldhag'
    type='unavailable'&gt;
  &lt;status&gt;gone where the goblins go&lt;/status&gt;
&lt;/presence&gt;
    </pre></div>
    <p class="" style="">Normal presence stanza generation rules apply as defined in <span class="ref" style="">XMPP IM</span>  [<a href="#nt-id2261053">8</a>], so that if the user sends a general unavailable presence stanza, the user's server will broadcast that stanza to the &lt;room@service/nick&gt; to which the user's client has sent directed presence.</p>
    <p class="" style="">If the room is not persistent and this occupant is the last to exit, the service is responsible for destroying the room.</p>
  </div>
  <div class="indent">
<h3>6.5 <a name="changenick">Changing Nickname</a>
</h3>
    <p class="" style="">A common feature of multi-user chat rooms is the ability for an occupant to change his or her nickname within the room. In MUC this is done by sending updated presence information to the room, specifically by sending presence to a new room JID in the same room (changing only the resource identifier in the room JID).</p>
    <p class="caption">Example 37. Occupant Changes Nickname</p>
<div class="indent"><pre>
&lt;presence
    from='hag66@shakespeare.lit/pda'
    to='darkcave@macbeth.shakespeare.lit/oldhag'/&gt;
    </pre></div>
    <p class="" style="">The service then sends two presence stanzas to the full JID of each occupant (including the occupant who is changing his or her room nickname), one of type "unavailable" for the old nickname and one indicating availability for the new nickname. The unavailable presence MUST contain the new nickname and an appropriate status code (namely 303) as extended presence information in an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace so that Jabber clients are able to provide relevant hints to occupants regarding the nickname change if desired.</p>
    <p class="caption">Example 38. Service Updates Nick</p>
<div class="indent"><pre>
&lt;presence
    from='darkcave@macbeth.shakespeare.lit/thirdwitch'
    to='crone1@shakespeare.lit/desktop'
    type='unavailable'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member'
          jid='hag66@shakespeare.lit/pda'
          nick='oldhag'
          role='participant'/&gt;
    &lt;status code='303'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
&lt;presence
    from='darkcave@macbeth.shakespeare.lit/thirdwitch'
    to='wiccarocks@shakespeare.lit/laptop'
    type='unavailable'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member'
          jid='hag66@shakespeare.lit/pda'
          nick='oldhag'
          role='participant'/&gt;
    &lt;status code='303'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
&lt;presence
    from='darkcave@macbeth.shakespeare.lit/thirdwitch'
    to='hag66@shakespeare.lit/pda'
    type='unavailable'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member'
          jid='hag66@shakespeare.lit/pda'
          nick='oldhag'
          role='participant'/&gt;
    &lt;status code='303'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;

&lt;presence
    from='darkcave@macbeth.shakespeare.lit/oldhag'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member'
          jid='hag66@shakespeare.lit/pda'
          role='participant'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
&lt;presence
    from='darkcave@macbeth.shakespeare.lit/oldhag'
    to='wiccarocks@shakespeare.lit/laptop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member'
          jid='hag66@shakespeare.lit/pda'
          role='participant'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
&lt;presence
    from='darkcave@macbeth.shakespeare.lit/oldhag'
    to='hag66@shakespeare.lit/pda'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member'
          jid='hag66@shakespeare.lit/pda'
          role='participant'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
    </pre></div>
    <p class="" style="">If the user attempts to change his or her room nickname to a room nickname that is already in use by another occupant (or that is reserved by someone affiliated with the room, e.g., a member or owner), the service MUST deny the nickname change request and inform the user of the conflict; this is done by returning a presence stanza of type "error" specifying a &lt;conflict/&gt; error condition:</p>
    <p class="caption">Example 39. Service Denies Nickname Change Because of Nick Conflict</p>
<div class="indent"><pre>
&lt;presence
    from='darkcave@macbeth.shakespeare.lit'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;error code='409' type='cancel'&gt;
    &lt;conflict xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/presence&gt;
    </pre></div>
  </div>
  <div class="indent">
<h3>6.6 <a name="changepres">Changing Availability Status</a>
</h3>
    <p class="" style="">In multi-user chat systems such as IRC, one common use for changing one's room nickname is to indicate a change in one's availability (e.g., changing one's room nickname to "thirdwitch|away"). In Jabber, availability is of course noted by a change in presence (specifically the &lt;show/&gt; and &lt;status/&gt; elements), which can provide important context within a chatroom. An occupant changes availability status within the room by sending the updated presence to its &lt;room@service/nick&gt;.</p>
    <p class="caption">Example 40. Occupant Changes Availability Status</p>
<div class="indent"><pre>
&lt;presence
    from='wiccarocks@shakespeare.lit/laptop'
    to='darkcave@macbeth.shakespeare.lit/oldhag'&gt;
  &lt;show&gt;xa&lt;/show&gt;
  &lt;status&gt;gone where the goblins go&lt;/status&gt;
&lt;/presence&gt;
    </pre></div>
    <p class="" style="">The service then sends a presence stanza from the occupant changing his or her presence to the full JID of each occupant, including extended presence information about the occupant's role and full JID to those with privileges to view such information:</p>
    <p class="caption">Example 41. Service Passes Along Changed Presence to All Occupants</p>
<div class="indent"><pre>
&lt;presence
    from='darkcave@macbeth.shakespeare.lit/secondwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;show&gt;xa&lt;/show&gt;
  &lt;status&gt;gone where the goblins go&lt;/status&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='admin'
          jid='wiccarocks@shakespeare.lit/laptop'
          role='moderator'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
.
.
.
    </pre></div>
  </div>
  <div class="indent">
<h3>6.7 <a name="invite">Inviting Another User to a Room</a>
</h3>
    <p class="" style="">It can be useful to invite another user to a room in which one is an occupant. Several different mechanisms have been suggested in the past to do this. One existing protocol is for the inviting occupant to send a message directly to the invitee, containing extended content qualified by the 'jabber:x:conference' namespace. The server (not the chat service) adds a 'from' address to the invite message, which is delivered like any other message. This undocumented protocol, which is <span style="font-style: italic">not</span> part of "groupchat 1.0", is as follows:</p>
    <p class="caption">Example 42. Occupant Sends an Invitation (Not Recommended)</p>
<div class="indent"><pre>
&lt;message
    from='crone1@shakespeare.lit/desktop'
    to='hecate@shakespeare.lit'&gt;
  &lt;body&gt;You have been invited to darkcave@macbeth.&lt;/body&gt;
    &lt;x jid='room@service' xmlns='jabber:x:conference'/&gt;
&lt;/message&gt;
    </pre></div>
    <p class="" style="">While the current protocol meets the needs of "groupchat 1.0" implementations, it could not work within the context of a members-only room, since the service needs to keep track of who is registered as a member. Because we would like to support members-only rooms, it seems desirable for an occupant to send the invitation to the &lt;room@service&gt; itself and have the room keep track of the invitations (if the room is members-only) or simply forward the invitation to the invitee.</p>
    <p class="" style="">Therefore the old undocumented protocol SHOULD NOT be used (it cannot be deprecated since it was never approved) and a MUC client MUST send XML of the following form to the &lt;room@service&gt; itself (the reason is OPTIONAL and the message MUST NOT possess a 'type' attribute; the service MAY ignore or reject invites that possess a 'type' attribute):</p>
    <p class="caption">Example 43. Occupant Sends an Invitation by Way of Room (Multi-User Chat)</p>
<div class="indent"><pre>
&lt;message
    from='crone1@shakespeare.lit/desktop'
    to='darkcave@macbeth.shakespeare.lit'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;invite to='hecate@shakespeare.lit'&gt;
      &lt;reason&gt;
        Hey Hecate, this is the place for all good witches!
      &lt;/reason&gt;
    &lt;/invite&gt;
  &lt;/x&gt;
&lt;/message&gt;
    </pre></div>
    <p class="" style="">The &lt;room@service&gt; itself MUST then add a 'from' address to the &lt;invite/&gt; element whose value is the bare JID (or, optionally, the room JID) of the invitor and send the invitation to the invitee captured in the 'to' address (the service SHOULD include a message body explaining the invitation or containing the reason, for the sake of older clients; in addition, the room SHOULD add the password if the room is password-protected) and MAY include the old jabber:x:conference extension as well for backwards-compatibility:</p>
    <p class="caption">Example 44. Room Sends Invitation to Invitee on Behalf of Invitor</p>
<div class="indent"><pre>
&lt;message
    from='darkcave@macbeth.shakespeare.lit'
    to='hecate@shakespeare.lit'&gt;
  &lt;body&gt;You have been invited to darkcave@macbeth by crone1@shakespeare.lit.&lt;/body&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;invite from='crone1@shakespeare.lit'&gt;
      &lt;reason&gt;
        Hey Hecate, this is the place for all good witches!
      &lt;/reason&gt;
    &lt;/invite&gt;
    &lt;password&gt;cauldron&lt;/password&gt;
  &lt;/x&gt;
  &lt;x jid='darkcave@macbeth.shakespeare.lit' xmlns='jabber:x:conference'&gt;
    Hey Hecate, this is the place for all good witches!
  &lt;/x&gt;
&lt;/message&gt;
    </pre></div>
    <p class="" style="">If the room is members-only, the service MAY also add the invitee to the member list. (Note: Invitation privileges in members-only rooms SHOULD be restricted to room admins; if a member without privileges to edit the member list attempts to invite another user, the service SHOULD return a &lt;forbidden/&gt; error to the occupant; for details, see the <a href="#modifymember">Modifying the Member List</a> section of this document.)</p>
    <p class="" style="">If the invitor supplies a non-existent JID, the room SHOULD return an &lt;item-not-found/&gt; error to the invitor.</p>
    <p class="" style="">The invitee MAY choose to formally decline (as opposed to ignore) the invitation; and this is something that the sender may want to be informed about. In order to decline the invitation, the invitee MUST send a message of the following form to the &lt;room@service&gt; itself:</p>

    <p class="caption">Example 45. Invitee Declines Invitation</p>
<div class="indent"><pre>
&lt;message
    from='hecate@shakespeare.lit/broom'
    to='darkcave@macbeth.shakespeare.lit'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;decline to='crone1@shakespeare.lit'&gt;
      &lt;reason&gt;
        Sorry, I'm too busy right now.
      &lt;/reason&gt;
    &lt;/decline&gt;
  &lt;/x&gt;
&lt;/message&gt;
    </pre></div>
    <p class="caption">Example 46. Room Informs Invitor that Invitation Was Declined</p>
<div class="indent"><pre>
&lt;message
    from='darkcave@macbeth.shakespeare.lit'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;decline from='hecate@shakespeare.lit'&gt;
      &lt;reason&gt;
        Sorry, I'm too busy right now.
      &lt;/reason&gt;
    &lt;/decline&gt;
  &lt;/x&gt;
&lt;/message&gt;
    </pre></div>
    <p class="" style="">It may be wondered why the invitee does not send the decline message directly to the invitor. The main reason is that certain implementations MAY choose to base invitations on room JIDs rather than bare JIDs (so that, for example, an occupant could invite someone from one room to another without knowing that person's bare JID). Thus the service MUST handle both the invites and declines.</p>
  </div>
  <div class="indent">
<h3>6.8 <a name="continue">Converting a One-to-One Chat Into a Conference</a>
</h3>
    <p class="" style="">Sometimes it is desirable to convert a one-to-one chat into a multi-user conference. The process flow is shown in the following examples.</p>
    <p class="" style="">First, two users begin a one-to-one chat.</p>
    <p class="caption">Example 47. A One-to-One Chat</p>
<div class="indent"><pre>
&lt;message
    from='crone1@shakespeare.lit/desktop'
    to='wiccarocks@shakespeare.lit/laptop'
    type='chat'&gt;
  &lt;body&gt;Thrice the brinded cat hath mew'd.&lt;/body&gt;
&lt;/message&gt;

&lt;message
    from='wiccarocks@shakespeare.lit/laptop'
    to='crone1@shakespeare.lit/desktop'
    type='chat'&gt;
  &lt;body&gt;Thrice and once the hedge-pig whined.&lt;/body&gt;
&lt;/message&gt;
    </pre></div>
    <p class="" style="">Now the first person decides to include a third person in the discussion, so she (or, more precisely, her client) does the following:</p>
    <ol start="1" type="">
      <li>Creates a new room (which SHOULD be non-anonymous and MAY be an instant room as specified below)</li>
      <li>Optionally sends history of the one-to-one chat to the room</li>
      <li>Sends an invitation to the second person and the third person, including a &lt;continue/&gt; flag.</li> 
    </ol>
    <p class="caption">Example 48. Continuing the Discussion I: User Creates Room</p>
<div class="indent"><pre>
&lt;presence
    from='crone1@shakespeare.lit/desktop'
    to='darkcave@macbeth.shakespeare.lit/firstwitch'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;
&lt;/presence&gt;

&lt;presence
    from='darkcave@macbeth.shakespeare.lit/firstwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='owner' role='moderator'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
    </pre></div>
    <p class="caption">Example 49. Continuing the Discussion II: Owner Sends History to Room</p>
<div class="indent"><pre>
&lt;message
    from='crone1@shakespeare.lit/desktop'
    to='darkcave@macbeth.shakespeare.lit'
    type='groupchat'&gt;
  &lt;body&gt;Thrice the brinded cat hath mew'd.&lt;/body&gt;
  &lt;x xmlns='jabber:x:delay'
     from='crone1@shakespeare.lit/desktop'
     stamp='20040929T01:54:37'/&gt;
&lt;/message&gt;

&lt;message
    from='crone1@shakespeare.lit/desktop'
    to='darkcave@macbeth.shakespeare.lit'
    type='groupchat'&gt;
  &lt;body&gt;Thrice and once the hedge-pig whined.&lt;/body&gt;
  &lt;x xmlns='jabber:x:delay'
     from='wiccarocks@shakespeare.lit/laptop'
     stamp='20040929T01:55:21'/&gt;
&lt;/message&gt;
    </pre></div>
    <p class="" style="">Note: Use of the <span style="font-weight: bold">Delayed Delivery</span> protocol enables the room creator to specify the datetime of each message from the one-to-one chat history (via the 'stamp' attribute), as well as the JID of the original sender of each message (via the 'from' attribute). The room creator SHOULD send the complete one-to-one chat history before inviting additional users to the room, and SHOULD also send as history any messages appearing in the one-to-one chat interface after joining the room and before the second person joins the room; if the one-to-one history is especially large, the sending client may want to send the history over a few seconds rather than all at once (to avoid triggering rate limits). The service SHOULD NOT add its own delay elements (as described in the <a href="#enter-history">Discussion History</a> section of this document) to prior chat history messages received from the room owner.</p>
    <p class="caption">Example 50. Continuing the Discussion III: Owner Sends Invitations, Including Continue Flag</p>
<div class="indent"><pre>
&lt;message
    from='crone1@shakespeare.lit/desktop'
    to='darkcave@macbeth.shakespeare.lit'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;invite to='wiccarocks@shakespeare.lit/laptop'&gt;
      &lt;reason&gt;This coven needs both wiccarocks and hag66.&lt;/reason&gt;
      &lt;continue/&gt;
    &lt;/invite&gt;
    &lt;invite to='hag66@shakespeare.lit'&gt;
      &lt;reason&gt;This coven needs both wiccarocks and hag66.&lt;/reason&gt;
      &lt;continue/&gt;
    &lt;/invite&gt;
  &lt;/x&gt;
&lt;/message&gt;
    </pre></div>
    <p class="" style="">Note: Since the invitor's client knows the full JID of the person with whom the invitor was having a one-to-one chat, it SHOULD include the full JID (rather than the bare JID) in the invitation.</p>
    <p class="" style="">The invitations are delivered to the invitees:</p>
    <p class="caption">Example 51. Invitations Delivered</p>
<div class="indent"><pre>
&lt;message
    from='darkcave@macbeth.shakespeare.lit'&gt;
    to='wiccarocks@shakespeare.lit/laptop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;invite from='crone1@shakespeare.lit'&gt;
      &lt;reason&gt;This coven needs both wiccarocks and hag66.&lt;/reason&gt;
      &lt;continue/&gt;
    &lt;/invite&gt;
  &lt;/x&gt;
&lt;/message&gt;

&lt;message
    from='darkcave@macbeth.shakespeare.lit'&gt;
    to='hag66@shakespeare.lit'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;invite from='crone1@shakespeare.lit'&gt;
      &lt;reason&gt;This coven needs both wiccarocks and hag66.&lt;/reason&gt;
      &lt;continue/&gt;
    &lt;/invite&gt;
  &lt;/x&gt;
&lt;/message&gt;
    </pre></div>
    <p class="" style="">When the client being used by &lt;wiccarocks@shakespeare.lit/laptop&gt; receives the invitation, it SHOULD auto-join the room or prompt the user whether to join (subject to user preferences) and then seamlessly convert the existing one-to-one chat window into a multi-user conferencing window:</p>
    <p class="caption">Example 52. Invitee Accepts Invitation, Joins Room, and Receives Presence and History</p>
<div class="indent"><pre>
&lt;presence
    from='wiccarocks@shakespeare.lit/laptop'
    to='darkcave@macbeth.shakespeare.lit/secondwitch'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;
&lt;/presence&gt;

&lt;presence
    from='darkcave@macbeth.shakespeare.lit/firstwitch'
    to='wiccarocks@shakespeare.lit/laptop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='owner' role='moderator'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;

&lt;presence
    from='darkcave@macbeth.shakespeare.lit/secondwitch'
    to='wiccarocks@shakespeare.lit/laptop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member' role='participant'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;

&lt;message
    from='darkcave@macbeth.shakespeare.lit'
    to='wiccarocks@shakespeare.lit/laptop'
    type='groupchat'&gt;
  &lt;body&gt;Thrice the brinded cat hath mew'd.&lt;/body&gt;
  &lt;x xmlns='jabber:x:delay'
     from='crone1@shakespeare.lit/desktop'
     stamp='20040929T01:54:37'/&gt;
&lt;/message&gt;

&lt;message
    from='darkcave@macbeth.shakespeare.lit'
    to='wiccarocks@shakespeare.lit/laptop'
    type='groupchat'&gt;
  &lt;body&gt;Thrice and once the hedge-pig whined.&lt;/body&gt;
  &lt;x xmlns='jabber:x:delay'
     from='wiccarocks@shakespeare.lit/laptop'
     stamp='20040929T01:55:21'/&gt;
&lt;/message&gt;
    </pre></div>
    <p class="" style="">Note: The fact that the messages come from the &lt;room@service&gt; itself rather than &lt;room@service/nick&gt; is a clue to the receiving client that these messages are prior chat history, since any message from a room occupant will have a 'from' address equal to the sender's room JID.</p>
  </div>
  <div class="indent">
<h3>6.9 <a name="subject-occupant">Occupant Modification of the Room Subject</a>
</h3>
    <p class="" style="">If allowed in accordance with room configuration, a mere occupant MAY be allowed to change the subject in a room. For details, see the <a href="#subject-mod">Modifying the Room Subject</a> section of this document.</p>
  </div>
  <div class="indent">
<h3>6.10 <a name="privatemessage">Sending a Private Message</a>
</h3>
    <p class="" style="">Since each occupant has a unique room JID, an occupant MAY send a "private message" to a selected occupant via the service by sending a message to the occupant's room JID. The message type SHOULD be "chat" and MUST NOT be "groupchat", but MAY be left unspecified (i.e., a normal message). This privilege SHOULD be allowed to any occupant (even a visitor in a moderated room).</p>
    <p class="caption">Example 53. Occupant Sends Private Message</p>
<div class="indent"><pre>
&lt;message
    from='wiccarocks@shakespeare.lit/laptop'
    to='darkcave@macbeth.shakespeare.lit/firstwitch'
    type='chat'&gt;
  &lt;body&gt;I'll give thee a wind.&lt;/body&gt;
&lt;/message&gt;
    </pre></div>
    <p class="" style="">The service is responsible for changing the 'from' address to the sender's room JID and delivering the message to the intended recipient's full JID.</p>
    <p class="caption">Example 54. Recipient Receives the Private Message</p>
<div class="indent"><pre>
&lt;message
    from='darkcave@macbeth.shakespeare.lit/secondwitch'
    to='crone1@shakespeare.lit/desktop'
    type='chat'&gt;
  &lt;body&gt;I'll give thee a wind.&lt;/body&gt;
&lt;/message&gt;
    </pre></div>
    <p class="" style="">If the sender attempts to send a private message of type "groupchat" to a particular occupant, the service MUST refuse to deliver the message (since the recipient's client would expect in-room messages to be of type "groupchat") and return a &lt;bad-request/&gt; error to the sender:</p>
    <p class="caption">Example 55. Occupant Attempts to Send a Message of Type "Groupchat" to a Particular Occupant</p>
<div class="indent"><pre>
&lt;message
    from='wiccarocks@shakespeare.lit/laptop'
    to='darkcave@macbeth.shakespeare.lit/firstwitch'
    type='groupchat'&gt;
  &lt;body&gt;I'll give thee a wind.&lt;/body&gt;
&lt;/message&gt;

&lt;message
    from='darkcave@macbeth.shakespeare.lit'
    to='wiccarocks@shakespeare.lit/laptop'
    type='error'&gt;
  &lt;body&gt;I'll give thee a wind.&lt;/body&gt;
  &lt;error code='400' type='modify'&gt;
    &lt;bad-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/message&gt;
    </pre></div>
    <p class="" style="">If the sender attempts to send a private message to a room JID that does not exist, the service MUST return an &lt;item-not-found/&gt; error to the sender.</p>
    <p class="" style="">If the sender is not an occupant of the room in which the intended recipient is visiting, the service MUST return a &lt;not-acceptable/&gt; error to the sender.</p>
  </div>
  <div class="indent">
<h3>6.11 <a name="message">Sending a Message to All Occupants</a>
</h3>
    <p class="" style="">An occupant sends a message to all other occupants in the room by sending a message of type "groupchat" to the &lt;room@service&gt; itself (a service MAY ignore or reject messages that do not have a type of "groupchat"). In a moderated room, this privilege is restricted to occupants with a role of participant or higher.</p>
    <p class="caption">Example 56. Occupant Sends a Message to All Occupants</p>
<div class="indent"><pre>
&lt;message
    from='hag66@shakespeare.lit/pda'
    to='darkcave@macbeth.shakespeare.lit'
    type='groupchat'&gt;
  &lt;body&gt;Harpier cries: 'tis time, 'tis time.&lt;/body&gt;
&lt;/message&gt;
    </pre></div>
    <p class="" style="">If the sender has voice in the room (this is the default except in moderated rooms), the service MUST change the 'from' attribute to the sender's room JID and reflect the message out to the full JID of each occupant.</p>
    <p class="caption">Example 57. Service Reflects Message to All Occupants</p>
<div class="indent"><pre>
&lt;message
    from='darkcave@macbeth.shakespeare.lit/thirdwitch'
    to='crone1@shakespeare.lit/desktop'
    type='groupchat'&gt;
  &lt;body&gt;Harpier cries: 'tis time, 'tis time.&lt;/body&gt;
&lt;/message&gt;
&lt;message
    from='darkcave@macbeth.shakespeare.lit/thirdwitch'
    to='wiccarocks@shakespeare.lit/laptop'
    type='groupchat'&gt;
  &lt;body&gt;Harpier cries: 'tis time, 'tis time.&lt;/body&gt;
&lt;/message&gt;
&lt;message
    from='darkcave@macbeth.shakespeare.lit/thirdwitch'
    to='hag66@shakespeare.lit/pda'
    type='groupchat'&gt;
  &lt;body&gt;Harpier cries: 'tis time, 'tis time.&lt;/body&gt;
&lt;/message&gt;
    </pre></div>
    <p class="" style="">If the sender is a visitor (i.e., does not have voice in a moderated room), the service MAY return a &lt;forbidden/&gt; error to the sender and MUST NOT reflect the message to all occupants. If the sender is not an occupant of the room, the service SHOULD return a &lt;not-acceptable/&gt; error to the sender and SHOULD NOT reflect the message to all occupants; the only exception to this rule is that an implementation MAY allow users with certain privileges (e.g., a room owner, room admin, or service-level admin) to send messages to the room even if those users are not occupants.</p>
  </div>
  <div class="indent">
<h3>6.12 <a name="register">Registering with a Room</a>
</h3>
    <p class="" style="">An implementation MAY allow an unaffiliated user (in a moderated room, probably a participant) to register with a room and thus become a member of the room (conversely, an implementation MAY restrict this privilege and allow only room admins to add new members). If allowed, this functionality SHOULD be implemented by enabling a user to send a request for registration requirements to the room qualified by the 'jabber:iq:register' namespace as described in <span class="ref" style="">In-Band Registration</span>  [<a href="#nt-id2262006">9</a>]:</p>
    <p class="caption">Example 58. User Requests Registration Requirements</p>
<div class="indent"><pre>
&lt;iq from='hag66@shakespeare.lit/pda'
    id='reg1'
    to='darkcave@macbeth.shakespeare.lit'
    type='get'&gt;
  &lt;query xmlns='jabber:iq:register'/&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">If the user requesting registration requirements is not allowed to register with the room (e.g., because that privilege has been restricted), the room MUST return a &lt;not-allowed/&gt; error to the user. If the user is already registered, the room MUST reply with an IQ stanza of type "result" that contains an empty &lt;register/&gt; element as described in JEP-0077. If the room does not exist, the service MUST return an &lt;item-not-found/&gt; error.</p>
    <p class="" style="">Otherwise, the room MUST then return a Data Form to the user (as described in <span class="ref" style="">Data Forms</span>  [<a href="#nt-id2262026">10</a>]). The information required to register MAY vary by implementation or deployment and is not fully specified in this JEP (e.g., the fields registered by this JEP for the 'http://jabber.org/protocol/muc#register' FORM_TYPE may be supplemented in the future via the mechanisms described in the <a href="#registrar-formtype">Field Standardization</a> section of this document). The following can be taken as a fairly typical example:</p>
    <p class="caption">Example 59. Service Returns Registration Form</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='reg1'
    to='hag66@shakespeare.lit/pda'
    type='result'&gt;
  &lt;query xmlns='jabber:iq:register'&gt;
    &lt;instructions&gt;
      To register on the web, visit http://shakespeare.lit/
    &lt;/instructions&gt;
    &lt;x xmlns='jabber:x:data' type='form'&gt;
      &lt;title&gt;Dark Cave Registration&lt;/title&gt;
      &lt;instructions&gt;
        Please provide the following information
        to register with this room.
      &lt;/instructions&gt;
      &lt;field
          type='hidden'
          var='FORM_TYPE'&gt;
        &lt;value&gt;http://jabber.org/protocol/muc#register&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='First Name'
          type='text-single'
          var='muc#register_first'&gt;
        &lt;required/&gt;
      &lt;/field&gt;
      &lt;field
          label='Last Name'
          type='text-single'
          var='muc#register_last'&gt;
        &lt;required/&gt;
      &lt;/field&gt;
      &lt;field
          label='Desired Nickname'
          type='text-single'
          var='muc#register_roomnick'&gt;
        &lt;required/&gt;
      &lt;/field&gt;
      &lt;field
          label='Your URL'
          type='text-single'
          var='muc#register_url'/&gt;
      &lt;field
          label='Email Address'
          type='text-single'
          var='muc#register_email'/&gt;
      &lt;field
          label='FAQ Entry'
          type='text-multi'
          var='muc#register_faqentry'/&gt;
    &lt;/x&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The user SHOULD then submit the form:</p>
    <p class="caption">Example 60. User Submits Registration Form</p>
<div class="indent"><pre>
&lt;iq from='hag66@shakespeare.lit/pda'
    id='reg2'
    to='darkcave@macbeth.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='jabber:iq:register'&gt;
    &lt;x xmlns='jabber:x:data' type='submit'&gt;
      &lt;field var='FORM_TYPE'&gt;
        &lt;value&gt;http://jabber.org/protocol/muc#register&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#register_first'&gt;
        &lt;value&gt;Brunhilde&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#register_last'&gt;
        &lt;value&gt;Entwhistle-Throckmorton&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#register_roomnick'&gt;
        &lt;value&gt;thirdwitch&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#register_url'&gt;
        &lt;value&gt;http://witchesonline/~hag66/&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#register_email'&gt;
        &lt;value&gt;hag66@witchesonline&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#register_faqentry'&gt;
        &lt;value&gt;Just another witch.&lt;/value&gt;
      &lt;/field&gt;
    &lt;/x&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">If the desired room nickname is already reserved for that room, the room MUST return a &lt;conflict/&gt; error to the user:</p>
    <p class="caption">Example 61. Room Returns Conflict Error to User</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='reg2'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;error code='409' type='cancel'&gt;
    &lt;conflict xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">If the room or service does not support registration, it MUST return a &lt;service-unavailable/&gt; error to the user:</p>
    <p class="caption">Example 62. Room Returns Service Unavailable Error to User</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='reg2'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;error code='503' type='cancel'&gt;
    &lt;service-unavailable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">If the user did not include a valid data form, the room MUST return a &lt;bad-request/&gt; error to the user:</p>
    <p class="caption">Example 63. Room Returns Service Bad Request Error to User</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='reg2'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;error code='400' type='modify'&gt;
    &lt;bad-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">Otherwise, the room MUST inform the user of successful registration:</p>
    <p class="caption">Example 64. Room Informs User of Successful Registration</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='reg2'
    to='hag66@shakespeare.lit/pda'
    type='result'/&gt;
    </pre></div>
    <p class="" style="">After the user successfully submits the form, the service MAY request that the submission be approved by a room admin/owner (see the <a href="#regapprove">Approving Registration Requests</a> section of this document) or MAY immediately add the user to the member list by changing the user's affiliation from "none" to "member". If the service changes the user's affiliation and the user is in the room, it MUST send updated presence from this individual to all occupants, indicating the change in affiliation by including an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'affiliation' attribute set to a value of "member".</p>
    <p class="caption">Example 65. Service Sends Notice of Membership to All Occupants</p>
<div class="indent"><pre>
&lt;presence
    from='darkcave@macbeth.shakespeare.lit/thirdwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member'
          jid='hag66@shakespeare.lit/pda'
          role='participant'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
.
.
.
    </pre></div>
    <p class="" style="">If a user has registered with a room, the room MAY choose to restrict the user to use of the registered nickname only in that room. If it does so, it SHOULD return a &lt;not-acceptable/&gt; error to the user if the user attempts to join the room with a roomnick other than the user's registered roomnick (this enables a room to "lock down" roomnicks for consistent identification of occupants).</p>
  </div>
  <div class="indent">
<h3>6.13 <a name="reservednick">Discovering Reserved Room Nickname</a>
</h3>
    <p class="" style="">A user MAY have a reserved room nickname, for example through explicit room registration or database integration. In such cases it may be desirable for the user to discover his or her reserved nickname before attempting to enter the room (e.g., because the user has forgotten his or her reserved nickname). This is done by sending a Service Discovery information request to the room JID while specifying a well-known Service Discovery node of "x-roomuser-item".</p>
    <p class="caption">Example 66. User Requests Reserved Nickname</p>
<div class="indent"><pre>
&lt;iq from='hag66@shakespeare.lit/pda'
    id='getnick1'
    to='darkcave@macbeth.shakespeare.lit'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'
         node='x-roomuser-item'/&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">It is OPTIONAL for a multi-user chat service to support the foregoing service discovery node. If the room or service does not support the foregoing service discovery node, it MUST return a &lt;feature-not-implemented/&gt; error to the user. If it does and the user has a registered nickname, it MUST return the nickname to the user as the value of the 'name' attribute of a Service Discovery &lt;identity/&gt; element (for which the category/type SHOULD be "conference/text"):</p>
    <p class="caption">Example 67. Room Returns Nickname</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='getnick1'
    to='hag66@shakespeare.lit/pda'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'
         node='x-roomuser-item'&gt;
    &lt;identity
        category='conference'
        name='thirdwitch'
        type='text'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">If the user does not have a registered nickname, the room MUST return a service discovery &lt;query/&gt; element that is empty (in accordance with JEP-0030).</p>
    <p class="" style="">Even if a user has registered one room nickname, the service SHOULD allow the user to specify a different nickname on entering the room (e.g., in order to join from different client resources), although the service MAY choose to "lock down" nicknames and therefore deny entry to the user, including a &lt;not-acceptable/&gt; error. The service MUST NOT return an error to the user if his or her client sends the foregoing request after having already joined the room, but instead SHOULD reply as described above.</p>
    <p class="" style="">If another user attempts to join the room with a nickname reserved by the first user, the service MUST deny entry to the second user and return a &lt;conflict/&gt; error as previously described.</p>
  </div>
<h2>7.
       <a name="moderator">Moderator Use Cases</a>
</h2>
  <p class="" style="">A moderator has privileges to perform certain actions within the room (e.g., to change the roles of some occupants) but does not have rights to change persistent information about affiliations (which may be changed only by an admin or owner) or defining information about the room. Exactly which actions may be performed by a moderator is subject to configuration. However, for the purposes of the MUC framework, moderators are stipulated to have privileges to perform the following actions:</p>
  <ol start="1" type="">
    <li>discover an occupant's full JID in a semi-anonymous room (occurs by default as shown above)</li>
    <li>modify the subject</li>
    <li>kick a participant or visitor from the room</li>
    <li>grant or revoke voice in a moderated room</li>
    <li>modify the list of occupants who have voice in a moderated room</li>
  </ol>
  <p class="" style="">These features shall be implemented with a request/response exchange using &lt;iq/&gt; elements that contain children qualified by the 'http://jabber.org/protocol/muc#admin' namespace. The examples below illustrate the protocol interactions to implement the desired functionality. (Except where explicitly noted below, any of the following administrative requests MUST be denied if the &lt;user@host&gt; of the 'from' address of the request does not match the bare JID portion of one of the moderators; in this case, the service MUST return a &lt;forbidden/&gt; error.)</p>
  <div class="indent">
<h3>7.1 <a name="subject-mod">Modifying the Room Subject</a>
</h3>
    <p class="" style="">A common feature of multi-user chat rooms is the ability to change the subject within the room. By default, only users with a role of "moderator" SHOULD be allowed to change the subject in a room (although this SHOULD be configurable, with the result that a mere participant or even visitor may be allowed to change the subject if desired). The subject is changed by sending a message of type "groupchat" to the &lt;room@service&gt;, containing no body but a &lt;subject/&gt; that specifies the new subject:</p>
    <p class="caption">Example 68. Moderator Changes Subject</p>
<div class="indent"><pre>
&lt;message
    from='wiccarocks@shakespeare.lit/laptop'
    to='darkcave@macbeth.shakespeare.lit'
    type='groupchat'&gt;
  &lt;subject&gt;Fire Burn and Cauldron Bubble!&lt;/subject&gt;
&lt;/message&gt;
    </pre></div>
    <p class="" style="">If a MUC service receives such a message, it MUST reflect the message to all other occupants with a 'from' address equal to the room JID that corresponds to the sender of the subject change:</p>
    <p class="caption">Example 69. Service Informs All Occupants of Subject Change</p>
<div class="indent"><pre>
&lt;message
    from='darkcave@macbeth.shakespeare.lit/secondwitch'
    to='crone1@shakespeare.lit/desktop'
    type='groupchat'&gt;
  &lt;subject&gt;Fire Burn and Cauldron Bubble!&lt;/subject&gt;
&lt;/message&gt;
.
.
.
    </pre></div>
    <p class="" style="">In addition, the room SHOULD include the last subject change in the discussion history sent when a new occupant joins the room.</p>
    <p class="" style="">A MUC client that receives such a message MAY choose to display an in-room message; the body of such in-room messages SHOULD NOT be generated by the sending client or the service, so as to ensure correct localization (however, the sending client or service MAY generate the body if desired). The in-room message could be something like the following:</p>
    <p class="caption">Example 70. Service Sends In-Room Subject Change Message</p>
<div class="indent"><pre>
&lt;message
    from='darkcave@macbeth.shakespeare.lit'
    to='crone1@shakespeare.lit/desktop'
    type='groupchat'&gt;
  &lt;subject&gt;Fire Burn and Cauldron Bubble!&lt;/subject&gt;
  &lt;body&gt;* secondwitch has changed the subject to: Fire Burn and Cauldron Bubble!&lt;/body&gt;
&lt;/message&gt;
.
.
.
    </pre></div>
    <p class="" style="">If someone without appropriate privileges attempts to change the room subject, the service MUST return a message of type "error" specifying a &lt;forbidden/&gt; error condition:</p>
    <p class="caption">Example 71. Service Returns Error Related to Unauthorized Subject Change</p>
<div class="indent"><pre>
&lt;message
    from='darkcave@macbeth.shakespeare.lit'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;subject&gt;Fire Burn and Cauldron Bubble!&lt;/subject&gt;
  &lt;error code='403' type='auth'&gt;
    &lt;forbidden xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/message&gt;
    </pre></div>
  </div>
  <div class="indent">
<h3>7.2 <a name="kick">Kicking a Visitor or Participant from a Room</a>
</h3>
    <p class="" style="">A moderator has permissions kick a visitor or participant from a room. The kick is normally performed based on the occupant's room nickname (though it MAY be based on the full JID) and is completed by setting the role of a participant or visitor to a value of "none".</p>
    <p class="caption">Example 72. Moderator Kicks Occupant</p>
<div class="indent"><pre>
&lt;iq from='fluellen@shakespeare.lit/pda'
    id='kick1'
    to='harfleur@henryv.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item nick='pistol' role='none'&gt;
      &lt;reason&gt;Avaunt, you cullion!&lt;/reason&gt;
    &lt;/item&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The service MUST remove the kicked occupant by sending a presence stanza of type "unavailable" to each kicked occupant, including status code 307 in the extended presence information, optionally along with the reason (if provided) and the bare JID of the user who initiated the kick.</p>
    <p class="caption">Example 73. Service Removes Kicked Occupant</p>
<div class="indent"><pre>
&lt;presence
    from='harfleur@henryv.shakespeare.lit/pistol'
    to='pistol@shakespeare.lit/harfleur'
    type='unavailable'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='none' role='none'&gt;
      &lt;actor jid='fluellen@shakespeare.lit'/&gt;
      &lt;reason&gt;Avaunt, you cullion!&lt;/reason&gt;
    &lt;/item&gt;
    &lt;status code='307'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
    </pre></div>
    <p class="" style="">The inclusion of the status code assists clients in presenting their own notification messages (e.g., information appropriate to the user's locality). The optional inclusion of the reason and actor enable the kicked user to understand why he or she was kicked, and by whom if the kicked occupant would like to discuss the matter.  [<a href="#nt-id2262587">11</a>]</p>
    <p class="" style="">After removing the kicked occupant(s), the service MUST then inform the moderator of success:</p>
    <p class="caption">Example 74. Service Informs Moderator of Success</p>
<div class="indent"><pre>
&lt;iq from='harfleur@henryv.shakespeare.lit'
    id='kick1'
    to='fluellen@shakespeare.lit/pda'
    type='result'/&gt;
    </pre></div>
    <p class="" style="">After informing the moderator, the service MUST then inform all of the remaining occupants that the kicked occupant is no longer in the room by sending presence stanzas of type "unavailable" from the individual's roomnick (&lt;room@service/nick&gt;) to all the remaining occupants (just as it does when occupants exit the room of their own volition), including the status code and optionally the reason and actor.</p>
    <p class="caption">Example 75. Service Informs Remaining Occupants</p>
<div class="indent"><pre>
&lt;presence
    from='harfleur@henryv.shakespeare.lit/pistol'
    to='gower@shakespeare.lit/cell'
    type='unavailable'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='none' role='none'/&gt;
    &lt;status code='307'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
.
.
.
    </pre></div>
    <p class="" style="">A moderator cannot be kicked from a room, nor can any user with an affiliation of "owner" or "admin". If a moderator attempts to kick such a user, the service MUST deny the request and return a &lt;not-allowed/&gt; error to the sender:</p>
    <p class="caption">Example 76. Service Returns Error on Attempt to Kick Moderator, Admin, or Owner</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='kicktest'
    to='wiccarocks@shakespeare.lit/laptop'
    type='error'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item nick='firstwitch' role='none'&gt;
      &lt;reason&gt;Be gone!&lt;/reason&gt;
    &lt;/item&gt;
  &lt;/query&gt;
  &lt;error code='405' type='cancel'&gt;
    &lt;not-allowed xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
  </div>
  <div class="indent">
<h3>7.3 <a name="grantvoice">Granting Voice to a Visitor</a>
</h3>
    <p class="" style="">In a moderated room, a moderator may want to manage who does and does not have "voice" in the room (i.e., the ability to send messages to all occupants). Voice is granted based on the visitor's room nickname, which the service will convert into the visitor's full JID internally. The moderator grants voice to a visitor by changing the visitor's role to "participant" (the &lt;reason/&gt; element is optional):</p>
    <p class="caption">Example 77. Moderator Grants Voice to a Visitor</p>
<div class="indent"><pre>
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='voice1'
    to='darkcave@macbeth.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item nick='thirdwitch'
          role='participant'&gt;
      &lt;reason&gt;A worthy witch indeed!&lt;/reason&gt;
    &lt;/item&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The service MUST then inform the moderator of success:</p>
    <p class="caption">Example 78. Service Informs Moderator of Success</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='voice1'
    to='crone1@shakespeare.lit/desktop'
    type='result'/&gt;
    </pre></div>
    <p class="" style="">The service MUST then send updated presence from this individual's &lt;room@service/nick&gt; to all occupants, indicating the addition of voice privileges by including an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'role' attribute set to a value of "participant".</p>
    <p class="caption">Example 79. Service Sends Notice of Voice to All Occupants</p>
<div class="indent"><pre>
&lt;presence
    from='darkcave@macbeth.shakespeare.lit/thirdwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member'
          nick='thirdwitch'
          role='participant'&gt;
      &lt;reason&gt;A worthy witch indeed!&lt;/reason&gt;
    &lt;/item&gt;
  &lt;/x&gt;
&lt;/presence&gt;
.
.
.
    </pre></div>
  </div>
  <div class="indent">
<h3>7.4 <a name="revokevoice">Revoking Voice from a Participant</a>
</h3>
    <p class="" style="">In a moderated room, a moderator may want to revoke a participant's privileges to speak. The moderator can revoke voice from a participant by changing the participant's role to "visitor":</p>
    <p class="caption">Example 80. Moderator Revokes Voice from a Participant</p>
<div class="indent"><pre>
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='voice2'
    to='darkcave@macbeth.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item nick='thirdwitch'
          role='visitor'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The service MUST then inform the moderator of success:</p>
    <p class="caption">Example 81. Service Informs Moderator of Success</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='voice2'
    to='crone1@shakespeare.lit/desktop'
    type='result'/&gt;
    </pre></div>
    <p class="" style="">The service MUST then send updated presence from this individual to all occupants, indicating the removal of voice privileges by sending a presence element that contains an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'role' attribute set to a value of "visitor".</p>
    <p class="caption">Example 82. Service Notes Loss of Voice</p>
<div class="indent"><pre>
&lt;presence
    from='darkcave@macbeth.shakespeare.lit/thirdwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member'
          jid='hag66@shakespeare.lit/pda'
          role='visitor'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
.
.
.
    </pre></div>
    <p class="" style="">A moderator MUST NOT be able to revoke voice from a user whose affiliation is at or above the moderator's level. In addition, a service MUST NOT allow the voice privileges of an admin or owner to be removed by anyone. If a moderator attempts to revoke voice privileges from such a user, the service MUST deny the request and return a &lt;not-allowed/&gt; error to the sender along with the offending item(s):</p>
    <p class="caption">Example 83. Service Returns Error on Attempt to Revoke Voice from an Admin, Owner, or User with a Higher Affiliation</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='voicetest'
    to='crone1@shakespeare.lit/desktop'
    type='error'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item nick='secondwitch' role='visitor'/&gt;
  &lt;/query&gt;
  &lt;error code='405' type='cancel'&gt;
    &lt;not-allowed xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
  </div>
  <div class="indent">
<h3>7.5 <a name="modifyvoice">Modifying the Voice List</a>
</h3>
    <p class="" style="">A moderator in a moderated room may want to modify the voice list. To do so, the moderator first requests the voice list by querying the room for all occupants with a role of 'participant'.</p>
    <p class="caption">Example 84. Moderator Requests Voice List</p>
<div class="indent"><pre>
&lt;iq from='bard@shakespeare.lit/globe'
    id='voice3'
    to='goodfolk@chat.shakespeare.lit'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item role='participant'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The service MUST then return the voice list to the moderator; each item MUST include the 'nick' and 'role' attributes and SHOULD include the 'affiliation' and 'jid' attributes:</p>
    <p class="caption">Example 85. Service Sends Voice List to Moderator</p>
<div class="indent"><pre>
&lt;iq from='goodfolk@chat.shakespeare.lit'
    id='voice3'
    to='bard@shakespeare.lit/globe'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='none'
          jid='polonius@hamlet/castle'
          nick='Polo'
          role='participant'/&gt;
    &lt;item affiliation='none'
          jid='horatio@hamlet/castle'
          nick='horotoro'
          role='participant'/&gt;
    &lt;item affiliation='member'
          jid='hecate@shakespeare.lit/broom'
          nick='Hecate'
          role='participant'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The moderator MAY then modify the voice list. In order to do so, the moderator MUST send the changed items (i.e., only the "delta") back to the service; each item MUST include the 'nick' attribute and 'role' attribute (normally set to a value of "participant" or "visitor") but SHOULD NOT include the 'jid' attribute and MUST NOT include the 'affiliation' attribute (which is used to manage affiliations such as owner rather than the participant role):</p>
    <p class="caption">Example 86. Moderator Sends Modified Voice List to Service</p>
<div class="indent"><pre>
&lt;iq from='bard@shakespeare.lit/globe'
    id='voice4'
    to='goodfolk@chat.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item nick='Hecate'
          role='visitor'/&gt;
    &lt;item nick='rosencrantz'
          role='participant'&gt;
      &lt;reason&gt;A worthy fellow.&lt;/reason&gt;
    &lt;/item&gt;
    &lt;item nick='guildenstern'
          role='participant'&gt;
      &lt;reason&gt;A worthy fellow.&lt;/reason&gt;
    &lt;/item&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The service MUST then inform the moderator of success:</p>
    <p class="caption">Example 87. Service Informs Moderator of Success</p>
<div class="indent"><pre>
&lt;iq from='goodfolk@chat.shakespeare.lit'
    id='voice1'
    to='bard@shakespeare.lit/globe'
    type='result'/&gt;
    </pre></div>
    <p class="" style="">The service MUST then send updated presence for any affected individuals to all occupants, indicating the change in voice privileges by sending the appropriate extended presence stanzas as described in the foregoing use cases.</p>
    <p class="" style="">As noted, voice privileges cannot be revoked from a room owner or room admin, nor from any user with a higher affiliation than the moderator making the request. If a room admin attempts to revoke voice privileges from such a user by modifying the voice list, the service MUST deny the request and return a &lt;not-allowed/&gt; error to the sender:</p>
    <p class="caption">Example 88. Service Returns Error on Attempt to Revoke Voice from an Admin, Owner, or User with a Higher Affiliation</p>
<div class="indent"><pre>
&lt;iq from='goodfolk@chat.shakespeare.lit'
    id='voicetest'
    to='bard@shakespeare.lit/globe'
    type='error'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item jid='hecate@shakespeare.lit'
          nick='Hecate'
          role='visitor'/&gt;
  &lt;/query&gt;
  &lt;error code='405' type='cancel'&gt;
    &lt;not-allowed xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
  </div>
<h2>8.
       <a name="admin">Admin Use Cases</a>
</h2>
  <p class="" style="">A room administrator has privileges to modify persistent information about user affiliations (e.g., by banning users) and to grant and revoke moderator privileges, but does not have rights to change the defining features of the room, which are the sole province of the room owner(s). Exactly which actions may be performed by a room admin will be subject to configuration. However, for the purposes of the MUC framework, room admins are stipulated to at a minimum have privileges to perform the following actions:</p>
  <ol start="1" type="">
    <li>ban a user from the room</li>
    <li>modify the list of users who are banned from the room</li>
    <li>grant or revoke membership</li>
    <li>modify the member list</li>
    <li>grant or revoke moderator privileges</li>
    <li>modify the list of moderators</li>
  </ol>
  <p class="" style="">These features shall be implemented with a request/response exchange using &lt;iq/&gt; elements that contain children qualified by the 'http://jabber.org/protocol/muc#admin' namespace. The examples below illustrate the protocol interactions that implement the desired functionality. (Except where explicitly noted below, any of the following administrative requests MUST be denied if the &lt;user@host&gt; of the 'from' address of the request does not match the bare JID of one of the room admins; in this case, the service MUST return a &lt;forbidden/&gt; error.)</p>
  <div class="indent">
<h3>8.1 <a name="ban">Banning a User</a>
</h3>
    <p class="" style="">An admin or owner can ban one or more users from a room. The ban MUST be performed based on the occupant's bare JID. In order to ban a user, an admin MUST change the user's affiliation to "outcast".</p>
    <p class="caption">Example 89. Admin Bans User</p>
<div class="indent"><pre>
&lt;iq from='kinghenryv@shakespeare.lit/throne'
    id='ban1'
    to='southampton@henryv.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='outcast'
          jid='earlofcambridge@shakespeare.lit'&gt;
      &lt;reason&gt;Treason&lt;/reason&gt;
    &lt;/item&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The service MUST add that bare JID to the ban list, SHOULD remove the outcast's nickname from the list of registered nicknames, and MUST inform the admin or owner of success:</p>
    <p class="caption">Example 90. Service Informs Admin or Owner of Success</p>
<div class="indent"><pre>
&lt;iq from='southampton@henryv.shakespeare.lit'
    id='ban1'
    to='kinghenryv@shakespeare.lit/throne'
    type='result'/&gt;
    </pre></div>
    <p class="" style="">The service MUST also remove any banned users who are in the room by sending a presence stanza of type "unavailable" to each banned occupant, including status code 301 in the extended presence information, optionally along with the reason (if provided) and the bare JID of the user who initiated the ban.</p>
    <p class="caption">Example 91. Service Removes Banned User</p>
<div class="indent"><pre>
&lt;presence
    from='southampton@henryv.shakespeare.lit/cambridge'
    to='earlofcambridge@shakespeare.lit/stabber'
    type='unavailable'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='outcast' role='none'&gt;
      &lt;actor jid='kinghenryv@shakespeare.lit'/&gt;
      &lt;reason&gt;Treason&lt;/reason&gt;
    &lt;/item&gt;
    &lt;status code='301'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
    </pre></div>
    <p class="" style="">The inclusion of the status code assists clients in presenting their own notification messages (e.g., information appropriate to the user's locality). The optional inclusion of the reason and actor enable the banned user to understand why he or she was banned, and by whom if the banned user would like to discuss the matter.</p>
    <p class="" style="">The service MUST then inform all of the remaining occupants that the banned user is no longer in the room by sending presence stanzas of type "unavailable" from the banned user to all remaining occupants (just as it does when occupants exit the room of their own volition), including the status code and optionally the reason and actor:</p>
    <p class="caption">Example 92. Service Informs Remaining Occupants</p>
<div class="indent"><pre>
&lt;presence
    type='unavailable'
    from='southampton@henryv.shakespeare.lit/cambridge'
    to='exeter@shakespeare.lit/pda'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='outcast'
          jid='earlofcambridge@shakespeare.lit/stabber'
          role='none'/&gt;
    &lt;status code='301'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
.
.
.
    </pre></div>
  </div>
  <div class="indent">
<h3>8.2 <a name="modifyban">Modifying the Ban List</a>
</h3>
    <p class="" style="">A room admin may want to modify the ban list. Note: The ban list is always based on a user's bare JID, although a nick (perhaps the last room nickname associated with that JID) MAY be included for convenience. To modify the list of banned JIDs, the admin first requests the ban list by querying the room for all users with an affiliation of 'outcast'.</p>
    <p class="caption">Example 93. Admin Requests Ban List</p>
<div class="indent"><pre>
&lt;iq from='kinghenryv@shakespeare.lit/throne'
    id='ban2'
    to='southampton@henryv.shakespeare.lit'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='outcast'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The service MUST then return the list of banned users to the admin; each item MUST include the 'affiliation' and 'jid' attributes but SHOULD NOT include the 'nick' and 'role' attributes:</p>
    <p class="caption">Example 94. Service Sends Ban List to Admin</p>
<div class="indent"><pre>
&lt;iq from='southampton@henryv.shakespeare.lit'
    id='ban2'
    to='kinghenryv@shakespeare.lit/throne'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='outcast'
          jid='earlofcambridge@shakespeare.lit'&gt;
      &lt;reason&gt;Treason&lt;/reason&gt;
    &lt;/item&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The admin MAY then modify the ban list. In order to do so, the admin MUST send the changed items (i.e., only the "delta") back to the service; each item MUST include the 'affiliation' attribute (normally set to a value of "outcast" to ban or "none" to remove ban) and 'jid' attribute but SHOULD NOT include the 'nick' attribute and MUST NOT include the 'role' attribute (which is used to manage roles such as participant rather than the outcast affiliation); in addition, the reason and actor elements are OPTIONAL:</p>
    <p class="caption">Example 95. Admin Sends Modified Ban List to Service</p>
<div class="indent"><pre>
&lt;iq from='kinghenryv@shakespeare.lit/throne'
    id='ban3'
    to='southampton@henryv.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='outcast'
          jid='earlofcambridge@shakespeare.lit'&gt;
      &lt;reason&gt;Treason&lt;/reason&gt;
    &lt;/item&gt;
    &lt;item affiliation='outcast'&gt;
          jid='lordscroop@shakespeare.lit' 
      &lt;reason&gt;Treason&lt;/reason&gt;
    &lt;/item&gt;
    &lt;item affiliation='outcast'
          jid='sirthomasgrey@shakespeare.lit'&gt;
      &lt;reason&gt;Treason&lt;/reason&gt;
    &lt;/item&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">After updating the ban list, the service MUST inform the admin of success:</p>
    <p class="caption">Example 96. Service Informs Admin of Success</p>
<div class="indent"><pre>
&lt;iq from='southampton@henryv.shakespeare.lit'
    id='ban3'
    to='kinghenryv@shakespeare.lit/throne'
    type='result'/&gt;
    </pre></div>
    <p class="" style="">The service MUST then remove the affected occupants (if they are in the room) and send updated presence (including the appropriate status code) from them to all the remaining occupants as described in the "Banning a User" use case. (The service SHOULD also remove each banned user's reserved nickname from the list of reserved roomnicks, if appropriate.)</p>
    <p class="" style="">When an entity is banned from a room, an implementation SHOULD match JIDs in the following order (these matching rules are the same as those defined for privacy lists in <span style="font-weight: bold">RFC 3921</span>):</p>
    <ol start="1" type="">
      <li>&lt;user@domain/resource&gt; (only that resource matches)</li>
      <li>&lt;user@domain&gt; (any resource matches)</li>
      <li>&lt;domain/resource&gt; (only that resource matches)</li>
      <li>&lt;domain&gt; (the domain itself matches, as does any user@domain, domain/resource, or address containing a subdomain)</li>
    </ol>
    <p class="" style="">Some administrators may wish to ban all users associated with a specific domain from all rooms hosted by a MUC service. Such functionality is a service-level feature and is therefore out of scope for this document (but see <span class="ref" style="">Service Administration</span>  [<a href="#nt-id2263361">12</a>]).</p>
  </div>
  <div class="indent">
<h3>8.3 <a name="grantmember">Granting Membership</a>
</h3>
    <p class="" style="">An admin can grant membership to a user; this is done by changing the user's affiliation to "member" (normally based on nick if the user is in the room, or on bare JID if not; in either case, if the nick is provided, that nick becomes the user's default nick in the room if that functionality is supported by the implementation):</p>
    <p class="caption">Example 97. Admin Grants Membership</p>
<div class="indent"><pre>
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='member1'
    to='darkcave@macbeth.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='member'
          jid='hag66@shakespeare.lit'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The service MUST add the user to the member list and then inform the admin of success:</p>
    <p class="caption">Example 98. Service Informs Admin of Success</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='member1'
    to='crone1@shakespeare.lit/desktop'
    type='result'/&gt;
    </pre></div>
    <p class="" style="">If the user is in the room, the service MUST then send updated presence from this individual to all occupants, indicating the granting of membership by including an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'affiliation' attribute set to a value of "member".</p>
    <p class="caption">Example 99. Service Sends Notice of Membership to All Occupants</p>
<div class="indent"><pre>
&lt;presence
    from='darkcave@macbeth.shakespeare.lit/thirdwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member'
          jid='hag66@shakespeare.lit/pda'
          role='participant'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
.
.
.
    </pre></div>
  </div>
  <div class="indent">
<h3>8.4 <a name="revokemember">Revoking Membership</a>
</h3>
    <p class="" style="">An admin may want to revoke a user's membership; this is done by changing the user's affiliation to "none":</p>
    <p class="caption">Example 100. Admin Revokes Membership</p>
<div class="indent"><pre>
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='member2'
    to='darkcave@macbeth.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='none'
          nick='thirdwitch'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The service MUST remove the user from the member list and then inform the moderator of success:</p>
    <p class="caption">Example 101. Service Informs Moderator of Success</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='member2'
    to='crone1@shakespeare.lit/desktop'
    type='result'/&gt;
    </pre></div>
    <p class="" style="">The service MUST then send updated presence from this individual to all occupants, indicating the loss of membership by sending a presence element that contains an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'affiliation' attribute set to a value of "none".</p>
    <p class="caption">Example 102. Service Notes Loss of Membership</p>
<div class="indent"><pre>
&lt;presence
    from='darkcave@macbeth.shakespeare.lit/thirdwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='none'
          jid='hag66@shakespeare.lit/pda'
          role='participant'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
.
.
.
    </pre></div>
    <p class="" style="">If the room is members-only, the service MUST remove the user from the room, including a status code of 321 to indicate that the user was removed because of an affiliation change, and inform all remaining occupants:</p>
    <p class="caption">Example 103. Service Removes Non-Member</p>
<div class="indent"><pre>
&lt;presence
    from='darkcave@macbeth.shakespeare.lit/thirdwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
    type='unavailable'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='none' role='none'&gt;
      &lt;actor jid='bard@shakespeare.lit'/&gt;
    &lt;/item&gt;
    &lt;status code='321'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;

&lt;presence
    from='darkcave@macbeth.shakespeare.lit/thirdwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
    type='unavailable'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='none' role='none'/&gt;
    &lt;status code='321'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
.
.
.
    </pre></div>
  </div>
  <div class="indent">
<h3>8.5 <a name="modifymember">Modifying the Member List</a>
</h3>
    <p class="" style="">In the context of a members-only room, the member list is essentially a "whitelist" of people who are allowed to enter the room. Anyone who is not a member is effectively banned from entering the room, even if their affiliation is not "outcast".</p>
    <p class="" style="">In the context of an open room, the member list is simply a list of users (bare JID and reserved nick) who are registered with the room. Such users may appear in a room roster, have their room nickname reserved, be returned in search results or FAQ queries, and the like.</p>
    <p class="" style="">It is RECOMMENDED that only room admins have the privilege to modify the member list in members-only rooms. To do so, the admin first requests the member list by querying the room for all users with an affiliation of "member":</p>
    <p class="caption">Example 104. Admin Requests Member List</p>
<div class="indent"><pre>
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='member3'
    to='darkcave@macbeth.shakespeare.lit'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='member'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">(A service SHOULD also return the member list to any occupant in a members-only room; i.e., it SHOULD NOT generate a &lt;forbidden/&gt; error when a member in the room requests the member list. This functionality may assist clients in showing all the existing members even if some of them are not in the room, e.g. to help a member determine if another user should be invited.)</p>
    <p class="" style="">The service MUST then return the full member list to the admin qualified by the 'http://jabber.org/protocol/muc#admin' namespace; each item MUST include the 'affiliation' and 'jid' attributes and MAY include the 'nick' and 'role' attributes for each members that is currently an occupant.</p>
    <p class="caption">Example 105. Service Sends Member List to Admin</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='member3'
    to='crone1@shakespeare.lit/desktop'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='member'
          jid='hag66@shakespeare.lit'
          nick='thirdwitch'
          role='participant'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The admin MAY then modify the member list. In order to do so, the admin MUST send the changed items (i.e., only the "delta") to the service; each item MUST include the 'affiliation' attribute (normally set to a value of "member" or "none") and 'jid' attribute but SHOULD NOT include the 'nick' attribute and MUST NOT include the 'role' attribute (which is used to manage roles such as participant rather than the member affiliation):</p>
    <p class="caption">Example 106. Admin Sends Modified Member List to Service</p>
<div class="indent"><pre>
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='member4'
    to='darkcave@macbeth.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='none'
          jid='hag66@shakespeare.lit'/&gt;
    &lt;item affiliation='member'
          jid='hecate@shakespeare.lit'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The service MUST modify the member list and then inform the moderator of success:</p>
    <p class="caption">Example 107. Service Informs Moderator of Success</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='member4'
    to='crone1@shakespeare.lit/desktop'
    type='result'/&gt;
    </pre></div>
    <p class="" style="">The service MUST change the affiliation of any affected user. If the user has been removed from the member list, the service MUST change the user's affiliation from "member" to "none". If the user has been added to the member list, the service MUST change the user's affiliation to "member".</p>
    <p class="" style="">If a removed member is currently in a members-only room, the service SHOULD kick the occupant by changing the removed member's role to "none" and send appropriate presence to the removed member as previously described. No matter whether the removed member was in or out of a members-only room, the service MUST subsequently refuse entry to the user.</p>
    <p class="" style="">For all room types, the service MUST send updated presence from this individual to all occupants, indicating the change in affiliation by including an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'affiliation' attribute set to a value of "none".</p>
    <p class="caption">Example 108. Service Sends Notice of Loss of Membership to All Occupants</p>
<div class="indent"><pre>
&lt;presence
    from='darkcave@macbeth.shakespeare.lit/thirdwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='none'
          jid='hag66@shakespeare.lit/pda'
          role='participant'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
.
.
.
    </pre></div>
    <p class="" style="">In addition, the service SHOULD send an invitation to any user who has been added to the member list of a members-only room if the user is not currently affiliated with the room, for example as an admin or owner (such a user would by definition not be in the room; note also that this example includes a password but not a reason -- both child elements are OPTIONAL):</p>
    <p class="caption">Example 109. Room Sends Invitation to New Member</p>
<div class="indent"><pre>
&lt;message
    from='darkcave@macbeth.shakespeare.lit'
    to='hecate@shakespeare.lit'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;invite from='bard@shakespeare.lit'/&gt;
    &lt;password&gt;cauldron&lt;/password&gt;
  &lt;/x&gt;
  &lt;x jid='darkcave@macbeth.shakespeare.lit'
     xmlns='jabber:x:conference'/&gt;
&lt;/message&gt;
    </pre></div>
    <p class="" style="">While only admins and owners SHOULD be allowed to modify the member list, an implementation MAY provide a configuration option that opens invitation privileges to any member of a members-only room. In such a situation, any invitation sent SHOULD automatically trigger the addition of the invitee to the member list. However, if invitation privileges are restricted to admins and a mere member attempts to a send an invitation, the service MUST deny the invitation request and return a &lt;forbidden/&gt; error to the sender:</p>
    <p class="caption">Example 110. Service Returns Error on Attempt by Mere Member to Invite Others to a Members-Only Room</p>
<div class="indent"><pre>
&lt;message
    from='darkcave@macbeth.shakespeare.lit'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;invite to='hecate@shakespeare.lit'&gt;
      &lt;reason&gt;
        Hey Hecate, this is the place for all good witches!
      &lt;/reason&gt;
    &lt;/invite&gt;
  &lt;/x&gt;
  &lt;error code='403' type='auth'&gt;
    &lt;forbidden xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/message&gt;
    </pre></div>
    <p class="" style="">Invitations sent through an open room MUST NOT trigger the addition of the invitee to the member list.</p>
    <p class="" style="">If a user is added to the member list of an open room and the user is in the room, the service MUST send updated presence from this individual to all occupants, indicating the change in affiliation by including an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'affiliation' attribute set to a value of "member".</p>
    <p class="caption">Example 111. Service Sends Notice of Membership to All Occupants</p>
<div class="indent"><pre>
&lt;presence
    from='darkcave@macbeth.shakespeare.lit/hecate'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member'
          jid='hecate@shakespeare.lit/broom'
          role='participant'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
.
.
.
    </pre></div>
  </div>
  <div class="indent">
<h3>8.6 <a name="grantmod">Granting Moderator Privileges</a>
</h3>
    <p class="" style="">An admin may want to grant moderator privileges to a participant or visitor; this is done by changing the user's role to "moderator":</p>
    <p class="caption">Example 112. Admin Grants Moderator Privileges</p>
<div class="indent"><pre>
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='mod1'
    to='darkcave@macbeth.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item nick='thirdwitch'
          role='moderator'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The service MUST add the user to the moderator list and then inform the admin of success:</p>
    <p class="caption">Example 113. Service Informs Admin of Success</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='mod1'
    to='crone1@shakespeare.lit/desktop'
    type='result'/&gt;
    </pre></div>
    <p class="" style="">The service MUST then send updated presence from this individual to all occupants, indicating the addition of moderator privileges by including an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'role' attribute set to a value of "moderator".</p>
    <p class="caption">Example 114. Service Sends Notice of Moderator Privileges to All Occupants</p>
<div class="indent"><pre>
&lt;presence
    from='darkcave@macbeth.shakespeare.lit/thirdwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member'
          jid='hag66@shakespeare.lit/pda'
          role='moderator'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
.
.
.
    </pre></div>
  </div>
  <div class="indent">
<h3>8.7 <a name="revokemod">Revoking Moderator Privileges</a>
</h3>
    <p class="" style="">An admin may want to revoke a user's moderator privileges. An admin MAY revoke moderator privileges only from a user whose affiliation is "member" or "none" (i.e., not from an owner or admin). The privilege is revoked by changing the user's role to "participant":</p>
    <p class="caption">Example 115. Admin Revokes Moderator Privileges</p>
<div class="indent"><pre>
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='mod2'
    to='darkcave@macbeth.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item nick='thirdwitch'
          role='participant'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The service MUST remove the user from the moderator list and then inform the admin of success:</p>
    <p class="caption">Example 116. Service Informs Admin of Success</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='mod2'
    to='crone1@shakespeare.lit/desktop'
    type='result'/&gt;
    </pre></div>
    <p class="" style="">The service MUST then send updated presence from this individual to all occupants, indicating the removal of moderator privileges by sending a presence element that contains an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'role' attribute set to a value of "participant".</p>
    <p class="caption">Example 117. Service Notes Loss of Moderator Privileges</p>
<div class="indent"><pre>
&lt;presence
    from='darkcave@macbeth.shakespeare.lit/thirdwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member'
          jid='hag66@shakespeare.lit/pda'
          role='participant'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
.
.
.
    </pre></div>
    <p class="" style="">As noted, an admin MUST NOT be allowed to revoke moderator privileges from a user whose affiliation is "owner" or "admin". If an admin attempts to revoke moderator privileges from such a user, the service MUST deny the request and return a &lt;not-allowed/&gt; error to the sender:</p>
    <p class="caption">Example 118. Service Returns Error on Attempt to Revoke Moderator Privileges from an Admin or Owner</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='modtest'
    to='crone1@shakespeare.lit/desktop'
    type='error'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item nick='secondwitch' role='participant'/&gt;
  &lt;/query&gt;
  &lt;error code='405' type='cancel'&gt;
    &lt;not-allowed xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
  </div>
  <div class="indent">
<h3>8.8 <a name="modifymod">Modifying the Moderator List</a>
</h3>
    <p class="" style="">An admin may want to modify the moderator list. To do so, the admin first requests the moderator list by querying the room for all users with a role of 'moderator'.</p>
    <p class="caption">Example 119. Admin Requests Moderator List</p>
<div class="indent"><pre>
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='mod3'
    to='darkcave@macbeth.shakespeare.lit'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item role='moderator'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The service MUST then return the moderator list to the admin; each item MUST include the 'jid', 'nick', and 'role' attributes and SHOULD include the 'affiliation' attribute:</p>
    <p class="caption">Example 120. Service Sends Moderator List to Admin</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='mod3'
    to='crone1@shakespeare.lit/desktop'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='member'
          jid='hag66@shakespeare.lit/pda'
          nick='thirdwitch'
          role='moderator'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The admin MAY then modify the moderator list. In order to do so, the admin MUST send the changed items (i.e., only the "delta") back to the service; each item MUST include the 'jid' attribute and 'role' attribute (normally set to a value of "member" or "participant") but SHOULD NOT include the 'nick' attribute and MUST NOT include the 'affiliation' attribute (which is used to manage affiliations such as admin rather than the moderator role):</p>
    <p class="caption">Example 121. Admin Sends Modified Moderator List to Service</p>
<div class="indent"><pre>
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='mod4'
    to='darkcave@macbeth.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item jid='hag66@shakespeare.lit/pda'
          role='participant'/&gt;
    &lt;item jid='hecate@shakespeare.lit/broom'
          role='moderator'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The service MUST modify the moderator list and then inform the admin of success:</p>
    <p class="caption">Example 122. Service Informs Admin of Success</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='mod4'
    to='crone1@shakespeare.lit/desktop'
    type='result'/&gt;
    </pre></div>
    <p class="" style="">The service MUST then send updated presence for any affected individuals to all occupants, indicating the change in moderator privileges by sending the appropriate extended presence stanzas as described in the foregoing use cases.</p>
    <p class="" style="">As noted, moderator privileges cannot be revoked from a room owner or room admin. If a room admin attempts to revoke moderator privileges from such a user by modifying the moderator list, the service MUST deny the request and return a &lt;not-allowed/&gt; error to the sender:</p>
    <p class="caption">Example 123. Service Returns Error on Attempt to Revoke Moderator Privileges from an Admin or Owner</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='modtest'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item jid='hecate@shakespeare.lit/broom'
          nick='Hecate'
          role='participant'/&gt;
  &lt;/query&gt;
  &lt;error code='405' type='cancel'&gt;
    &lt;not-allowed xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
  </div>
  <div class="indent">
<h3>8.9 <a name="regapprove">Approving Registration Requests</a>
</h3>
    <p class="" style="">If a service does not automatically accept requests to register with a room, it MAY provide a way for room admins to approve or deny registration requests over Jabber (alternatively, it could provide a web interface or some other admin tool). The simplest way to do so is for the service to send a &lt;message/&gt; stanza to the room admin(s) when the registration request is received, where the &lt;message/&gt; stanza contains a Data Form asking for approval or denial of the request. The following Data Form is RECOMMENDED but implementations MAY use a different form entirely, or supplement the following form with additional fields.</p>
    <p class="caption">Example 124. Registration Request Approval Form</p>
<div class="indent"><pre>
&lt;message from='darkcave@macbeth.shakespeare.lit'
         id='approve'
         to='crone1@shakespeare.lit/pda'&gt;
  &lt;x xmlns='jabber:x:data' type='form'&gt;
    &lt;title&gt;Registration request&lt;/title&gt;
    &lt;instructions&gt;
      To approve this registration request, select the
      &amp;quot;Allow this person to register with the room?&amp;quot;
      checkbox and click OK. To skip this request, click the 
      cancel button.
    &lt;/instructions&gt;
    &lt;field var='FORM_TYPE' type='hidden'&gt;
        &lt;value&gt;http://jabber.org/protocol/muc#register&lt;/value&gt;
    &lt;/field&gt;
    &lt;field var='muc#register_first'
           type='text-single'
           label='First Name'&gt;
      &lt;value&gt;Brunhilde&lt;/value&gt;
    &lt;/field&gt;
    &lt;field var='muc#register_last'
           type="text-single"
           label="Last Name"&gt;
      &lt;value&gt;Entwhistle-Throckmorton&lt;/value&gt;
    &lt;/field&gt;
    &lt;field var='muc#register_roomnick'
           type="text-single"
           label="Desired Nickname"&gt;
      &lt;value&gt;thirdwitch&lt;/value&gt;
    &lt;/field&gt;
    &lt;field var='muc#register_url'
           type="text-single"
           label="User URL"&gt;
      &lt;value&gt;http://witchesonline/~hag66/&lt;/value&gt;
    &lt;/field&gt;
    &lt;field var='muc#register_email'
           type="text-single"
           label="Email Address"&gt;
      &lt;value&gt;hag66@witchesonline&lt;/value&gt;
    &lt;/field&gt;
    &lt;field var='muc#register_faqentry'
           type="text-single"
           label="FAQ Entry"&gt;
      &lt;value&gt;Just another witch.&lt;/value&gt;
    &lt;/field&gt;
    &lt;field var='muc#register_allow'
           type='boolean'
           label='Allow this person to register with the room?'&gt;
      &lt;value&gt;0&lt;/value&gt;
    &lt;/field&gt;
  &lt;/x&gt;
&lt;/message&gt;
    </pre></div>
    <p class="" style="">If the admin approves the registration request, the service shall register the user with the room.</p>
    <p class="" style="">More advanced registration approval mechanisms (e.g., retrieving a list of registration requests using <span class="ref" style="">Ad-Hoc Commands</span>  [<a href="#nt-id2264223">13</a>] as is done in <span class="ref" style="">Publish-Subscribe</span>  [<a href="#nt-id2264245">14</a>]) are out of scope for this JEP.</p>
  </div>
<h2>9.
       <a name="owner">Owner Use Cases</a>
</h2>
  <p class="" style="">Every room MUST have at least one owner, and that owner (or a successor) is a long-lived attribute of the room for as long as the room exists (e.g., the owner does not lose ownership on exiting a persistent room). This JEP assumes that the (initial) room owner is the individual who creates the room and that only a room owner has the right to change defining room configuration settings such as the room type. Ideally, room owners will be able to specify not only the room types (password-protected, members-only, etc.) but also certain attributes of the room as listed in the <a href="#reqs">Requirements</a> section of this document. In addition, it would be good if an owner were able to specify the JIDs of other owners, but that shall be determined by the implementation.</p>
  <p class="" style="">In order to provide the necessary flexibility for a wide range of configuration options, Data Forms (JEP-0004) shall be used for room configuration, triggered by use of the 'http://jabber.org/protocol/muc' namespace.</p>
  <p class="" style="">Note: The configuration options shown below address all of the features and room types listed in the requirements section of this JEP; however, the exact configuration options and form layout shall be determined by the implementation or specific deployment. Also, these are examples only and are not intended to define the only allowed or required configuration options for rooms. A given implementation or deployment MAY choose to provide additional configuration options (profanity filters, setting the default language for a room, message logging, etc.), which is why the use of the 'jabber:x:data' protocol is valuable here.</p>
  <div class="indent">
<h3>9.1 <a name="createroom">Creating a Room</a>
</h3>
    <div class="indent">
<h3>9.1.1 <a name="createroom-general">General Considerations</a>
</h3>
      <p class="" style="">The privilege to create rooms MAY be restricted to certain users or may be reserved to an administrator of the service. If access is restricted and a user attempts to create a room, the service MUST return a &lt;not-allowed/&gt; error:</p>
      <p class="caption">Example 125. Service Informs User of Inability to Create a Room</p>
<div class="indent"><pre>
&lt;presence
    from='darkcave@macbeth.shakespeare.lit/thirdwitch'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;error code='405' type='cancel'&gt;
    &lt;not-allowed xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/presence&gt;
      </pre></div>
      <p class="" style="">If access is not restricted, the service MUST allow the user to create a room as described below.</p>
      <p class="" style="">From the perspective of room creation, there are in essence two kinds of rooms:</p>
      <ul>
        <li><p class="" style="">"Instant rooms" -- these are available for immediate access and are automatically created based on some default configuration.</p></li>
        <li><p class="" style="">"Reserved rooms" -- these are manually configured by the room creator before anyone is allowed to enter.</p></li>
      </ul>
      <p class="" style="">The workflow for creating and configuring such rooms is as follows:</p>
      <ol start="1" type="">
        <li><p class="" style="">The user MUST send presence to &lt;room@service/nick&gt; and signal his or her support for the Multi-User Chat protocol by including extended presence information in an empty &lt;x/&gt; child element qualified by the 'http://jabber.org/protocol/muc' namespace (note the lack of an '#owner' or '#user' fragment).</p></li>
        <li><p class="" style="">If this user is allowed to create a room and the room does not yet exist, the service MUST create the room according to some default configuration, assign the requesting user as the initial room owner, and add the owner to the room but not allow anyone else to enter the room (effectively "locking" the room). The initial presence stanza received by the owner from the room MUST include extended presence information indicating the user's status as an owner and acknowledging that the room has been created (via status code 201) and is awaiting configuration.</p></li>
        <li><p class="" style="">If the initial room owner would like to create and configure a reserved room, the room owner MUST then request a configuration form by sending an IQ stanza of type "get" to the room containing an empty &lt;query/&gt; element qualified by the 'http://jabber.org/protocol/muc#owner' namespace, then complete Steps 4 and 5. If the room owner would prefer to create an instant room, the room owner MUST send a query element qualified by the 'http://jabber.org/protocol/muc#owner' namespace and containing an empty &lt;x/&gt; element of type "submit" qualified by the 'jabber:x:data' namespace, then skip to Step 6.</p></li>
        <li><p class="" style="">If the room owner requested a configuration form, the service MUST send an IQ to the room owner containing a configuration form qualified by the 'jabber:x:data' namespace. If there are no configuration options available, the room MUST return an empty query element to the room owner.</p></li>
        <li><p class="" style="">The initial room owner SHOULD provide a starting configuration for the room (or accept the default configuration) by sending an IQ of type "set" containing the completed configuration form. Alternatively, the room owner MAY cancel the configuration process. (An implementation MAY set a timeout for initial configuration, such that if the room owner does not configure the room within the timeout period, the room owner is assumed to have accepted the default configuration or to have cancelled the configuration process.)</p></li>
        <li><p class="" style="">Once the service receives the completed configuration form from the initial room owner (or receives a request for an instant room), the service MUST "unlock" the room (i.e., allow other users to enter the room) and send an IQ of type "result" to the room owner. If the service receives a cancellation, it MUST destroy the room.</p></li>
      </ol>
      <p class="" style="">The protocol for this workflow is shown in the examples below.</p>
      <p class="" style="">First, the Jabber user MUST send presence to the room, including and empty &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc' namespace (this is the same stanza sent when seeking to enter a room).</p>
      <p class="caption">Example 126. Jabber User Creates a Room and Signals Support for Multi-User Chat</p>
<div class="indent"><pre>
&lt;presence
    from='crone1@shakespeare.lit/desktop'
    to='darkcave@macbeth.shakespeare.lit/firstwitch'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;
&lt;/presence&gt;
      </pre></div>
      <p class="" style="">If the room does not yet exist, the service SHOULD create the room (subject to local policies regarding room creation), assign the bare JID of the requesting user as the owner, add the owner to the room, and acknowledge successful creation of the room by sending a presence stanza of the following form:</p>
      <p class="caption">Example 127. Service Acknowledges Room Creation</p>
<div class="indent"><pre>
&lt;presence
    from='darkcave@macbeth.shakespeare.lit/firstwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='owner'
          role='moderator'/&gt;
    &lt;status code='201'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
      </pre></div>
      <p class="" style="">After receiving notification that the room has been created, the room owner needs to decide whether to accept the default room configuration (i.e., create an "instant room") or configure the room to have something other than the default room configuration (i.e., create a "reserved room"). The protocol flows for completing those two use cases are shown in the following sections.</p>
      <p class="" style="">Note: If the presence stanza sent to a nonexistent room does not include an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc' namespace as shown above, the service SHOULD create a default room without delay (i.e., it MUST assume that the client supports "groupchat 1.0" rather than Multi-User Chat and therefore it MUST NOT lock the room while waiting for the room creator to either accept an instant room or configure a reserved room).</p>
    </div>
    <div class="indent">
<h3>9.1.2 <a name="createroom-instant">Creating an Instant Room</a>
</h3>
      <p class="" style="">If the initial room owner wants to accept the default room configuration (i.e., create an "instant room"), the room owner MUST decline an initial configuration form by sending an IQ set to the &lt;room@service&gt; itself containing a &lt;query/&gt; element qualified by the 'http://jabber.org/protocol/muc#owner' namespace, where the only child of the &lt;query/&gt; is an empty &lt;x/&gt; element that is qualified by the 'jabber:x:data' namespace and that possesses a 'type' attribute whose value is "submit":</p>
      <p class="caption">Example 128. Owner Requests Instant Room</p>
<div class="indent"><pre>
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='create1'
    to='darkcave@macbeth.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#owner'&gt;
    &lt;x xmlns='jabber:x:data' type='submit'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
      </pre></div>
      <p class="" style="">The service MUST then unlock the room and allow other entities to join it.</p>
    </div>
    <div class="indent">
<h3>9.1.3 <a name="createroom-reserved">Creating a Reserved Room</a>
</h3>
      <p class="" style="">If the initial room owner wants to create and configure a reserved room, the room owner MUST request an initial configuration form by sending an IQ get to the &lt;room@service&gt; itself containing an empty &lt;query/&gt; element qualified by the 'http://jabber.org/protocol/muc#owner' namespace:</p>
      <p class="caption">Example 129. Owner Requests Configuration Form</p>
<div class="indent"><pre>
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='create1'
    to='darkcave@macbeth.shakespeare.lit'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#owner'/&gt;
&lt;/iq&gt;
      </pre></div>
      <p class="" style="">If the room does not already exist, the service MUST return an initial room configuration form to the user. (Note: The following example shows a representative sample of configuration options. A full list of x:data fields registered for use in room creation and configuration is maintained by the Jabber Registrar; see the <a href="#registrar">Jabber Registrar Considerations</a> section of this document.)</p>
      <p class="caption">Example 130. Service Sends Configuration Form</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='create1'
    to='crone1@shakespeare.lit/desktop'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#owner'&gt;
    &lt;x xmlns='jabber:x:data' type='form'&gt;
      &lt;title&gt;Configuration for "darkcave" Room&lt;/title&gt;
      &lt;instructions&gt;
          Your room darkcave@macbeth has been created!
          The default configuration is as follows:
            - No logging
            - No moderation
            - Up to 20 occupants
            - No password required
            - No invitation required
            - Room is not persistent
            - Only admins may change the subject
            - Presence broadcasted for all users
          To accept the default configuration, click OK. To
          select a different configuration, please complete
          this form.
      &lt;/instructions&gt;
      &lt;field
          type='hidden'
          var='FORM_TYPE'&gt;
        &lt;value&gt;http://jabber.org/protocol/muc#roomconfig&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Natural-Language Room Name'
          type='text-single'
          var='muc#roomconfig_roomname'/&gt;
      &lt;field
          label='Short Description of Room'
          type='text-single'
          var='muc#roomconfig_roomdesc'/&gt;
      &lt;field
          label='Natural Language for Room Discussions'
          type='text-single'
          var='muc#roomconfig_lang'/&gt;
      &lt;field
          label='Enable Logging?'
          type='boolean'
          var='muc#roomconfig_enablelogging'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Allow Occupants to Change Subject?'
          type='boolean'
          var='muc#roomconfig_changesubject'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Allow Occupants to Invite Others?'
          type='boolean'
          var='muc#roomconfig_allowinvites'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Maximum Number of Occupants'
          type='list-single'
          var='muc#roomconfig_maxusers'&gt;
        &lt;value&gt;20&lt;/value&gt;
        &lt;option label='10'&gt;&lt;value&gt;10&lt;/value&gt;&lt;/option&gt;
        &lt;option label='20'&gt;&lt;value&gt;20&lt;/value&gt;&lt;/option&gt;
        &lt;option label='30'&gt;&lt;value&gt;30&lt;/value&gt;&lt;/option&gt;
        &lt;option label='50'&gt;&lt;value&gt;50&lt;/value&gt;&lt;/option&gt;
        &lt;option label='100'&gt;&lt;value&gt;100&lt;/value&gt;&lt;/option&gt;
        &lt;option label='None'&gt;&lt;value&gt;none&lt;/value&gt;&lt;/option&gt;
      &lt;/field&gt;
      &lt;field
          label='Roles for which Presence is Broadcast'
          type='list-multi'
          var='muc#roomconfig_presencebroadcast'&gt;
        &lt;value&gt;moderator&lt;/value&gt;
        &lt;value&gt;participant&lt;/value&gt;
        &lt;value&gt;visitor&lt;/value&gt;
        &lt;option label='Moderator'&gt;&lt;value&gt;moderator&lt;/value&gt;&lt;/option&gt;
        &lt;option label='Participant'&gt;&lt;value&gt;participant&lt;/value&gt;&lt;/option&gt;
        &lt;option label='Visitor'&gt;&lt;value&gt;visitor&lt;/value&gt;&lt;/option&gt;
      &lt;/field&gt;
      &lt;field
          label='Make Room Publicly Searchable?'
          type='boolean'
          var='muc#roomconfig_publicroom'&gt;
        &lt;value&gt;1&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Make Room Persistent?'
          type='boolean'
          var='muc#roomconfig_persistentroom'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Make Room Moderated?'
          type='boolean'
          var='muc#roomconfig_moderatedroom'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Make Room Members-Only?'
          type='boolean'
          var='muc#roomconfig_membersonly'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Password Required to Enter?'
          type='boolean'
          var='muc#roomconfig_passwordprotectedroom'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field type='fixed'&gt;
        &lt;value&gt;
          If a password is required to enter this room,
          you must specify the password below.
        &lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Password'
          type='text-private'
          var='muc#roomconfig_roomsecret'/&gt;
      &lt;field
          label='Who May Discover Real JIDs?'
          type='list-single'
          var='muc#roomconfig_whois'&gt;
        &lt;option label='Moderators Only'&gt;
          &lt;value&gt;moderators&lt;/value&gt;
        &lt;/option&gt;
        &lt;option label='Anyone'&gt;
          &lt;value&gt;anyone&lt;/value&gt;
        &lt;/option&gt;
      &lt;/field&gt;
      &lt;field type='fixed'&gt;
        &lt;value&gt;
          You may specify additional people who have
          administrative privileges in the room. Please
          provide one Jabber ID per line.
        &lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Room Admins'
          type='jid-multi'
          var='muc#roomconfig_roomadmins'/&gt;
      &lt;field type='fixed'&gt;
        &lt;value&gt;
          You may specify additional owners for this
          room. Please provide one Jabber ID per line.
        &lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Room Owners'
          type='jid-multi'
          var='muc#roomconfig_roomowners'/&gt;
    &lt;/x&gt;
  &lt;/query&gt;
&lt;/iq&gt;
      </pre></div>
      <p class="" style="">If there are no configuration options available, the service MUST return an empty query element to the room owner:</p>
      <p class="caption">Example 131. Service Informs Owner that No Configuration is Possible</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='create1'
    to='crone1@shakespeare.lit/desktop'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#owner'/&gt;
&lt;/iq&gt;
    </pre></div>
      <p class="" style="">The room owner SHOULD then fill out the form and submit it to the service.</p>
      <p class="caption">Example 132. Owner Submits Configuration Form</p>
<div class="indent"><pre>
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='create2'
    to='darkcave@macbeth.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#owner'&gt;
    &lt;x xmlns='jabber:x:data' type='submit'&gt;
      &lt;field var='FORM_TYPE'&gt;
        &lt;value&gt;http://jabber.org/protocol/muc#roomconfig&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roomconfig_roomname'&gt;
        &lt;value&gt;A Dark Cave&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roomconfig_roomdesc'&gt;
        &lt;value&gt;The place for all good witches!&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roomconfig_enablelogging'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roomconfig_changesubject'&gt;
        &lt;value&gt;1&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roomconfig_allowinvites'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roomconfig_maxusers'&gt;
        &lt;value&gt;10&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roomconfig_publicroom'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roomconfig_persistentroom'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roomconfig_moderatedroom'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roomconfig_membersonly'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roomconfig_passwordprotectedroom'&gt;
        &lt;value&gt;1&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roomconfig_roomsecret'&gt;
        &lt;value&gt;cauldron&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roomconfig_whois'&gt;
        &lt;value&gt;moderators&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc#roomconfig_roomadmins'&gt;
        &lt;value&gt;wiccarocks@shakespeare.lit&lt;/value&gt;
        &lt;value&gt;hecate@shakespeare.lit&lt;/value&gt;
      &lt;/field&gt;
    &lt;/x&gt;
  &lt;/query&gt;
&lt;/iq&gt;
      </pre></div>
      <p class="" style="">If room creation is successful, the service MUST inform the new room owner of success:</p>
      <p class="caption">Example 133. Service Informs New Room Owner of Success</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='create2'
    to='crone1@shakespeare.lit/desktop'
    type='result'/&gt;
      </pre></div>
      <p class="" style="">Alternatively, the room owner MAY cancel the configuration process:</p>
      <p class="caption">Example 134. Owner Cancels Initial Configuration</p>
<div class="indent"><pre>
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='create2'
    to='darkcave@macbeth.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#owner'&gt;
    &lt;x xmlns='jabber:x:data' type='cancel'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
      </pre></div>
      <p class="" style="">If the room owner cancels the initial configuration, the service SHOULD destroy the room, making sure to send unavailable presence to the room owner (see the "Destroying a Room" use case for protocol details).</p>
      <p class="" style="">If the room owner becomes unavailable for any reason before submitting the form (e.g., a lost connection), the service will receive a presence stanza of type "unavailable" from the owner to the owner's &lt;room@service/nick&gt; or to &lt;room@service&gt; (or both). The service MUST then destroy the room, sending a presence stanza of type "unavailable" from the room to the owner including a &lt;destroy/&gt; element and reason (if provided) as defined in the <a href="#destroyroom">Destroying a Room</a> section of this document.</p>
    </div>
  </div>
  <div class="indent">
<h3>9.2 <a name="roomconfig">Subsequent Room Configuration</a>
</h3>
    <p class="" style="">At any time after specifying the initial configuration of the room, a room owner may want to change the configuration. In order to initiate this process, a room owner MUST request a new configuration form from the room by sending an IQ to &lt;room@service&gt; containing an empty &lt;query/&gt; element qualified by the 'http://jabber.org/protocol/muc#owner' namespace.</p>
    <p class="caption">Example 135. Owner Requests Configuration Form</p>
<div class="indent"><pre>
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='config1'
    to='darkcave@macbeth.shakespeare.lit'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#owner'/&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">If the &lt;user@host&gt; of the 'from' address does not match the bare JID of a room owner, the service MUST return a &lt;forbidden/&gt; error to the sender:</p>
    <p class="caption">Example 136. Service Denies Configuration Access to Non-Owner</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='configures'
    to='wiccarocks@shakespeare.lit/laptop'
    type='error'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#owner'/&gt;
  &lt;error code='403' type='auth'&gt;
    &lt;forbidden xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">Otherwise, the service MUST send a configuration form to the room owner with the current options set as defaults:</p>
    <p class="caption">Example 137. Service Sends Configuration Form to Owner</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='config1'
    to='crone1@shakespeare.lit/desktop'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#owner'&gt;
    &lt;x xmlns='jabber:x:data' type='form'&gt;
      &lt;title&gt;Configuration for "darkcave" Room&lt;/title&gt;
      &lt;instructions&gt;
        Complete this form to make changes to
        the configuration of your room.
      &lt;/instructions&gt;
      &lt;field
          type='hidden'
          var='FORM_TYPE'&gt;
        &lt;value&gt;http://jabber.org/protocol/muc#roomconfig&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Natural-Language Room Name'
          type='text-single'
          var='muc#roomconfig_roomname'&gt;
        &lt;value&gt;A Dark Cave&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Short Description of Room'
          type='text-single'
          var='muc#roomconfig_roomdesc'&gt;
        &lt;value&gt;The place for all good witches!&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Enable Logging?'
          type='boolean'
          var='muc#roomconfig_enablelogging'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Allow Occupants to Change Subject?'
          type='boolean'
          var='muc#roomconfig_changesubject'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Allow Occupants to Invite Others?'
          type='boolean'
          var='muc#roomconfig_allowinvites'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Maximum Number of Occupants'
          type='list-single'
          var='muc#roomconfig_maxusers'&gt;
        &lt;value&gt;10&lt;/value&gt;
        &lt;option label='10'&gt;&lt;value&gt;10&lt;/value&gt;&lt;/option&gt;
        &lt;option label='20'&gt;&lt;value&gt;20&lt;/value&gt;&lt;/option&gt;
        &lt;option label='30'&gt;&lt;value&gt;30&lt;/value&gt;&lt;/option&gt;
        &lt;option label='50'&gt;&lt;value&gt;50&lt;/value&gt;&lt;/option&gt;
        &lt;option label='100'&gt;&lt;value&gt;100&lt;/value&gt;&lt;/option&gt;
        &lt;option label='None'&gt;&lt;value&gt;none&lt;/value&gt;&lt;/option&gt;
      &lt;/field&gt;
      &lt;field
          label='Roles for which Presence is Broadcast'
          type='list-multi'
          var='muc#roomconfig_presencebroadcast'&gt;
        &lt;value&gt;moderator&lt;/value&gt;
        &lt;value&gt;participant&lt;/value&gt;
        &lt;value&gt;visitor&lt;/value&gt;
        &lt;option label='Moderator'&gt;&lt;value&gt;moderator&lt;/value&gt;&lt;/option&gt;
        &lt;option label='Participant'&gt;&lt;value&gt;participant&lt;/value&gt;&lt;/option&gt;
        &lt;option label='Visitor'&gt;&lt;value&gt;visitor&lt;/value&gt;&lt;/option&gt;
      &lt;/field&gt;
      &lt;field
          label='Make Room Publicly Searchable?'
          type='boolean'
          var='muc#roomconfig_publicroom'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Make Room Persistent?'
          type='boolean'
          var='muc#roomconfig_persistentroom'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Make Room Moderated?'
          type='boolean'
          var='muc#roomconfig_moderatedroom'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Make Room Members Only?'
          type='boolean'
          var='muc#roomconfig_membersonly'&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Password Required for Entry?'
          type='boolean'
          var='muc#roomconfig_passwordprotectedroom'&gt;
        &lt;value&gt;1&lt;/value&gt;
      &lt;/field&gt;
      &lt;field type='fixed'&gt;
        &lt;value&gt;
          If a password is required to enter this room,
          you must specify the password below.
        &lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Password'
          type='text-private'
          var='muc#roomconfig_roomsecret'&gt;
        &lt;value&gt;cauldron&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Who May Discover Real JIDs?'
          type='list-single'
          var='muc#roomconfig_whois'&gt;
        &lt;value&gt;moderators&lt;/value&gt;
        &lt;option label='Moderators Only'&gt;
          &lt;value&gt;moderators&lt;/value&gt;
        &lt;/option&gt;
        &lt;option label='Anyone'&gt;
          &lt;value&gt;anyone&lt;/value&gt;
        &lt;/option&gt;
      &lt;/field&gt;
      &lt;field type='fixed'&gt;
        &lt;value&gt;
          You may specify additional people who have
          administrative privileges in the room. Please
          provide one Jabber ID per line.
        &lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Room Admins'
          type='jid-multi'
          var='muc#roomconfig_roomadmins'&gt;
        &lt;value&gt;wiccarocks@shakespeare.lit&lt;/value&gt;
        &lt;value&gt;hecate@shakespeare.lit&lt;/value&gt;
      &lt;/field&gt;
      &lt;field type='fixed'&gt;
        &lt;value&gt;
          You may specify additional owners for this
          room. Please provide one Jabber ID per line.
        &lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          label='Room Owners'
          type='jid-multi'
          var='muc#roomconfig_roomowners'/&gt;
    &lt;/x&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">If there are no configuration options available, the service MUST return an empty query element to the room owner as shown in the previous use case.</p>
    <p class="" style="">The room owner SHOULD then submit the form with updated configuration information.</p>
    <p class="" style="">Alternatively, the room owner MAY cancel the configuration process:</p>
    <p class="caption">Example 138. Owner Cancels Subsequent Configuration</p>
<div class="indent"><pre>
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='config2'
    to='darkcave@macbeth.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#owner'&gt;
    &lt;x xmlns='jabber:x:data' type='cancel'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">If the room owner cancels the subsequent configuration, the service MUST leave the configuration of the room as it was before the room owner initiated the subsequent configuration process.</p>
    <p class="" style="">If as a result of a change in the room configuration a room admin loses administrative privileges while the admin is in the room, the room MUST send updated presence for that individual to all occupants, denoting the change in status by including an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'affiliation' attribute set to a value of "member" and the 'role' attribute set to a value of "participant" or "visitor" as appropriate for the affiliation level and the room type:</p>
    <p class="caption">Example 139. Service Notes Loss of Admin Affiliation</p>
<div class="indent"><pre>
&lt;presence
    from='darkcave@macbeth.shakespeare.lit/secondwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member'
          jid='wiccarocks@shakespeare.lit/laptop'
          role='participant'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
.
.
.
    </pre></div>
    <p class="" style="">If as a result of a change in the room configuration a user gains administrative privileges while the user is in the room, the room MUST send updated presence for that individual to all occupants, denoting the change in status by including an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'affiliation' attribute set to a value of "admin" and the 'role' attribute set to a value of "admin":</p>
    <p class="caption">Example 140. Service Notes Gain of Admin Affiliation to All Users</p>
<div class="indent"><pre>
&lt;presence
    from='darkcave@macbeth.shakespeare.lit/secondwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='admin'
          jid='wiccarocks@shakespeare.lit/laptop'
          role='moderator'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
.
.
.
    </pre></div>
    <p class="" style="">If as a result of a change in the room configuration a room owner loses owner privileges while that owner is in the room, the room MUST send updated presence for that individual to all occupants, denoting the change in status by including an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'affiliation' attribute set to a value of "admin" and the 'role' attribute set to a value of "moderator":</p>
    <p class="caption">Example 141. Service Notes Loss of Owner Affiliation</p>
<div class="indent"><pre>
&lt;presence
    from='darkcave@macbeth.shakespeare.lit/secondwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='admin'
          jid='wiccarocks@shakespeare.lit/laptop'
          role='moderator'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
.
.
.
    </pre></div>
    <p class="" style="">A service MUST NOT allow an owner to revoke his or her own ownership privileges if there are no other owners; if an owner attempts to do this, the service MUST return a &lt;conflict/&gt; error to the owner. However, a service SHOULD allow an owner to revoke his or her own ownership privileges if there are other owners.</p>
    <p class="" style="">If as a result of a change in the room configuration a user gains ownership privileges while the user is in the room, the room MUST send updated presence for that individual to all occupants, denoting the change in status by including an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'affiliation' attribute set to a value of "owner" and the 'role' attribute set to a value of 'moderator'.</p>
    <p class="caption">Example 142. Service Notes Gain of Owner Affiliation to All Users</p>
<div class="indent"><pre>
&lt;presence
    from='darkcave@macbeth.shakespeare.lit/secondwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='owner'
          jid='wiccarocks@shakespeare.lit/laptop'
          role='moderator'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
.
.
.
    </pre></div>
    <p class="" style="">If as a result of a change in the room configuration the room type is changed to members-only but there are non-members in the room, the service MUST remove any non-members from the room and include a status code of 322 in the presence unavailable stanzas sent to those users as well as any remaining occupants.</p>
  </div>
  <div class="indent">
<h3>9.3 <a name="grantowner">Granting Ownership Privileges</a>
</h3>
    <p class="" style="">If allowed by an implementation, an owner MAY grant ownership privileges to another user; this is done by changing the user's affiliation to "owner":</p>
    <p class="caption">Example 143. Owner Grants Ownership Privileges</p>
<div class="indent"><pre>
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='owner1'
    to='darkcave@macbeth.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='owner'
          jid='hecate@shakespeare.lit'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The service MUST add the user to the owner list and then inform the owner of success:</p>
    <p class="caption">Example 144. Service Informs Owner of Success</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='owner1'
    to='crone1@shakespeare.lit/desktop'
    type='result'/&gt;
    </pre></div>
    <p class="" style="">If the user is in the room, the service MUST then send updated presence from this individual to all occupants, indicating the granting of ownership privileges by including an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'affiliation' attribute set to a value of "owner" and the 'role' attribute set to a value of "moderator".</p>
    <p class="caption">Example 145. Service Sends Notice of Ownership Privileges to All Occupants</p>
<div class="indent"><pre>
&lt;presence
    from='darkcave@macbeth.shakespeare.lit/hecate'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='owner'
          jid='hecate@shakespeare.lit/broom'
          role='moderator'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
.
.
.
    </pre></div>
  </div>
  <div class="indent">
<h3>9.4 <a name="revokeowner">Revoking Ownership Privileges</a>
</h3>
    <p class="" style="">An implementation MAY allow an owner to revoke another user's ownership privileges; this is done by changing the user's affiliation to something other than "owner":</p>
    <p class="caption">Example 146. Owner Revokes Ownership Privileges</p>
<div class="indent"><pre>
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='owner2'
    to='darkcave@macbeth.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='admin'
          jid='hecate@shakespeare.lit'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">A service MUST NOT allow an owner to revoke his or her own ownership privileges if there are no other owners; if an owner attempts to do this, the service MUST return a &lt;conflict/&gt; error to the owner. However, a service SHOULD allow an owner to revoke his or her own ownership privileges if there are other owners.</p>
    <p class="" style="">If an implementation does not allow one owner to revoke another user's ownership privileges, the implementation MUST return a &lt;not-authorized/&gt; error to the owner who made the request.</p>
    <p class="" style="">In all other cases, the service MUST remove the user from the owner list and then inform the owner of success:</p>
    <p class="caption">Example 147. Service Informs Owner of Success</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='owner2'
    to='crone1@shakespeare.lit/desktop'
    type='result'/&gt;
    </pre></div>
    <p class="" style="">If the user is in the room, the service MUST then send updated presence from this individual to all occupants, indicating the loss of ownership privileges by sending a presence element that contains an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'affiliation' attribute set to a value other than "owner" and the 'role' attribute set to an appropriate value:</p>
    <p class="caption">Example 148. Service Notes Loss of Owner Affiliation</p>
<div class="indent"><pre>
&lt;presence
    from='darkcave@macbeth.shakespeare.lit/secondwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='admin'
          jid='hecate@shakespeare.lit/broom'
          role='moderator'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
.
.
.
    </pre></div>
    <p class="" style="">Note: Allowing an owner to remove another user's ownership privileges can compromise the control model for room management; therefore this feature is OPTIONAL, and implementations are encouraged to support owner removal through an interface that is open only to individuals with service-wide administrative privileges.</p>
  </div>
  <div class="indent">
<h3>9.5 <a name="modifyowner">Modifying the Owner List</a>
</h3>
    <p class="" style="">If allowed by an implementation, a room owner may want to modify the owner list. To do so, the owner first requests the owner list by querying the room for all users with an affiliation of 'owner'.</p>
    <p class="caption">Example 149. Owner Requests Owner List</p>
<div class="indent"><pre>
&lt;iq from='bard@shakespeare.lit/globe'
    id='owner3'
    to='darkcave@macbeth.shakespeare.lit'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='owner'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">If the &lt;user@host&gt; of the 'from' address does not match the bare JID of a room owner, the service MUST return a &lt;forbidden/&gt; error to the sender.</p>
    <p class="" style="">Otherwise, the service MUST then return the owner list to the owner; each item MUST include the 'affiliation' and 'jid' attributes and MAY include the 'nick' and 'role' attributes for any owner that is currently an occupant:</p>
    <p class="caption">Example 150. Service Sends Owner List to Owner</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='owner3'
    to='bard@shakespeare.lit/globe'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='owner'
          jid='crone1@shakespeare.lit'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The owner MAY then modify the owner list. In order to do so, the owner MUST send the changed items (i.e., only the "delta") back to the service;  [<a href="#nt-id2265574">15</a>] each item MUST include the 'affiliation' and 'jid' attributes but SHOULD NOT include the 'nick' attribute and MUST NOT include the 'role' attribute (which is used to manage roles such as participant rather than the owner affiliation):</p>
    <p class="caption">Example 151. Owner Sends Modified Owner List to Service</p>
<div class="indent"><pre>
&lt;iq from='bard@shakespeare.lit/globe'
    id='owner4'
    to='darkcave@macbeth.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='owner'
          jid='hecate@shakespeare.lit'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">Only owners shall be allowed to modify the owner list. If a non-owner attempts to view or modify the owner list, the service MUST deny the request and return a &lt;forbidden/&gt; error to the sender:</p>
    <p class="caption">Example 152. Service Returns Error on Attempt by Non-Owner to Modify Owner List</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='ownertest'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='owner' 
          jid='hecate@shakespeare.lit'/&gt;
  &lt;/query&gt;
  &lt;error code='403' type='auth'&gt;
    &lt;forbidden xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">A service MUST NOT allow an owner to revoke his or her own ownership privileges if there are no other owners; if an owner attempts to do this, the service MUST return a &lt;conflict/&gt; error to the owner. However, a service SHOULD allow an owner to revoke his or her own ownership privileges if there are other owners.</p>
    <p class="" style="">In all other cases, the service MUST modify owner list and then inform the owner of success:</p>
    <p class="caption">Example 153. Service Informs Owner of Success</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='owner4'
    to='crone1@shakespeare.lit/desktop'
    type='result'/&gt;
    </pre></div>
    <p class="" style="">The service MUST also send presence notifications related to any affiliation changes that result from modifying the owner list as previously described.</p>
  </div>
  <div class="indent">
<h3>9.6 <a name="grantadmin">Granting Administrative Privileges</a>
</h3>
    <p class="" style="">An owner can grant administrative privileges to a member or unaffiliated user; this is done by changing the user's affiliation to "admin":</p>
    <p class="caption">Example 154. Owner Grants Admin Privileges</p>
<div class="indent"><pre>
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='admin1'
    to='darkcave@macbeth.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='admin'
          jid='wiccarocks@shakespeare.lit'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The service MUST add the user to the admin list and then inform the owner of success:</p>
    <p class="caption">Example 155. Service Informs Owner of Success</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='admin1'
    to='crone1@shakespeare.lit/desktop'
    type='result'/&gt;
    </pre></div>
    <p class="" style="">If the user is in the room, the service MUST then send updated presence from this individual to all occupants, indicating the granting of administrative privileges by including an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'affiliation' attribute set to a value of "admin" and the 'role' attribute set to a value of "moderator".</p>
    <p class="caption">Example 156. Service Sends Notice of Administrative Privileges to All Occupants</p>
<div class="indent"><pre>
&lt;presence
    from='darkcave@macbeth.shakespeare.lit/secondwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='admin'
          jid='wiccarocks@shakespeare.lit/laptop'
          role='moderator'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
.
.
.
    </pre></div>
  </div>
  <div class="indent">
<h3>9.7 <a name="revokeadmin">Revoking Administrative Privileges</a>
</h3>
    <p class="" style="">An owner may want to revoke a user's administrative privileges; this is done by changing the user's affiliation to something other than "admin" or "owner":</p>
    <p class="caption">Example 157. Owner Revokes Administrative Privileges</p>
<div class="indent"><pre>
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='admin2'
    to='darkcave@macbeth.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='member'
          nick='secondwitch'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The service MUST remove the user from the admin list and then inform the owner of success:</p>
    <p class="caption">Example 158. Service Informs Owner of Success</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='admin2'
    to='crone1@shakespeare.lit/desktop'
    type='result'/&gt;
    </pre></div>
    <p class="" style="">The service MUST then send updated presence from this individual to all occupants, indicating the loss of administrative privileges by sending a presence element that contains an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child with the 'affiliation' attribute set to a value other than "admin" or "owner" and the 'role' attribute set to an appropriate value given the affiliation level and the room type:</p>
    <p class="caption">Example 159. Service Notes Loss of Admin Affiliation</p>
<div class="indent"><pre>
&lt;presence
    from='darkcave@macbeth.shakespeare.lit/secondwitch'
    to='crone1@shakespeare.lit/desktop'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='member'
          jid='wiccarocks@shakespeare.lit/laptop'
          role='participant'/&gt;
  &lt;/x&gt;
&lt;/presence&gt;
.
.
.
    </pre></div>
  </div>
  <div class="indent">
<h3>9.8 <a name="modifyadmin">Modifying the Admin List</a>
</h3>
    <p class="" style="">A room owner may want to modify the admin list. To do so, the owner first requests the admin list by querying the room for all users with an affiliation of 'admin'.</p>
    <p class="caption">Example 160. Owner Requests Admin List</p>
<div class="indent"><pre>
&lt;iq from='bard@shakespeare.lit/desktopaffiliation
    id='admin3'
    to='darkcave@macbeth.shakespeare.lit'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='admin'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">If the &lt;user@host&gt; of the 'from' address does not match the bare JID of a room owner, the service MUST return a &lt;forbidden/&gt; error to the sender.</p>
    <p class="" style="">Otherwise, the service MUST then return the admin list to the owner; each item MUST include the 'affiliation' and 'jid' attributes and MAY include the 'nick' and 'role' attributes for any admin that is currently an occupant:</p>
    <p class="caption">Example 161. Service Sends Admin List to Owner</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='admin3'
    to='bard@shakespeare.lit/globe'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='admin'
          jid='wiccarocks@shakespeare.lit'
          nick='secondwitch'/&gt;
    &lt;item affiliation='admin'
          jid='hag66@shakespeare.lit'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The owner MAY then modify the admin list. In order to do so, the owner MUST send the changed items (i.e., only the "delta") back to the service;  [<a href="#nt-id2265898">16</a>] each item MUST include the 'affiliation' attribute (normally set to a value of "admin" or "none") and 'jid' attribute but SHOULD NOT include the 'nick' attribute and MUST NOT include the 'role' attribute (which is used to manage roles such as participant rather than the admin affiliation):</p>
    <p class="caption">Example 162. Owner Sends Modified Admin List to Service</p>
<div class="indent"><pre>
&lt;iq from='bard@shakespeare.lit/globe'
    id='admin4'
    to='darkcave@macbeth.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='none'
          jid='hag66@shakespeare.lit'&gt;
    &lt;/item&gt;
    &lt;item affiliation='admin'
          jid='hecate@shakespeare.lit'&gt;
    &lt;/item&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">Only owners shall be allowed to modify the admin list. If a non-owner attempts to view or modify the admin list, the service MUST deny the request and return a &lt;forbidden/&gt; error to the sender:</p>
    <p class="caption">Example 163. Service Returns Error on Attempt by Non-Owner to Modify Admin List</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='admintest'
    to='hag66@shakespeare.lit/pda'
    type='error'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='admin' 
          jid='hecate@shakespeare.lit'/&gt;
  &lt;/query&gt;
  &lt;error code='403' type='auth'&gt;
    &lt;forbidden xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">Otherwise, the service MUST modify the admin list and then inform the owner of success:</p>
    <p class="caption">Example 164. Service Informs Owner of Success</p>
<div class="indent"><pre>
&lt;iq from='darkcave@macbeth.shakespeare.lit'
    id='admin4'
    to='crone1@shakespeare.lit/desktop'
    type='result'/&gt;
    </pre></div>
    <p class="" style="">The service MUST also send presence notifications related to any affiliation changes that result from modifying the admin list as previously described.</p>
  </div>
  <div class="indent">
<h3>9.9 <a name="destroyroom">Destroying a Room</a>
</h3>
    <p class="" style="">A room owner MUST be able to destroy a room, especially if the room is persistent. The workflow is as follows:</p>
    <ol start="1" type="">
      <li><p class="" style="">The room owner requests that the room be destroyed, specifying a reason and an alternate venue if desired.</p></li>
      <li><p class="" style="">The room removes all users from the room (including appropriate information about the alternate location and the reason for being removed) and destroys the room, even if it was defined as persistent.</p></li>
    </ol>
    <p class="" style="">Other than the foregoing, this JEP does not specify what (if anything) a MUC service implementation shall do as a result of a room destruction request. For example, if the room was defined as persistent, an implementation MAY choose to lock the room ID so that it cannot be re-used, redirect enter requests to the alternate venue, or invite the current participants to the new room; however, such behavior is OPTIONAL.</p>
    <p class="" style="">In order to destroy a room, the room owner MUST send an IQ set to the address of the room to be destroyed. The &lt;iq/&gt; stanza shall contain a &lt;query/&gt; element qualified by the 'http://jabber.org/protocol/muc#owner' namespace, which in turn shall contain a &lt;destroy/&gt; element. The address of the alternate venue MAY be provided as the value of the &lt;destroy/&gt; element's 'jid' attribute. A password for the alternate venue MAY be provided as the XML character data of a &lt;password/&gt; child element of the &lt;destroy/&gt; element. The reason for the room destruction MAY be provided as the XML character data of a &lt;reason/&gt; child element of the &lt;destroy/&gt; element.</p>
    <p class="" style="">The following examples illustrate the protocol elements to be sent and received:</p>
    <p class="caption">Example 165. Owner Submits Room Destruction Request</p>
<div class="indent"><pre>
&lt;iq from='crone1@shakespeare.lit/desktop'
    id='begone'
    to='heath@macbeth.shakespeare.lit'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#owner'&gt;
    &lt;destroy jid='darkcave@macbeth.shakespeare.lit'&gt;
      &lt;reason&gt;Macbeth doth come.&lt;/reason&gt;
    &lt;/destroy&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The service is responsible for removing all the occupants. It SHOULD NOT broadcast presence stanzas of type "unavailable" from all occupants, instead sending only one presence stanza of type "unavailable" to each occupant so that the user knows he or she has been removed from the room. If extended presence information specifying the JID of an alternate location and the reason for the room destruction was provided by the room owner, the presence stanza MUST include that information.</p>
    <p class="caption">Example 166. Service Removes Each Occupant</p>
<div class="indent"><pre>
&lt;presence
    from='heath@macbeth.shakespeare.lit/firstwitch'
    to='crone1@shakespeare.lit/desktop'
    type='unavailable'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='none' role='none'/&gt;
    &lt;destroy jid='darkcave@macbeth.shakespeare.lit'&gt;
      &lt;reason&gt;Macbeth doth come.&lt;/reason&gt;
    &lt;/destroy&gt;
  &lt;/x&gt;
&lt;/presence&gt;

&lt;presence
    from='heath@macbeth.shakespeare.lit/secondwitch'
    to='wiccarocks@shakespeare.lit/laptop'
    type='unavailable'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='none' role='none'/&gt;
    &lt;destroy jid='darkcave@macbeth.shakespeare.lit'&gt;
      &lt;reason&gt;Macbeth doth come.&lt;/reason&gt;
    &lt;/destroy&gt;
  &lt;/x&gt;
&lt;/presence&gt;

&lt;presence
    from='heath@macbeth.shakespeare.lit/thirdwitch'
    to='hag66@shakespeare.lit/pda'
    type='unavailable'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;item affiliation='none' role='none'/&gt;
    &lt;destroy jid='darkcave@macbeth.shakespeare.lit'&gt;
      &lt;reason&gt;Macbeth doth come.&lt;/reason&gt;
    &lt;/destroy&gt;
  &lt;/x&gt;
&lt;/presence&gt;
    </pre></div>
    <p class="caption">Example 167. Service Informs Owner of Successful Destruction</p>
<div class="indent"><pre>
&lt;iq from='heath@macbeth.shakespeare.lit'
    id='begone'
    to='crone1@shakespeare.lit/desktop'
    type='result'/&gt;
    </pre></div>
    <p class="" style="">If the &lt;user@host&gt; of the 'from' address received on a destroy request does not match the bare JID of a room owner, the service MUST return a &lt;forbidden/&gt; error to the sender:</p>
    <p class="caption">Example 168. Service Denies Destroy Request Submitted by Non-Owner</p>
<div class="indent"><pre>
&lt;iq from='heath@macbeth.shakespeare.lit'
    id='destroytest'
    to='wiccarocks@shakespeare.lit/laptop'
    type='error'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#owner'&gt;
    &lt;destroy jid='darkcave@macbeth.shakespeare.lit'&gt;
      &lt;reason&gt;Macbeth doth come.&lt;/reason&gt;
    &lt;/destroy&gt;
  &lt;/query&gt;
  &lt;error code='403' type='auth'&gt;
    &lt;forbidden xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
  </div>
<h2>10.
       <a name="errorstatus">Error and Status Codes</a>
</h2>
  <div class="indent">
<h3>10.1 <a name="errorcodes">Error Codes</a>
</h3>
    <p class="" style="">The error codes associated with the 'http://jabber.org/protocol/muc#user' namespace are fairly straightforward, as summarized in the following table. For detailed information about mapping legacy error codes to XMPP-style error types and conditions, refer to <span class="ref" style="">Error Condition Mappings</span>  [<a href="#nt-id2266207">17</a>]; implementations SHOULD support both legacy and XMPP error handling.</p>
    <p class="caption">Table 8: Error Codes for http://jabber.org/protocol/muc#user Namespace</p>
<table border="1" cellpadding="3" cellspacing="0">
      <tr class="body">
        <th colspan="" rowspan="">Code</th>
        <th colspan="" rowspan="">Type</th>
        <th colspan="" rowspan="">Element</th>
        <th colspan="" rowspan="">Context</th>
        <th colspan="" rowspan="">Purpose</th>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">401</td>
        <td align="" colspan="" rowspan="">Error</td>
        <td align="" colspan="" rowspan="">Presence</td>
        <td align="" colspan="" rowspan="">Entering a room</td>
        <td align="" colspan="" rowspan="">Inform user that a password is required</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">403</td>
        <td align="" colspan="" rowspan="">Error</td>
        <td align="" colspan="" rowspan="">Presence</td>
        <td align="" colspan="" rowspan="">Entering a room</td>
        <td align="" colspan="" rowspan="">Inform user that he or she is banned from the room</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">404</td>
        <td align="" colspan="" rowspan="">Error</td>
        <td align="" colspan="" rowspan="">Presence</td>
        <td align="" colspan="" rowspan="">Entering a room</td>
        <td align="" colspan="" rowspan="">Inform user that the room does not exist</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">405</td>
        <td align="" colspan="" rowspan="">Error</td>
        <td align="" colspan="" rowspan="">Presence</td>
        <td align="" colspan="" rowspan="">Entering a room</td>
        <td align="" colspan="" rowspan="">Inform user that room creation is restricted</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">406</td>
        <td align="" colspan="" rowspan="">Error</td>
        <td align="" colspan="" rowspan="">Presence</td>
        <td align="" colspan="" rowspan="">Entering a room</td>
        <td align="" colspan="" rowspan="">Inform user that the reserved roomnick must be used</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">407</td>
        <td align="" colspan="" rowspan="">Error</td>
        <td align="" colspan="" rowspan="">Presence</td>
        <td align="" colspan="" rowspan="">Entering a room</td>
        <td align="" colspan="" rowspan="">Inform user that he or she is not on the member list</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">409</td>
        <td align="" colspan="" rowspan="">Error</td>
        <td align="" colspan="" rowspan="">Presence</td>
        <td align="" colspan="" rowspan="">Entering a room</td>
        <td align="" colspan="" rowspan="">Inform user that his or her desired room nickname is in use or registered by another user</td>
      </tr>
    </table>
    <p class="" style="">This JEP does not stipulate text strings (i.e., values of the XMPP &lt;text/&gt; element) associated with the foregoing error conditions.</p>
  </div>
  <div class="indent">
<h3>10.2 <a name="statuscodes">Status Codes</a>
</h3>
    <p class="" style="">Multi-User Chat uses a &lt;status/&gt; element (specifically, the 'code' attribute of the &lt;status/&gt; element) to communicate information about a user's status in a room. Over time, the number of status codes has grown quite large, and new status codes continue to be requested of the JEP author. Therefore, these codes are now documented in a registry maintained by the Jabber Registrar. For details, refer to the <a href="#registrar-statuscodes">Status Codes Registry</a> section of this document.</p>
    <p class="" style="">Note: In general, MUC status codes tend to follow the "philosophy" of status codes that is implicit in <span class="ref" style="">RFC 2616</span>  [<a href="#nt-id2266646">18</a>] and <span class="ref" style="">RFC 1893</span>  [<a href="#nt-id2266668">19</a>] (1xx codes are informational, 2xx codes specify that it is fine to continue, 3xx codes specify redirects such as being kicked or banned, x3x codes refer to system status, x7x codes refer to security or policy matters, etc.).</p>
    <p class="" style="">Note: If the MUC protocol were being designed today, it would specify a more flexible, XML-friendly approach rather than hardcoded status numbers; however, at this point the pain of changing the status reporting system would be greater than the benefit of doing so, which is why the status code numbers remain in use. A future version of this JEP may define a more XMPP-like approach to status conditions, retaining the code numbers but supplementing them with more descriptive child elements as is done in <span style="font-weight: bold">RFC 3920</span>.</p>
  </div>
<h2>11.
       <a name="i18n">Internationalization Considerations</a>
</h2>
  <p class="" style="">As specified in <span style="font-weight: bold">RFC 3920</span>, XMPP entities (including MUC rooms and MUC services) SHOULD respect the value of the 'xml:lang' attribute provided with any given stanza. However, simultaneous translation of groupchat messages is out of scope for this document.</p>
  <p class="" style="">The status and error codes defined herein enable a client implementation to present a localized interface; however, definition of the localized text strings for any given language community is out of scope for this document.</p>
<h2>12.
       <a name="security">Security Considerations</a>
</h2>
  <p class="" style="">No room entrance authentication or authorization method more secure than cleartext passwords is defined or required by this document. This is recognized to be sub-optimal.</p>
  <p class="" style="">No end-to-end message or session encryption method is specified herein.</p>
<h2>13.
       <a name="iana">IANA Considerations</a>
</h2>
  <p class="" style="">This JEP requires no interaction with the <span class="ref" style="">Internet Assigned Numbers Authority (IANA)</span>  [<a href="#nt-id2266788">20</a>].</p>
<h2>14.
       <a name="registrar">Jabber Registrar Considerations</a>
</h2>
  <p class="" style="">The <span class="ref" style="">Jabber Registrar</span>  [<a href="#nt-id2266835">21</a>] includes the following information in its registries.</p>
  <div class="indent">
<h3>14.1 <a name="registrar-protocol">Protocol Namespaces</a>
</h3>
    <p class="" style="">The Jabber Registrar includes the following MUC-related namespaces in its registry of protocol namespaces:</p>
    <ul>
      <li>http://jabber.org/protocol/muc</li>
      <li>http://jabber.org/protocol/muc#admin</li>
      <li>http://jabber.org/protocol/muc#owner</li>
      <li>http://jabber.org/protocol/muc#user</li>
    </ul>
  </div>
  <div class="indent">
<h3>14.2 <a name="registrar-discocat">Service Discovery Category/Type</a>
</h3>
    <p class="" style="">A Multi-User Chat service or room is identified by the "conference" category and the "text" type within Service Discovery.</p>
  </div>
  <div class="indent">
<h3>14.3 <a name="registrar-features">Service Discovery Features</a>
</h3>
    <p class="" style="">There are many features related to a MUC service or room that can be discovered by means of Service Discovery. The most fundamental of these is the 'http://jabber.org/protocol/muc' namespace. In addition, a MUC room SHOULD provide information about the specific room features it implements, such as password protection and room moderation.</p>
    <p class="caption">Registry Submission</p>
<div class="indent"><pre>
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/muc#register&lt;/name&gt;
  &lt;desc&gt;Support for the muc#register FORM_TYPE&lt;/desc&gt;
  &lt;doc&gt;JEP-0045&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/muc#roomconfig&lt;/name&gt;
  &lt;desc&gt;Support for the muc#roomconfig FORM_TYPE&lt;/desc&gt;
  &lt;doc&gt;JEP-0045&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/muc#roominfo&lt;/name&gt;
  &lt;desc&gt;Support for the muc#roominfo FORM_TYPE&lt;/desc&gt;
  &lt;doc&gt;JEP-0045&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;muc_hidden&lt;/name&gt;
  &lt;desc&gt;Hidden room in Multi-User Chat (MUC)&lt;/desc&gt;
  &lt;doc&gt;JEP-0045&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;muc_membersonly&lt;/name&gt;
  &lt;desc&gt;Members-only room in Multi-User Chat (MUC)&lt;/desc&gt;
  &lt;doc&gt;JEP-0045&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;muc_moderated&lt;/name&gt;
  &lt;desc&gt;Moderated room in Multi-User Chat (MUC)&lt;/desc&gt;
  &lt;doc&gt;JEP-0045&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;muc_nonanonymous&lt;/name&gt;
  &lt;desc&gt;Non-anonymous room in Multi-User Chat (MUC)&lt;/desc&gt;
  &lt;doc&gt;JEP-0045&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;muc_open&lt;/name&gt;
  &lt;desc&gt;Open room in Multi-User Chat (MUC)&lt;/desc&gt;
  &lt;doc&gt;JEP-0045&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;muc_passwordprotected&lt;/name&gt;
  &lt;desc&gt;Password-protected room in Multi-User Chat (MUC)&lt;/desc&gt;
  &lt;doc&gt;JEP-0045&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;muc_persistent&lt;/name&gt;
  &lt;desc&gt;Persistent room in Multi-User Chat (MUC)&lt;/desc&gt;
  &lt;doc&gt;JEP-0045&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;muc_public&lt;/name&gt;
  &lt;desc&gt;Public room in Multi-User Chat (MUC)&lt;/desc&gt;
  &lt;doc&gt;JEP-0045&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;muc_rooms&lt;/name&gt;
  &lt;desc&gt;List of MUC rooms (each as a separate item)&lt;/desc&gt;
  &lt;doc&gt;JEP-0045&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;muc_semianonymous&lt;/name&gt;
  &lt;desc&gt;Semi-anonymous room in Multi-User Chat (MUC)&lt;/desc&gt;
  &lt;doc&gt;JEP-0045&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;muc_temporary&lt;/name&gt;
  &lt;desc&gt;Temporary room in Multi-User Chat (MUC)&lt;/desc&gt;
  &lt;doc&gt;JEP-0045&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;muc_unmoderated&lt;/name&gt;
  &lt;desc&gt;Unmoderated room in Multi-User Chat (MUC)&lt;/desc&gt;
  &lt;doc&gt;JEP-0045&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;muc_unsecured&lt;/name&gt;
  &lt;desc&gt;Unsecured room in Multi-User Chat (MUC)&lt;/desc&gt;
  &lt;doc&gt;JEP-0045&lt;/doc&gt;
&lt;/var&gt;
    </pre></div>
  </div>
  <div class="indent">
<h3>14.4 <a name="registrar-nodes">Well-Known Service Discovery Nodes</a>
</h3>
    <p class="" style="">The well-known Service Discovery node 'http://jabber.org/protocol/muc#rooms' enables discovery of the rooms in which a user is an occupant.</p>
    <p class="" style="">The well-known Service Discovery node 'x-roomuser-item' enables a user to discover his or registered roomnick from outside the room.</p>
    <p class="" style="">The well-known Service Discovery node 'http://jabber.org/protocol/muc#traffic' enables discovery of the namespaces that are allowed in traffic sent through a room (see the <a href="#impl-service-traffic">Allowable Traffic</a> section of this document).</p>
  </div>
  <div class="indent">
<h3>14.5 <a name="registrar-formtype">Field Standardization</a>
</h3>
    <p class="" style=""><span class="ref" style="">Field Standardization for Data Forms</span>  [<a href="#nt-id2267032">22</a>] defines a process for standardizing the fields used within Data Forms qualified by a particular namespace. Within MUC, there are three uses of such forms: room registration within muc#user, room configuration within muc#owner, and service discovery extensions for room information. The reserved fields are defined below.</p>
    <div class="indent">
<h3>14.5.1 <a name="registrar-formtype-register">muc#register FORM_TYPE</a>
</h3>
      <p class="caption">Registry Submission</p>
<div class="indent"><pre>
&lt;form_type&gt;
  &lt;name&gt;http://jabber.org/protocol/muc#register&lt;/name&gt;
  &lt;doc&gt;JEP-0045&lt;/doc&gt;
  &lt;desc&gt;
    Forms enabling user registration with a
    Multi-User Chat (MUC) room or admin approval
    of user registration requests.
  &lt;/desc&gt;
  &lt;field 
     var='muc#register_allow'
     type='boolean'
     label='Allow this person to register with the room?'/&gt;
  &lt;field
      var='muc#register_email'
      type='text-single'
      label='Email Address'/&gt;
  &lt;field
      var='muc#register_faqentry'
      type='text-multi'
      label='FAQ Entry'/&gt;
  &lt;field
      var='muc#register_first'
      type='text-single'
      label='First Name'/&gt;
  &lt;field
      var='muc#register_last'
      type='text-single'
      label='Last Name'/&gt;
  &lt;field
      var='muc#register_roomnick'
      type='text-single'
      label='Desired Nickname'/&gt;
  &lt;field
      var='muc#register_url'
      type='text-single'
      label='Your URL'/&gt;
&lt;/form_type&gt;
      </pre></div>
    </div>
    <div class="indent">
<h3>14.5.2 <a name="registrar-formtype-owner">muc#roomconfig FORM_TYPE</a>
</h3>
      <p class="caption">Registry Submission</p>
<div class="indent"><pre>
&lt;form_type&gt;
  &lt;name&gt;http://jabber.org/protocol/muc#roomconfig&lt;/name&gt;
  &lt;doc&gt;JEP-0045&lt;/doc&gt;
  &lt;desc&gt;
    Forms enabling creation and configuration of
    a Multi-User Chat (MUC) room.
  &lt;/desc&gt;
  &lt;field
      var='muc#roomconfig_allowinvites'
      type='boolean'
      label='Whether to Allow Occupants to Invite Others'/&gt;
  &lt;field
      var='muc#roomconfig_changesubject'
      type='boolean'
      label='Whether to Allow Occupants to Change Subject'/&gt;
  &lt;field
      var='muc#roomconfig_enablelogging'
      type='boolean'
      label='Whether to Enable Logging of Room Conversations'/&gt;
  &lt;field
      var='muc#roomconfig_lang'
      type='text-single'
      label='Natural Language for Room Discussions'/&gt;
  &lt;field
      var='muc#roomconfig_maxusers'
      type='list-single'
      label='Maximum Number of Room Occupants'/&gt;
  &lt;field
      var='muc#roomconfig_membersonly'
      type='boolean'
      label='Whether an Make Room Members-Only'/&gt;
  &lt;field
      var='muc#roomconfig_moderatedroom'
      type='boolean'
      label='Whether to Make Room Moderated'/&gt;
  &lt;field
      var='muc#roomconfig_passwordprotectedroom'
      type='boolean'
      label='Whether a Password is Required to Enter'/&gt;
  &lt;field
      var='muc#roomconfig_persistentroom'
      type='boolean'
      label='Whether to Make Room Persistent'/&gt;
  &lt;field
      var='muc#roomconfig_presencebroadcast'
      type='list-multi'
      label='Roles for which Presence is Broadcast'/&gt;
  &lt;field
      var='muc#roomconfig_publicroom'
      type='boolean'
      label='Whether to Allow Public Searching for Room'/&gt;
  &lt;field
      var='muc#roomconfig_roomadmins'
      type='jid-multi'
      label='Full List of Room Admins'/&gt;
  &lt;field
      var='muc#roomconfig_roomdesc'
      type='text-single'
      label='Short Description of Room'/&gt;
  &lt;field
      var='muc#roomconfig_roomname'
      type='text-single'
      label='Natural-Language Room Name'/&gt;
  &lt;field
      var='muc#roomconfig_roomowners'
      type='jid-multi'
      label='Full List of Room Owners'/&gt;
  &lt;field
      var='muc#roomconfig_roomsecret'
      type='text-private'
      label='The Room Password'/&gt;
  &lt;field
      var='muc#roomconfig_whois'
      type='list-single'
      label='Affiliations that May Discover Real JIDs of Occupants'/&gt;
&lt;/form_type&gt;
      </pre></div>
    </div>
    <div class="indent">
<h3>14.5.3 <a name="registrar-formtype-roominfo">muc#roominfo FORM_TYPE</a>
</h3>
      <p class="caption">Registry Submission</p>
<div class="indent"><pre>
&lt;form_type&gt;
  &lt;name&gt;http://jabber.org/protocol/muc#roominfo&lt;/name&gt;
  &lt;doc&gt;JEP-0045&lt;/doc&gt;
  &lt;desc&gt;
    Forms enabling the communication of extended service discovery
    information about a Multi-User Chat (MUC) room.
  &lt;/desc&gt;
  &lt;field
      var='muc#roominfo_description'
      type='text-single'
      label='Short Description of Room'/&gt;
  &lt;field
      var='muc#roominfo_lang'
      type='text-single'
      label='Natural Language for Room Discussions'/&gt;
  &lt;field
      var='muc#roominfo_occupants'
      type='text-single'
      label='Current Number of Occupants in Room'/&gt;
  &lt;field
      var='muc#roominfo_subject'
      type='text-single'
      label='Current Subject or Discussion Topic in Room'/&gt;
&lt;/form_type&gt;
      </pre></div>
    </div>
  </div>
  <div class="indent">
<h3>14.6 <a name="registrar-statuscodes">Status Codes Registry</a>
</h3>
    <div class="indent">
<h3>14.6.1 <a name="registrar-statuscodes-process">Process</a>
</h3>
      <p class="" style="">The Jabber Registrar maintains a registry of values for the 'code' attribute of the &lt;status/&gt; element when qualified by the 'http://jabber.org/protocol/muc#user' namespace.</p>
      <p class="" style="">In order to submit new values to this registry, the registrant must define an XML fragment of the following form and either include it in the relevant Jabber Enhancement Proposal or send it to the email address &lt;registrar@jabber.org&gt;:</p>
      <p class="caption"></p>
<div class="indent"><pre>
&lt;statuscode&gt;
  &lt;number&gt;the three-digit code number&lt;/number&gt;
  &lt;stanza&gt;the stanza type of which it is a child (message or presence)&lt;/desc&gt;
  &lt;context&gt;the use case or situation in which the status is used&lt;/context&gt;
  &lt;purpose&gt;a natural-language description of the meaning&lt;/purpose&gt;
  &lt;child&gt;the descriptive child element (reserved for future use)&lt;/child&gt;
&lt;/statuscode&gt;
      </pre></div>
      <p class="" style="">The registrant may register more than one status code at a time, each contained in a separate &lt;statuscode/&gt; element.</p>
    </div>
    <div class="indent">
<h3>14.6.2 <a name="registrar-statuscodes-init">Initial Submission</a>
</h3>
      <p class="" style="">As part of this document, the following status codes are registered:</p>
      <p class="caption"></p>
<div class="indent"><pre>
&lt;statuscode&gt;
  &lt;number&gt;100&lt;/number&gt;
  &lt;stanza&gt;message&lt;/stanza&gt;
  &lt;context&gt;Entering a room&lt;/context&gt;
  &lt;purpose&gt;Inform user that any occupant is allowed to see the user's full JID&lt;/purpose&gt;
&lt;/statuscode&gt;
&lt;statuscode&gt;
  &lt;number&gt;101&lt;/number&gt;
  &lt;stanza&gt;message (out of band)&lt;/stanza&gt;
  &lt;context&gt;Affiliation change&lt;/context&gt;
  &lt;purpose&gt;Inform user that his or her affiliation changed while not in the room&lt;/purpose&gt;
&lt;/statuscode&gt;
&lt;statuscode&gt;
  &lt;number&gt;102&lt;/number&gt;
  &lt;stanza&gt;message&lt;/stanza&gt;
  &lt;context&gt;Configuration change&lt;/context&gt;
  &lt;purpose&gt;Inform occupants that room now shows unavailable members&lt;/purpose&gt;
&lt;/statuscode&gt;
&lt;statuscode&gt;
  &lt;number&gt;103&lt;/number&gt;
  &lt;stanza&gt;message&lt;/stanza&gt;
  &lt;context&gt;Configuration change&lt;/context&gt;
  &lt;purpose&gt;Inform occupants that room now does not show unavailable members&lt;/purpose&gt;
&lt;/statuscode&gt;
&lt;statuscode&gt;
  &lt;number&gt;104&lt;/number&gt;
  &lt;stanza&gt;message&lt;/stanza&gt;
  &lt;context&gt;Configuration change&lt;/context&gt;
  &lt;purpose&gt;Inform occupants that some room configuration has changed&lt;/purpose&gt;
&lt;/statuscode&gt;
&lt;statuscode&gt;
  &lt;number&gt;201&lt;/number&gt;
  &lt;stanza&gt;presence&lt;/stanza&gt;
  &lt;context&gt;Entering a room&lt;/context&gt;
  &lt;purpose&gt;Inform user that a new room has been created&lt;/purpose&gt;
&lt;/statuscode&gt;
&lt;statuscode&gt;
  &lt;number&gt;301&lt;/number&gt;
  &lt;stanza&gt;presence&lt;/stanza&gt;
  &lt;context&gt;Removal from room&lt;/context&gt;
  &lt;purpose&gt;Inform user that he or she has been banned from the room&lt;/purpose&gt;
&lt;/statuscode&gt;
&lt;statuscode&gt;
  &lt;number&gt;303&lt;/number&gt;
  &lt;stanza&gt;presence&lt;/stanza&gt;
  &lt;context&gt;Exiting a room&lt;/context&gt;
  &lt;purpose&gt;Inform all occupants of new room nickname&lt;/purpose&gt;
&lt;/statuscode&gt;
&lt;statuscode&gt;
  &lt;number&gt;307&lt;/number&gt;
  &lt;stanza&gt;presence&lt;/stanza&gt;
  &lt;context&gt;Removal from room&lt;/context&gt;
  &lt;purpose&gt;Inform user that he or she has been kicked from the room&lt;/purpose&gt;
&lt;/statuscode&gt;
&lt;statuscode&gt;
  &lt;number&gt;321&lt;/number&gt;
  &lt;stanza&gt;presence&lt;/stanza&gt;
  &lt;context&gt;Removal from room&lt;/context&gt;
  &lt;purpose&gt;Inform user that he or she is being removed from the room 
    because of an affiliation change&lt;/purpose&gt;
&lt;/statuscode&gt;
&lt;statuscode&gt;
  &lt;number&gt;322&lt;/number&gt;
  &lt;stanza&gt;presence&lt;/stanza&gt;
  &lt;context&gt;Removal from room&lt;/context&gt;
  &lt;purpose&gt;Inform user that he or she is being removed from the room 
    because the room has been changed to members-only and the user 
    is not a member&lt;/purpose&gt;
&lt;/statuscode&gt;
&lt;statuscode&gt;
  &lt;number&gt;332&lt;/number&gt;
  &lt;stanza&gt;presence&lt;/stanza&gt;
  &lt;context&gt;Removal from room&lt;/context&gt;
  &lt;purpose&gt;Inform user that he or she is being removed from the room 
    because of a system shutdown&lt;/purpose&gt;
&lt;/statuscode&gt;
      </pre></div>
    </div>
  </div>
<h2>15.
       <a name="bizrules">Business Rules</a>
</h2>
  <div class="indent">
<h3>15.1 <a name="bizrules-jids">Addresses</a>
</h3>
    <p class="" style="">In order to provide consistency regarding the addresses captured in room JIDs, Room IDs MUST match the Nodeprep profile of Stringprep and Room Nicknames MUST match the Resourceprep profile of Stringprep (both of these are defined in <span style="font-weight: bold">RFC 3920</span>)).</p>
  </div>
  <div class="indent">
<h3>15.2 <a name="bizrules-message">Message</a>
</h3>
    <ol start="1" type="">
      <li><p class="" style="">If an occupant wants to send a message to all other occupants, a MUC client MUST set the 'type' attribute to a value of "groupchat". A service MAY ignore messages that are improperly typed, or reject them with a &lt;bad-request/&gt; error.</p></li>
      <li><p class="" style="">If a MUC service receives a message directed to the room or to a single occupant from a Jabber user who has a role of "none", the service MUST NOT deliver the message and SHOULD return the message to the sender with a &lt;forbidden/&gt; error.</p></li>
      <li><p class="" style="">If a MUC service receives a message directed to a room that does not exist or is not yet unlocked, the service SHOULD return the message to the sender with an &lt;item-not-found/&gt; error.</p></li>
      <li><p class="" style="">A MUC service SHOULD pass extended information (e.g., an XHTML version of the message body) through to occupants unchanged; however, a MUC service MAY disallow message specific extensions (see the <a href="#impl-service-traffic">Allowable Traffic</a> section of this document).</p></li>
      <li><p class="" style="">A MUC client MAY generate extensions that conform to the <span class="ref" style="">Message Events</span>  [<a href="#nt-id2267409">23</a>] or <span class="ref" style="">Chat State Notifications</span>  [<a href="#nt-id2267432">24</a>] specification; however, a MUC service MAY disallow these extensions (see the <a href="#impl-service-traffic">Allowable Traffic</a> section of this document).</p></li>
    </ol>
  </div>
  <div class="indent">
<h3>15.3 <a name="bizrules-presence">Presence</a>
</h3>
    <ol start="1" type="">
      <li><p class="" style="">A room MUST silently ignore unavailable presence received from a user who has a role of "none".</p></li>
      <li><p class="" style="">Only the MUC service itself SHOULD generate extended presence information about roles, affiliations, full JIDs, or status codes qualified by the 'http://jabber.org/protocol/muc#user' namespace (based on information the service knows about occupants, e.g., roles, or as a result of actions taken by a moderator or room administrator). A client SHOULD NOT presume to generate such information. If a MUC service receives such extended presence information from an occupant, it MUST NOT reflect it to other occupants. (A client MAY generate extended presence information qualified by the 'http://jabber.org/protocol/muc#user' namespace in order to supply a password, but naturally this is not reflected to other occupants.)</p></li>
      <li><p class="" style="">A MUC service SHOULD allow all other presence information to pass through, although it MAY choose to block extended presence information; see the <a href="#impl-service-traffic">Allowable Traffic</a> section of this document.</p></li>
      <li><p class="" style="">In order to appropriately inform occupants of room roles and affiliations, and to make it easier for Jabber clients to track the current state of all users in the room, MUC service implementations MUST provide extended presence information about roles and affiliations in all presence stanzas, including presence stanzas of type "unavailable" sent when a user exits the room for any reason.</p></li>
      <li><p class="" style="">If a privilege is revoked, the service MUST note that by sending an &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc#user' namespace and containing an &lt;item/&gt; child element with the 'role' and/or 'affiliation' attributes set to a value that indicates the loss of the relevant privilege. All future presence stanzas for the occupant MUST include the updated role and affiliation, until and unless they change again.</p></li>
      <li><p class="" style="">A MUC service MUST send extended presence to a client even if the client did not send an empty &lt;x/&gt; element qualified by the 'http://jabber.org/protocol/muc' namespace on entering the room; naturally, a client MUST ignore such information if it does not understand it (in accordance with <span style="font-weight: bold">RFC 3920</span>).</p></li>
      <li><p class="" style="">Extended presence about roles and affiliations sent in the muc#user namespace MUST include the full JID (not the bare JID) as the value of the 'jid' attribute.</p></li>
      <li><p class="" style="">A client MAY send a custom exit message if desired (as is often done in IRC channels) by including a &lt;status/&gt; element in the presence stanza of type "unavailable" sent when exiting a room.</p></li>
    </ol>
  </div>
  <div class="indent">
<h3>15.4 <a name="bizrules-iq">IQ</a>
</h3>
    <ol start="1" type="">
      <li><p class="" style="">If an occupant wants to send an IQ stanza to another user in a non-anonymous room, the sender SHOULD send the request directly to the recipient's bare JID or full JID, rather than attempting to send the request through the room (i.e., via the recipient's room JID).</p></li>
      <li><p class="" style="">If an occupant wants to send an IQ stanza to another user in a semi-anonymous room, the sender can direct the stanza to the recipient's room JID and the service MAY forward the stanza to the recipient's real JID. However, a MUC service MUST NOT reveal the sender's real JID to the recipient at any time, nor reveal the recipient's real JID to the sender.</p></li>
      <li><p class="" style="">A MUC client MUST send only the 'affiliation' attribute or the 'role' attribute in the &lt;item/&gt; element contained within an IQ set qualified by the 'http://jabber.org/protocol/muc#admin' namespace; if a moderator, admin, or owner attempts to modify both the affiliation and role of the same item in the same IQ set, the service MUST return a &lt;bad-request/&gt; error to the sender. However, a MUC service MAY modify a role based on a change to an affiliation and thus MAY send presence updates that include both a modified role and a modified affiliation.</p></li>
      <li><p class="" style="">In IQ sets regarding roles, a MUC client MUST include the 'nick' attribute only; in IQ results regarding roles, a MUC service MUST include the 'nick', 'role', 'affiliation', and 'jid' attributes (with the value of the latter set to the user's full JID).</p></li>
      <li><p class="" style="">In IQ sets regarding affiliations, a MUC client MUST include the 'jid' attribute only (with the value set to the bare JID); in IQ results regarding affiliations, a MUC service MUST NOT include the 'role' attribute, MUST include the 'affiliation' attribute and the 'jid' attribute (with the value set to the bare JID), and SHOULD include the 'nick' attribute (except if the affiliation is "outcast", since outcasts SHOULD NOT have reserved nicknames).</p></li>
    </ol>
  </div>
<h2>16.
       <a name="impl">Implementation Notes</a>
</h2>
  <p class="" style="">The following guidelines may assist client and component developers in creating MUC implementations.</p>
  <div class="indent">
<h3>16.1 <a name="impl-service">Services</a>
</h3>
    <ol start="1" type="">
      <li><p class="" style="">In handling messages sent by visitors in a moderated room, a MUC service MAY queue each message for approval by a moderator and MAY inform the sender that the message is being held for approval; however, such behavior is OPTIONAL, and definition of a message approval protocol (e.g., using Data Forms as defined in JEP-0004) is out of scope for this JEP.</p></li>
      <li><p class="" style="">It is common for MUC services to provide in-room messages when certain events occur, such as when the subject changes, when an occupant enters or exits, or when a room is destroyed. Such messages are entirely OPTIONAL and are left up to the implementation or deployment, but if used MUST be messages of type "groupchat" sent from the room JID itself (room@service) rather than a specific occupant (&lt;room@service/nick&gt;). However, in general it is preferable for the receiving client to generate such messages based on events in the room (e.g., user entrances and exits) as well as specific status codes provided in MUC; this will help ensure correct localization of such messages.</p></li>
      <li><p class="" style="">Out of courtesy, a MUC service MAY send an out-of-room &lt;message/&gt; to an occupant who is kicked or banned, and MAY broadcast an in-room &lt;message/&gt; to all remaining occupants informing them that the occupant has been kicked or banned from the room. However, such messages are OPTIONAL, and indeed are unnecessary since the information required for a receiving client to generate such messages is communicated in the presence stanzas (specifically the status codes) sent by a MUC service.</p></li>
      <li><p class="" style="">Out of courtesy, a MUC service MAY send an out-of-room &lt;message/&gt; if a user's affiliation changes while the user is not in the room; the message SHOULD be sent from the room to the user's bare JID, MAY contain a &lt;body/&gt; element describing the affiliation change, and MUST contain a status code of 101.</p></li>
      <li><p class="" style="">There is no requirement that a MUC service shall provide special treatment for users of the older "groupchat 1.0" protocol, such as messages that contain equivalents to the extended presence information that is qualified by the 'http://jabber.org/protocol/muc#user' namespace.</p></li>
      <li><p class="" style="">Room types MAY be configured in any combination. A MUC service MAY support or allow any desired room types or combinations thereof.</p></li>
      <li><p class="" style="">A MUC service MAY limit the number of configuration options presented to an owner after initial configuration has been completed, e.g. because certain options cannot take effect without restarting the service.</p></li>
      <li><p class="" style="">A MUC service MAY provide an interface to room creation and configuration (e.g., in the form of a special Jabber user or a Web page), so that the ostensible room owner is actually the application instead of a human user.</p></li>
      <li><p class="" style="">A MUC service MAY choose to make available a special in-room resource that provides an interface to administrative functionality (e.g., a "user" named "ChatBot"), which occupants could interact with directly, thus enabling admins to type <tt>'/command parameter'</tt> in a private message to that "user". Obviously this kind of implementation would require the service to add a 'ChatBot' user to the room when it is created, and to prevent any occupant from having the nickname 'ChatBot' in the room. This might be difficult to ensure in some implementations or deployments. In any case, any such interface is OPTIONAL.</p></li>
      <li><p class="" style="">A MUC service SHOULD remove a user if the service receives a delivery-related error in relation to a stanza it has previously sent to the user (remote server unreachable, user not found, etc.).</p></li>
      <li><p class="" style="">A MUC service MAY choose to discard extended presence information that is attached to a &lt;presence/&gt; stanza before reflecting the presence change to the occupants of a room. That is, an implementation MAY choose to reflect only the &lt;show/&gt;, &lt;status/&gt;, and &lt;priority/&gt; child elements of the presence element as specified in the XML schema for the 'jabber:client' namespace, with the result that presence "changes" in extended namespaces (e.g., gabber:x:music:info) are not passed through to occupants. If a service prohibits certain extended namespaces, it SHOULD provide a description of allowable traffic at the well-known Service Discovery node 'http://jabber.org/protocol/muc#traffic' as described in the <a href="impl-service-traffic">Allowable Traffic</a> section of this document.</p></li>
      <li><p class="" style="">A MUC service MAY choose to discard extended information attached to &lt;message/&gt; stanzas before reflecting the message to the occupants of a room. An example of such extended information is the lightweight text markup specified by <span class="ref" style="">XHTML-IM</span>  [<a href="#nt-id2267963">25</a>]. If a service prohibits certain extended namespaces, it SHOULD provide a description of allowable traffic at the well-known Service Discovery node 'http://jabber.org/protocol/muc#traffic' as described in the <a href="impl-service-traffic">Allowable Traffic</a> section of this document..</p></li>
    </ol>
    <div class="indent">
<h3>16.1.1 <a name="impl-service-traffic">Allowable Traffic</a>
</h3>
      <p class="" style="">As noted, a service (more precisely, a properly-configured room) MAY discard some or all extended namespaces attached to &lt;message/&gt; and &lt;presence/&gt; stanzas that are intended for reflection from the sender through the room to all of the room occupants. If the room does so, it SHOULD enable senders to discover the list of allowable extensions by sending a disco#info query to the well-known Service Discovery node 'http://jabber.org/protocol/muc#traffic', returning one &lt;feature/&gt; element for each namespace supported in the result. If the room does not allow any extended namespaces, it MUST return an empty query as specified in JEP-0030. If the room does not support the "#traffic" node, it MUST return a &lt;feature-not-implemented/&gt; error in response to queries sent to the 'http://jabber.org/protocol/muc#traffic' node.</p>
      <p class="" style="">The following example shows a room that allows the 'http://jabber.org/protocol/xhtml-im' and 'http://jabber.org/protocol/rosterx' namespaces only, but no other extended namespaces.</p>
      <p class="caption">Example 169. User Queries Service Regarding Allowable Namespaces</p>
<div class="indent"><pre>
&lt;iq from='wiccarocks@shakespeare.lit/laptop'
    to='heath@macbeth.shakespeare.lit'
    id='allow1'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'
         node='http://jabber.org/protocol/muc#traffic'/&gt;
&lt;/iq&gt;
      </pre></div>
      <p class="caption">Example 170. Service Returns Allowable Namespaces</p>
<div class="indent"><pre>
&lt;iq from='heath@macbeth.shakespeare.lit'
    to='wiccarocks@shakespeare.lit/laptop'
    id='allow1'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'
         node='http://jabber.org/protocol/muc#traffic'&gt;
    &lt;feature var='http://jabber.org/protocol/xhtml-im'/&gt;
    &lt;feature var='http://jabber.org/protocolhttp://jabber.org/protocol//rosterx'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
      </pre></div>
    </div>
  </div>
  <div class="indent">
<h3>16.2 <a name="impl-client">Clients</a>
</h3>
    <ol start="1" type="">
      <li><p class="" style="">Jabber clients MAY present room roles by showing ad-hoc groups for each role within a room roster. This will enable occupants to clearly visualize which occupants are moderators, participants, and visitors. However, such a representation is OPTIONAL.</p></li>
      <li><p class="" style="">Jabber clients MAY implement a variety of interface styles that provide "shortcuts" to functionality such as changing one's nickname, kicking or banning users, discovering an occupant's full JID, or changing the subject. One option consists of IRC-style commands such as '/nick', '/kick', '/ban', and '/whois'; another is to enable a user to right-click items in a room roster. All such interface styles are OPTIONAL. However, for convenience, a mapping of IRC commands to MUC protocols is provided below.</p></li>
    </ol>
    <div class="indent">
<h3>16.2.1 <a name="impl-client-irc">IRC Command Mapping</a>
</h3>
      <p class="" style="">Internet Relay Chat clients use a number of common "shortcut" commands that begin with a forward slash, such as '/nick' and '/ban'. The following table provides a mapping of IRC-style commands to MUC protocols, for use by Jabber clients that wish to support such functionality.</p>
      <p class="caption">Table 9: IRC Command Mapping</p>
<table border="1" cellpadding="3" cellspacing="0">
        <tr class="body">
          <th colspan="" rowspan="">Command</th>
          <th colspan="" rowspan="">Function</th>
          <th colspan="" rowspan="">MUC protocol</th>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">/ban &lt;roomnick&gt; [comment]</td>
          <td align="" colspan="" rowspan="">bans user with that roomnick from this room (client translates roomnick to bare JID)</td>
          <td align="" colspan="" rowspan="">
<p class="caption"></p>
<div class="indent"><pre>
&lt;iq id='someid'
    to='room@service'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item affiliation='outcast'
          jid='jid-of-roomnick'&gt;
      &lt;reason&gt;comment&lt;/reason&gt;
    &lt;/item&gt;
  &lt;/query&gt;
&lt;/iq&gt;
          </pre></div>
</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">/invite &lt;jid&gt; [comment]</td>
          <td align="" colspan="" rowspan="">invites user with that JID to this room</td>
          <td align="" colspan="" rowspan="">
<p class="caption"></p>
<div class="indent"><pre>
&lt;message to='room@service'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;invite to='jid'&gt;
      &lt;reason&gt;comment&lt;/reason&gt;
    &lt;/invite&gt;
  &lt;/x&gt;
&lt;/message&gt;
          </pre></div>
</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">/join &lt;roomname&gt; [pass]</td>
          <td align="" colspan="" rowspan="">joins room on this service (roomnick is same as nick in this room)</td>
          <td align="" colspan="" rowspan="">
<p class="caption"></p>
<div class="indent"><pre>
&lt;presence to='room@service/nick'&gt;
  &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
    &lt;password&gt;pass&lt;/password&gt;
  &lt;/x&gt;
&lt;/presence&gt;
          </pre></div>
</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">/kick &lt;roomnick&gt; [comment]</td>
          <td align="" colspan="" rowspan="">kicks user with that roomnick from this room</td>
          <td align="" colspan="" rowspan="">
<p class="caption"></p>
<div class="indent"><pre>
&lt;iq id='someid'
    to='room@service'
    type='set'&gt;
  &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;
    &lt;item nick='roomnick' role='none'&gt;
      &lt;reason&gt;comment&lt;/reason&gt;
    &lt;/item&gt;
  &lt;/query&gt;
&lt;/iq&gt;
          </pre></div>
</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">/msg &lt;roomnick&gt; &lt;foo&gt;</td>
          <td align="" colspan="" rowspan="">sends private message "foo" to roomnick</td>
          <td align="" colspan="" rowspan="">
<p class="caption"></p>
<div class="indent"><pre>
&lt;message to='room@service/nick' type='chat'&gt;
  &lt;body&gt;foo&lt;/body&gt;
&lt;/message&gt;
          </pre></div>
</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">/nick &lt;newnick&gt;</td>
          <td align="" colspan="" rowspan="">changes nick in this room to "newnick"</td>
          <td align="" colspan="" rowspan="">
<p class="caption"></p>
<div class="indent"><pre>
&lt;presence to='room@service/newnick'/&gt;
          </pre></div>
</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">/part [comment]</td>
          <td align="" colspan="" rowspan="">exits this room (some IRC clients also support /leave)</td>
          <td align="" colspan="" rowspan="">
<p class="caption"></p>
<div class="indent"><pre>
&lt;presence to='room@service/nick'
          type='unavailable'&gt;
  &lt;status&gt;comment&lt;/status&gt;
&lt;/presence&gt;
          </pre></div>
</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">/topic &lt;foo&gt;</td>
          <td align="" colspan="" rowspan="">changes subject of this room to "foo"</td>
          <td align="" colspan="" rowspan="">
<p class="caption"></p>
<div class="indent"><pre>
&lt;message to='room@service' type='groupchat'&gt;
  &lt;subject&gt;foo&lt;/subject&gt;
&lt;/message&gt;
          </pre></div>
</td>
        </tr>
      </table>
      <p class="" style="">Note: Because MUC roomnicks follow the Resourceprep profile of stringprep, they are allowed to contain a space character, whereas IRC nicknames do not. Although a given client MAY support quotation characters for this purpose (resulting in commands such as '/ban "king lear" insanity is no defense'), most common quotation characters (such as " and ') are also allowed by Resourceprep, thus leading to added complexity and potential problems with quotation of roomnicks that contain both spaces and quotation characters. Therefore it is NOT RECOMMENDED for Jabber clients to support IRC-style shortcut commands with roomnicks that contain space characters.</p>
      <p class="" style="">Note: Many Jabber clients also implement a '/me ' command, where the command is followed by a verb or verb phrase (e.g., '/me laughs'). This command does not result in any MUC or IRC protocol action and is therefore not shown in the foregoing table. Instead, the message is sent as-is (e.g., &lt;body&gt;/me laughs&lt;/body&gt;) and the receiving client performs string-matching on the character data of the &lt;body/&gt; element to determine if the message begins with the string '/me '; if it does the receiving client will show the message in a special format, usually italicized text sometimes prepended by the "*" character:</p>
      <p class="" style="margin-left: 5%"><span style="font-style: italic">* stpeter laughs</span></p>
    </div>
  </div>
<h2>17.
       <a name="schemas">XML Schemas</a>
</h2>
  <div class="indent">
<h3>17.1 <a name="schemas-muc">http://jabber.org/protocol/muc</a>
</h3>
    <p class="caption"></p>
<div class="indent"><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='http://jabber.org/protocol/muc'
    xmlns='http://jabber.org/protocol/muc'
    elementFormDefault='qualified'&gt;

  &lt;xs:annotation&gt;
    &lt;xs:documentation&gt;
      The protocol documented by this schema is defined in
      JEP-0045: http://www.jabber.org/jeps/jep-0045.html
    &lt;/xs:documentation&gt;
  &lt;/xs:annotation&gt;

  &lt;xs:element name='x'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='history' minOccurs='0'/&gt;
        &lt;xs:element name='password' type='xs:string' minOccurs='0'/&gt;
      &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='history'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='maxchars' type='xs:int' use='optional'/&gt;
          &lt;xs:attribute name='maxstanzas' type='xs:int' use='optional'/&gt;
          &lt;xs:attribute name='seconds' type='xs:int' use='optional'/&gt;
          &lt;xs:attribute name='since' type='xs:dateTime' use='optional'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
    </pre></div>
  </div>
  <div class="indent">
<h3>17.2 <a name="schemas-user">http://jabber.org/protocol/muc#user</a>
</h3>
    <p class="caption"></p>
<div class="indent"><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='http://jabber.org/protocol/muc#user'
    xmlns='http://jabber.org/protocol/muc#user'
    elementFormDefault='qualified'&gt;

  &lt;xs:annotation&gt;
    &lt;xs:documentation&gt;
      The protocol documented by this schema is defined in
      JEP-0045: http://www.jabber.org/jeps/jep-0045.html
    &lt;/xs:documentation&gt;
  &lt;/xs:annotation&gt;

  &lt;xs:element name='x'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice minOccurs='0' maxOccurs='unbounded'&gt;
        &lt;xs:element ref='decline' minOccurs='0'/&gt;
        &lt;xs:element ref='destroy' minOccurs='0'/&gt;
        &lt;xs:element ref='invite' minOccurs='0' maxOccurs='unbounded'/&gt;
        &lt;xs:element ref='item' minOccurs='0'/&gt;
        &lt;xs:element name='password' type='xs:string' minOccurs='0'/&gt;
        &lt;xs:element ref='status' minOccurs='0'/&gt;
      &lt;/xs:choice&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='decline'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='reason' minOccurs='0'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='from' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='to' type='xs:string' use='optional'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='destroy'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='reason' minOccurs='0'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='jid' type='xs:string' use='optional'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='invite'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='reason' minOccurs='0'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='from' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='to' type='xs:string' use='optional'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='item'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='actor' minOccurs='0'/&gt;
        &lt;xs:element ref='reason' minOccurs='0'/&gt;
        &lt;xs:element name='continue' type='empty' minOccurs='0'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='affiliation' use='optional'&gt;
        &lt;xs:simpleType&gt;
          &lt;xs:restriction base='xs:NCName'&gt;
            &lt;xs:enumeration value='admin'/&gt;
            &lt;xs:enumeration value='member'/&gt;
            &lt;xs:enumeration value='none'/&gt;
            &lt;xs:enumeration value='outcast'/&gt;
            &lt;xs:enumeration value='owner'/&gt;
          &lt;/xs:restriction&gt;
        &lt;/xs:simpleType&gt;
      &lt;/xs:attribute&gt;
      &lt;xs:attribute name='jid' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='nick' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='role' use='optional'&gt;
        &lt;xs:simpleType&gt;
          &lt;xs:restriction base='xs:NCName'&gt;
            &lt;xs:enumeration value='moderator'/&gt;
            &lt;xs:enumeration value='none'/&gt;
            &lt;xs:enumeration value='participant'/&gt;
            &lt;xs:enumeration value='visitor'/&gt;
          &lt;/xs:restriction&gt;
        &lt;/xs:simpleType&gt;
      &lt;/xs:attribute&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='actor'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='jid' type='xs:string' use='required'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='status'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:attribute name='code' use='required'&gt;
        &lt;xs:simpleType&gt;
          &lt;xs:restriction base='xs:int'&gt;
            &lt;xs:length value='3'/&gt;
          &lt;/xs:restriction&gt;
        &lt;/xs:simpleType&gt;
      &lt;/xs:attribute&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='reason' type='xs:string'/&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
    </pre></div>
  </div>
  <div class="indent">
<h3>17.3 <a name="schemas-admin">http://jabber.org/protocol/muc#admin</a>
</h3>
    <p class="caption"></p>
<div class="indent"><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='http://jabber.org/protocol/muc#admin'
    xmlns='http://jabber.org/protocol/muc#admin'
    elementFormDefault='qualified'&gt;

  &lt;xs:annotation&gt;
    &lt;xs:documentation&gt;
      The protocol documented by this schema is defined in
      JEP-0045: http://www.jabber.org/jeps/jep-0045.html
    &lt;/xs:documentation&gt;
  &lt;/xs:annotation&gt;

  &lt;xs:element name='query'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='item' maxOccurs='unbounded'/&gt;
      &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='item'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='actor' minOccurs='0'/&gt;
        &lt;xs:element ref='reason' minOccurs='0'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='affiliation' use='optional'&gt;
        &lt;xs:simpleType&gt;
          &lt;xs:restriction base='xs:NCName'&gt;
            &lt;xs:enumeration value='admin'/&gt;
            &lt;xs:enumeration value='member'/&gt;
            &lt;xs:enumeration value='none'/&gt;
            &lt;xs:enumeration value='outcast'/&gt;
            &lt;xs:enumeration value='owner'/&gt;
          &lt;/xs:restriction&gt;
        &lt;/xs:simpleType&gt;
      &lt;/xs:attribute&gt;
      &lt;xs:attribute name='jid' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='nick' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='role' use='optional'&gt;
        &lt;xs:simpleType&gt;
          &lt;xs:restriction base='xs:NCName'&gt;
            &lt;xs:enumeration value='moderator'/&gt;
            &lt;xs:enumeration value='none'/&gt;
            &lt;xs:enumeration value='participant'/&gt;
            &lt;xs:enumeration value='visitor'/&gt;
          &lt;/xs:restriction&gt;
        &lt;/xs:simpleType&gt;
      &lt;/xs:attribute&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='actor'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='jid' type='xs:string' use='required'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='reason' type='xs:string'/&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
    </pre></div>
  </div>
  <div class="indent">
<h3>17.4 <a name="schemas-owner">http://jabber.org/protocol/muc#owner</a>
</h3>
    <p class="caption"></p>
<div class="indent"><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='http://jabber.org/protocol/muc#owner'
    xmlns='http://jabber.org/protocol/muc#owner'
    elementFormDefault='qualified'&gt;

  &lt;xs:annotation&gt;
    &lt;xs:documentation&gt;
      The protocol documented by this schema is defined in
      JEP-0045: http://www.jabber.org/jeps/jep-0045.html
    &lt;/xs:documentation&gt;
  &lt;/xs:annotation&gt;

  &lt;xs:import 
      namespace='jabber:x:data'
      schemaLocation='http://jabber.org/protocol/x-data/x-data.xsd'/&gt;

  &lt;xs:element name='query'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice xmlns:xdata='jabber:x:data' minOccurs='0'&gt;
        &lt;xs:element ref='xdata:x'/&gt;
        &lt;xs:element ref='destroy'/&gt;
      &lt;/xs:choice&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='destroy'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element name='password' type='xs:string' minOccurs='0'/&gt;
        &lt;xs:element name='reason' type='xs:string' minOccurs='0'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='jid' type='xs:string' use='optional'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
    </pre></div>
  </div>
<h2>18.
       <a name="ack">Acknowledgements</a>
</h2>
  <p class="" style="">The author would like to thank the following individuals for their many helpful comments on various drafts of this proposal: David Sutton, Peter Millard, Joe Hildebrand, Craig Kaes, Alexey Shchepin, David Waite, Jean-Louis Seguineau, Jacek Konieczny, Gaston Dombiak, and many others in the jdev@conference.jabber.org conference room and on the Standards-JIG mailing list.</p>
<p><hr></p>
<a name="notes"></a><h2>Notes</h2>
<div class="indent">
<p><a name="nt-id2250245">1</a>. RFC 1459: Internet Relay Chat &lt;<a href="http://www.ietf.org/rfc/rfc1459.txt">http://www.ietf.org/rfc/rfc1459.txt</a>&gt;.</p>
<p><a name="nt-id2256104">2</a>. <a href="http://www.jabber.org/protocol/groupchat.html">http://www.jabber.org/protocol/groupchat.html</a></p>
<p><a name="nt-id2259172">3</a>. RFC 3920: Extensible Messaging and Presence Protocol (XMPP): Core &lt;<a href="http://www.ietf.org/rfc/rfc3920.txt">http://www.ietf.org/rfc/rfc3920.txt</a>&gt;.</p>
<p><a name="nt-id2259349">4</a>. JEP-0030: Service Discovery &lt;<a href="http://www.jabber.org/jeps/jep-0030.html">http://www.jabber.org/jeps/jep-0030.html</a>&gt;.</p>
<p><a name="nt-id2259520">5</a>. JEP-0128: Service Discovery Extensions &lt;<a href="http://www.jabber.org/jeps/jep-0128.html">http://www.jabber.org/jeps/jep-0128.html</a>&gt;.</p>
<p><a name="nt-id2260620">6</a>. JEP-0091: Delayed Delivery &lt;<a href="http://www.jabber.org/jeps/jep-0091.html">http://www.jabber.org/jeps/jep-0091.html</a>&gt;.</p>
<p><a name="nt-id2260811">7</a>. JEP-0082: Jabber Date and Time Profiles &lt;<a href="http://www.jabber.org/jeps/jep-0082.html">http://www.jabber.org/jeps/jep-0082.html</a>&gt;.</p>
<p><a name="nt-id2261053">8</a>. RFC 3921: Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence &lt;<a href="http://www.ietf.org/rfc/rfc3921.txt">http://www.ietf.org/rfc/rfc3921.txt</a>&gt;.</p>
<p><a name="nt-id2262006">9</a>. JEP-0077: In-Band Registration &lt;<a href="http://www.jabber.org/jeps/jep-0077.html">http://www.jabber.org/jeps/jep-0077.html</a>&gt;.</p>
<p><a name="nt-id2262026">10</a>. JEP-0004: Data Forms &lt;<a href="http://www.jabber.org/jeps/jep-0004.html">http://www.jabber.org/jeps/jep-0004.html</a>&gt;.</p>
<p><a name="nt-id2262587">11</a>. Some commentors have complained that this opens room owners and administrators up to potential abuse; however, with power comes responsibility.</p>
<p><a name="nt-id2263361">12</a>. JEP-0133: Service Administration &lt;<a href="http://www.jabber.org/jeps/jep-0133.html">http://www.jabber.org/jeps/jep-0133.html</a>&gt;.</p>
<p><a name="nt-id2264223">13</a>. JEP-0050: Ad-Hoc Commands &lt;<a href="http://www.jabber.org/jeps/jep-0050.html">http://www.jabber.org/jeps/jep-0050.html</a>&gt;.</p>
<p><a name="nt-id2264245">14</a>. JEP-0060: Publish-Subscribe &lt;<a href="http://www.jabber.org/jeps/jep-0060.html">http://www.jabber.org/jeps/jep-0060.html</a>&gt;.</p>
<p><a name="nt-id2265574">15</a>. This is different from the behavior of room configuration, wherein the 'muc#roomconfig_roomowners' field specifies the full list of room owners, not the delta.</p>
<p><a name="nt-id2265898">16</a>. This is different from the behavior of room configuration, wherein the 'muc#roomconfig_roomadmins' field specifies the full list of room admins, not the delta.</p>
<p><a name="nt-id2266207">17</a>. JEP-0086: Error Condition Mappings &lt;<a href="http://www.jabber.org/jeps/jep-0086.html">http://www.jabber.org/jeps/jep-0086.html</a>&gt;.</p>
<p><a name="nt-id2266646">18</a>. RFC 2616: Hypertext Transport Protocol -- HTTP/1.1 &lt;<a href="http://www.ietf.org/rfc/rfc2616.txt">http://www.ietf.org/rfc/rfc2616.txt</a>&gt;.</p>
<p><a name="nt-id2266668">19</a>. RFC 1893: Enhanced Mail System Status Codes &lt;<a href="http://www.ietf.org/rfc/rfc1893.txt">http://www.ietf.org/rfc/rfc1893.txt</a>&gt;.</p>
<p><a name="nt-id2266788">20</a>. The Internet Assigned Numbers Authority (IANA) is the central coordinator for the assignment of unique parameter values for Internet protocols, such as port numbers and URI schemes. For further information, see &lt;<a href="http://www.iana.org/">http://www.iana.org/</a>&gt;.</p>
<p><a name="nt-id2266835">21</a>. The Jabber Registrar maintains a list of reserved Jabber protocol namespaces as well as registries of parameters used in the context of protocols approved by the Jabber Software Foundation. For further information, see &lt;<a href="http://www.jabber.org/registrar/">http://www.jabber.org/registrar/</a>&gt;.</p>
<p><a name="nt-id2267032">22</a>. JEP-0068: Field Data Standardization for Data Forms &lt;<a href="http://www.jabber.org/jeps/jep-0068.html">http://www.jabber.org/jeps/jep-0068.html</a>&gt;.</p>
<p><a name="nt-id2267409">23</a>. JEP-0022: Message Events &lt;<a href="http://www.jabber.org/jeps/jep-0022.html">http://www.jabber.org/jeps/jep-0022.html</a>&gt;.</p>
<p><a name="nt-id2267432">24</a>. JEP-0085: Chat State Notifications &lt;<a href="http://www.jabber.org/jeps/jep-0085.html">http://www.jabber.org/jeps/jep-0085.html</a>&gt;.</p>
<p><a name="nt-id2267963">25</a>. JEP-0071: XHTML-IM &lt;<a href="http://www.jabber.org/jeps/jep-0071.html">http://www.jabber.org/jeps/jep-0071.html</a>&gt;.</p>
</div>
<p><hr></p>
<a name="revs"></a><h2>Revision History</h2>
<div class="indent">
<h4>Version 1.19 (2005-04-21)</h4>
<div class="indent">Specified how to send multiple invitations simultaneously; corrected some errors regarding consistency of affiliation state changes; changed message events prohibition from MUST NOT to SHOULD NOT; corrected error handling related to the #traffic disco node; allowed &lt;password/&gt; as a child of &lt;destroy/&gt;; changed max users error from &lt;not-allowed/&gt; to &lt;service-unavailable/&gt;; specified that the maxchars attribute counts characters in complete XML stanzas; added disco features for FORM_TYPEs; defined registry for status codes; split Create Instant Room into separate use case for protocol compliance purposes; adjusted XML schemas to reflect the foregoing changes; re-wrote the introduction; clarified small textual matters throughout. (psa)
    </div>
<h4>Version 1.18 (2004-11-02)</h4>
<div class="indent">Corrected several errors in the affiliation state chart and in the examples (wrong FORM_TYPE values); mentioned /me command. (psa)
    </div>
<h4>Version 1.17 (2004-10-04)</h4>
<div class="indent">Added text about allowable extension namespaces and related service discovery mechanisms; specified well-known service discovery nodes; added conformance terms to clarify some descriptions; modified affiliation state chart to allow more flexible state changes; per list dicussion, added ability to convert a one-to-one chat into a conference, including sending of history; specified error to use when max users limit is reached; specified form for admin approval of user registration requests and modified FORM_TYPE from http://jabber.org/protocol/muc#user to http://jabber.org/protocol/muc#register; modified FORM_TYPE for room configuration from http://jabber.org/protocol/muc#owner to http://jabber.org/protocol/muc#roomconfig. (psa)
    </div>
<h4>Version 1.16 (2004-06-30)</h4>
<div class="indent">Added example and registry submission for service discovery extension. (psa)
    </div>
<h4>Version 1.15 (2004-06-24)</h4>
<div class="indent">Removed jabber:iq:browse references; clarified order of presence stanzas sent to new occupant on entering room; specified format of in-room messages (type='groupchat', from='room@service'); clarified allowable attributes in various list-related operations; made admin/owner revocation text and examples consistent with state chart; clarified ownership revocation conflict scenarios; changed the 'muc#roomconfig_inviteonly' field to 'muc#roomconfig_membersonly'; changed attribute order in examples to match XML canonicalization rules; corrected several errors in the schemas. (psa)
    </div>
<h4>Version 1.14 (2004-05-03)</h4>
<div class="indent">Corrected discovery of registered roomnicks; added note about error to return if nicks are locked down. (psa)
    </div>
<h4>Version 1.13 (2004-03-31)</h4>
<div class="indent">Fixed an error in the muc#user schema. (psa)
    </div>
<h4>Version 1.12 (2004-03-01)</h4>
<div class="indent">Corrected a few errors in the examples; added IQ results in order to clarify workflows. (psa)
    </div>
<h4>Version 1.11 (2004-02-05)</h4>
<div class="indent">Clarified JID matching rules (same as for privacy lists in XMPP IM). (psa)
    </div>
<h4>Version 1.10 (2004-01-07)</h4>
<div class="indent">Added XMPP error handling; fully specified all conformance terms. (psa)
    </div>
<h4>Version 1.9 (2003-12-14)</h4>
<div class="indent">Removed protocol for requesting voice in a moderated room (should be performed using Ad-Hoc Commands). (psa)
    </div>
<h4>Version 1.8 (2003-12-04)</h4>
<div class="indent">Added protocol for requesting voice in a moderated room; added (informational) mapping of IRC commands to MUC protocols. (psa)
    </div>
<h4>Version 1.7 (2003-10-21)</h4>
<div class="indent">Added room configuration option for restricting presence broadcast to certain roles. (psa)
    </div>
<h4>Version 1.6 (2003-10-03)</h4>
<div class="indent">Added history management protocol on entering a room. (psa)
    </div>
<h4>Version 1.5 (2003-09-11)</h4>
<div class="indent">Specified that ban occurs by JID, not roomnick; allowed privileged users to send messages to the room even if not present in the room; added note that service should remove occupant if a delivery-related stanza error occurs; enabled user to disco the room in order to discover registered roomnick; specified that "banning" by domain or regex is a service-level configuration matter and therefore out of scope for MUC; specified that role should be decremented as appropriate if affiliation is lowered; added some clarifying text to room creation workflow; added implementation note about sending an out-of-band message if a user's affiliation changes while the user is not in the room; fixed stringprep references (room nicks use Resourceprep); clarified relationship between Room ID (i.e., node identifier of Room JID, which may be opaque) and natural-language Room Name; specified Field Standardization profile per JEP-0068; defined Jabber Registrar submissions; added schema locations. (psa)
    </div>
<h4>Version 1.4 (2003-02-16)</h4>
<div class="indent">Added XML schemas. (psa)
    </div>
<h4>Version 1.3 (2003-02-11)</h4>
<div class="indent">Added reference to nodeprep Internet-Draft. (psa)
    </div>
<h4>Version 1.2 (2003-01-30)</h4>
<div class="indent">Commented out revision history prior to version 1.0 (too long); clarified business rules regarding when nicks, full JIDs, and bare JIDs are used in reference to roles and affiliations; consistently specified that extended presence information in the muc#user namespace must include the full JID as the value of the 'jid' attribute in all cases; cleaned up text and examples throughout; added open issue regarding syntax of room nicknames. (psa)
    </div>
<h4>Version 1.1 (2002-12-16)</h4>
<div class="indent">Added protocol for declining an invitation; replaced &lt;created/&gt; element with status code 201; modified the destroy room protocol so that &lt;destroy/&gt; is a child of &lt;query/&gt;; clarified usage of 'nick' attribute when adding members; prohibited use of message events. (psa)
    </div>
<h4>Version 1.0 (2002-11-21)</h4>
<div class="indent">Per a vote of the Jabber Council, revision 0.23 was advanced to Draft on 2002-11-21. (For earlier revision history, refer to XML source.) (psa)
    </div>
</div>
<p><hr></p>
<p>END</p>
</body>
</html>
