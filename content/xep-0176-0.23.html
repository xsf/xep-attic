<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>XEP-0176: Jingle ICE-UDP Transport Method</title><link rel="stylesheet" type="text/css" href="../xmpp.css" /><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" /><meta name="DC.Title" content="Jingle ICE-UDP Transport Method" /><meta name="DC.Creator" content="Joe Beda" /><meta name="DC.Creator" content="Scott Ludwig" /><meta name="DC.Creator" content="Peter Saint-Andre" /><meta name="DC.Creator" content="Joe Hildebrand" /><meta name="DC.Creator" content="Sean Egan" /><meta name="DC.Description" content="This specification defines a Jingle transport method that results in sending media data using raw datagram associations via the User Datagram Protocol (UDP). This transport method is negotiated via the Interactive Connectivity Establishment (ICE) methodology, which provides robust NAT traversal for media traffic." /><meta name="DC.Publisher" content="XMPP Standards Foundation" /><meta name="DC.Contributor" content="XMPP Extensions Editor" /><meta name="DC.Date" content="2008-12-19" /><meta name="DC.Type" content="XMPP Extension Protocol" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="XEP-0176" /><meta name="DC.Language" content="en" /><meta name="DC.Rights" content="This XMPP Extension Protocol is copyright (c) 1999 - 2009 by the XMPP Standards Foundation (XSF)." /></head><body><h1>XEP-0176: Jingle ICE-UDP Transport Method</h1><p>Copyright (c) 1999 - 2009 <a href="http://xmpp.org/">XMPP Standards Foundation</a>. See <a href="#appendix-legal">Legal Notices</a>.</p><hr /><p>This specification defines a Jingle transport method that results in sending media data using raw datagram associations via the User Datagram Protocol (UDP). This transport method is negotiated via the Interactive Connectivity Establishment (ICE) methodology, which provides robust NAT traversal for media traffic.</p><p style="color:red">NOTICE: This document is currently within Last Call or under consideration by the XMPP Council for advancement to the next stage in the XSF standards process.</p><hr /><h2>Table of Contents</h2><div class="indent"><p><br />1.  <a href="#intro">Introduction</a><br />2.  <a href="#terms">Glossary</a><br />3.  <a href="#reqs">Requirements</a><br />4.  <a href="#conformance">Jingle Conformance</a><br />5.  <a href="#protocol">Protocol Description</a><br />   
      5.1.  <a href="#protocol-flow">Overall Flow</a><br />   
      5.2.  <a href="#protocol-initiate">Transport Initiation</a><br />   
      5.3.  <a href="#protocol-response">Response</a><br />   
      5.4.  <a href="#protocol-candidates">Candidate Negotiation</a><br />      
      5.4.1.  <a href="#protocol-candidates-syntax">Syntax of Candidate Element</a><br />      
      5.4.2.  <a href="#protocol-candidates-exchange">Exchange of Candidates</a><br />   
      5.5.  <a href="#protocol-checks">Connectivity Checks</a><br />   
      5.6.  <a href="#protocol-acceptance">Acceptance of Successful Candidate</a><br />   
      5.7.  <a href="#protocol-modify">Modifying an Existing Candidate</a><br />   
      5.8.  <a href="#protocol-renegotiate">Negotiating a New Candidate</a><br />6.  <a href="#fallback">Fallback to Raw UDP</a><br />7.  <a href="#support">Determining Support</a><br />   
      7.1.  <a href="#support-ice">ICE Support</a><br />   
      7.2.  <a href="#support-sdp">SDP Offer / Answer Support</a><br />8.  <a href="#impl">Implementation Notes</a><br />9.  <a href="#deploy">Deployment Notes</a><br />10.  <a href="#security">Security Considerations</a><br />   
      10.1.  <a href="#security-sharing">Sharing IP Addresses</a><br />   
      10.2.  <a href="#security-media">Encryption of Media</a><br />11.  <a href="#iana">IANA Considerations</a><br />12.  <a href="#registrar">XMPP Registrar Considerations</a><br />   
      12.1.  <a href="#registrar-ns">Protocol Namespaces</a><br />   
      12.2.  <a href="#registrar-versioning">Protocol Versioning</a><br />   
      12.3.  <a href="#registrar-features">Service Discovery Features</a><br />   
      12.4.  <a href="#registrar-transports">Jingle Transport Methods</a><br />13.  <a href="#schema">XML Schema</a><br />14.  <a href="#ack">Acknowledgements</a></p><p><a href="#appendices">Appendices</a><br />    <a href="#appendix-docinfo">A: Document Information</a><br />    <a href="#appendix-authorinfo">B: Author Information</a><br />    <a href="#appendix-legal">C: Legal Notices</a><br />    <a href="#appendix-xmpp">D: Relation to XMPP</a><br />    <a href="#appendix-discuss">E: Discussion Venue</a><br />    <a href="#appendix-conformance">F: Requirements Conformance</a><br />    <a href="#appendix-notes">G: Notes</a><br />    <a href="#appendix-revs">H: Revision History</a></p></div><hr /><h2>1.
       <a name="intro" id="intro">Introduction</a></h2>
  <p class="" style=""><span class="ref" style=""><a href="http://xmpp.org/extensions/xep-0166.html">Jingle</a></span>  [<a href="#nt-id2261717">1</a>] defines a framework for negotiating and managing out-of-band data sessions over XMPP. In order to provide a flexible framework, the base Jingle specification defines neither data transport methods nor application formats, leaving that up to separate specifications.</p>
  <p class="" style="">The current document defines a transport method for establishing and managing data exchanges between XMPP entities over the User Datagram Protocol (see <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc0768">RFC 768</a></span>  [<a href="#nt-id2261749">2</a>]), using the ICE methodology developed within the IETF and specified in <span class="ref" style=""><a href="http://tools.ietf.org/html/draft-ietf-mmusic-ice">Interactive Connectivity Establishment (ICE)</a></span>  [<a href="#nt-id2261779">3</a>] (hereafter referred to as <span class="ref">ICE-CORE</span>). Use of the <span class="strong">ice-udp</span> method results in a datagram transport suitable for media applications where some packet loss is tolerable (e.g., audio and video).</p>
  <p class="" style="">Note: <span class="ref">ICE-CORE</span> has been approved for publication as an RFC but has not yet been published as an RFC. While every effort has been made to keep this document synchronized with <span class="ref">ICE-CORE</span>, the interested reader is referred to <span class="ref">ICE-CORE</span> for a detailed description of the ICE methodology.</p>
  <p class="" style="">The process for ICE negotiation is largely the same in Jingle as it is in ICE. There are several differences:</p>
  <ul class="" style="">
    <li class="" style="">Instead of using the Session Initiation Protocol (SIP) as the signalling channel, Jingle uses XMPP as the signalling channel.</li>
    <li class="" style="">In Jingle, each candidate transport is typically sent in a separate IQ exchange (rather than sending all candidates at once as in <span class="ref">ICE-CORE</span>). This approach takes advantage of the request-response semantics of the XMPP &lt;iq/&gt; stanza type and enables the parties to send higher-priority candidates earlier in the negotiation, thus resulting in a faster negotiation. However, a Jingle client MAY send multiple candidates at a time in order to ensure interworking with entities that adhere to the SDP offer / answer model described in <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc3264">RFC 3264</a></span>  [<a href="#nt-id2261884">4</a>].</li>
    <li class="" style="">Syntax from the Session Description Protocol (see <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc4566">RFC 4566</a></span>  [<a href="#nt-id2261918">5</a>]) is mapped to an XML syntax suitable for sending over the XMPP signalling channel.</li>
    <li class="" style="">ICE candidates can be upgraded during a session (e.g., to change an IP address).</li>
    <li class="" style="">Either party can continue to send ICE candidates throughout a session and renegotiate which candidate will be used.</li>
  </ul>
<h2>2.
       <a name="terms" id="terms">Glossary</a></h2>
  <p class="" style="">The reader is referred to <span class="ref">ICE-CORE</span> for a description of various terms used in the context of ICE. Those terms are not reproduced here.</p>
<h2>3.
       <a name="reqs" id="reqs">Requirements</a></h2>
  <p class="" style="">The Jingle transport method defined herein are designed to meet the following requirements:</p>
  <ol start="" class="" style="">
    <li class="" style="">Make it possible to establish and manage out-of-band connections between two XMPP entities, even if they are behind Network Address Translators (NATs) or firewalls.</li>
    <li class="" style="">Enable use of UDP as the transport protocol.</li>
    <li class="" style="">Make it relatively easy to implement support in standard Jabber/XMPP clients.</li>
    <li class="" style="">Where communication with non-XMPP entities is needed, push as much complexity as possible onto server-side gateways between the XMPP network and the non-XMPP network.</li>
  </ol>
<h2>4.
       <a name="conformance" id="conformance">Jingle Conformance</a></h2>
   <p class="" style="">In accordance with Section 10 of <span class="ref">XEP-0166</span>, this document specifies the following information related to the Jingle ice-udp transport method:</p>
   <ol start="" class="" style="">
     <li class="" style=""><p class="" style="">The transport negotiation process is defined in the <a href="#protocol">Protocol Description</a> section of this document.</p></li>
     <li class="" style=""><p class="" style="">The semantics of the &lt;transport/&gt; element are defined in the <a href="#protocol-negotiate">ICE Negotiation</a> section of this document.</p></li>
     <li class="" style=""><p class="" style="">Successful negotiation of the ice-udp method results in use of a datagram transport that is suitable for applications where some packet loss is tolerable, such as audio and video.</p></li>
     <li class="" style=""><p class="" style="">If multiple components are to be communicated over the transport in the context of the Real-time Transport Protocol (RTP; see <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc3550">RFC 3550</a></span>  [<a href="#nt-id2262135">6</a>]), the component numbered "1" shall be associated with RTP and the component numbered "2" shall be associated with the Real Time Control Protocol (RTCP).</p></li>
   </ol>
<h2>5.
       <a name="protocol" id="protocol">Protocol Description</a></h2>
  <div class="indent"><h3>5.1 <a name="protocol-flow" id="protocol-flow">Overall Flow</a></h3>
    <p class="" style="">The overall protocol flow for negotiation of the Jingle ICE-UDP Transport Method is as follows (note: many of these events happen simultaneously, not in sequence).</p>
    <p class="caption"></p><div class="indent"><pre>
INITIATOR                              RESPONDER
    |                                      |
    |  Jingle session-initiate stanza      |
    |-------------------------------------&gt;|
    |  Jingle ack (XMPP IQ-result)         |
    |&lt;-------------------------------------|
    |  multiple Jingle transport-info      |
    |  stanzas (one candidate per stanaza) |
    |&lt;------------------------------------&gt;|
    |  multiple Jingle acks                |
    |  (XMPP IQ-result stanzas)            |
    |&lt;------------------------------------&gt;|
    |  multiple STUN Binding Requests      |
    |&lt;====================================&gt;|
    |  multiple STUN Binding Results       |
    |&lt;====================================&gt;|
    |  Jingle session-accept stanza        |
    |&lt;-------------------------------------|
    |  Jingle ack (XMPP IQ-result)         |
    |-------------------------------------&gt;|
    |&lt;=========MEDIA NOW FLOWS============&gt;|
    |                                      |
    </pre></div>
    <p class="" style="">Note: The examples in this document follow the scenario described in Section 17 of <span class="ref">ICE-CORE</span>, except that we substitute the Shakespearean characters "Romeo" and "Juliet" for the generic entities "L" and "R".</p>
  </div>
  <div class="indent"><h3>5.2 <a name="protocol-initiate" id="protocol-initiate">Transport Initiation</a></h3>
    <p class="" style="">In order for the initiator in a Jingle exchange to start the negotiation, it sends a Jingle "session-initiate" stanza that includes at least one content type, as described in <span class="ref">XEP-0166</span>. If the initiator wishes to negotiate the ice-udp transport method for an application format, it MUST include an empty &lt;transport/&gt; child element qualified by the 'urn:xmpp:jingle:transports:ice-udp:0' namespace (see <a href="#registrar-versioning">Namespace Versioning</a> regarding the possibility of incrementing the version number).</p>
    <p class="caption"><a name="example-1" id="example-1"></a>Example 1. Initiation</p><div class="indent"><pre>
&lt;iq from='romeo@montague.lit/orchard'
    id='jingle1'
    to='juliet@capulet.lit/balcony'
    type='set'&gt;
  &lt;jingle xmlns='urn:xmpp:jingle:0'
          action='session-initiate'
          initiator='romeo@montague.lit/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content name='this-is-the-audio-content'&gt;
      &lt;description xmlns='urn:xmpp:jingle:apps:rtp:1' media='audio'&gt;
        &lt;payload-type id='96' name='speex' clockrate='16000'/&gt;
        &lt;payload-type id='97' name='speex' clockrate='8000'/&gt;
        &lt;payload-type id='18' name='G729'/&gt;
        &lt;payload-type id='0' name='PCMU' /&gt;
        &lt;payload-type id='103' name='L16' clockrate='16000' channels='2'/&gt;
        &lt;payload-type id='98' name='x-ISAC' clockrate='8000'/&gt;
      &lt;/description&gt;
      &lt;transport xmlns='urn:xmpp:jingle:transports:ice-udp:0'
                 pwd='asd88fgpdd777uzjYhagZg'
                 ufrag='8hhy'/&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The 'pwd' and 'ufrag' attributes MUST be included in the session-initiate request, in subsequent content-add and transport-replace actions, and when offering candidates via the transport-info action. The attributes SHOULD NOT be included in a session-accept action. The values are separately generated for both the initiator and the responder, in accordance with <span class="ref">ICE-CORE</span> and as shown in the examples. The attributes are defined as follows.</p>
    <div class="indent"><p class="caption"><a name="table-1" id="table-1"></a>Table 1: Transport Attributes</p><table border="1" cellpadding="3" cellspacing="0">
      <tr class="body">
        <th colspan="" rowspan="">Name</th>
        <th colspan="" rowspan="">Description</th>
        <th colspan="" rowspan="">SDP Syntax</th>
        <th colspan="" rowspan="">Example</th>
      </tr>
      <tr class="body">
        <td colspan="" rowspan="">pwd</td>
        <td colspan="" rowspan="">A Password as defined in <span class="ref">ICE-CORE</span>.</td>
        <td colspan="" rowspan="">a=ice-pwd line</td>
        <td colspan="" rowspan="">asd88fgpdd777uzjYhagZg</td>
      </tr>
      <tr class="body">
        <td colspan="" rowspan="">ufrag</td>
        <td colspan="" rowspan="">A User Fragment as defined in <span class="ref">ICE-CORE</span>.</td>
        <td colspan="" rowspan="">a=ice-ufrag line</td>
        <td colspan="" rowspan="">8hhy</td>
      </tr>
    </table></div>
  </div>
  <div class="indent"><h3>5.3 <a name="protocol-response" id="protocol-response">Response</a></h3>
    <p class="" style="">As described in <span class="ref">XEP-0166</span>, to acknowledge receipt of the session initiation request, the responder returns an IQ-result:</p>
    <p class="caption"><a name="example-2" id="example-2"></a>Example 2. Responder acknowledges receipt of session-initiate request</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.lit/balcony'
    id='jingle1'
    to='romeo@montague.lit/orchard'
    type='result'/&gt;
    </pre></div>
  </div>
  <div class="indent"><h3>5.4 <a name="protocol-candidates" id="protocol-candidates">Candidate Negotiation</a></h3>
    <p class="" style="">Once the responder acknowledges receipt of the session initiation request as shown above, both initiator and responder MUST immediately negotiate connectivity over ICE by exchanging XML-formatted transport "candidates" for the channel. This negotiation proceeds immediately in order to maximize the possibility that media can be exchanged as quickly as possible.  [<a href="#nt-id2262434">7</a>]</p>
    <p class="" style="">In order to expedite session establishment, the initiator MAY send transport candidates immediately after sending the "session-initiate" message and before receiving acknowledgement from the responder (i.e., the initiator MUST consider the session to be live even before receiving acknowledgement). Given in-order delivery as mandated by <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc3920">XMPP Core</a></span>  [<a href="#nt-id2262483">8</a>], the responder will receive such "transport-info" messages after receiving the "session-initiate" message; if not, it is appropriate for the responder to return &lt;unknown-session/&gt; errors since according to its state machine the session does not exist.</p>
    <p class="caption"><a name="example-3" id="example-3"></a>Example 3. Responder returns unknown-session error</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.lit/balcony'
    id='jingle1'
    to='romeo@montague.lit/orchard'
    type='error'&gt;
  &lt;error type='cancel'&gt;
    &lt;item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;unknown-session xmlns='urn:xmpp:jingle:errors:0'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">If either party receives an &lt;unknown-session/&gt; error from the other party, it MUST terminate the negotiation and the session.</p>
    <p class="" style="">Note: See the <a href="#security">Security Considerations</a> section of this document regarding the exposure of IP addresses on behalf by the responder's client.</p>
    <p class="" style="">The candidate syntax and negotiation flow are described below.</p>
    <div class="indent"><h3>5.4.1 <a name="protocol-candidates-syntax" id="protocol-candidates-syntax">Syntax of Candidate Element</a></h3>
      <p class="" style="">The following is an example of the candidate format:</p>
      <p class="caption"></p><div class="indent"><pre>
&lt;candidate component='1'
           foundation='1'
           generation='0'
           id='el0747fg11'
           ip='10.0.1.1'
           network='0'
           port='8998'
           priority='2130706431'
           protocol='udp'
           type='host'/&gt;
      </pre></div>
      <p class="" style="">The attributes of the &lt;candidate/&gt; element are described in the following table:</p>
      <div class="indent"><p class="caption"><a name="table-2" id="table-2"></a>Table 2: Candidate Attributes</p><table border="1" cellpadding="3" cellspacing="0">
        <tr class="body">
          <th colspan="" rowspan="">Name</th>
          <th colspan="" rowspan="">Description</th>
          <th colspan="" rowspan="">SDP Syntax</th>
          <th colspan="" rowspan="">Example</th>
        </tr>
        <tr class="body">
          <td colspan="" rowspan="">component</td>
          <td colspan="" rowspan="">A Component ID as defined in <span class="ref">ICE-CORE</span>.</td>
          <td colspan="" rowspan="">Component ID value in a=candidate line</td>
          <td colspan="" rowspan="">1</td>
        </tr>
        <tr class="body">
          <td colspan="" rowspan="">foundation</td>
          <td colspan="" rowspan="">A Foundation as defined in <span class="ref">ICE-CORE</span>.</td>
          <td colspan="" rowspan="">Foundation value in a=candidate line</td>
          <td colspan="" rowspan="">1</td>
        </tr>
        <tr class="body">
          <td colspan="" rowspan="">generation</td>
          <td colspan="" rowspan="">An index, starting at 0, that enables the parties to keep track of updates to the candidate throughout the life of the session.</td>
          <td colspan="" rowspan="">N/A</td>
          <td colspan="" rowspan="">0</td>
        </tr>
        <tr class="body">
          <td colspan="" rowspan="">id</td>
          <td colspan="" rowspan="">A unique identifier for the candidate.</td>
          <td colspan="" rowspan="">N/A</td>
          <td colspan="" rowspan="">el0747fg11</td>
        </tr>
        <tr class="body">
          <td colspan="" rowspan="">ip</td>
          <td colspan="" rowspan="">The Internet Protocol (IP) address for the candidate transport mechanism; this may be either an IPv4 address or an IPv6 address.</td>
          <td colspan="" rowspan="">IP Address value in a=candidate line</td>
          <td colspan="" rowspan="">192.0.2.3</td>
        </tr>
        <tr class="body">
          <td colspan="" rowspan="">network</td>
          <td colspan="" rowspan="">An index, starting at 0, referencing which network this candidate is on for a given peer (used for diagnostic purposes if the calling hardware has more than one Network Interface Card).</td>
          <td colspan="" rowspan="">N/A</td>
          <td colspan="" rowspan="">0</td>
        </tr>
        <tr class="body">
          <td colspan="" rowspan="">port</td>
          <td colspan="" rowspan="">The port at the candidate IP address.</td>
          <td colspan="" rowspan="">Port value in a=candidate line</td>
          <td colspan="" rowspan="">45664</td>
        </tr>
        <tr class="body">
          <td colspan="" rowspan="">priority</td>
          <td colspan="" rowspan="">A Priority as defined in <span class="ref">ICE-CORE</span>
             [<a href="#nt-id2262890">9</a>]
          </td>
          <td colspan="" rowspan="">Priority value in a=candidate line</td>
          <td colspan="" rowspan="">2130706431</td>
        </tr>
        <tr class="body">
          <td colspan="" rowspan="">protocol</td>
          <td colspan="" rowspan="">The protocol to be used. The only value defined by this specification is "udp".</td>
          <td colspan="" rowspan="">Transport protocol field in a=candidate line</td>
          <td colspan="" rowspan="">udp</td>
        </tr>
        <tr class="body">
          <td colspan="" rowspan="">rel-addr</td>
          <td colspan="" rowspan="">A related address as defined in <span class="ref">ICE-CORE</span>.</td>
          <td colspan="" rowspan="">raddr value in a=candidate line</td>
          <td colspan="" rowspan="">10.0.1.1</td>
        </tr>
        <tr class="body">
          <td colspan="" rowspan="">rel-port</td>
          <td colspan="" rowspan="">A related port as defined in <span class="ref">ICE-CORE</span>.</td>
          <td colspan="" rowspan="">rport value in a=candidate line</td>
          <td colspan="" rowspan="">8998</td>
        </tr>
        <tr class="body">
          <td colspan="" rowspan="">rem-addr</td>
          <td colspan="" rowspan="">A IP address for a remote address as defined in <span class="ref">ICE-CORE</span>.</td>
          <td colspan="" rowspan="">connection-address value in a=remote-candidates line</td>
          <td colspan="" rowspan="">192.0.2.1</td>
        </tr>
        <tr class="body">
          <td colspan="" rowspan="">rem-port</td>
          <td colspan="" rowspan="">The port for a remote address as defined in <span class="ref">ICE-CORE</span>.</td>
          <td colspan="" rowspan="">port value in a=remote-candidates line</td>
          <td colspan="" rowspan="">3478</td>
        </tr>
        <tr class="body">
          <td colspan="" rowspan="">type</td>
          <td colspan="" rowspan="">A Candidate Type as defined in <span class="ref">ICE-CORE</span>. The allowable values are "host" for host candidates, "prflx" for peer reflexive candidates, "relay" for relayed candidates, and "srflx" for server reflexive candidates.</td>
          <td colspan="" rowspan="">Typ field in a=candidate line</td>
          <td colspan="" rowspan="">srflx</td>
        </tr>
      </table></div>
    </div>
    <div class="indent"><h3>5.4.2 <a name="protocol-candidates-exchange" id="protocol-candidates-exchange">Exchange of Candidates</a></h3>
      <p class="" style="">The first step in negotiating connectivity is for each party to immediately begin sending transport candidates to the other party.  [<a href="#nt-id2263178">10</a>] These candidates SHOULD be gathered by following the procedure specified in Section 4.1.1 of <span class="ref">ICE-CORE</span> (typically by communicating with a standalone STUN server in order to discover the client's public IP address and port) and prioritized by following the procedure specified in Section 4.1.2 of <span class="ref">ICE-CORE</span>.</p>
      <p class="" style="">Each candidate or set of candidates shall be sent as &lt;candidate/&gt; children of a &lt;transport/&gt; element qualified by the 'urn:xmpp:jingle:transports:ice-udp:0' namespace. The &lt;transport/&gt; element shall be sent via a Jingle action of "transport-info" as shown in the examples below.</p>
      <p class="" style="">Either party MAY include multiple &lt;candidate/&gt; elements in one &lt;transport/&gt; element. Sending one candidate per transport-info action typically results in a faster negotiation because the candidates most likely to succeed are sent first and it is not necessary to gather all candidates before beginning to send any candidates. Furthermore, because certain candidates can be more "expensive" in terms of bandwidth or processing power, the initiator might not want to advertise their existence unless it is necessary to do so after other candidates have failed. However, sending multiple candidates in a single "transport-info" action can help to ensure interoperability with entities that implement the SDP offer/answer model described in <span class="ref">RFC 3264</span>. An entity SHOULD send one candidate per "transport-info" action and send multiple such actions, instead of sending multiple candidates in a single "transport-info" action; the only exception is if the other party advertises support for the "urn:ietf:rfc:3264" service discovery feature as described in the <a href="#support-sdp">SDP Offer / Answer Support</a> section of this document.</p>
      <p class="" style="">If the responder receives and can successfully process a given candidate or set of candidates, it returns an IQ-result (if not, for example because the candidate data is improperly formatted, it returns an IQ-error). At this point, the responder is only indicating receipt of the candidate or set of candidates, not telling the initiator that the candidate will be used.</p>
      <p class="" style="">The initiator keeps sending candidates (without stopping to receive an acknowledgement of receipt from the responder for each candidate) until it has exhausted its supply of possible or desirable candidate transports. For each candidate or set of candidates, the responder acknowledges receipt.</p>
      <p class="" style="">At the same time (i.e., immediately after acknowledging receipt of the session-initiate request, not waiting for the initiator to begin or finish sending candidates), the responder also begins sending potential candidates, in order of desirability according to the responder. As above, the initiator acknowledges receipt of the candidates.</p>
      <p class="caption"><a name="example-4" id="example-4"></a>Example 4. Initiator sends some candidates</p><div class="indent"><pre>
&lt;iq from='romeo@montague.lit/orchard'
    id='info1'
    to='juliet@capulet.lit/balcony'
    type='set'&gt;
  &lt;jingle xmlns='urn:xmpp:jingle:0'
          action='transport-info'
          initiator='romeo@montague.lit/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='this-is-the-audio-content'&gt;
      &lt;transport xmlns='urn:xmpp:jingle:transports:ice-udp:0'
                 pwd='asd88fgpdd777uzjYhagZg'
                 ufrag='8hhy'&gt;
        &lt;candidate component='1'
                   foundation='1'
                   generation='0'
                   id='el0747fg11'
                   ip='10.0.1.1'
                   network='1'
                   port='8998'
                   priority='2130706431'
                   protocol='udp'
                   type='host'/&gt;
      &lt;/transport&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;

&lt;iq from='romeo@montague.lit/orchard'
    id='info2'
    to='juliet@capulet.lit/balcony'
    type='set'&gt;
  &lt;jingle xmlns='urn:xmpp:jingle:0'
          action='transport-info'
          initiator='romeo@montague.lit/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='this-is-the-audio-content'&gt;
      &lt;transport xmlns='urn:xmpp:jingle:transports:ice-udp:0'
                 pwd='asd88fgpdd777uzjYhagZg'
                 ufrag='8hhy'&gt;
        &lt;candidate component='1'
                   foundation='2'
                   generation='0'
                   id='y3s2b30v3r'
                   ip='192.0.2.3'
                   network='1'
                   port='45664'
                   priority='1694498815'
                   protocol='udp'
                   rel-addr='10.0.1.1'
                   rel-port='8998'
                   type='srflx'/&gt;
      &lt;/transport&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
      </pre></div>
      <p class="" style="">For each candidate received, the other party (in this case the responder) MUST acknowledge receipt or return an error.</p>
      <p class="caption"><a name="example-5" id="example-5"></a>Example 5. Responder acknowledges receipt</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.lit/balcony'
    id='info1'
    to='romeo@montague.lit/orchard'
    type='result'/&gt;

&lt;iq from='juliet@capulet.lit/balcony'
    id='info2'
    to='romeo@montague.lit/orchard'
    type='result'/&gt;
      </pre></div>
      <p class="" style="">At the same time (i.e., immediately after acknowledging the session-initation request, not waiting for the initiator to begin or finish sending candidates), the responder also sends candidates that may work for it.</p>
      <p class="caption"><a name="example-6" id="example-6"></a>Example 6. Responder sends candidates</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.lit/balcony'
    to='romeo@montague.lit/orchard'
    id='info3'
    type='set'&gt;
  &lt;jingle xmlns='urn:xmpp:jingle:0'
          action='transport-info'
          initiator='romeo@montague.lit/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='this-is-the-audio-content'&gt;
      &lt;transport xmlns='urn:xmpp:jingle:transports:ice-udp:0'
                 pwd='YH75Fviy6338Vbrhrlp8Yh'
                 ufrag='9uB6'&gt;
        &lt;candidate component='1'
                   foundation='1'
                   generation='0'
                   id='or2ii2syr1'
                   ip='192.0.2.1'
                   network='0'
                   port='3478'
                   priority='2130706431'
                   protocol='udp'
                   type='host'/&gt;
      &lt;/transport&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
      </pre></div>
      <p class="" style="">As above for the candidates sent by the initiator, here the initiator acknowledges receipt of the candidates sent by the responder.</p>
      <p class="caption"><a name="example-7" id="example-7"></a>Example 7. Initiator acknowledges receipt</p><div class="indent"><pre>
&lt;iq from='romeo@montague.lit/orchard'
    id='info3'
    to='juliet@capulet.lit/balcony'
    type='result'/&gt;
      </pre></div>
    </div>
  </div>
  <div class="indent"><h3>5.5 <a name="protocol-checks" id="protocol-checks">Connectivity Checks</a></h3>
    <p class="" style="">As the initiator and responder receive candidates, they probe the various candidate transports for connectivity. In performing these connectivity checks, each party SHOULD follow the procedure specified in Section 7 of <span class="ref">ICE-CORE</span>. The following business rules apply:</p>
    <ol start="" class="" style="">
      <li class="" style="">Each party sends a STUN Binding Request (see <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc5389">RFC 5389</a></span>  [<a href="#nt-id2263473">11</a>]) from each local candidate it generated to each remote candidate it received.</li>
      <li class="" style="">In accordance with <span class="ref">ICE-CORE</span>, the STUN Binding Requests MUST include the PRIORITY attribute (computed according to Section 7.1.1.1. of <span class="ref">ICE-CORE</span>).</li>
      <li class="" style="">For the purposes of the Jingle ICE-UDP Transport Method, both parties are full ICE implementations and therefore the controlling role MUST be assumed by the initiator and the controlled role MUST be assumed by the responder.</li>
      <li class="" style="">The STUN Binding Requests generated by the initiator MAY include the USE-CANDIDATE attribute to indicate that the initiator wishes to cease checks for this component.</li>
      <li class="" style="">The STUN Binding Requests generated by the initiator MUST include the ICE-CONTROLLING attribute.</li>
      <li class="" style="">The STUN Binding Requests generated by the responder MUST include the ICE-CONTROLLED attribute.</li>
      <li class="" style="">The parties MUST use STUN short term credentials to authenticate requests and perform message integrity checks. As in <span class="ref">ICE-CORE</span>, the username in the STUN Binding Request is of the form "ufrag-of-sender:ufrag-of-peer" and the password is the value of the 'pwd' attribute provided by the peer.  [<a href="#nt-id2263552">12</a>]</li>
    </ol>
    <p class="" style="">When it receives a STUN Binding Request, each party MUST return a STUN Binding Response, which indicates either an error case or the success case. As described in Section 7.1.2.2 of <span class="ref">ICE-CORE</span>, a connectivity check succeeds if <span class="em">all</span> of the following are true:</p>
    <ol start="" class="" style="">
      <li class="" style="">The STUN transaction generated a success response.</li>
      <li class="" style="">The source IP address and port of the response equals the destination IP address and port to which the Binding Request was sent.</li>
      <li class="" style="">The destination IP address and port of the response match the source IP address and port from which the Binding Request was sent.</li>
    </ol>
    <p class="" style="">For the candidates exchanged in the previous section, the connectivity checks would be as follows (this diagram mirrors the example in <span class="ref">ICE-CORE</span>).</p>
    <p class="caption"></p><div class="indent"><pre>
INITIATOR                  NAT                  RESPONDER
    |                       |                       |
    |                       | STUN Binding Request  |
    |                       | from 192.0.2.1:3478   |
    |                       | to   10.0.1.1:8998    |
    |                       |   (dropped)           |
    |                       |  x====================|
    | STUN Binding Request  |                       |
    | from 10.0.1.1:8998    |                       |
    | to   192.0.2.1:3478   |                       |
    | USE-CANDIDATE         |                       |
    |======================&gt;|                       |
    |                       | STUN Binding Request  |
    |                       | from 192.0.2.3:45664  |
    |                       | to   192.0.2.1:3478   |
    |                       | USE-CANDIDATE         |
    |                       |======================&gt;|
    |                       | STUN Binding Response |
    |                       | from 192.0.2.1:3478   |
    |                       | to   192.0.2.3:45664  |
    |                       |&lt;======================|
    | STUN Binding Response |                       |
    | from 192.0.2.1:3478   |                       |
    | to   10.0.1.1:8998    |                       |
    | map  192.0.2.3:45664  |                       |
    |&lt;======================|                       |
    |                       |                       |
    |&lt;==Media Now Can Flow==|                       |
    |                       |                       |
    |                       | STUN Binding Request  |
    |                       | from 192.0.2.1:3478   |
    |                       | to   192.0.2.3:45664  |
    |                       |&lt;======================|
    | STUN Binding Request  |                       |
    | from 192.0.2.1:3478   |                       |
    | to   10.0.1.1:8998    |                       |
    |&lt;======================|                       |
    | STUN Binding Response |                       |
    | from 10.0.1.1:8998    |                       |
    | to   192.0.2.1:3478   |                       |
    | map  192.0.2.1:3478   |                       |
    |======================&gt;|                       |
    |                       | STUN Binding Response |
    |                       | from 192.0.2.3:45664  |
    |                       | to   192.0.2.1:3478   |
    |                       | map  192.0.2.1:3478   |
    |                       |======================&gt;|
    |                       |                       |
    |                       |==Media Now Can Flow==&gt;|
    |                       |                       |
    </pre></div>
    <p class="" style="">Note: Here the initiator (controlling agent) is using "aggressive nomination" as described in Section 8.1.1.2 of <span class="ref">ICE-CORE</span> and therefore includes the USE-CANDIDATE attribute in the STUN Binding Requests it sends.</p>
  </div>
  <div class="indent"><h3>5.6 <a name="protocol-acceptance" id="protocol-acceptance">Acceptance of Successful Candidate</a></h3>
    <p class="" style="">If, based on STUN connectivity checks, the parties determine that they will be able to exchange media between a given pair of local candidates and remote candidates (i.e., the pair is "nominated" and ICE processing is "completed"), the parties shall proceed as follows:</p>
    <ol start="" class="" style="">
      <li class="" style="">The responder sends a Jingle session-accept action to the initiator.</li>
      <li class="" style="">The initiator acknowledges receipt of the session-accept.</li>
    </ol>
    <p class="" style="">First, the responder sends a session-accept action to the initiator, specifying the candidate that succeeded. The session-accept MUST contain information about the nominated pair, including the "rem-addr" and "rem-port" attributes (which specify the IP address and port for the responder's end of the pair, which is a "remote address" according to the initiator). This enables both parties to explicitly agree to both ends of the connection pair (i.e., the local address+port and the remote address+port).</p>
    <p class="caption"><a name="example-8" id="example-8"></a>Example 8. Responder definitively accepts the successful candidate</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.lit/balcony'
    id='accept1'
    to='romeo@montague.lit/orchard'
    type='set'&gt;
  &lt;jingle xmlns='urn:xmpp:jingle:0'
          action='session-accept'
          initiator='romeo@montague.lit/orchard'
          responder='juliet@capulet.lit/balcony'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='this-is-the-audio-content'&gt;
      &lt;description xmlns='urn:xmpp:jingle:apps:rtp:1' media='audio'&gt;
        &lt;payload-type id='97' name='speex' clockrate='8000'/&gt;
        &lt;payload-type id='18' name='G729'/&gt;
      &lt;/description&gt;
      &lt;transport xmlns='urn:xmpp:jingle:transports:ice-udp:0'&gt;
        &lt;candidate component='1'
                   foundation='1'
                   generation='0'
                   id='y3s2b30v3r'
                   ip='192.0.2.3'
                   network='1'
                   port='45664'
                   priority='1694498815'
                   protocol='udp'
                   rel-addr='10.0.1.1'
                   rel-port='8998'
                   rem-addr='192.0.2.1'
                   rem-port='3478'
                   type='srflx'/&gt;
      &lt;/transport&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">Since according to the connectivity checks the initiator can also send data over that candidate, it acknowledges the responder's acceptance:</p>
    <p class="caption"><a name="example-9" id="example-9"></a>Example 9. Initiator acknowledges acceptance of successful candidate</p><div class="indent"><pre>
&lt;iq from='romeo@montague.lit/orchard'
    id='accept1'
    to='juliet@capulet.lit/balcony'
    type='result'/&gt;
    </pre></div>
    <p class="" style="">Now the initiator and responder can begin sending media data over the negotiated connection (in fact, they could have sent data as soon as the connectivity checks succeeded, as shown in the preceding examples).</p>
    <p class="" style="">If a candidate succeeded for the responder but the initiator cannot send data over that candidate, it MUST return a &lt;not-acceptable/&gt; error in response to the responder's acceptance of the successful candidate:</p>
    <p class="caption"><a name="example-10" id="example-10"></a>Example 10. Initiator returns error in response to acceptance of successful candidate</p><div class="indent"><pre>
&lt;iq from='romeo@montague.lit/orchard'
    id='accept1'
    to='juliet@capulet.lit/balcony'
    type='error'&gt;
  &lt;error type='cancel'&gt;
    &lt;not-acceptable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">If the responder cannot find a suitable candidate transport or it receives a &lt;not-acceptable/&gt; error from the initiator in response to its acceptance of a suitable transport, it SHOULD terminate the session as described in <span class="ref">XEP-0166</span>.</p>
  </div>
  <div class="indent"><h3>5.7 <a name="protocol-modify" id="protocol-modify">Modifying an Existing Candidate</a></h3>
    <p class="" style="">The creator of a content type MAY modify an existing, in-use candidate at any time during the session, for example to change the IP address or port. This is done by sending a transport-replace action with the changed candidate information, where the value of the 'generation' attribute is incremented to specify that the candidate information is a modification to an existing candidate.</p>
    <p class="" style="">An example follows (change to IP address and port).</p>
    <p class="caption"><a name="example-11" id="example-11"></a>Example 11. Initiator modifies the in-use candidate</p><div class="indent"><pre>
&lt;iq from='romeo@montague.lit/orchard'
    id='rep2'
    to='juliet@capulet.lit/balcony'
    type='set'&gt;
  &lt;jingle xmlns='urn:xmpp:jingle:0'
          action='transport-replace'
          initiator='romeo@montague.lit/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='this-is-the-audio-content'&gt;
      &lt;transport xmlns='urn:xmpp:jingle:transports:ice-udp:0'
                 pwd='asd88fgpdd777uzjYhagZg'
                 ufrag='8hhy'&gt;
        &lt;candidate component='1'
                   foundation='1'
                   generation='1'
                   id='y3s2b30v3r'
                   ip='192.0.2.3'
                   network='1'
                   port='45665'
                   priority='1694498815'
                   protocol='udp'
                   type='srflx'/&gt;
      &lt;/transport&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The recipient then acknowledges receipt.</p>
    <p class="caption"><a name="example-12" id="example-12"></a>Example 12. Recipient acknowledges transport-replace</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.lit/balcony'
    id='rep2'
    to='romeo@montague.lit/orchard'
    type='result'/&gt;
    </pre></div>
    <p class="" style="">If the transport-replace is acceptable, the recipient then sends a transport-accept action (if not, the recipient sends a transport-reject action).</p>
    <p class="caption"><a name="example-13" id="example-13"></a>Example 13. Responder definitively accepts the replaced candidate</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.lit/balcony'
    id='accept2'
    to='romeo@montague.lit/orchard'
    type='set'&gt;
  &lt;jingle xmlns='urn:xmpp:jingle:0'
          action='transport-accept'
          initiator='romeo@montague.lit/orchard'
          responder='juliet@capulet.lit/balcony'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='this-is-the-audio-content'&gt;
      &lt;transport xmlns='urn:xmpp:jingle:transports:ice-udp:0'
                 pwd='asd88fgpdd777uzjYhagZg'
                 ufrag='8hhy'&gt;
        &lt;candidate component='1'
                   foundation='1'
                   generation='1'
                   id='y3s2b30v3r'
                   ip='192.0.2.3'
                   network='1'
                   port='45665'
                   priority='1694498815'
                   protocol='udp'
                   type='srflx'/&gt;
      &lt;/transport&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The initiator then acknowledges the responder's acceptance:</p>
    <p class="caption"><a name="example-14" id="example-14"></a>Example 14. Initiator acknowledges content acceptance</p><div class="indent"><pre>
&lt;iq from='romeo@montague.lit/orchard'
    id='accept2'
    to='juliet@capulet.lit/balcony'
    type='result'/&gt;
    </pre></div>
    <p class="" style="">The parties then use the modified candidate in subsequent communications.</p>
  </div>
  <div class="indent"><h3>5.8 <a name="protocol-renegotiate" id="protocol-renegotiate">Negotiating a New Candidate</a></h3>
    <p class="" style="">Even after content acceptance or session acceptance, either party MAY continue to send additional candidates to the other party (e.g., because the user agent has become aware of a new media proxy or network interface card). As above, such candidates are shared by sending a transport-info action.</p>
    <p class="caption"><a name="example-15" id="example-15"></a>Example 15. Initiator sends a fourth candidate</p><div class="indent"><pre>
&lt;iq from='romeo@montague.lit/orchard'
    id='info4'
    to='juliet@capulet.lit/balcony'
    type='set'&gt;
  &lt;jingle xmlns='urn:xmpp:jingle:0'
          action='transport-info'
          initiator='romeo@montague.lit/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='this-is-the-audio-content'&gt;
      &lt;transport xmlns='urn:xmpp:jingle:transports:ice-udp:0'
                 pwd='asd88fgpdd777uzjYhagZg'
                 ufrag='8hhy'&gt;
        &lt;candidate component='1'
                   foundation='1'
                   generation='0'
                   id='m3110wc4nd'
                   ip='10.0.1.2'
                   network='0'
                   port='9001'
                   priority='21149780477'
                   protocol='udp'
                   type='host'/&gt;
      &lt;/transport&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The receiving party MUST acknowledge receipt of the candidate.</p>
    <p class="caption"><a name="example-16" id="example-16"></a>Example 16. Recipient acknowledges receipt</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.lit/balcony'
    id='info4'
    to='romeo@montague.lit/orchard'
    type='result'/&gt;
    </pre></div>
    <p class="" style="">The parties SHOULD check the newly-offered candidate for connectivity, as described previously. If the parties determine that media can flow over the candidate, the initiating party MAY send a transport-replace action to the responder in order to use the new candidate.</p>
    <p class="caption"><a name="example-17" id="example-17"></a>Example 17. Initiator sends transport-replace</p><div class="indent"><pre>
&lt;iq from='romeo@montague.lit/orchard'
    id='rep3'
    to='juliet@capulet.lit/balcony'
    type='set'&gt;
  &lt;jingle xmlns='urn:xmpp:jingle:0'
          action='transport-replace'
          initiator='romeo@montague.lit/orchard'
          responder='juliet@capulet.lit/balcony'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='this-is-the-audio-content'&gt;
      &lt;transport xmlns='urn:xmpp:jingle:transports:ice-udp:0'
                 pwd='asd88fgpdd777uzjYhagZg'
                 ufrag='8hhy'&gt;
        &lt;candidate component='1'
                   foundation='1'
                   generation='0'
                   id='m3110wc4nd'
                   ip='10.0.1.2'
                   network='0'
                   port='9001'
                   priority='21149780477'
                   protocol='udp'
                   type='host'/&gt;
      &lt;/transport&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The responder then acknowledges the replaced transport definition.</p>
    <p class="caption"><a name="example-18" id="example-18"></a>Example 18. Responder acknowledges transport-replace</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.lit/balcony'
    id='rep3'
    to='romeo@montague.lit/orchard'
    type='result'/&gt;
    </pre></div>
    <p class="" style="">The responder then accepts the replaced transport definition.</p>
    <p class="caption"><a name="example-19" id="example-19"></a>Example 19. Responder definitively accepts the replaced transport definition</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.lit/balcony'
    id='accept3'
    to='romeo@montague.lit/orchard'
    type='set'&gt;
  &lt;jingle xmlns='urn:xmpp:jingle:0'
          action='transport-accept'
          initiator='romeo@montague.lit/orchard'
          responder='juliet@capulet.lit/balcony'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='this-is-the-audio-content'&gt;
      &lt;transport xmlns='urn:xmpp:jingle:transports:ice-udp:0'
                 pwd='asd88fgpdd777uzjYhagZg'
                 ufrag='8hhy'&gt;
        &lt;candidate component='1'
                   foundation='1'
                   generation='0'
                   id='m3110wc4nd'
                   ip='10.0.1.2'
                   network='0'
                   port='9001'
                   priority='21149780477'
                   protocol='udp'
                   type='host'/&gt;
      &lt;/transport&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The initiator then acknowledges content acceptance.</p>
    <p class="caption"><a name="example-20" id="example-20"></a>Example 20. Initiator acknowledges content acceptance</p><div class="indent"><pre>
&lt;iq from='romeo@montague.lit/orchard'
    id='accept3'
    to='juliet@capulet.lit/balcony'
    type='result'/&gt;
    </pre></div>
    <p class="" style="">The parties then use the new candidate in subsequent communications.</p>
  </div>
<h2>6.
       <a name="fallback" id="fallback">Fallback to Raw UDP</a></h2>
  <p class="" style="">It can happen that the responder does not support ICE, in which case it can be necessary to fall back to use of the <span class="ref" style=""><a href="http://xmpp.org/extensions/xep-0177.html">Jingle Raw UDP Transport Method </a></span>  [<a href="#nt-id2264203">13</a>]. One typical scenario is communication between an ICE-aware Jingle endpoint and a non-ICE-aware SIP endpoint through a Jingle-to-SIP gateway, as follows:</p>
  <ol start="" class="" style="">
    <li class="" style="">The Jingle endpoint sends a session-initiate request to the SIP endpoint, specifying a transport method of ICE-UDP.</li>
    <li class="" style="">Based on capabilities information, the gateway knows that the SIP endpoint does not support ICE, so it enables the endpoints to use its media relay. It does this by:
      <ul class="" style="">
        <li class="" style="">Sending a content-add request to the Jingle endpoint on behalf of the SIP endpoint, specifying a transport method of Raw UDP and a candidate whose IP address and port are hosted at the gateway.</li>
        <li class="" style="">Sending a content-remove request to the Jingle endpoint on behalf of the SIP endpoint, specifying a transport method of ICE-UDP.</li>
        <li class="" style="">Sending SIP INVITE to the SIP endpoint on behalf of the Jingle endpoint, speciying an IP address and port at the gateway.</li>
      </ul>
    </li>
  </ol>
  <p class="" style="">The session flow is as follows.</p> 
  <p class="caption"></p><div class="indent"><pre>
Romeo                    Gateway                    Juliet
  |                         |                         |
  |   session-initiate      |                         |
  |   (audio definition)    |                         |
  |------------------------&gt;|                         |
  |   ack                   |                         |
  |&lt;------------------------|                         |
  |   transport-replace     |                         |
  |   (Raw UDP)             |                         |
  |&lt;------------------------|                         |
  |   ack                   |                         |
  |------------------------&gt;|                         |
  |   transport-accept      |                         |
  |------------------------&gt;|                         |
  |   ack                   |                         |
  |&lt;------------------------|   SIP INVITE            |
  |                         |------------------------&gt;|
  |                         |   200 OK                |
  |                         |&lt;------------------------|
  |   session-accept        |                         |
  |&lt;------------------------|                         |
  |   ack                   |                         |
  |------------------------&gt;|                         |
  |                    MEDIA SESSION                  |
  |&lt;=================================================&gt;|
  |                         |   session-terminate     |
  |                         |&lt;------------------------|
  |   session-terminate     |                         |
  |&lt;------------------------|                         |
  |   ack                   |                         |
  |------------------------&gt;|   ack                   |
  |                         |------------------------&gt;|
  |                         |                         |
    </pre></div>
    <p class="" style="">The protocol flow is as follows, showing only the stanzas sent between Romeo and the gateway (acting on Juliet's behalf).</p>
    <p class="caption"><a name="example-21" id="example-21"></a>Example 21. Initiator sends session-initiate</p><div class="indent"><pre>
&lt;iq from='romeo@montague.lit/orchard'
    id='jingle1'
    to='juliet@capulet.lit/balcony'
    type='set'&gt;
  &lt;jingle xmlns='urn:xmpp:jingle:0'
          action='session-initiate'
          initiator='romeo@montague.lit/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='voice'&gt;
      &lt;description xmlns='urn:xmpp:jingle:apps:rtp:1' media='audio'&gt;
        &lt;payload-type id='96' name='speex' clockrate='16000'/&gt;
        &lt;payload-type id='97' name='speex' clockrate='8000'/&gt;
        &lt;payload-type id='18' name='G729'/&gt;
        &lt;payload-type id='103' name='L16' clockrate='16000' channels='2'/&gt;
        &lt;payload-type id='98' name='x-ISAC' clockrate='8000'/&gt;
      &lt;/description&gt;
      &lt;transport xmlns='urn:xmpp:jingle:transports:ice-udp:0'/&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="caption"><a name="example-22" id="example-22"></a>Example 22. Responder acknowledges session-initiate</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.lit/balcony'
    id='accept1'
    to='romeo@montague.lit/orchard'
    type='result'/&gt;
    </pre></div>
    <p class="" style="">Immediately the gateway sends a transport-replace action to Romeo, specifying a transport of Raw UDP with a candidate whose IP address and port identify a media relay at the gateway.</p>
    <p class="caption"><a name="example-23" id="example-23"></a>Example 23. Gateway sends transport-replace on behalf of responder</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.lit/balcony'
    id='replace1'
    to='romeo@montague.lit/orchard'
    type='set'&gt;
  &lt;jingle xmlns='urn:xmpp:jingle:0'
          action='transport-replace'
          initiator='romeo@montague.lit/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='voice1'&gt;
      &lt;transport xmlns='urn:xmpp:jingle:transports:raw-udp:1'&gt;
        &lt;candidate generation='0'
                   id='a9j3mnbtu1'
                   ip='10.1.1.104'
                   port='13540'/&gt;
      &lt;/transport&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">Romeo then acknowledges the transport-replace action and immediately also sends a transport-accept.</p>
    <p class="caption"><a name="example-24" id="example-24"></a>Example 24. Initiator acknowledges transport-replace</p><div class="indent"><pre>
&lt;iq from='romeo@montague.lit/orchard'
    id='replace1'
    to='juliet@capulet.lit/balcony'
    type='result'/&gt;
    </pre></div>
    <p class="caption"><a name="example-25" id="example-25"></a>Example 25. Initiator accepts new transport</p><div class="indent"><pre>
&lt;iq from='romeo@montague.lit/orchard'
    id='accept1'
    to='juliet@capulet.lit/balcony'
    type='set'&gt;
  &lt;jingle xmlns='urn:xmpp:jingle:0'
          action='transport-accept'
          initiator='romeo@montague.lit/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='responder' name='voice2'&gt;
      &lt;transport xmlns='urn:xmpp:jingle:transports:raw-udp:1'&gt;
        &lt;candidate generation='0'
                   id='a9j3mnbtu1'
                   ip='10.1.1.104'
                   port='13540'/&gt;
      &lt;/transport&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The gateway then acknowledges the acceptance on behalf of Juliet.</p>
    <p class="caption"><a name="example-26" id="example-26"></a>Example 26. Gateway acknowledges transport-accept</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.lit/balcony'
    id='accept1'
    to='romeo@montague.lit/orchard'
    type='result'/&gt;
    </pre></div>
    <p class="" style="">Eventually, the responder sends a session-accept through the gateway.</p>
    <p class="caption"><a name="example-27" id="example-27"></a>Example 27. Responder sends session-accept</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.lit/balcony'
    id='accept1'
    to='romeo@montague.lit/orchard'
    type='set'&gt;
  &lt;jingle xmlns='urn:xmpp:jingle:0'
          action='session-accept'
          initiator='romeo@montague.lit/orchard'
          responder='juliet@capulet.lit/balcony'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='voice'&gt;
      &lt;description xmlns='urn:xmpp:jingle:apps:rtp:1' media='audio'&gt;
        &lt;payload-type id='18' name='G729'/&gt;
      &lt;/description&gt;
      &lt;transport xmlns='urn:xmpp:jingle:transports:raw-udp:1'&gt;
        &lt;candidate generation='0'
                   id='a9j3mnbtu1'
                   ip='10.1.1.104'
                   port='13540'/&gt;
      &lt;/transport&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="caption"><a name="example-28" id="example-28"></a>Example 28. Initiator acknowledges session-accept</p><div class="indent"><pre>
&lt;iq from='romeo@montague.lit/orchard'
    id='accept1'
    to='juliet@capulet.lit/balcony'
    type='result'/&gt;
    </pre></div>
    <p class="" style="">The endpoints now begin to exchange session media, and can continue the session as long as desired.</p>
    <p class="" style="">Eventually, one of the endpoints terminates the session.</p>
    <p class="caption"><a name="example-29" id="example-29"></a>Example 29. Responder terminates the session</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.lit/balcony'
    id='term1'
    to='romeo@montague.lit/orchard'
    type='set'&gt;
  &lt;jingle xmlns='urn:xmpp:jingle:0'
          action='session-terminate'
          initiator='romeo@montague.lit/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;reason&gt;
      &lt;success/&gt;
      &lt;text&gt;Sorry, gotta go!&lt;/text&gt;
    &lt;/reason&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The other party then acknowledges termination of the session:</p>
    <p class="caption"><a name="example-30" id="example-30"></a>Example 30. Initiator acknowledges termination</p><div class="indent"><pre>
&lt;iq from='romeo@montague.lit/orchard'
    id='term1'
    to='juliet@capulet.lit/balcony'
    type='result'/&gt;
    </pre></div>
<h2>7.
       <a name="support" id="support">Determining Support</a></h2>
  <div class="indent"><h3>7.1 <a name="support-ice" id="support-ice">ICE Support</a></h3>
    <p class="" style="">If an entity supports the Jingle ice-udp transport, it MUST return a feature of "urn:xmpp:jingle:transports:ice-udp:0" (see <a href="#registrar-versioning">Namespace Versioning</a> regarding the possibility of incrementing the version number) in response to <span class="ref" style=""><a href="http://xmpp.org/extensions/xep-0030.html">Service Discovery</a></span>  [<a href="#nt-id2264712">14</a>] information requests.</p>
    <p class="caption"><a name="example-31" id="example-31"></a>Example 31. Service discovery information request</p><div class="indent"><pre>
&lt;iq from='romeo@montague.lit/orchard'
    id='disco1'
    to='juliet@capulet.lit/balcony'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="caption"><a name="example-32" id="example-32"></a>Example 32. Service discovery information response</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.lit/balcony'
    id='disco1'
    to='romeo@montague.lit/orchard'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;feature var='urn:xmpp:jingle:transports:ice-udp:0'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">In order for an application to determine whether an entity supports this protocol, where possible it SHOULD use the dynamic, presence-based profile of service discovery defined in <span class="ref" style=""><a href="http://xmpp.org/extensions/xep-0115.html">Entity Capabilities</a></span>  [<a href="#nt-id2264768">15</a>]. However, if an application has not received entity capabilities information from an entity, it SHOULD use explicit service discovery instead.</p>
  </div>
  <div class="indent"><h3>7.2 <a name="support-sdp" id="support-sdp">SDP Offer / Answer Support</a></h3>
    <p class="" style="">If an entity supports the SDP offer / answer model described in <span class="ref">RFC 3264</span> and therefore prefers to receive multiple candidates in a single "transport-info" action, it MUST advertise support for the "urn:ietf:rfc:3264" service discovery feature. Typically this feature will be advertised only by gateways between Jingle and SIP.</p>
    <p class="caption"><a name="example-33" id="example-33"></a>Example 33. Service discovery information request</p><div class="indent"><pre>
&lt;iq from='romeo@montague.lit/orchard'
    id='disco2'
    to='sip.shakespeare.lit'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="caption"><a name="example-34" id="example-34"></a>Example 34. Service discovery information response</p><div class="indent"><pre>
&lt;iq from='sip.shakespeare.lit'
    id='disco2'
    to='romeo@montague.lit/orchard'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    ...
    &lt;feature var='urn:ietf:rfc:3264'/&gt;
    &lt;feature var='urn:xmpp:jingle:transports:ice-udp:0'/&gt;
    ...
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
  </div>
<h2>8.
       <a name="impl" id="impl">Implementation Notes</a></h2>
  <p class="" style="">In order to speed the negotiation process so that media can flow as quickly as possible, the initiator SHOULD gather and prioritize candidates in advance, or as soon as the principal begins the process of initiating a session.</p>
<h2>9.
       <a name="deploy" id="deploy">Deployment Notes</a></h2>
  <p class="" style="">This specification applies exclusively to Jabber/XMPP clients and places no additional requirements on Jabber/XMPP servers. However, service administrators might wish to deploy a STUN server in order to ease the client-to-client negotiation process, and a TURN server for media relaying (see <span class="ref" style=""><a href="http://tools.ietf.org/html/draft-ietf-behave-turn">TURN</a></span>  [<a href="#nt-id2264886">16</a>]).</p>
<h2>10.
       <a name="security" id="security">Security Considerations</a></h2>
  <div class="indent"><h3>10.1 <a name="security-sharing" id="security-sharing">Sharing IP Addresses</a></h3>
    <p class="" style="">By definition, the exchange of transport candidates results in exposure of the sender's IP addresses, which comprise a form of personally identifying information. A Jingle client MUST enable a user to control which entities will be allowed to receive such information. If a human user explicitly accepts a session request, then the client SHOULD consider that action to imply approval of IP address sharing. However, waiting for a human user to explicitly accept the session request can result in delays during session setup, since it is more efficient to immediately begin sharing transport candidates. Therefore, it is RECOMMENDED for the client to immediately send transport candidates to a contact (without waiting for explicit user approval of the session request) in the following cases:</p>
    <ol start="" class="" style="">
      <li class="" style="">The user has permanently and formally authorized the contact to view the user's presence information via a presence subscription as reflected in an XMPP roster item (see <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc3921">XMPP IM</a></span>  [<a href="#nt-id2264962">17</a>]).</li>
      <li class="" style="">The user has temporarily and dynamically shared presence with the contact via "directed presence" as described in <span class="ref">RFC 3921</span>.</li>
      <li class="" style="">The user has explicitly added the contact to a "whitelist" of entities who are allowed to access the user's personally-identifying information.</li>
    </ol>
  </div>
  <div class="indent"><h3>10.2 <a name="security-media" id="security-media">Encryption of Media</a></h3>
    <p class="" style="">In order to secure the data stream that is negotiated via the Jingle ICE transport, implementations SHOULD use encryption methods appropriate to the transport method and media being exchanged (for details regarding RTP exchanges, refer to <span class="ref" style=""><a href="http://xmpp.org/extensions/xep-0167.html">Jingle RTP Sessions</a></span>  [<a href="#nt-id2265031">18</a>]).</p>
  </div>
<h2>11.
       <a name="iana" id="iana">IANA Considerations</a></h2>
  <p class="" style="">This document requires no interaction with the <span class="ref" style=""><a href="http://www.iana.org/">Internet Assigned Numbers Authority (IANA)</a></span>  [<a href="#nt-id2265077">19</a>].</p>
<h2>12.
       <a name="registrar" id="registrar">XMPP Registrar Considerations</a></h2>
  <div class="indent"><h3>12.1 <a name="registrar-ns" id="registrar-ns">Protocol Namespaces</a></h3>
    <p class="" style="">This specification defines the following XML namespace:</p>
    <ul class="" style="">
      <li class="" style="">urn:xmpp:jingle:transports:ice-udp:0</li>
    </ul>
    <p class="" style="">Upon advancement of this specification from a status of Experimental to a status of Draft, the <span class="ref" style=""><a href="http://xmpp.org/registrar/">XMPP Registrar</a></span>  [<a href="#nt-id2265152">20</a>] shall add the foregoing namespaces to the registry located at &lt;<a href="http://xmpp.org/registrar/namespaces.html">http://xmpp.org/registrar/namespaces.html</a>&gt;, as described in Section 4 of <span class="ref" style=""><a href="http://xmpp.org/extensions/xep-0053.html">XMPP Registrar Function</a></span>  [<a href="#nt-id2265197">21</a>].</p>
  </div>
  <div class="indent"><h3>12.2 <a name="registrar-versioning" id="registrar-versioning">Protocol Versioning</a></h3>
    <p class="" style="">If the protocol defined in this specification undergoes a revision that is not fully backwards-compatible with an older version, the XMPP Registrar shall increment the protocol version number found at the end of the XML namespaces defined herein, as described in Section 4 of <span class="ref">XEP-0053</span>.</p>
  </div>
  <div class="indent"><h3>12.3 <a name="registrar-features" id="registrar-features">Service Discovery Features</a></h3>
    <p class="" style="">If an entity supports the SDP offer / answer model described in <span class="ref">RFC 3264</span> and therefore prefers to receive one "transport-info" action with multiple candidates, it MUST advertise support for the "urn:ietf:rfc:3264" feature.</p>
    <p class="" style="">The registry submission is as follows.</p>
    <p class="caption">Registry Submission</p><div class="indent"><pre>
&lt;var&gt;
  &lt;name&gt;urn:ietf:rfc:3264&lt;/name&gt;
  &lt;desc&gt;
    Signals support for the SDP offer / answer model 
    described in RFC 3264
  &lt;/desc&gt;
  &lt;doc&gt;XEP-0176&lt;/doc&gt;
&lt;/var&gt;
    </pre></div>
  </div>
  <div class="indent"><h3>12.4 <a name="registrar-transports" id="registrar-transports">Jingle Transport Methods</a></h3>
    <p class="" style="">The XMPP Registrar shall include "ice-udp" in its registry of Jingle transport methods. The registry submission is as follows:</p>
    <p class="caption"></p><div class="indent"><pre>
&lt;transport&gt;
  &lt;name&gt;ice-udp&lt;/name&gt;
  &lt;desc&gt;
    A method for negotiation of out-of-band UDP connections 
    with built-in NAT and firewall traversal, equivalent to 
    the IETF's Interactive Connectivity Establishment (ICE) 
    methodology when resulting in the use of UDP as the
    transport protocol.
  &lt;/desc&gt;
  &lt;type&gt;datagram&lt;/type&gt;
  &lt;doc&gt;XEP-0176&lt;/doc&gt;
&lt;/transport&gt;
    </pre></div>
  </div>
<h2>13.
       <a name="schema" id="schema">XML Schema</a></h2>
  <p class="caption"></p><div class="indent"><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='urn:xmpp:jingle:transports:ice-udp:0'
    xmlns='urn:xmpp:jingle:transports:ice-udp:0'
    elementFormDefault='qualified'&gt;

  &lt;xs:element name='transport'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element name='candidate' 
                    type='candidateElementType'
                    minOccurs='0' 
                    maxOccurs='unbounded'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='pwd' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='ufrag' type='xs:string' use='optional'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:complexType name='candidateElementType'&gt;
    &lt;xs:simpleContent&gt;
      &lt;xs:extension base='empty'&gt;
        &lt;xs:attribute name='component' type='xs:unsignedByte' use='required'/&gt;
        &lt;xs:attribute name='foundation' type='xs:unsignedByte' use='required'/&gt;
        &lt;xs:attribute name='generation' type='xs:unsignedByte' use='required'/&gt;
        &lt;xs:attribute name='id' type='xs:NCName' use='required'/&gt;
        &lt;xs:attribute name='ip' type='xs:string' use='required'/&gt;
        &lt;xs:attribute name='network' type='xs:unsignedByte' use='required'/&gt;
        &lt;xs:attribute name='port' type='xs:unsignedShort' use='required'/&gt;
        &lt;xs:attribute name='priority' type='xs:positiveInteger' use='required'/&gt;
        &lt;xs:attribute name='protocol' type='xs:NCName' use='required'/&gt;
        &lt;xs:attribute name='rel-addr' type='xs:string' use='optional'/&gt;
        &lt;xs:attribute name='rel-port' type='xs:unsignedShort' use='optional'/&gt;
        &lt;xs:attribute name='rem-addr' type='xs:string' use='optional'/&gt;
        &lt;xs:attribute name='rem-port' type='xs:unsignedShort' use='optional'/&gt;
        &lt;xs:attribute name='type' use='required'&gt;
          &lt;xs:simpleType&gt;
            &lt;xs:restriction base='xs:NCName'&gt;
              &lt;xs:enumeration value='host'/&gt;
              &lt;xs:enumeration value='prflx'/&gt;
              &lt;xs:enumeration value='relay'/&gt;
              &lt;xs:enumeration value='srflx'/&gt;
            &lt;/xs:restriction&gt;
          &lt;/xs:simpleType&gt;
        &lt;/xs:attribute&gt;
      &lt;/xs:extension&gt;
    &lt;/xs:simpleContent&gt;
  &lt;/xs:complexType&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
  </pre></div>
<h2>14.
       <a name="ack" id="ack">Acknowledgements</a></h2>
  <p class="" style="">Thanks to Diana Cionoiu, Olivier Crête, Tim Julien, Steffen Larsen, Robert McQueen, Mike Ruprecht, and Paul Witty for their feedback.</p>
<hr /><a name="appendices" id="appendices"></a><h2>Appendices</h2><hr /><a name="appendix-docinfo" id="appendix-docinfo"></a><h3>Appendix A: Document Information</h3><p class="indent">
            Series: <a href="http://www.xmpp.org/extensions/">XEP</a><br />
            Number: 0176<br />
            Publisher: <a href="/xsf/">XMPP Standards Foundation</a><br />
            Status: 
            <a href="http://www.xmpp.org/extensions/xep-0001.html#states-Proposed">Proposed</a><br />
            Type:
            <a href="http://www.xmpp.org/extensions/xep-0001.html#types-Standards Track">Standards Track</a><br />
            Version: 0.23<br />
            Last Updated: 2008-12-19<br />
                Approving Body: <a href="http://www.xmpp.org/council/">XMPP Council</a><br />Dependencies: XMPP Core, XEP-0166<br />
                Supersedes: None<br />
                Superseded By: None<br />
            Short Name: N/A<br />
              Source Control: 
                <a class="standardsButton" href="http://svn.xmpp.org:18080/browse/XMPP/trunk/extensions/xep-0176.xml">HTML</a> 
                <a class="standardsButton" href="http://svn.xmpp.org:18080//changelog/~rss/XMPP/trunk/extensions/xep-0176.xml/rss.xml">RSS</a></p><hr /><a name="appendix-authorinfo" id="appendix-authorinfo"></a><h3>Appendix B: Author Information</h3><div class="indent"><h3>Joe Beda</h3><p class="indent">
        Email:
        <a href="mailto:jbeda@google.com">jbeda@google.com</a><br />
        JabberID: 
        <a href="xmpp:jbeda@google.com">jbeda@google.com</a><br /></p><h3>Scott Ludwig</h3><p class="indent">
        Email:
        <a href="mailto:scottlu@google.com">scottlu@google.com</a><br />
        JabberID: 
        <a href="xmpp:scottlu@google.com">scottlu@google.com</a><br /></p><h3>Peter Saint-Andre</h3><p class="indent">
        JabberID: 
        <a href="xmpp:stpeter@jabber.org">stpeter@jabber.org</a><br />
        URI: 
        <a href="https://stpeter.im/">https://stpeter.im/</a><br /></p><h3>Joe Hildebrand</h3><p class="indent">
        Email:
        <a href="mailto:jhildebrand@jabber.com">jhildebrand@jabber.com</a><br />
        JabberID: 
        <a href="xmpp:hildjj@jabber.org">hildjj@jabber.org</a><br /></p><h3>Sean Egan</h3><p class="indent">
        Email:
        <a href="mailto:seanegan@google.com">seanegan@google.com</a><br />
        JabberID: 
        <a href="xmpp:seanegan@google.com">seanegan@google.com</a><br /></p></div><hr /><a name="appendix-legal" id="appendix-legal"></a><h3>Appendix C: Legal Notices</h3><div class="indent"><h4>Copyright</h4>This XMPP Extension Protocol is copyright (c) 1999 - 2009 by the <a href="http://xmpp.org/">XMPP Standards Foundation</a> (XSF).<h4>Permissions</h4>Permission is hereby granted, free of charge, to any person obtaining a copy of this specification (the "Specification"), to make use of the Specification without restriction, including without limitation the rights to implement the Specification in a software program, deploy the Specification in a network service, and copy, modify, merge, publish, translate, distribute, sublicense, or sell copies of the Specification, and to permit persons to whom the Specification is furnished to do so, subject to the condition that the foregoing copyright notice and this permission notice shall be included in all copies or substantial portions of the Specification. Unless separate permission is granted, modified works that are redistributed shall not contain misleading information regarding the authors, title, number, or publisher of the Specification, and shall not claim endorsement of the modified works by the authors, any organization or project to which the authors belong, or the XMPP Standards Foundation.<h4>Disclaimer of Warranty</h4><span style="font-weight: bold">## NOTE WELL: This Specification is provided on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE. In no event shall the XMPP Standards Foundation or the authors of this Specification be liable for any claim, damages, or other liability, whether in an action of contract, tort, or otherwise, arising from, out of, or in connection with the Specification or the implementation, deployment, or other use of the Specification. ##</span><h4>Limitation of Liability</h4>In no event and under no legal theory, whether in tort (including negligence), contract, or otherwise, unless required by applicable law (such as deliberate and grossly negligent acts) or agreed to in writing, shall the XMPP Standards Foundation or any author of this Specification be liable for damages, including any direct, indirect, special, incidental, or consequential damages of any character arising out of the use or inability to use the Specification (including but not limited to damages for loss of goodwill, work stoppage, computer failure or malfunction, or any and all other commercial damages or losses), even if the XMPP Standards Foundation or such author has been advised of the possibility of such damages.<h4>IPR Conformance</h4>This XMPP Extension Protocol has been contributed in full conformance with the XSF's Intellectual Property Rights Policy (a copy of which may be found at &lt;<a href="http://xmpp.org/extensions/ipr-policy.shtml">http://xmpp.org/extensions/ipr-policy.shtml</a>&gt; or obtained by writing to XSF, P.O. Box 1641, Denver, CO 80201 USA).</div><hr /><a name="appendix-xmpp" id="appendix-xmpp"></a><h3>Appendix D: Relation to XMPP</h3><p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 3920) and XMPP IM (RFC 3921) specifications contributed by the XMPP Standards Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this document has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p><hr /><a name="appendix-discuss" id="appendix-discuss"></a><h3>Appendix E: Discussion Venue</h3><p class="indent">There exists a special venue for discussion related to the technology described in this document: the &lt;<a href="http://mail.jabber.org/mailman/listinfo/jingle">jingle@xmpp.org</a>&gt; mailing list.</p><p class="indent">The primary venue for discussion of XMPP Extension Protocols is the &lt;<a href="http://mail.jabber.org/mailman/listinfo/standards">standards@xmpp.org</a>&gt; discussion list.</p><p class="indent">Discussion on other xmpp.org discussion lists might also be appropriate; see &lt;<a href="http://xmpp.org/about/discuss.shtml">http://xmpp.org/about/discuss.shtml</a>&gt; for a complete list.</p><p class="indent">Errata may be sent to &lt;<a href="mailto:editor@xmpp.org">editor@xmpp.org</a>&gt;.</p><hr /><a name="appendix-conformance" id="appendix-conformance"></a><h3>Appendix F: Requirements Conformance</h3><p class="indent">The following requirements keywords as used in this document are to be interpreted as described in <a href="http://www.ietf.org/rfc/rfc2119.txt">RFC 2119</a>: "MUST", "SHALL", "REQUIRED"; "MUST NOT", "SHALL NOT"; "SHOULD", "RECOMMENDED"; "SHOULD NOT", "NOT RECOMMENDED"; "MAY", "OPTIONAL".</p><hr /><a name="appendix-notes" id="appendix-notes"></a><h3>Appendix G: Notes</h3><div class="indent"><p><a name="nt-id2261717" id="nt-id2261717">1</a>. XEP-0166: Jingle &lt;<a href="http://xmpp.org/extensions/xep-0166.html">http://xmpp.org/extensions/xep-0166.html</a>&gt;.</p><p><a name="nt-id2261749" id="nt-id2261749">2</a>. RFC 768: User Datagram Protocol &lt;<a href="http://tools.ietf.org/html/rfc0768">http://tools.ietf.org/html/rfc0768</a>&gt;.</p><p><a name="nt-id2261779" id="nt-id2261779">3</a>. Interactive Connectivity Establishment (ICE): A Methodology for Network Address Translator (NAT) Traversal for Offer/Answer Protocols &lt;<a href="http://tools.ietf.org/html/draft-ietf-mmusic-ice">http://tools.ietf.org/html/draft-ietf-mmusic-ice</a>&gt;. Work in progress.</p><p><a name="nt-id2261884" id="nt-id2261884">4</a>. RFC 3264: An Offer/Answer Model with the Session Description Protocol (SDP) &lt;<a href="http://tools.ietf.org/html/rfc3264">http://tools.ietf.org/html/rfc3264</a>&gt;.</p><p><a name="nt-id2261918" id="nt-id2261918">5</a>. RFC 4566: SDP: Session Description Protocol &lt;<a href="http://tools.ietf.org/html/rfc4566">http://tools.ietf.org/html/rfc4566</a>&gt;.</p><p><a name="nt-id2262135" id="nt-id2262135">6</a>. RFC 3550: RTP: A Transport Protocol for Real-Time Applications &lt;<a href="http://tools.ietf.org/html/rfc3550">http://tools.ietf.org/html/rfc3550</a>&gt;.</p><p><a name="nt-id2262434" id="nt-id2262434">7</a>. Concurrent with negotiation of the ICE candidates, it is possible for the initiator and responder to negotiate which content types the session will include, which transport methods will be tried for each content type, etc. Those negotiation flows are shown in other specifications, such as <span class="ref">XEP-0166</span>. This document specifies only negotiation of the ICE transport method.</p><p><a name="nt-id2262483" id="nt-id2262483">8</a>. RFC 3920: Extensible Messaging and Presence Protocol (XMPP): Core &lt;<a href="http://tools.ietf.org/html/rfc3920">http://tools.ietf.org/html/rfc3920</a>&gt;.</p><p><a name="nt-id2262890" id="nt-id2262890">9</a>. In accordance with the rules specified in Section 4.1.1 of <span class="ref">ICE-CORE</span>, the priority values shown in the examples within this document have been calculated as follows. The "type preference" for host candidates is stipulated to be "126" and for server reflexive candidates "100". The "local preference" for network 0 is stipulated to be "4096", for network 1 "2048", and for network 2 "1024".</p><p><a name="nt-id2263178" id="nt-id2263178">10</a>. The fact that both parties send candidates means that Jingle requires each party to be a full implementation of ICE, not a lite implementation as specified in <span class="ref">ICE-CORE</span>.</p><p><a name="nt-id2263473" id="nt-id2263473">11</a>. RFC 5389: Session Traversal Utilities for NAT (STUN) &lt;<a href="http://tools.ietf.org/html/rfc5389">http://tools.ietf.org/html/rfc5389</a>&gt;.</p><p><a name="nt-id2263552" id="nt-id2263552">12</a>. Thus when Romeo sends a STUN Binding Request to Juliet the credentials will be STUN username "8hhy:9uB6" and password "YH75Fviy6338Vbrhrlp8Yh" whereas when Juliet sends a STUN Binding Request to Romeo the credentials will be STUN username "9uB6:8hhy" and password "asd88fgpdd777uzjYhagZg".</p><p><a name="nt-id2264203" id="nt-id2264203">13</a>. XEP-0177: Jingle Raw UDP Transport Method &lt;<a href="http://xmpp.org/extensions/xep-0177.html">http://xmpp.org/extensions/xep-0177.html</a>&gt;.</p><p><a name="nt-id2264712" id="nt-id2264712">14</a>. XEP-0030: Service Discovery &lt;<a href="http://xmpp.org/extensions/xep-0030.html">http://xmpp.org/extensions/xep-0030.html</a>&gt;.</p><p><a name="nt-id2264768" id="nt-id2264768">15</a>. XEP-0115: Entity Capabilities &lt;<a href="http://xmpp.org/extensions/xep-0115.html">http://xmpp.org/extensions/xep-0115.html</a>&gt;.</p><p><a name="nt-id2264886" id="nt-id2264886">16</a>. Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN) &lt;<a href="http://tools.ietf.org/html/draft-ietf-behave-turn">http://tools.ietf.org/html/draft-ietf-behave-turn</a>&gt;. Work in progress.</p><p><a name="nt-id2264962" id="nt-id2264962">17</a>. RFC 3921: Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence &lt;<a href="http://tools.ietf.org/html/rfc3921">http://tools.ietf.org/html/rfc3921</a>&gt;.</p><p><a name="nt-id2265031" id="nt-id2265031">18</a>. XEP-0167: Jingle RTP Sessions &lt;<a href="http://xmpp.org/extensions/xep-0167.html">http://xmpp.org/extensions/xep-0167.html</a>&gt;.</p><p><a name="nt-id2265077" id="nt-id2265077">19</a>. The Internet Assigned Numbers Authority (IANA) is the central coordinator for the assignment of unique parameter values for Internet protocols, such as port numbers and URI schemes. For further information, see &lt;<a href="http://www.iana.org/">http://www.iana.org/</a>&gt;.</p><p><a name="nt-id2265152" id="nt-id2265152">20</a>. The XMPP Registrar maintains a list of reserved protocol namespaces as well as registries of parameters used in the context of XMPP extension protocols approved by the XMPP Standards Foundation. For further information, see &lt;<a href="http://xmpp.org/registrar/">http://xmpp.org/registrar/</a>&gt;.</p><p><a name="nt-id2265197" id="nt-id2265197">21</a>. XEP-0053: XMPP Registrar Function &lt;<a href="http://xmpp.org/extensions/xep-0053.html">http://xmpp.org/extensions/xep-0053.html</a>&gt;.</p></div><hr /><a name="appendix-revs" id="appendix-revs"></a><h3>Appendix H: Revision History</h3><div class="indent"><h4>Version 0.23 (2008-12-19)</h4><div class="indent"><p class="" style="">Specified id attribute and added it to the examples; updated namespaces to reflect changes to other Jingle specifications; completed editorial review.</p> (psa)
    </div><h4>Version 0.22 (2008-09-30)</h4><div class="indent"><p class="" style="">Corrected fallback scenario to use transport-replace and transport-accept.</p> (psa)
    </div><h4>Version 0.21 (2008-09-25)</h4><div class="indent">
      <ul class="" style="">
        <li class="" style="">Added section on fallback to Raw UDP transport method.</li>
        <li class="" style="">Modified namespaces to incorporate namespace versioning.</li>
        <li class="" style="">Cleaned up XML schemas.</li>
      </ul>
     (psa)
    </div><h4>Version 0.20 (2008-07-31)</h4><div class="indent"><p class="" style="">For consistency with XEP-0166, removed profile attribute, changed content-replace to transport-replace, and changed content-accept to transport-accept.</p> (psa)
    </div><h4>Version 0.19 (2008-06-04)</h4><div class="indent"><p class="" style="">Allowed batching of multiple candidates in a single transport-info action for optional interworking with the SDP offer-answer model, and added urn:ietf:rfc:3264 service discovery feature to advertise such support; updated security considerations regarding sharing of IP addresses.</p> (psa)
    </div><h4>Version 0.18 (2008-05-28)</h4><div class="indent"><p class="" style="">Removed content-replace action from acceptance flow, since in ICE that information is sent via STUN, not in the signalling channel.</p> (psa)
    </div><h4>Version 0.17 (2008-03-20)</h4><div class="indent"><p class="" style="">Moved pwd and ufrag attributes from candidate element to transport element since they describe session-level or media-level information.</p> (psa)
    </div><h4>Version 0.16 (2008-02-29)</h4><div class="indent"><p class="" style="">Changed content-modify to content-replace per XEP-0166.</p> (psa)
    </div><h4>Version 0.15 (2008-01-06)</h4><div class="indent"><p class="" style="">Clarified several small points regarding candidate gathering procedures and STUN connectivity checks.</p> (psa)
    </div><h4>Version 0.14 (2008-01-02)</h4><div class="indent"><p class="" style="">Modified flow for ICE completion to require content-modify from initiator to responder, thus mapping to sending of revised offer in SIP; added rem-addr and rem-port attributes to map to a=remote-candidates information in SDP; changed raddr and rport attributes to rel-addr and rel-port to prevent confusion with rem-addr and rem-port attributes.</p> (psa)
    </div><h4>Version 0.13 (2007-12-28)</h4><div class="indent"><p class="" style="">Added further details about connectivity checks; defined raddr and rport attributes for complete mapping to SDP.</p> (psa)
    </div><h4>Version 0.12 (2007-11-28)</h4><div class="indent"><p class="" style="">Moved ice-tcp definition to a separate specification.</p> (psa)
    </div><h4>Version 0.11 (2007-11-27)</h4><div class="indent"><p class="" style="">Further editorial review; also added sections on modification of existing candidates and exchange of subsequent candidates.</p> (psa)
    </div><h4>Version 0.10 (2007-11-15)</h4><div class="indent"><p class="" style="">Editorial review and consistency check.</p> (psa)
    </div><h4>Version 0.9 (2007-06-28)</h4><div class="indent"><p class="" style="">Updated to track ICE-16.</p> (psa)
    </div><h4>Version 0.8 (2007-04-17)</h4><div class="indent"><p class="" style="">Separately defined ice-tcp and ice-udp transport methods to enable clearer definition of transport methods and reuse by application types; specified Jingle conformance, including definition of ice-udp as datagram and ice-tcp as streaming.</p> (psa)
    </div><h4>Version 0.7 (2007-03-23)</h4><div class="indent"><p class="" style="">Updated to track ICE-14 and ICE-TCP-03; moved text on discovery of STUN servers to separate specification.</p> (psa)
    </div><h4>Version 0.6 (2006-12-21)</h4><div class="indent"><p class="" style="">Modified spec to use provisional namespace before advancement to Draft (per XEP-0053).</p> (psa)
    </div><h4>Version 0.5 (2006-10-31)</h4><div class="indent"><p class="" style="">Updated to track ICE-12; corrected service discovery process; completed editorial review; removed mention of DTMF, which is for audio only.</p> (psa)
    </div><h4>Version 0.4 (2006-09-13)</h4><div class="indent"><p class="" style="">Updated to track ICE-10; added section on service discovery.</p> (psa)
    </div><h4>Version 0.3 (2006-07-12)</h4><div class="indent"><p class="" style="">Specified that DTMF must use in-band signalling (XEP-0181).</p> (se/psa)
    </div><h4>Version 0.2 (2006-03-24)</h4><div class="indent"><p class="" style="">Recommended use of RTP-native methods for DTMF.</p> (psa)
    </div><h4>Version 0.1 (2006-03-01)</h4><div class="indent"><p class="" style="">Initial version (split from XEP-0166).</p> (psa/jb)
    </div></div><hr /><p>END</p></body></html>
