<!DOCTYPE html>
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>XEP-0490: Message Displayed Synchronization</title><style type="text/css">
/* don't mind this hack */
nav#toc h2:before {
display: none;
content: "XEP-0490";
}
        </style><link rel="stylesheet" type="text/css" href="xmpp.css"><link href="prettify.css" type="text/css" rel="stylesheet"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico"><script type="text/javascript" src="prettify.js"></script><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="DC.Title" content="Message Displayed Synchronization"><meta name="DC.Creator" content="Daniel Gultsch"><meta name="DC.Description" content="This specification allows multiple clients of the same user to synchronize the displayed state of their chats."><meta name="DC.Publisher" content="XMPP Standards Foundation"><meta name="DC.Contributor" content="XMPP Extensions Editor"><meta name="DC.Date" content="2024-03-26"><meta name="DC.Type" content="XMPP Extension Protocol"><meta name="DC.Format" content="XHTML"><meta name="DC.Identifier" content="XEP-0490"><meta name="DC.Language" content="en"><meta name="DC.Rights" content="This XMPP Extension Protocol is copyright © 1999 – 2024 by the XMPP Standards Foundation (XSF)."></head><body onload="prettyPrint()"><h1>XEP-0490: Message Displayed Synchronization</h1><div class="docmeta-wrap"><dl id="docmeta" class="compact"><dt>Abstract</dt><dd>This specification allows multiple clients of the same user to synchronize the displayed state of their chats.</dd><dt>Author</dt><dd>Daniel Gultsch</dd><dt>Copyright</dt><dd>© 2024 – 2024 XMPP Standards Foundation. <a href="#appendix-legal">SEE LEGAL NOTICES</a>.</dd><dt>Status</dt><dd><p>Experimental</p><div id="status-notice" class="experimental standards track">WARNING: This Standards-Track document is Experimental. Publication as an XMPP Extension Protocol does not imply approval of this proposal by the XMPP Standards Foundation. Implementation of the protocol described herein is encouraged in exploratory implementations, but production systems are advised to carefully consider whether it is appropriate to deploy implementations of this protocol before it advances to a status of Draft.</div></dd><dt>Type</dt><dd>Standards Track</dd><dt>Version</dt><dd>0.1.0 (2024-03-26)</dd></dl><div class="timeline-wrap"><div class="timeline-head">Document Lifecycle</div><ol class="timeline"><li class="current">Experimental</li><li>Proposed</li><li>Stable</li><li>Final</li></ol></div></div><nav id="toc"><a href="#top"><h2>Table of Contents</h2></a><ol class="toc"><li><a href="#intro">Introduction</a></li><li><a href="#reqs">Requirements</a></li><li><a href="#glossary">Glossary</a></li><li><a href="#usecases">Use Cases</a><ol><li><a href="#pep-node">Server-side persistence</a></li><li><a href="#publish">Flagging chat as displayed</a></li><li><a href="#notify">Retrieving notifications</a></li><li><a href="#catchup">Catching up</a></li><li><a href="#interaction">Interaction with Displayed Markers and Server Assist</a><ol><li><a href="#sect-id10">Server assist</a></li><li><a href="#sect-id11">Discovering support</a></li><li><a href="#sect-id12">Sending assisted displayed</a></li></ol></li></ol></li><li><a href="#rules">Business Rules</a><ol><li><a href="#rules-client">Client</a></li><li><a href="#rules-server">Server</a></li></ol></li><li><a href="#access">Accessibility Considerations</a></li><li><a href="#security">Security Considerations</a></li><li><a href="#privacy">Privacy Considerations</a></li><li><a href="#iana">IANA Considerations</a></li><li><a href="#design">Design Considerations</a><ol><li><a href="#distinct-element">Distinct Element for Server Assist</a></li><li><a href="#server-assist-wo-marker">Server Assist without Display Markers</a></li></ol></li><li><a href="#registrar">XMPP Registrar Considerations</a></li><li><a href="#schema">XML Schema</a></li></ol><h6><a href="#appendices">Appendices</a></h6><ol class="toc-appendices"><li><a href="#appendix-docinfo">Document Information</a></li><li><a href="#appendix-authorinfo">Author Information</a></li><li><a href="#appendix-legal">Legal Notices</a></li><li><a href="#appendix-xmpp">Relation to XMPP</a></li><li><a href="#appendix-discuss">Discussion Venue</a></li><li><a href="#appendix-conformance">Requirements Conformance</a></li><li><a href="#appendix-notes">Notes</a></li><li><a href="#appendix-revs">Revision History</a></li><li><a href="#appendix-biblatex">Bib(La)Tex Entry</a></li></ol></nav><h2 id="intro">1.
       Introduction<a class="anchor-link" href="#intro"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">In multi-device environments marking a chat as <em>displayed</em> on one device should mark that chat as <em>displayed</em> on all devices. Historically carbon copies (<span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0280.html">Message Carbons (XEP-0280)</a></span>  [<a href="#nt-id25">1</a>]) of the &lt;displayed/&gt; element of Displayed Markers (<span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0333.html">Displayed Markers (was: Chat Markers) (XEP-0333)</a></span>  [<a href="#nt-id26">2</a>]) have been used to achieve this effect. However this approach has a couple of downsides that this specification is trying eliminate:</p>
  <ul class="" style="">
    <li class="" style="">The contact has to request Displayed Markers by tagging a message with &lt;markable/&gt;.</li>
    <li class="" style="">Displayed Markers let the contact know that a device has displayed the message. This might not always be advisable when synchronization across multiple devices of the same user is the desired outcome.</li>
    <li class="" style="">When used in large group chats Displayed Markers can create a lot of unwanted traffic.</li>
  </ul>
  <p class="" style="">This specification isolates the task of multi-device synchronization from providing information to the contact, while borrowing some of the semantics of Displayed Markers such as <em>displayed</em> refering to all messages up to this point.</p>
<h2 id="reqs">2.
       Requirements<a class="anchor-link" href="#reqs"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <ul class="" style="">
    <li class="" style="">Basic functionality should only have minimal server requirements (<span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0163.html">Personal Eventing Protocol (XEP-0163)</a></span>  [<a href="#nt-id27">3</a>] and <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0223.html">Best Practices for Persistent Storage of Private Data via Publish-Subscribe (XEP-0223)</a></span>  [<a href="#nt-id28">4</a>]).</li>
    <li class="" style="">Rely on server-injected &lt;stanza-id/&gt; (see <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0359.html">Unique and Stable Stanza IDs (XEP-0359)</a></span>  [<a href="#nt-id29">5</a>]) to provide unique and stable IDs. While this is commonly done as part of <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0313.html">Message Archive Management (XEP-0313)</a></span>  [<a href="#nt-id30">6</a>] it does not technically depend on the message being archived.</li>
    <li class="" style="">Define the interaction with <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0333.html">Displayed Markers (was: Chat Markers) (XEP-0333)</a></span>  [<a href="#nt-id26">2</a>].</li>
    <li class="" style="">Provide optional methods for traffic optimizations on supporting servers.</li>
    <li class="" style="">Make no assertions on what constitutes an <em>open</em> or <em>archived</em> chat. This specification allows clients to state that they have displayed messages in a certain chat up to a certain point. It does not indicate that a chat is open or in case of group chats joined.</li>
  </ul>
<h2 id="glossary">3.
       Glossary<a class="anchor-link" href="#glossary"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <div class="indent"><dl>
    
      <dt><strong>Displayed</strong></dt>
      <dd>
          Colloquially this is also known as <em>read</em>. However since a common implementation of <em>read</em> is: "shown on screen, in full, in the context of the chat", and this gives no indication on whether the user has actually read a message, <em>displayed</em> was chosen as a more accurate terminology. A message might also be manually acknowledged by the user, for example via a <em>mark as read</em> action in a notification. Implementations are also possible, for example in smart home devices or infotainment systems, where the message is read aloud by a Text-to-Speech system, but never actually displayed. It is up to the implementors discretion to determine what the best approximation of <em>the user has had a reasonable chance to mentally process the message</em> is.          
      </dd>
    
  </dl></div>
<h2 id="usecases">4.
       Use Cases<a class="anchor-link" href="#usecases"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <div class="indent"><h3 id="pep-node">4.1 Server-side persistence<a class="anchor-link" href="#pep-node"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">Clients use items in a private PEP (<span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0163.html">Personal Eventing Protocol (XEP-0163)</a></span>  [<a href="#nt-id27">3</a>]) node called 'urn:xmpp:mds:displayed:0' to synchronize and persist the displayed state (See <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0223.html">Best Practices for Persistent Storage of Private Data via Publish-Subscribe (XEP-0223)</a></span>  [<a href="#nt-id28">4</a>]). The item ID corresponds to the JID of the respective chat. For normal, 1:1 chats this SHOULD be the bare JID of the contact, for group chats this SHOULD be the bare JID of the room and for private messages in group chats the full JID of the participant.</p>
    <p class="" style="">The item contains a single &lt;displayed/&gt; element qualified by the 'xrn:xmpp:mds:displayed:0' namespace. The &lt;displayed/&gt; element MUST contain exactly one <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0359.html">Unique and Stable Stanza IDs (XEP-0359)</a></span>  [<a href="#nt-id29">5</a>] &lt;stanza-id/&gt; element that corresponds to the stanza-id of the most recent, displayed message, in that particular chat.</p>
  </div>
  <div class="indent"><h3 id="publish">4.2 Flagging chat as displayed<a class="anchor-link" href="#publish"><abbr title="Link to this point in the document">¶</abbr></a></h3>
  <p class="" style="">Only messages <strong>received</strong> by the user (meaning sent by third parties such as a contact, a participant in a group chat, etc) SHOULD be flagged as 'displayed'. However since 'displayed' means <em>all messages up to this point</em> and the stanza-id of a message <strong>sent</strong> by the user indicates a valid point in the chat history, sent messages MAY be flagged as well.</p>
  <p class="" style="">Flagging a chat as <em>displayed up to this point</em> happens by publishing a PEP item with an id corresponding to the JID of the chat and a &lt;displayed/&gt; payload element into the 'urn:xmpp:mds:displayed:0' node.</p>
  <p class="" style="">For group chats the &lt;stanza-id/&gt; child of the &lt;displayed/&gt; element refers to the stanza-id injected by the room. For all other chats the stanza-id child refers to the stanza-id injected by the user’s server (the server hosting the user account).</p>
  <p class="" style="">The client MUST include appropriate publish-options in the publication, including, but not limited to, setting the access model to whitelist and the max-items to max.</p>
  <figure class="code-example" id="example-1"><figcaption><strong>Example 1.</strong> Client marks a chat as display<a class="anchor-link" href="#example-1"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony' type='set' id='flag-as-displayed-1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;publish node='urn:xmpp:mds:displayed:0'&gt;
      &lt;item id='romeo@montegue.lit'&gt;
        &lt;displayed xmlns='urn:xmpp:mds:displayed:0'&gt;
          &lt;stanza-id xmlns='urn:xmpp:sid:0'
                     by='juliet@capulet.lit'
                     id='0f710f2b-52ed-4d52-b928-784dad74a52b'/&gt;
        &lt;/display&gt;
      &lt;/item&gt;
    &lt;/publish&gt;
    &lt;publish-options&gt;
      &lt;x xmlns='jabber:x:data' type='submit'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
          &lt;value&gt;http://jabber.org/protocol/pubsub#publish-options&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#persist_items'&gt;
          &lt;value&gt;true&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#max_items'&gt;
          &lt;value&gt;max&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#send_last_published_item'&gt;
          &lt;value&gt;never&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#access_model'&gt;
          &lt;value&gt;whitelist&lt;/value&gt;
        &lt;/field&gt;
      &lt;/x&gt;
    &lt;/publish-options&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    <figure class="code-example" id="example-2"><figcaption><strong>Example 2.</strong> Server acknowledges successful storage<a class="anchor-link" href="#example-2"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq to='juliet@capulet.lit/balcony' type='result' id='flag-as-displayed-1'/&gt;
</pre></figure>
  </div>
  <div class="indent"><h3 id="notify">4.3 Retrieving notifications<a class="anchor-link" href="#notify"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">A client interested in synchronizing the displayed state with other clients SHOULD include the 'urn:xmpp:mds:displayed:0+notify' feature in its <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0115.html">Entity Capabilities (XEP-0115)</a></span>  [<a href="#nt-id31">7</a>], as per <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0163.html">Personal Eventing Protocol (XEP-0163)</a></span>  [<a href="#nt-id27">3</a>] rules.</p>
  </div>
  <div class="indent"><h3 id="catchup">4.4 Catching up<a class="anchor-link" href="#catchup"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">Upon bind and initial presence a client retrieves all items in the 'urn:xmpp:mds:displayed:0' node to learn what changes to the displayed state have occured while the client was offline.</p>
    <figure class="code-example" id="example-3"><figcaption><strong>Example 3.</strong> Client retrieves all displayed items<a class="anchor-link" href="#example-3"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony' type='get' id='catchup-1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;items node='urn:xmpp:mds:displayed:0'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    <figure class="code-example" id="example-4"><figcaption><strong>Example 4.</strong> Server returns the displayed states for various chat<a class="anchor-link" href="#example-4"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    to='juliet@capulet.lit/balcony'
    id='catchup-1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;items node='urn:xmpp:mds:displayed:0'&gt;
      &lt;item id='romeo@montegue.lit'&gt;
        &lt;displayed xmlns='urn:xmpp:mds:displayed:0'&gt;
          &lt;stanza-id xmlns='urn:xmpp:sid:0'
                     id='0f710f2b-52ed-4d52-b928-784dad74a52b'
                     by='juliet@capulet.lit'/&gt;
        &lt;/displayed&gt;
      &lt;/item&gt;
      &lt;item id='example@conference.shakespeare.lit'&gt;
        &lt;displayed xmlns='urn:xmpp:mds:displayed:0'
          &lt;stanza-id xmlns='urn:xmpp:sid:0'
                     id='ca21deaf-812c-48f1-8f16-339a674f2864'
                     by='example@conference.shakespeare.lit'/&gt;
        &lt;/displayed&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
  </div>
  <div class="indent"><h3 id="interaction">4.5 Interaction with Displayed Markers and Server Assist<a class="anchor-link" href="#interaction"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">A <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0333.html">Displayed Markers (was: Chat Markers) (XEP-0333)</a></span>  [<a href="#nt-id26">2</a>] displayed marker refers to the message id set by the sender of the message whereas the displayed element defined in this specification refers to the stanza-id injected by the user’s server.</p>
    <p class="" style="">In the likely scenario that a client wishes to share the displayed state with their own devices and the sender of the message, a client SHOULD sent a <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0333.html">Displayed Markers (was: Chat Markers) (XEP-0333)</a></span>  [<a href="#nt-id26">2</a>] displayed marker and ensure that the 'urn:xmpp:mds:displayed:0' node gets updated.</p>
    <div class="indent"><h4 id="sect-id10">4.5.1 Server assist<a class="anchor-link" href="#sect-id10"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">A <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0060.html">Publish-Subscribe (XEP-0060)</a></span>  [<a href="#nt-id32">8</a>] item publication is a fairly verbose operation for something that is expected to happen rather frequently. Therfore this specification defines an optional way to combine the PEP node item update and the Displayed Marker in one simple message.</p>
    </div>
    <div class="indent"><h4 id="sect-id11">4.5.2 Discovering support<a class="anchor-link" href="#sect-id11"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">Server assisted displayed node updates are an optional feature a user’s server can provide. To signal support the server announces an <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0115.html">Entity Capabilities (XEP-0115)</a></span>  [<a href="#nt-id31">7</a>] feature of 'urn:xmpp:mds:server-assist:0' on the account.</p>
      <figure class="code-example" id="example-5"><figcaption><strong>Example 5.</strong> Client queries for server features<a class="anchor-link" href="#example-5"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='get' id='disco-1' to='juliet@capulet.lit' from='juliet@capulet.lit/balcony'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;
</pre></figure>
      <figure class="code-example" id="example-6"><figcaption><strong>Example 6.</strong> Server responds with features<a class="anchor-link" href="#example-6"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result' id='disco1' from='juliet@capulet.lit' to='juliet@capulet.lit/balcony'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;feature var='urn:xmpp:mds:server-assist:0'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
</pre></figure>
    </div>
    <div class="indent"><h4 id="sect-id12">4.5.3 Sending assisted displayed<a class="anchor-link" href="#sect-id12"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">To update the displayed item in the 'urn:xmpp:mds:displayed:0' PEP node more efficiently a client MAY send a message with the 'to' attribute set to the item id (which is equivalent to the JID of the contact) and with a &lt;displayed/&gt; element qualified by the 'urn:xmpp:mds:displayed:0' namespace. The server MUST strip the &lt;displayed/&gt; element from the message and continue to process it normally. The server MUST publish a PEP item on the 'urn:xmpp:mds:displayed:0' node where the item id is taken from the 'to' attribute and the payload is the &lt;displayed/&gt; element. A client MUST NOT include the &lt;displayed/&gt; element qualified by the 'urn:xmpp:mds:displayed:0' namespace if the message would otherwise be empty. A client that wishes to update the device synchronized displayed state but not inform the sender of the message via Displayed Markers SHOULD use the regular PubSub publication process.</p>
      <figure class="code-example" id="example-7"><figcaption><strong>Example 7.</strong> Juliet receives a message from Romeo<a class="anchor-link" href="#example-7"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;message to='juliet@capulet.lit' from='romeo@montegue.lit/orchard' id='the-msg-1'&gt;
  &lt;body&gt;Hi. How are you?&lt;/body&gt;
  &lt;markable xmlns='urn:xmpp:chat-markers:0'/&gt;
  &lt;stanza-id xmlns='urn:xmpp:sid:0' by='juliet@capulet.lit' id='0423e3a9-d516-493d-bb06-bee0e51ab9fb'/&gt;
&lt;/message&gt;
</pre></figure>
      <figure class="code-example" id="example-8"><figcaption><strong>Example 8.</strong> Juliet lets both Romeo and her other devices know she has displayed the message<a class="anchor-link" href="#example-8"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;message to='romeo@montegue.lit'&gt;
   &lt;displayed xmlns='urn:xmpp:chat-markers:0' id='the-msg-1'/&gt;
   &lt;displayed xmlns='urn:xmpp:mds:displayed:0'&gt;
     &lt;stanza-id xmlns='urn:xmpp:sid:0' by='juliet@capulet.lit' id='0423e3a9-d516-493d-bb06-bee0e51ab9fb'/&gt;
   &lt;/displayed&gt;
&lt;/message&gt;
</pre></figure>
   <figure class="code-example" id="example-9"><figcaption><strong>Example 9.</strong> Juliet’s server strips the displayed element used for server assist and forwards the stanza to Romeo<a class="anchor-link" href="#example-9"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;message to='romeo@montegue.lit' from='juliet@capulet.let/balcony'&gt;
   &lt;displayed xmlns='urn:xmpp:chat-markers:0' id='the-msg-1'/&gt;
&lt;/message&gt;
</pre></figure>
      <figure class="code-example" id="example-10"><figcaption><strong>Example 10.</strong> Server sends out PEP notifications to Juliets connected devices<a class="anchor-link" href="#example-10"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;message from='juliet@capulet.lit' to='juliet@capulet.lit/balcony' type='headline' id='new-displayed-pep-event'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='urn:xmpp:mds:displayed:0'&gt;
      &lt;item id='romeo@montegue.lit'&gt;
        &lt;displayed xmlns='urn:xmpp:mds:displayed:0'&gt;
          &lt;stanza-id xmlns='urn:xmpp:sid:0' by='juliet@capulet.lit' id='0423e3a9-d516-493d-bb06-bee0e51ab9fb'/&gt;
        &lt;/displayed&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;
</pre></figure>
    </div>
  </div>
<h2 id="rules">5.
       Business Rules<a class="anchor-link" href="#rules"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <div class="indent"><h3 id="rules-client">5.1 Client<a class="anchor-link" href="#rules-client"><abbr title="Link to this point in the document">¶</abbr></a></h3>   
  <ul class="" style="">
      <li class="" style="">The displayed state only moves forward. Receiving a displayed state with a stanza-id that references a message older than the current local representation is considered redundant and MUST be ignored.</li>
      <li class="" style="">Displayed states with a stanza-id not found in the respective chat MUST be ignored.</li>
      <li class="" style="">Receiving an outgoing message (for example via <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0280.html">Message Carbons (XEP-0280)</a></span>  [<a href="#nt-id25">1</a>] or <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0313.html">Message Archive Management (XEP-0313)</a></span>  [<a href="#nt-id30">6</a>]) SHOULD NOT mark the chat as displayed. Outgoing messages are neutral towards the overall displayed state of a given chat. For example if the <em>displayed up to</em> state references the most recent incoming message and this message is only followed by outgoing messages the overall state of that chat SHOULD be considered <em>displayed</em>.</li>
      <li class="" style="">A client receiving an outgoing message MAY NOT update the displayed node item with that stanza-id. However clients SHOULD be able to handle displayed states that use stanza-ids that refer to outgoing messages and simply consider the chat as displayed up to that point.</li>
      <li class="" style="">While Displayed Markers (<span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0333.html">Displayed Markers (was: Chat Markers) (XEP-0333)</a></span>  [<a href="#nt-id26">2</a>]), in 1:1 chats, MAY be sent to a full JID, a client combining both &lt;displayed/&gt; elements in a single message MUST address that message to the bare JID, as the server will use the verbatim 'to' attribute as the item ID.</li>
    </ul>
  </div>
  <div class="indent"><h3 id="rules-server">5.2 Server<a class="anchor-link" href="#rules-server"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <ul class="" style="">
      <li class="" style="">The PEP item id (or 'to' attribute when using server-assist) and the stanza-id are opaque values that MAY NOT be validated by the server beyond the requirements of <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0060.html">Publish-Subscribe (XEP-0060)</a></span>  [<a href="#nt-id32">8</a>].</li>
      <li class="" style="">Processing and stripping of the &lt;displayed/&gt; element qualified by the 'urn:xmpp:mds:displayed:0' namespace on the server MUST happen before the message is stored in the archive (<span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0313.html">Message Archive Management (XEP-0313)</a></span>  [<a href="#nt-id30">6</a>]) and before it is reflected back to the sender via <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0280.html">Message Carbons (XEP-0280)</a></span>  [<a href="#nt-id25">1</a>] or <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0409.html">IM Routing-NG (XEP-0409)</a></span>  [<a href="#nt-id33">9</a>].</li>
      <li class="" style="">If processing the &lt;displayed/&gt; element would implicitly create the PEP node the server MUST ensure that an appropriate node configuration is applied (see the Security Considerations of this specification).</li>
    </ul>
  </div>
<h2 id="access">6.
       Accessibility Considerations<a class="anchor-link" href="#access"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">This specification comes with no accessibility considerations that go beyond what is required of any client (i.e. providing an accessible distinction between <em>read</em> and <em>unread</em> chats).</p>
<h2 id="security">7.
       Security Considerations<a class="anchor-link" href="#security"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <ul class="" style="">
    <li class="" style="">When publishing displayed states via <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0060.html">Publish-Subscribe (XEP-0060)</a></span>  [<a href="#nt-id32">8</a>] the client MUST use publish-options to set the access model on the node to <em>whitelist</em>. To ensure the server supports publish-options the client MUST first check for the "http://jabber.org/protocol/pubsub#publish-options" feature.</li>
    <li class="" style="">Servers that support the server assist feature MUST strip the &lt;displayed/&gt; element in the "urn:xmpp:mds:displayed:0" namespace from the message to avoid the stanza-id being leaked to the recipient of that message.</li>
    <li class="" style="">Clients MUST NOT put the &lt;displayed/&gt; into a message to trigger server-assisted displayed synchronization unless the server announces the "urn:xmpp:mds:server-assist:0" feature.</li>
    <li class="" style="">This specification provides a convenient process to synchronize a user’s own devices and informing the third party in one, single message. However letting the third party know is not always desirable, for example when the user has generally opted out of transmitting the displayed status or when a non-contact initiated a chat. In those cases the client MUST use the <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0060.html">Publish-Subscribe (XEP-0060)</a></span>  [<a href="#nt-id32">8</a>] method instead of server-assist.</li>
  </ul>
<h2 id="privacy">8.
       Privacy Considerations<a class="anchor-link" href="#privacy"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">Implementing this specification gives the server the opportunity to perform activity tracking of a similiar scope than implementing <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0085.html">Chat State Notifications (XEP-0085)</a></span>  [<a href="#nt-id34">10</a>] or <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0333.html">Displayed Markers (was: Chat Markers) (XEP-0333)</a></span>  [<a href="#nt-id26">2</a>] would.</p>
  <p class="" style="">When using the server assist feature in conjunction with <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0333.html">Displayed Markers (was: Chat Markers) (XEP-0333)</a></span>  [<a href="#nt-id26">2</a>] the Privacy Considerations of <em>Display Markers</em> apply.</p>
<h2 id="iana">9.
       IANA Considerations<a class="anchor-link" href="#iana"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">This document requires no interaction with the Internet Assigned Numbers Authority (IANA).</p>
<h2 id="design">10.
       Design Considerations<a class="anchor-link" href="#design"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <div class="indent"><h3 id="distinct-element">10.1 Distinct Element for Server Assist<a class="anchor-link" href="#distinct-element"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">This specification introduces a distinct element to enable server assist instead of utilizing <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0333.html">Displayed Markers (was: Chat Markers) (XEP-0333)</a></span>  [<a href="#nt-id26">2</a>] because Displayed Markers use the message id instead of stanza-ids. Translating between message id and stanza-id would require that the message (or parts of it) are archived on the server. Archiving should not be a requirement to offer server assist. (Especially since archived or not can depend on user settings.)</p>
  </div>
  <div class="indent"><h3 id="server-assist-wo-marker">10.2 Server Assist without Display Markers<a class="anchor-link" href="#server-assist-wo-marker"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">Server assist is not allowed in messages that would otherwise be empty. Overloading the semantic of sending a stanza to a third party entity solely to perform an action on the account that involves said third party is a dangerous example to set. (For example if server assit fails due to implementation errors a third party can be flooded with messages.) While stripping elements from stanzas is a common requirement on XMPP dropping entire stanzas without error is not.</p>
  </div>
<h2 id="registrar">11.
       XMPP Registrar Considerations<a class="anchor-link" href="#registrar"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">This specification defines the following XML namespace:</p>
  <ul class="" style="">
    <li class="" style="">urn:xmpp:mds:displayed:0</li>
  </ul>
<h2 id="schema">12.
       XML Schema<a class="anchor-link" href="#schema"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">REQUIRED for protocol specifications.</p>
<hr><a name="appendices"></a><h2>Appendices</h2><h3 id="appendix-docinfo">Appendix A: Document Information<a class="anchor-link" href="#appendix-docinfo"><abbr title="Link to this point in the document">¶</abbr></a></h3><dl class="compact"><dt>Series</dt><dd><a href="https://xmpp.org/extensions/">XEP</a></dd><dt>Number</dt><dd>0490</dd><dt>Publisher</dt><dd><a href="/xsf/">XMPP Standards Foundation</a></dd><dt>Status</dt><dd><a href="https://xmpp.org/extensions/xep-0001.html#states-Experimental">Experimental</a></dd><dt>Type</dt><dd><a href="https://xmpp.org/extensions/xep-0001.html#types-Standards%20Track">Standards Track</a></dd><dt>Version</dt><dd>0.1.0</dd><dt>Last Updated</dt><dd>2024-03-26</dd><dt>Approving Body</dt><dd><a href="https://xmpp.org/council/">XMPP Council</a></dd><dt>Dependencies</dt><dd>XMPP Core, <a href="xep-0001.html">XEP-0001</a>, <a href="xep-0163.html">XEP-0163</a></dd><dt>Supersedes</dt><dd>None</dd><dt>Superseded By</dt><dd>None</dd><dt>Short Name</dt><dd>mds</dd><dt>Source Control</dt><dd><a class="standardsButton" href="https://github.com/xsf/xeps/blob/master/xep-0490.xml">HTML</a></dd></dl><p>
          This document in other formats:
          <a class="standardsButton" href="https://xmpp.org/extensions/xep-0490.xml">XML</a> 
          <a class="standardsButton" href="https://xmpp.org/extensions/xep-0490.pdf">PDF</a></p><h3 id="appendix-authorinfo">Appendix B: Author Information<a class="anchor-link" href="#appendix-authorinfo"><abbr title="Link to this point in the document">¶</abbr></a></h3><h5>Daniel Gultsch</h5><dl class="compact"><dt>Email</dt><dd><a href="mailto:daniel@gultsch.de">daniel@gultsch.de</a></dd><dt>JabberID</dt><dd><a href="xmpp:daniel@gultsch.de">daniel@gultsch.de</a></dd></dl><h3 id="appendix-legal">Appendix C: Legal Notices<a class="anchor-link" href="#appendix-legal"><abbr title="Link to this point in the document">¶</abbr></a></h3><div class="indent"><h4>Copyright</h4><p>This XMPP Extension Protocol is copyright © 1999 – 2024 by the <a href="https://xmpp.org/">XMPP Standards Foundation</a> (XSF).</p><h4>Permissions</h4><p>Permission is hereby granted, free of charge, to any person obtaining a copy of this specification (the "Specification"), to make use of the Specification without restriction, including without limitation the rights to implement the Specification in a software program, deploy the Specification in a network service, and copy, modify, merge, publish, translate, distribute, sublicense, or sell copies of the Specification, and to permit persons to whom the Specification is furnished to do so, subject to the condition that the foregoing copyright notice and this permission notice shall be included in all copies or substantial portions of the Specification. Unless separate permission is granted, modified works that are redistributed shall not contain misleading information regarding the authors, title, number, or publisher of the Specification, and shall not claim endorsement of the modified works by the authors, any organization or project to which the authors belong, or the XMPP Standards Foundation.</p><h4>Disclaimer of Warranty</h4><p class="box info">## NOTE WELL: This Specification is provided on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE. ##</p><h4>Limitation of Liability</h4><p>In no event and under no legal theory, whether in tort (including negligence), contract, or otherwise, unless required by applicable law (such as deliberate and grossly negligent acts) or agreed to in writing, shall the XMPP Standards Foundation or any author of this Specification be liable for damages, including any direct, indirect, special, incidental, or consequential damages of any character arising from, out of, or in connection with the Specification or the implementation, deployment, or other use of the Specification (including but not limited to damages for loss of goodwill, work stoppage, computer failure or malfunction, or any and all other commercial damages or losses), even if the XMPP Standards Foundation or such author has been advised of the possibility of such damages.</p><h4>IPR Conformance</h4><p>This XMPP Extension Protocol has been contributed in full conformance with the XSF's Intellectual Property Rights Policy (a copy of which can be found at &lt;<a href="https://xmpp.org/about/xsf/ipr-policy">https://xmpp.org/about/xsf/ipr-policy</a>&gt; or obtained by writing to XMPP Standards Foundation, P.O. Box 787, Parker, CO 80134 USA).</p><h4>Visual Presentation</h4><p>The HTML representation (you are looking at) is maintained by the XSF. It is based on the <a href="http://yaml.de">YAML CSS Framework</a>, which is licensed under the terms of the <a href="https://creativecommons.org/licenses/by/2.0/">CC-BY-SA 2.0</a> license.</p></div><h3 id="appendix-xmpp">Appendix D: Relation to XMPP<a class="anchor-link" href="#appendix-xmpp"><abbr title="Link to this point in the document">¶</abbr></a></h3><p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 6120) and XMPP IM (RFC 6121) specifications contributed by the XMPP Standards Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this document has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p><h3 id="appendix-discuss">Appendix E: Discussion Venue<a class="anchor-link" href="#appendix-discuss"><abbr title="Link to this point in the document">¶</abbr></a></h3><p class="indent">The primary venue for discussion of XMPP Extension Protocols is the &lt;<a href="https://mail.jabber.org/mailman/listinfo/standards">standards@xmpp.org</a>&gt; discussion list.</p><p class="indent">Discussion on other xmpp.org discussion lists might also be appropriate; see &lt;<a href="https://xmpp.org/community/">https://xmpp.org/community/</a>&gt; for a complete list.</p><p class="indent">Errata can be sent to &lt;<a href="mailto:editor@xmpp.org">editor@xmpp.org</a>&gt;.</p><h3 id="appendix-conformance">Appendix F: Requirements Conformance<a class="anchor-link" href="#appendix-conformance"><abbr title="Link to this point in the document">¶</abbr></a></h3><p class="indent">The following requirements keywords as used in this document are to be interpreted as described in <a href="https://www.ietf.org/rfc/rfc2119.txt">RFC 2119</a>: "MUST", "SHALL", "REQUIRED"; "MUST NOT", "SHALL NOT"; "SHOULD", "RECOMMENDED"; "SHOULD NOT", "NOT RECOMMENDED"; "MAY", "OPTIONAL".</p><h3 id="appendix-notes">Appendix G: Notes<a class="anchor-link" href="#appendix-notes"><abbr title="Link to this point in the document">¶</abbr></a></h3><div class="indent"><p><a name="nt-id25">1</a>. XEP-0280: Message Carbons &lt;<a href="https://xmpp.org/extensions/xep-0280.html">https://xmpp.org/extensions/xep-0280.html</a>&gt;.</p><p><a name="nt-id26">2</a>. XEP-0333: Displayed Markers (was: Chat Markers) &lt;<a href="https://xmpp.org/extensions/xep-0333.html">https://xmpp.org/extensions/xep-0333.html</a>&gt;.</p><p><a name="nt-id27">3</a>. XEP-0163: Personal Eventing Protocol &lt;<a href="https://xmpp.org/extensions/xep-0163.html">https://xmpp.org/extensions/xep-0163.html</a>&gt;.</p><p><a name="nt-id28">4</a>. XEP-0223: Best Practices for Persistent Storage of Private Data via Publish-Subscribe &lt;<a href="https://xmpp.org/extensions/xep-0223.html">https://xmpp.org/extensions/xep-0223.html</a>&gt;.</p><p><a name="nt-id29">5</a>. XEP-0359: Unique and Stable Stanza IDs &lt;<a href="https://xmpp.org/extensions/xep-0359.html">https://xmpp.org/extensions/xep-0359.html</a>&gt;.</p><p><a name="nt-id30">6</a>. XEP-0313: Message Archive Management &lt;<a href="https://xmpp.org/extensions/xep-0313.html">https://xmpp.org/extensions/xep-0313.html</a>&gt;.</p><p><a name="nt-id31">7</a>. XEP-0115: Entity Capabilities &lt;<a href="https://xmpp.org/extensions/xep-0115.html">https://xmpp.org/extensions/xep-0115.html</a>&gt;.</p><p><a name="nt-id32">8</a>. XEP-0060: Publish-Subscribe &lt;<a href="https://xmpp.org/extensions/xep-0060.html">https://xmpp.org/extensions/xep-0060.html</a>&gt;.</p><p><a name="nt-id33">9</a>. XEP-0409: IM Routing-NG &lt;<a href="https://xmpp.org/extensions/xep-0409.html">https://xmpp.org/extensions/xep-0409.html</a>&gt;.</p><p><a name="nt-id34">10</a>. XEP-0085: Chat State Notifications &lt;<a href="https://xmpp.org/extensions/xep-0085.html">https://xmpp.org/extensions/xep-0085.html</a>&gt;.</p></div><h3 id="appendix-revs">Appendix H: Revision History<a class="anchor-link" href="#appendix-revs"><abbr title="Link to this point in the document">¶</abbr></a></h3><p>Note: Older versions of this specification might be available at <a href="https://xmpp.org/extensions/attic/">https://xmpp.org/extensions/attic/</a></p><ol class="revision-history"><li id="revision-history-v0.1.0"><div class="revision-head">Version <a href="https://xmpp.org/extensions/attic/xep-0490-0.1.0.html">0.1.0</a> (2024-03-26)<a class="anchor-link" href="#revision-history-v0.1.0"><abbr title="Link to this point in the document">¶</abbr></a></div>
      <ul class="" style="">
        <li class="" style="">Promoted to Experimental</li>
      </ul>
    <div class="revision-author">XEP Editor: dg</div></li><li id="revision-history-v0.0.3"><div class="revision-head">Version <a href="https://xmpp.org/extensions/attic/xep-0490-0.0.3.html">0.0.3</a> (2024-04-26)<a class="anchor-link" href="#revision-history-v0.0.3"><abbr title="Link to this point in the document">¶</abbr></a></div>
      <p class="" style="">Split Business Rules into Server and Client sections.</p>
    <div class="revision-author">dg</div></li><li id="revision-history-v0.0.2"><div class="revision-head">Version <a href="https://xmpp.org/extensions/attic/xep-0490-0.0.2.html">0.0.2</a> (2024-03-14)<a class="anchor-link" href="#revision-history-v0.0.2"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Add Accessibility, Privacy and Design Considerations</p><div class="revision-author">dg</div></li><li id="revision-history-v0.0.1"><div class="revision-head">Version <a href="https://xmpp.org/extensions/attic/xep-0490-0.0.1.html">0.0.1</a> (2024-02-21)<a class="anchor-link" href="#revision-history-v0.0.1"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">First draft.</p><div class="revision-author">dg</div></li></ol><h3 id="appendix-biblatex">Appendix I: Bib(La)TeX Entry</h3><pre>
@report{gultsch2024mds,
  title = {Message Displayed Synchronization},
  author = {Gultsch, Daniel},
  type = {XEP},
  number = {0490},
  version = {0.1.0},
  institution = {XMPP Standards Foundation},
  url = {https://xmpp.org/extensions/xep-0490.html},
  date = {2024-02-21/2024-03-26},
}</pre><p>END</p></body></html>
