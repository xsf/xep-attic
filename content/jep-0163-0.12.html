<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>JEP-0163: Personal Eventing via Pubsub</title>
<link rel="stylesheet" type="text/css" href="jep.css">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
<meta name="DC.Title" content="Personal Eventing via Pubsub">
<meta name="DC.Creator" content="Peter Saint-Andre">
<meta name="DC.Creator" content="Kevin Smith">
<meta name="DC.Description" content="This document specifies XMPP semantics for using the publish-subscribe protocol to broadcast state change events associated with a user or account.">
<meta name="DC.Publisher" content="Jabber Software Foundation">
<meta name="DC.Contributor" content="JEP Editor">
<meta name="DC.Date" content="2006-08-01">
<meta name="DC.Type" content="Jabber Enhancement Proposal">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="JEP-0163">
<meta name="DC.Language" content="en">
<meta name="DC.Rights" content="This Jabber Enhancement Proposal is copyright 1999 - 2006 by the Jabber Software Foundation (JSF) and is in full conformance with the JSF's Intellectual Property Rights Policy &lt;http://www.jabber.org/jsf/ipr-policy.shtml&gt;. This material may be distributed only subject to the terms and conditions set forth in the Creative Commons Attribution License (&lt;http://creativecommons.org/licenses/by/2.5/&gt;).">
</head>
<body>
<h1>JEP-0163: Personal Eventing via Pubsub</h1>
<p>This document specifies XMPP semantics for using the publish-subscribe protocol to broadcast state change events associated with a user or account.</p>
<p><hr></p>
<p style="color:red">WARNING: This Standards-Track JEP is Experimental. Publication as a Jabber Enhancement Proposal does not imply approval of this proposal by the Jabber Software Foundation. Implementation of the protocol described herein is encouraged in exploratory implementations, but production systems should not deploy implementations of this protocol until it advances to a status of Draft.</p>
<p><hr></p>
<h2>JEP Information</h2>
<p class="indent">
            Status: 
            <a href="http://www.jabber.org/jeps/jep-0001.html#states-Experimental">Experimental</a><br>
            Type:
            <a href="http://www.jabber.org/jeps/jep-0001.html#types-Standards%20Track">Standards Track</a><br>
            Number: 0163<br>
            Version: 0.12<br>
            Last Updated: 2006-08-01<br>
            JIG: Standards JIG<br>
                Approving Body: <a href="http://www.jabber.org/council/">Jabber Council</a><br>Dependencies: XMPP Core, XMPP IM, JEP-0030, JEP-0060, JEP-0115<br>
                Supersedes: None<br>
                Superseded By: None<br>
            Short Name: pep<br>
              Wiki Page: &lt;<a href="http://wiki.jabber.org/index.php/Personal%20Eventing%20via%20Pubsub%20(JEP-0163)">http://wiki.jabber.org/index.php/Personal Eventing via Pubsub (JEP-0163)</a>&gt;
            </p>
<h2>Author Information</h2>
<div class="indent">
<h3>Peter Saint-Andre</h3>
<p class="indent">
        Email:
        <a href="mailto:stpeter@jabber.org">stpeter@jabber.org</a><br>
        JID: 
        <a href="xmpp:stpeter@jabber.org">stpeter@jabber.org</a></p>
<h3>Kevin Smith</h3>
<p class="indent">
        Email:
        <a href="mailto:kevin@kismith.co.uk">kevin@kismith.co.uk</a><br>
        JID: 
        <a href="xmpp:kevdadrum@jabber.ex.ac.uk">kevdadrum@jabber.ex.ac.uk</a></p>
</div>
<h2>Legal Notice</h2>
<p class="indent">This Jabber Enhancement Proposal is copyright 1999 - 2006 by the <a href="http://www.jabber.org/jsf/">Jabber Software Foundation</a> (JSF) and is in full conformance with the JSF's Intellectual Property Rights Policy &lt;<a href="http://www.jabber.org/jsf/ipr-policy.shtml">http://www.jabber.org/jsf/ipr-policy.shtml</a>&gt;. This material may be distributed only subject to the terms and conditions set forth in the Creative Commons Attribution License (&lt;<a href="http://creativecommons.org/licenses/by/2.5/">http://creativecommons.org/licenses/by/2.5/</a>&gt;).</p>
<h2>Discussion Venue</h2>
<p class="indent">The preferred venue for discussion of this document is the Standards-JIG discussion list: &lt;<a href="http://mail.jabber.org/mailman/listinfo/standards-jig">http://mail.jabber.org/mailman/listinfo/standards-jig</a>&gt;.</p>
<h2>Relation to XMPP</h2>
<p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 3920) and XMPP IM (RFC 3921) specifications contributed by the Jabber Software Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this JEP has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p>
<h2>Conformance Terms</h2>
<p class="indent">The following keywords as used in this document are to be interpreted as described in RFC 2119: "MUST", "SHALL", "REQUIRED"; "MUST NOT", "SHALL NOT"; "SHOULD", "RECOMMENDED"; "SHOULD NOT", "NOT RECOMMENDED"; "MAY", "OPTIONAL".</p>
<p><hr></p>
<h2>Table of Contents</h2>
<div class="indent"><dl>
<dt>1.  <a href="#intro">Introduction</a>
</dt>
<dt>2.  <a href="#approach">Concepts and Approach</a>
</dt>
<dl>
<dt>2.1.  <a href="#approach-everyjid">Every Account a Pubsub Service</a>
</dt>
<dt>2.2.  <a href="#approach-publisher">One Publisher Per Node</a>
</dt>
<dt>2.3.  <a href="#approach-onenode">One Node Per Namespace</a>
</dt>
<dt>2.4.  <a href="#approach-defaults">Smart Defaults</a>
</dt>
<dt>2.5.  <a href="#approach-presence">Use Presence</a>
</dt>
</dl>
<dt>3.  <a href="#scenario">Scenario</a>
</dt>
<dt>4.  <a href="#owner-disco">Account Owner Service Discovery</a>
</dt>
<dt>5.  <a href="#owner-create">Account Owner Node Creation</a>
</dt>
<dt>6.  <a href="#contact-disco">Contact Service Discovery</a>
</dt>
<dt>7.  <a href="#contact-subscribe">Contact Subscription</a>
</dt>
<dt>8.  <a href="#owner-publish">Account Owner Publishing</a>
</dt>
<dt>9.  <a href="#contact-filter">Contact Notification Filtering</a>
</dt>
<dt>10.  <a href="#notifications">Generating Notifications</a>
</dt>
<dl>
<dt>10.1.  <a href="#notifications-num">Number of Notifications</a>
</dt>
<dt>10.2.  <a href="#notifications-when">When to Generate Notifications</a>
</dt>
</dl>
<dt>11.  <a href="#last">Sending the Last Published Item</a>
</dt>
<dt>12.  <a href="#defaults">Recommended Defaults</a>
</dt>
<dt>13.  <a href="#imple">Implementation Notes</a>
</dt>
<dl><dt>13.1.  <a href="#impl-subscriptions">Cancelling Subscriptions</a>
</dt></dl>
<dt>14.  <a href="#security">Security Considerations</a>
</dt>
<dt>15.  <a href="#iana">IANA Considerations</a>
</dt>
<dt>16.  <a href="#registrar">Jabber Registrar Considerations</a>
</dt>
<dl><dt>16.1.  <a href="#registrar-disco">Service Discovery Category/Type</a>
</dt></dl>
<dt>17.  <a href="#schema">XML Schema</a>
</dt>
<dt>18.  <a href="#ack">Acknowledgements</a>
</dt>
<dt><a href="#notes">Notes</a></dt>
<dt><a href="#revs">Revision History</a></dt>
</dl></div>
<p><hr></p>
<h2>1.
       <a name="intro">Introduction</a>
</h2>
  <p class="" style="">The XMPP <span class="ref" style="">Publish-Subscribe</span>  [<a href="#nt-id2250971">1</a>] extension ("pubsub") can be used to broadcast state change events associated with a Jabber/XMPP account or user, such as those described in <span class="ref" style="">User Geolocation</span>  [<a href="#nt-id2250986">2</a>], <span class="ref" style="">User Mood</span>  [<a href="#nt-id2251006">3</a>], <span class="ref" style="">User Activity</span>  [<a href="#nt-id2251030">4</a>], and <span class="ref" style="">User Tune</span>  [<a href="#nt-id2259616">5</a>].  [<a href="#nt-id2251018">6</a>] However, the full, generic pubsub protocol is often thought of as complicated and therefore has not been widely implemented in clients. To make publish-subscribe functionality more accessible (especially to instant messaging and presence applications that conform to <span class="ref" style="">XMPP IM</span>  [<a href="#nt-id2259651">7</a>]), this document defines simplified protocol semantics that can be followed by instant messaging client and server developers, hopefully resulting in the deployment of personal eventing services across the Jabber/XMPP network.</p>
<h2>2.
       <a name="approach">Concepts and Approach</a>
</h2>
  <p class="" style="">Personal eventing via pubsub ("PEP") is based on five principles:</p>
  <ol start="1" type="">
    <li>Every account a pubsub service.</li>
    <li>One publisher per node.</li>
    <li>One node per namespace.</li>
    <li>Smart defaults.</li>
    <li>Use presence.</li>
  </ol>
  <p class="" style="">These principles are described more fully below.</p>
  <div class="indent">
<h3>2.1 <a name="approach-everyjid">Every Account a Pubsub Service</a>
</h3>
    <p class="" style="">When a user creates an account (or has an account provisioned) at a Jabber/XMPP server, that account should have associated with it a virtual pubsub service. This greatly simplifies the task of discovering the account owner's personal pubsub nodes, since the root pubsub node simply is the account owner's bare JID (&lt;node@domain.tld&gt;). This assumption also simplifies publishing and subscribing.</p>
  </div>
  <div class="indent">
<h3>2.2 <a name="approach-publisher">One Publisher Per Node</a>
</h3>
    <p class="" style="">There is no need for multiple publishers to a personal eventing service, since by definition the service generates information associated with only one entity. The owner-publisher for every node is the bare JID of the account owner.</p>
  </div>
  <div class="indent">
<h3>2.3 <a name="approach-onenode">One Node Per Namespace</a>
</h3>
    <p class="" style="">To further simplify matters, we recommend that there be only one publish-subscribe node associated with any given payload type (XML namespace) for the owner-publisher. For example, there should be one pubsub node for location events, one node for tune events, one node for mood events, and so on. This simplifies node creation, discovery, publishing, and subscribing.</p>
  </div>
  <div class="indent">
<h3>2.4 <a name="approach-defaults">Smart Defaults</a>
</h3>
    <p class="" style="">Most pubsub configuration options and metadata are not needed for personal eventing. Instead, servers should offer smart defaults to simplify node creation and management.</p>
  </div>
  <div class="indent">
<h3>2.5 <a name="approach-presence">Use Presence</a>
</h3>
    <p class="" style="">Although generic publish-subscribe service do not necessarily have access to presence information about subscribers, personal eventing services are integrated with presence in the following ways:</p>
    <ul>
      <li>Each messaging and presence account simply <span style="font-style: italic">is</span> a virtual publish-subscribe service.</li>
      <li>The recommended access models are "presence" and "roster" (both of which involve presence subscriptions in XMPP instant messaging and presence systems).</li>
      <li>Subscriptions are handled via XMPP presence and the extended <span class="ref" style="">Entity Capabilities</span>  [<a href="#nt-id2259880">8</a>] information contained in presence broadcasts.</li>
      <li>Services take account of subscriber presence in the generation of notifications.</li>
    </ul>
    <p class="" style="">These uses of presence simplify the task of developing compliant clients (cf. <span class="ref" style="">Protocol Design Guidelines</span>  [<a href="#nt-id2259847">9</a>]).</p>
  </div>
<h2>3.
       <a name="scenario">Scenario</a>
</h2>
  <p class="" style="">This document illustrates PEP through a series of examples that use the following scenario:</p>
  <ol start="" type="">
    <li>
      <p class="" style="">An owner-publisher juliet@capulet.com who publishes the following information:</p>
      <ol start="" type="">
        <li>Tune information that anyone may see (i.e., an access model of "open")</li>
        <li>Activity information that only presence subscribers may see (i.e., an access model of "presence")</li>
        <li>Geolocation information that only contacts in her "Friends" group may see (i.e., an access model of "roster" with a group of "Friends")</li>
        <li>Bookmark information that only the account owner may see (i.e., an access model of "whitelist"; note that a PEP node with an access model of "whitelist" and no entities on the whitelist effectively results in a node that enables private data storage such as that defined in <span class="ref" style="">Private XML Storage</span>  [<a href="#nt-id2259964">10</a>])</li>
      </ol>
    </li>
    <li>
      <p class="" style="">Three users who have the following relationship to Juliet:</p>
      <ol start="" type="">
        <li>benvolio@montague.net, who has no subscription to Juliet's presence</li>
        <li>nurse@capulet.com, who has a bidirectional subscription to Juliet's presence and who is in the "Servants" group in Juliet's roster</li>
        <li>romeo@montague.net, who has a bidirectional subscription to Juliet's presence and who is in the "Friends" group in Juliet's roster</li>
      </ol>
    </li>
  </ol>
  <p class="" style="">The examples shown in the following sections walk through the protocol flows for node creation, discovery, publishing, and subscribing.</p>
<h2>4.
       <a name="owner-disco">Account Owner Service Discovery</a>
</h2>
  <p class="" style="">Naturally, before an account owner attempts to create nodes, its client SHOULD determine whether the account owner's server supports PEP; to do so, it MUST send a <span class="ref" style="">Service Discovery</span>  [<a href="#nt-id2260050">11</a>] information request to the server:</p>
  <p class="caption">Example 1. Account owner queries server regarding protocol support</p>
<div class="indent"><pre>
&lt;iq from='juliet@capulet.com/balcony'
    to='capulet.com'
    id='disco1'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="" style="">If a server supports PEP, it MUST return an identity of "pubsub/pep" (as well as a list of the namespaces and other features it supports, including all supported <span style="font-weight: bold">JEP-0060</span> features):</p>
  <p class="caption">Example 2. Server communicates protocol support</p>
<div class="indent"><pre>
&lt;iq from='capulet.com'
    to='juliet@capulet.com/balcony'
    id='disco1'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;identity category='pubsub' type='pep'/&gt;
    ...
  &lt;/query&gt;
&lt;/iq&gt;
  </pre></div>
<h2>5.
       <a name="owner-create">Account Owner Node Creation</a>
</h2>
  <p class="" style="">In order to create a node, an account owner MUST follow the node creation protocol specified in <span style="font-weight: bold">JEP-0060</span>.  [<a href="#nt-id2260104">12</a>]</p>
  <p class="" style="">For example, Juliet would send the following stanzas in order to create the nodes mentioned above:</p>
  <p class="caption">Example 3. Account owner creates open node for tune data</p>
<div class="indent"><pre>
&lt;iq from='juliet@capulet.com/balcony' type='set' id='create-open'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;create node='http://jabber.org/protocol/tune'/&gt;
    &lt;configure&gt;
      &lt;x xmlns='jabber:x:data' type='submit'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
          &lt;value&gt;http://jabber.org/protocol/pubsub#node_config&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#access_model'&gt;
          &lt;option&gt;&lt;value&gt;open&lt;/value&gt;&lt;/option&gt;
        &lt;/field&gt;
      &lt;/x&gt;
    &lt;/configure&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="caption">Example 4. Account owner creates presence node for activity data</p>
<div class="indent"><pre>
&lt;iq from='juliet@capulet.com/balcony' type='set' id='create-presence'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;create node='http://jabber.org/protocol/activity'/&gt;
    &lt;configure&gt;
      &lt;x xmlns='jabber:x:data' type='submit'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
          &lt;value&gt;http://jabber.org/protocol/pubsub#node_config&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#access_model'&gt;
          &lt;option&gt;&lt;value&gt;presence&lt;/value&gt;&lt;/option&gt;
        &lt;/field&gt;
      &lt;/x&gt;
    &lt;/configure&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="caption">Example 5. Account owner creates roster access node for geolocation data</p>
<div class="indent"><pre>
&lt;iq from='juliet@capulet.com/balcony' type='set' id='create-roster'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;create node='http://jabber.org/protocol/geoloc'/&gt;
    &lt;configure&gt;
      &lt;x xmlns='jabber:x:data' type='submit'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
          &lt;value&gt;http://jabber.org/protocol/pubsub#node_config&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#access_model'&gt;
          &lt;option&gt;&lt;value&gt;roster&lt;/value&gt;&lt;/option&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#roster_groups_allowed'&gt;
          &lt;option&gt;&lt;value&gt;friends&lt;/value&gt;&lt;/option&gt;
        &lt;/field&gt;
      &lt;/x&gt;
    &lt;/configure&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="caption">Example 6. Account owner creates whitelist node for bookmark data</p>
<div class="indent"><pre>
&lt;iq from='juliet@capulet.com/balcony' type='set' id='create-whitelist'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;create node='storage:bookmarks'/&gt;
    &lt;configure&gt;
      &lt;x xmlns='jabber:x:data' type='submit'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
          &lt;value&gt;http://jabber.org/protocol/pubsub#node_config&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#access_model'&gt;
          &lt;option&gt;&lt;value&gt;whitelist&lt;/value&gt;&lt;/option&gt;
        &lt;/field&gt;
      &lt;/x&gt;
    &lt;/configure&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
  </pre></div>
<h2>6.
       <a name="contact-disco">Contact Service Discovery</a>
</h2>
  <p class="" style="">A contact MAY send service discovery requests to the account owner's bare JID (&lt;node@domain.tld&gt;). Although this is not necessary in order to subscribe to the account owner's personal eventing data (as explained in the following section), it is shown here to further illustrate the role of access models.</p>
  <p class="" style="">First, benvolio@montague.net sends a disco#info request to juliet@capulet.com:</p>
  <p class="caption">Example 7. Unaffiliated entity queries account owner regarding information</p>
<div class="indent"><pre>
&lt;iq from='benvolio@montague.net/home'
    to='juliet@capulet.com'
    id='disco1'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="" style="">If Juliet's server supports PEP (thereby making juliet@capulet.com a virtual pubsub service), it MUST return an identity of "pubsub/pep":</p>
  <p class="caption">Example 8. Server communicates protocol support</p>
<div class="indent"><pre>
&lt;iq from='juliet@capulet.com'
    to='benvolio@montague.net/home'
    id='disco1'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;identity category='pubsub' type='pep'/&gt;
    ...
  &lt;/query&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="" style="">Second, benvolio@montague.net sends a disco#items request to juliet@capulet.com:</p>
  <p class="caption">Example 9. Unaffiliated entity queries account owner regarding items</p>
<div class="indent"><pre>
&lt;iq from='benvolio@montague.net/home'
    to='juliet@capulet.com'
    id='disco2'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'/&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="" style="">The account owner's server MUST check the access model for each of the account owner's PEP nodes and MUST return as service discovery items only those nodes to which the contact is allowed to subscribe or from which the contact is allowed to retrieve items.</p>
  <p class="" style="">Therefore, in this case, the server would return only the "http://jabber.org/protocol/tune" node (since it has an open access model and the contact does not have a presence subscription to the account owner's presence):</p>
  <p class="caption">Example 10. Server returns appropriate items</p>
<div class="indent"><pre>
&lt;iq from='juliet@capulet.com'
    to='benvolio@montague.net/home'
    id='disco2'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'&gt;
    &lt;item jid='juliet@capulet.com' node='http://jabber.org/protocol/tune'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="" style="">Next, nurse@capulet.com sends a disco#items request to juliet@capulet.com:</p>
  <p class="caption">Example 11. Contact with presence subscription queries account owner regarding items</p>
<div class="indent"><pre>
&lt;iq from='nurse@capulet.com/chamber'
    to='juliet@capulet.com'
    id='disco3'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'/&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="" style="">However, in this case, the server would return the "http://jabber.org/protocol/tune" node (open access model) <span style="font-style: italic">and</span> the "http://jabber.org/protocol/activity" node (presence access model):</p>
  <p class="caption">Example 12. Server returns appropriate items</p>
<div class="indent"><pre>
&lt;iq from='juliet@capulet.com'
    to='nurse@capulet.com/chamber'
    id='disco3'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'&gt;
    &lt;item jid='juliet@capulet.com' node='http://jabber.org/protocol/tune'/&gt;
    &lt;item jid='juliet@capulet.com' node='http://jabber.org/protocol/activity'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="" style="">Finally, romeo@montague.net sends a disco#items request to juliet@capulet.com:</p>
  <p class="caption">Example 13. Contact with presence subscription and in privileged roster group queries account owner regarding items</p>
<div class="indent"><pre>
&lt;iq from='romeo@montague.net/orchard'
    to='juliet@capulet.com'
    id='disco4'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'/&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="" style="">In this case, the server would return the "http://jabber.org/protocol/tune" node (open access model) <span style="font-style: italic">and</span> the "http://jabber.org/protocol/activity" node (presence access model) <span style="font-style: italic">and</span> the "http://jabber.org/protocol/geoloc" node (roster access model):</p>
  <p class="caption">Example 14. Server returns appropriate items</p>
<div class="indent"><pre>
&lt;iq from='juliet@capulet.com'
    to='romeo@montague.net/orchard'
    id='disco4'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'&gt;
    &lt;item jid='juliet@capulet.com' node='http://jabber.org/protocol/tune'/&gt;
    &lt;item jid='juliet@capulet.com' node='http://jabber.org/protocol/activity'/&gt;
    &lt;item jid='juliet@capulet.com' node='http://jabber.org/protocol/geoloc'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
  </pre></div>
<h2>7.
       <a name="contact-subscribe">Contact Subscription</a>
</h2>
  <p class="" style="">If an entity is not subscribed to the account owner's presence, it MUST subscribe to a node using the protocol defined in <span style="font-weight: bold">JEP-0060</span>. For instance, here is how benvolio@montague.net would subscribe Juliet's tune information:</p>
  <p class="caption">Example 15. Unaffiliated entity subscribes to an open node</p>
<div class="indent"><pre>
&lt;iq type='set'
    from='benvolio@montague.net/home'
    to='juliet@capulet.com'
    id='sub1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;subscribe node='http://jabber.org/protocol/tune' jid='romeo@montague.net'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="" style="">However, when a contact is affiliated with the account owner through a presence subscription, PEP greatly simplifies the subscription process. Indeed, such a contact automatically receives notifications from all nodes of interest simply by being subscribed to the account owner's presence. This is done by associating the presence subscription with a pubsub subscription to the account owner's root collection node (i.e., bare JID), with a subscription_type of "items" and a subscription_depth of "all". As a result, a contact with a presence subscription to the account owner will receive all items published to all of the account owner's nodes with access models of "open" and "presence".</p>
  <p class="" style="">Consider, then, the following presence subscription exchange:</p>
  <p class="caption">Example 16. Presence subscription handshake</p>
<div class="indent"><pre>
&lt;presence from='nurse@capulet.com' to='juliet@capulet.com' type='subscribe'/&gt;

&lt;presence from='juliet@capulet.com' to='nurse@capulet.com' type='subscribed'/&gt;
  </pre></div>
  <p class="" style="">This is equivalent to the following pubsub subscription exchange:</p>
  <p class="caption">Example 17. Entity subscribes to a collection node</p>
<div class="indent"><pre>
&lt;iq type='set'
    from='nurse@capulet.com/chamber'
    to='juliet@capulet.com
    id='collsub'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;subscribe jid='nurse@capulet.com'/&gt;
    &lt;options&gt;
      &lt;x xmlns='jabber:x:data'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
          &lt;value&gt;http://jabber.org/protocol/pubsub#subscribe_options&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#subscription_type'&gt;
          &lt;value&gt;items&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#subscription_depth'&gt;
          &lt;value&gt;all&lt;/value&gt;
        &lt;/field&gt;
      &lt;/x&gt;
   &lt;/options&gt;
 &lt;/pubsub&gt;
&lt;/iq&gt;

&lt;iq type='result' from='juliet@capulet.com' to='nurse@capulet.com/chamber' id='collsub'/&gt;
  </pre></div>
  <p class="" style="">Therefore, because both nurse@capulet.com and romeo@montague.net have presence subscriptions to juliet@capulet.com, they will receive all notifications generated by the "http://jabber.org/protocol/tune" and "http://jabber.org/protocol/activity" nodes.</p>
  <p class="" style="">In addition, because romeo@montague.net is in the "Friends" group in Juliet's roster, he will receive the foregoing notifications as well as notifications generated by the "http://jabber.org/protocol/geoloc" node.</p>
<h2>8.
       <a name="owner-publish">Account Owner Publishing</a>
</h2>
  <p class="" style="">Consider what happens when the account owner publishes an item to a node:</p>
  <p class="caption">Example 18. Account owner publishes item</p>
<div class="indent"><pre>
&lt;iq from='juliet@capulet.com/balcony' type='set' id='pub1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;publish node='http://jabber.org/protocol/tune'&gt;
      &lt;item&gt;
        &lt;tune xmlns='http://jabber.org/protocol/tune'&gt;
          &lt;artist&gt;Gerald Finzi&lt;/artist&gt;
          &lt;title&gt;Introduction (Allegro vigoroso)&lt;/title&gt;
          &lt;source&gt;Music for "Love's Labors Lost" (Suite for small orchestra)&lt;/source&gt;
          &lt;track&gt;1&lt;/track&gt;
          &lt;length&gt;255&lt;/length&gt;
        &lt;/tune&gt;
      &lt;/item&gt;
    &lt;/publish&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="" style="">Now the account owner's server generates notifications and sends them to all subscribers (in this case, all three entities):</p>
  <p class="caption">Example 19. Server sends notification to subscribers</p>
<div class="indent"><pre>
&lt;message from='juliet@capulet.com'
         to='benvolio@montague.net'
         type='headline'
         id='foo'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='http://jabber.org/protocol/tune'&gt;
      &lt;item&gt;
        &lt;tune xmlns='http://jabber.org/protocol/tune'&gt;
          &lt;artist&gt;Gerald Finzi&lt;/artist&gt;
          &lt;title&gt;Introduction (Allegro vigoroso)&lt;/title&gt;
          &lt;source&gt;Music for "Love's Labors Lost" (Suite for small orchestra)&lt;/source&gt;
          &lt;track&gt;1&lt;/track&gt;
          &lt;length&gt;255&lt;/length&gt;
        &lt;/tune&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;

&lt;message from='juliet@capulet.com'
         to='nurse@capulet.com/chamber'
         type='headline'
         id='foo'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='http://jabber.org/protocol/tune'&gt;
      &lt;item&gt;
        &lt;tune xmlns='http://jabber.org/protocol/tune'&gt;
          &lt;artist&gt;Gerald Finzi&lt;/artist&gt;
          &lt;title&gt;Introduction (Allegro vigoroso)&lt;/title&gt;
          &lt;source&gt;Music for "Love's Labors Lost" (Suite for small orchestra)&lt;/source&gt;
          &lt;track&gt;1&lt;/track&gt;
          &lt;length&gt;255&lt;/length&gt;
        &lt;/tune&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/event&gt;
  &lt;addresses xmlns='http://jabber.org/protocol/address'&gt;
    &lt;address type='replyto' jid='juliet@capulet.com/balcony'/&gt;
  &lt;/addresses&gt;
&lt;/message&gt;

&lt;message from='juliet@capulet.com'
         to='romeo@montague.net/home'
         type='headline'
         id='foo'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='http://jabber.org/protocol/tune'&gt;
      &lt;item&gt;
        &lt;tune xmlns='http://jabber.org/protocol/tune'&gt;
          &lt;artist&gt;Gerald Finzi&lt;/artist&gt;
          &lt;title&gt;Introduction (Allegro vigoroso)&lt;/title&gt;
          &lt;source&gt;Music for "Love's Labors Lost" (Suite for small orchestra)&lt;/source&gt;
          &lt;track&gt;1&lt;/track&gt;
          &lt;length&gt;255&lt;/length&gt;
        &lt;/tune&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/event&gt;
  &lt;addresses xmlns='http://jabber.org/protocol/address'&gt;
    &lt;address type='replyto' jid='juliet@capulet.com/balcony'/&gt;
  &lt;/addresses&gt;
&lt;/message&gt;
  </pre></div>
  <p class="" style="">The server MUST set the 'from' address on the notification to the bare JID (&lt;node@domain.tld&gt;) of the account owner (in this example, "juliet@capulet.com"). When sending notifications to entities that have presence subscription to the account owner, the server SHOULD include an <span class="ref" style="">Extended Stanza Addressing</span>  [<a href="#nt-id2260615">13</a>] "replyto" extension specifying the publishing resource (in this example, "juliet@capulet.com/balcony"); this enables the subscriber's client to differentiate between information received from each of an account owner's resources (for example, different resources may be in different places and therefore may need to specify distinct geolocation data). However, a server MUST NOT include the "replyto" address when sending notifications to entities that do not have presence subscriptions to the account owner. In addition, any errors related to the notification MUST be directed to the JID of the 'from' address on the notification (i.e., the bare JID) so that bounce processing can be handled by the PEP service rather than by the publishing client.</p>
  <p class="" style="">For further rules regarding notifications, see the <a href="#notifications">Contact Notification Filtering</a> and <a href="#notifications">Generating Notifications</a> sections of this document.</p>
<h2>9.
       <a name="contact-filter">Contact Notification Filtering</a>
</h2>
  <p class="" style="">A contact with a presence subscription to the account owner may not want to receive notifications from all nodes with an access model of "open" or "presence" (or "roster"). A contact MAY signal its preferences to the account owner's server by including <span class="ref" style="">Entity Capabilities</span>  [<a href="#nt-id2260706">14</a>] information that specifies the namespaces for which the contact wishes to receive notifications.</p>
  <p class="" style="">In order to make this possible, all possible payload namespaces can be appended with the string "+notify" to indicate that the contact wishes to receive notifications for the payload format. Thus if Romeo wants to receive notifications for activity data and geolocation data but not tune data, his client would advertise support for the following namespaces in the disco#info results it sends:</p>
  <ul>
    <li>http://jabber.org/protocol/activity</li>
    <li>http://jabber.org/protocol/activity+notify</li>
    <li>http://jabber.org/protocol/geoloc</li>
    <li>http://jabber.org/protocol/geoloc+notify</li>
  </ul>
  <p class="" style="">This set of namespaces would then be advertised as a <span style="font-weight: bold">JEP-0115</span> "ext" value, such as the following:</p>
  <p class="caption">Example 20. Contact sends presence with caps</p>
<div class="indent"><pre>
&lt;presence from='romeo@montague.net/orchard'&gt;
  &lt;c xmlns='http://jabber.org/protocol/caps'
     node='http://www.chatopus.com/'
     ver='2.1'
     ext='foobar pres+'/&gt;
&lt;/presence&gt;
  </pre></div>
  <p class="" style="">Note: In <span style="font-weight: bold">JEP-0115</span>, the "ext" values are opaque strings with no semantic meaning.</p>
  <p class="" style="">It is the responsibility of the account owner's server to cache <span style="font-weight: bold">JEP-0115</span> information (including "ext" values and their associated namespaces). When the server receives presence from a contact, it MUST check that presence information for entity capabilities data and correlate that data with the supported and desired namespaces for the contact's client. The server MUST NOT send notifications related to any data formats that the contact's client has not asked for via the relevant "namespace+notify" disco#info feature. This enables a client to turn off all notifications (e.g., because of bandwidth restrictions) and to easily receive all desired data formats simply by adding support for the appropriate "namespace+notify" combination in its disco#info results and client capabililies. However, it also implies that a client can request notifications only on a global basis and cannot request, say, mood information only from certain contacts in the user's roster. Developer consensus is that this is an acceptable tradeoff. Also, note that this works only if the account owner has a presence subscription to the contact.</p>
  <p class="" style="">Some examples may help to illustrate the concept. Here we show presence generated by two of the contacts listed above (benvolio@montague.net does have any presence subscriptions to or from juliet@capulet.com and therefore is not involved in these protocol flows).</p>
  <p class="caption">Example 21. Presence with caps</p>
<div class="indent"><pre>
&lt;presence from='nurse@capulet.com/chamber'&gt;
  &lt;c xmlns='http://jabber.org/protocol/caps'
     node='http://exodus.jabberstudio.org/caps'
     ver='0.9'
     ext='asdf fdsa bar baz'/&gt;
&lt;/presence&gt;

&lt;presence from='romeo@montague.net/orchard'&gt;
  &lt;c xmlns='http://jabber.org/protocol/caps'
     node='http://www.chatopus.com/'
     ver='2.1'
     ext='foobar pres+'/&gt;
&lt;/presence&gt;
  </pre></div>
  <p class="" style="">We assume that Juliet's server doesn't know anything about these capabilities, so it sends service discovery information requests to each of the clients on Juliet's behalf (realistically, the capulet.com server will quickly build up a cache of client capabilities so will not need to send these services discovery requests):</p>
  <p class="caption">Example 22. Account server queries contact</p>
<div class="indent"><pre>
&lt;iq from='juliet@capulet.com'
    to='nurse@capulet.com/chamber'
    type='get'
    id='disco123'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;

&lt;iq from='nurse@capulet.com/chamber'
    to='juliet@capulet.com'
    type='result'
    id='disco123'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;feature var='http://jabber.org/protocol/tune'/&gt;
    &lt;feature var='http://jabber.org/protocol/tune+notify'/&gt;
    &lt;feature var='http://jabber.org/protocol/activity'/&gt;
    &lt;feature var='http://jabber.org/protocol/activity+notify'/&gt;
    &lt;feature var='http://jabber.org/protocol/geoloc'/&gt;
    &lt;feature var='http://jabber.org/protocol/geoloc+notify'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="caption">Example 23. Account server queries contact</p>
<div class="indent"><pre>
&lt;iq from='juliet@capulet.com'
    to='romeo@montague.net/orchard'
    type='get'
    id='disco234'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;

&lt;iq from='romeo@montague.net/orchard'
    to='juliet@capulet.com'
    type='result'
    id='disco234'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;feature var='http://jabber.org/protocol/tune'/&gt;
    &lt;feature var='http://jabber.org/protocol/activity'/&gt;
    &lt;feature var='http://jabber.org/protocol/geoloc'/&gt;
    &lt;feature var='http://jabber.org/protocol/geoloc+notify'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="" style="">Now we revisit account owner publication and server generation of notifications, with filtering enabled because the server has caps information:</p>
  <ul>
    <li><p class="" style="">If Juliet publishes a tune item to the open-access "http://jabber.org/protocol/tune" node, her server will send notifications to &lt;benvolio@montague.net&gt; (bare JID) and to &lt;nurse@capulet.com/chamber&gt; (full JID) but not to &lt;romeo@montague.net/orchard&gt;.</p></li>
    <li><p class="" style="">If Juliet publishes an activity item to the presence-access "http://jabber.org/protocol/activity" node, her server will send notifications only to &lt;nurse@capulet.com/chamber&gt;.</p></li>
    <li><p class="" style="">If Juliet publishes a geolocation item to the roster-access "http://jabber.org/protocol/geolco" node, her server will send notifications only to &lt;romeo@montague.net/orchard&gt;.</p></li>
  </ul>
<h2>10.
       <a name="notifications">Generating Notifications</a>
</h2>
  <div class="indent">
<h3>10.1 <a name="notifications-num">Number of Notifications</a>
</h3>
    <ol start="1" type="">
      <li><p class="" style="">If a subscriber subscribed using a full JID (&lt;node@domain.tld/resource&gt;), domain identifier (&lt;domain.tld&gt;), or domain plus resource (&lt;domain.tld/resource&gt;), a PEP service MUST send one notification only, addressed to the subscribed JID.</p></li>
      <li><p class="" style="">If a subscriber subscribed using a bare JID (&lt;node@domain.tld&gt;) and a PEP service has presence information about the subscriber, the service MUST send one notification to the full JID (&lt;node@domain.tld/resource&gt;) of each of the subscriber's available resources that have specified non-negative presence priority.  [<a href="#nt-id2261158">15</a>]</p></li>
      <li><p class="" style="">If a subscriber subscribed using a bare JID (&lt;node@domain.tld&gt;) and a PEP service does not have presence information about the subscriber, it MUST send at most one notification, addressed to the bare JID (&lt;node@domain.tld&gt;) of the subscriber.</p></li>
    </ol>
  </div>
  <div class="indent">
<h3>10.2 <a name="notifications-when">When to Generate Notifications</a>
</h3>
    <ol start="1" type="">
      <li><p class="" style="">When an account owner publishes an item to a node, a PEP service MUST generate a notification and send it to all subscribers (where the number of notifications is determined by the foregoing rules).</p></li>
      <li><p class="" style="">When a PEP service successfully processes a new subscription, it MUST generate a notification containing the last published item for that node and send it to the subscribing JID (where the number of notifications is determined by the foregoing rules).</p></li>
      <li><p class="" style="">When a PEP service receives initial presence information from a subscriber's resource with a non-negative priority, it MUST generate a notification containing the last published item for that node and send it to the newly-available resource.</p></li>
      <li><p class="" style="">As an exception to the foregoing MUST rules, a PEP service MAY choose not to send notifications to a subscriber if the subscribed JID is a bare JID (&lt;node@domain.tld&gt;) and the service does not have presence information about the subscriber.  [<a href="#nt-id2260994">16</a>]</p></li>
      <li><p class="" style="">As an exception to the foregoing MUST rules, a PEP service MAY choose not to send notifications to a particular resource for a subscriber if it knows via <span style="font-weight: bold">Entity Capabilities</span> that the resource does not support PEP or does not support the payload namespace associated with a particular node.</p></li>
      <li><p class="" style="">As an exception to the foregoing MUST rules, a PEP service MUST NOT send notifications to a subscriber if the user has blocked the subscriber from receiving all or any kinds of stanza (presence, message, IQ, or any combination thereof) using privacy lists as specified in <span style="font-weight: bold">XMPP IM</span>.</p></li>
    </ol>
  </div>
<h2>11.
       <a name="last">Sending the Last Published Item</a>
</h2>
  <p class="" style="">As described in the <a href="#notifications">Generating Notifications</a> section of this document, a PEP service MUST send the last published item to all new subscribers and to all newly-available resources for each subscriber.  [<a href="#nt-id2261150">17</a>]</p>
  <p class="caption">Example 24. Subscriber sends presence from newly-available resource</p>
<div class="indent"><pre>
&lt;presence from='romeo@montague.net/orchard'/&gt;
  </pre></div>
  <p class="caption">Example 25. Subscriber's server sends presence from newly-available resource to publisher's bare JID (i.e., PEP service)</p>
<div class="indent"><pre>
&lt;presence from='romeo@montague.net/orchard' to='juliet@capulet.com'/&gt;
  </pre></div>
  <p class="caption">Example 26. PEP service sends last published item to newly-available resource</p>
<div class="indent"><pre>
&lt;message from='juliet@capulet.com'
         to='romeo@montague.net/orchard'
         type='headline'
         id='foo'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='http://jabber.org/protocol/tune'&gt;
      &lt;item&gt;
        &lt;tune xmlns='http://jabber.org/protocol/tune'&gt;
          &lt;artist&gt;Gerald Finzi&lt;/artist&gt;
          &lt;title&gt;Introduction (Allegro vigoroso)&lt;/title&gt;
          &lt;source&gt;Music for "Love's Labors Lost" (Suite for small orchestra)&lt;/source&gt;
          &lt;track&gt;1&lt;/track&gt;
          &lt;length&gt;255&lt;/length&gt;
        &lt;/tune&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/event&gt;
  &lt;x xmlns='jabber:x:delay' stamp='20031213T23:58:37'/&gt;
&lt;/message&gt;
  </pre></div>
<h2>12.
       <a name="defaults">Recommended Defaults</a>
</h2>
  <p class="" style="">A PEP service MUST support the node discovery, node creation, node deletion, publish item, subscribe, unsubscribe, and items retrieval use cases specified in <span style="font-weight: bold">JEP-0060</span>, and MAY support other use cases according to implementation decisions or deployment policies.</p>
  <p class="" style="">A PEP service MUST support the "owner" and "subscriber" affiliations but SHOULD NOT support other affiliations.</p>
  <p class="" style="">The default access model for a PEP service SHOULD be "presence" for IM servers and SHOULD be "open" for non-IM servers; a PEP service associated with an IM server SHOULD also support the "roster" access model; a PEP service MAY also support the "authorize" and "whitelist" access models.</p>
  <p class="" style="">A PEP service SHOULD use the following "smart defaults" for every node:</p>
  <ol start="1" type="">
    <li>Deliver payloads (no notification-only nodes).</li>
    <li>No item persistence (all nodes are transient).</li>
    <li>No delete-items.</li>
    <li>No get-affiliations.</li>
    <li>No purge-items.</li>
    <li>No node configuration.</li>
    <li>No node metadata.</li>
    <li>No configuration of subscription options.</li>
    <li>No subscription IDs.</li>
  </ol>
  <p class="" style="">A PEP service MUST treat the owner-publisher's bare JID (&lt;node@domain.tld&gt;) as a collection node (i.e., as the root collection node for the account's virtual pubsub service), but SHOULD NOT support any other collection nodes.</p>
  <p class="" style="">A PEP service SHOULD NOT support instant nodes, since the "one node per namespace" rule makes instant nodes unnecessary.</p>
<h2>13.
       <a name="imple">Implementation Notes</a>
</h2>
  <div class="indent">
<h3>13.1 <a name="impl-subscriptions">Cancelling Subscriptions</a>
</h3>
    <p class="" style="">In order to ensure appropriate access to information published at nodes of type "presence" and "roster"", a PEP service MUST re-calculate access controls when:</p>
    <ol start="1" type="">
      <li>A presence subscription state changes (e.g., when a subscription request is approved).</li>
      <li>A roster item is modified (e.g., when the item is moved to a new roster group).</li>
    </ol>
    <p class="" style="">If the modification results in a loss of access, the service MUST cancel the entity's subscription and SHOULD send a message to the (former) subscriber informing it of the cancellation. For information about the format of messages sent to notify subscribers of subscription cancellation, see the "Notification of Subscription Denial or Cancellation" section of <span style="font-weight: bold">JEP-0060</span>.</p>
  </div>
<h2>14.
       <a name="security">Security Considerations</a>
</h2>
  <p class="" style="">A PEP service MAY enforce additional privacy and security policies when determining whether an entity is allowed to subscribe to a node or retrieve items from a node; however, any such policies shall be considered specific to an implementation or deployment and are out of scope for this document.</p>
<h2>15.
       <a name="iana">IANA Considerations</a>
</h2>
  <p class="" style="">This JEP requires no interaction with the <span class="ref" style="">Internet Assigned Numbers Authority (IANA)</span>  [<a href="#nt-id2261434">18</a>].</p>
<h2>16.
       <a name="registrar">Jabber Registrar Considerations</a>
</h2>
  <div class="indent">
<h3>16.1 <a name="registrar-disco">Service Discovery Category/Type</a>
</h3>
    <p class="" style="">The Jabber Registrar includes a category of "pubsub" in its registry of Service Discovery identities (see &lt;<a href="http://www.jabber.org/registrar/disco-features.html">http://www.jabber.org/registrar/disco-features.html</a>&gt;); as a result of this JEP, the Registrar shall add a type of "pep" to that category.</p>
    <p class="" style="">The registry submission is as follows:</p>
    <p class="caption"></p>
<div class="indent"><pre>
&lt;category&gt;
  &lt;name&gt;pubsub&lt;/name&gt;
  &lt;type&gt;
    &lt;name&gt;pep&lt;/name&gt;
    &lt;desc&gt;
      A personal eventing service that supports the 
      publish-subscribe subset defined in JEP-0163.
    &lt;/desc&gt;
    &lt;doc&gt;JEP-0163&lt;/doc&gt;
  &lt;/type&gt;
&lt;/category&gt;
    </pre></div>
  </div>
<h2>17.
       <a name="schema">XML Schema</a>
</h2>
  <p class="" style="">Because the Personal Eventing Protocol is all and only a subset of Publish-Subscribe, the schemas defined in <span style="font-weight: bold">JEP-0060</span> apply to PEP as well.</p>
<h2>18.
       <a name="ack">Acknowledgements</a>
</h2>
  <p class="" style="">The authors wish to thank the participants in the XMPP Interoperability Testing Event held July 24 and 25, 2006, who provided valuable feedback that resulted in radical simplification of the protocol.</p>
<p><hr></p>
<a name="notes"></a><h2>Notes</h2>
<div class="indent">
<p><a name="nt-id2250971">1</a>. JEP-0060: Publish-Subscribe &lt;<a href="http://www.jabber.org/jeps/jep-0060.html">http://www.jabber.org/jeps/jep-0060.html</a>&gt;.</p>
<p><a name="nt-id2250986">2</a>. JEP-0080: User Geolocation &lt;<a href="http://www.jabber.org/jeps/jep-0080.html">http://www.jabber.org/jeps/jep-0080.html</a>&gt;.</p>
<p><a name="nt-id2251006">3</a>. JEP-0107: User Mood &lt;<a href="http://www.jabber.org/jeps/jep-0107.html">http://www.jabber.org/jeps/jep-0107.html</a>&gt;.</p>
<p><a name="nt-id2251030">4</a>. JEP-0108: User Activity &lt;<a href="http://www.jabber.org/jeps/jep-0108.html">http://www.jabber.org/jeps/jep-0108.html</a>&gt;.</p>
<p><a name="nt-id2259616">5</a>. JEP-0118: User Tune &lt;<a href="http://www.jabber.org/jeps/jep-0118.html">http://www.jabber.org/jeps/jep-0118.html</a>&gt;.</p>
<p><a name="nt-id2251018">6</a>. Currently, many "extended presence" formats are sent using the &lt;presence/&gt; stanza type; however, this overloads presence, results in unnecessary presence traffic, and does not provide fine-grained control over access. The use of publish-subscribe rather than presence is therefore preferable.</p>
<p><a name="nt-id2259651">7</a>. RFC 3921: Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence &lt;<a href="http://www.ietf.org/rfc/rfc3921.txt">http://www.ietf.org/rfc/rfc3921.txt</a>&gt;.</p>
<p><a name="nt-id2259880">8</a>. JEP-0115: Entity Capabilities &lt;<a href="http://www.jabber.org/jeps/jep-0115.html">http://www.jabber.org/jeps/jep-0115.html</a>&gt;.</p>
<p><a name="nt-id2259847">9</a>. JEP-0134: Protocol Design Guidelines &lt;<a href="http://www.jabber.org/jeps/jep-0134.html">http://www.jabber.org/jeps/jep-0134.html</a>&gt;.</p>
<p><a name="nt-id2259964">10</a>. JEP-0049: Private XML Storage &lt;<a href="http://www.jabber.org/jeps/jep-0049.html">http://www.jabber.org/jeps/jep-0049.html</a>&gt;.</p>
<p><a name="nt-id2260050">11</a>. JEP-0030: Service Discovery &lt;<a href="http://www.jabber.org/jeps/jep-0030.html">http://www.jabber.org/jeps/jep-0030.html</a>&gt;.</p>
<p><a name="nt-id2260104">12</a>. The authors considered simpler node creation semantics, for example behavior in which a service automatically creates a given node when an account owner attempts to publish to it. Although this has the virtue of being similar to, say, room creation in <span style="font-weight: bold">JEP-0045</span>, it seriously complicates the task of determining the node access model (so much so that the publish semantics would in the end closely resemble the existing node creation semantics).</p>
<p><a name="nt-id2260615">13</a>. JEP-0033: Extended Stanza Addressing &lt;<a href="http://www.jabber.org/jeps/jep-0033.html">http://www.jabber.org/jeps/jep-0033.html</a>&gt;.</p>
<p><a name="nt-id2260706">14</a>. JEP-0115: Entity Capabilities &lt;<a href="http://www.jabber.org/jeps/jep-0115.html">http://www.jabber.org/jeps/jep-0115.html</a>&gt;.</p>
<p><a name="nt-id2261158">15</a>. If the only presence information received by the service is from resources that have specified negative priorities, the service MUST NOT send any notifications.</p>
<p><a name="nt-id2260994">16</a>. If the only presence information received by the service is from resources that have specified negative priorities, the service MUST NOT send any notifications.</p>
<p><a name="nt-id2261150">17</a>. That is, the default value of the "pubsub#send_last_published_item" node configuration field must be "on_sub_and_presence"; this behavior essentially mimics the functionality of presence as defined in <span style="font-weight: bold">XMPP IM</span>.</p>
<p><a name="nt-id2261434">18</a>. The Internet Assigned Numbers Authority (IANA) is the central coordinator for the assignment of unique parameter values for Internet protocols, such as port numbers and URI schemes. For further information, see &lt;<a href="http://www.iana.org/">http://www.iana.org/</a>&gt;.</p>
</div>
<p><hr></p>
<a name="revs"></a><h2>Revision History</h2>
<div class="indent">
<h4>Version 0.12 (2006-08-01)</h4>
<div class="indent">
<p class="" style="">Simplified the subscription process using XMPP presence and entity capabilities.</p> (psa)
    </div>
<h4>Version 0.11 (2006-07-20)</h4>
<div class="indent">
<p class="" style="">Clarified rules regarding number of notifications and when to generate notifications; corrected several errors in the text and examples.</p> (psa)
    </div>
<h4>Version 0.10 (2006-07-07)</h4>
<div class="indent">
<p class="" style="">Updated to reflect version 1.8 of JEP-0060.</p> (psa)
    </div>
<h4>Version 0.9 (2006-06-15)</h4>
<div class="indent">
<p class="" style="">Updated to reflect use of data forms in JEP-0060.</p> (psa)
    </div>
<h4>Version 0.8 (2006-04-10)</h4>
<div class="indent">
<p class="" style="">Clarified terminology and defaults.</p> (psa)
    </div>
<h4>Version 0.7 (2006-04-10)</h4>
<div class="indent">
<p class="" style="">Specified that notifications are to be sent from bare JID, not full JID.</p> (psa)
    </div>
<h4>Version 0.6 (2006-04-10)</h4>
<div class="indent">
<p class="" style="">Updated to reflect pubsub changes; clarified business rules for generation of notifications and cancellation of subscriptions.</p> (psa)
    </div>
<h4>Version 0.5 (2006-03-09)</h4>
<div class="indent">
<p class="" style="">Modified roster groups example to use jabber:x:data; added note about advertising client support for PEP.</p> (psa)
    </div>
<h4>Version 0.4 (2006-02-02)</h4>
<div class="indent">
<p class="" style="">Specified rules for generation of notifications, including use of presence in determining address of intended recipient for notifications and sending of last published item on receipt of presence information; changed name to Personal Eventing Protocol; specified service discovery identity of pubsub/pep; removed section on service types; added Kevin Smith as co-author.</p> (psa/ks)
    </div>
<h4>Version 0.3 (2006-01-30)</h4>
<div class="indent">
<p class="" style="">Specified that a service may enforce additional privacy and security policies; specified that an account owner must always be allowed to subscribe and to retrieve items; specified that an implementation should enforce access modifications resulting from roster state changes.</p> (psa)
    </div>
<h4>Version 0.2 (2006-01-11)</h4>
<div class="indent">
<p class="" style="">Updated to reflect proposed JEP-0060 modifications.</p> (psa)
    </div>
<h4>Version 0.1 (2005-11-02)</h4>
<div class="indent">
<p class="" style="">Initial JEP version.</p> (psa)
    </div>
<h4>Version 0.0.2 (2005-10-25)</h4>
<div class="indent">
<p class="" style="">Added more details and examples.</p> (psa)
    </div>
<h4>Version 0.0.1 (2005-10-24)</h4>
<div class="indent">
<p class="" style="">First draft.</p> (psa)
    </div>
</div>
<p><hr></p>
<p>END</p>
</body>
</html>
